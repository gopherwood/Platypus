(function(){var d={};PBS=this.PBS||{};PBS.KIDS=this.PBS.KIDS||{};PBS.KIDS.platformer=d;d.settings={global:{autoLoad:true,initialScene:"load",fps:60,rootElement:"root",aspectRatio:1.333,nativeAssetResolution:960,resizeFont:true},aspects:[{ogg:["firefox","opera","chrome"],m4aCombined:["android","silk","ipod","ipad","iphone"],mp3:["msie","safari","trident"]}],assets:{walk:{id:"walk",src:{ogg:"a/walk.ogg",mp3:"a/walk.mp3",m4aCombined:{assetId:"combined",src:"a/combined.m4a",data:{offset:3200,length:330}}}},jump:{id:"jump",src:{ogg:"a/jump.ogg",mp3:"a/jump.mp3",m4aCombined:{assetId:"combined",src:"a/combined.m4a",data:{offset:1500,length:250}}}},buttons:{id:"buttons",src:"i/buttons.png"},mookie:{id:"mookie",src:"i/mookie.png",data:{rows:4,columns:4}},sprites:{id:"sprites",src:"i/game-sprites.png",data:{rows:4,columns:4}},tiles:{id:"tiles",src:"i/tiles.png",data:{rows:2,columns:2}},"title-screen":{id:"title-screen",src:"i/title-screen.png"},objects:{id:"objects",src:"i/objects.png",data:{rows:1,columns:4}},entities:{id:"entities",src:"i/entities.png",data:{rows:2,columns:2}}},includes:{CreateJS:{id:"CreateJS",src:"http://code.createjs.com/createjs-2013.09.25.min.js"},Box2d:{id:"Box2d",src:"../game/Box2dWeb-2.1.a.3.min.js"},Browser:{id:"Browser",src:"../engine/browser.js"},Main:{id:"Main",src:"../engine/main.js"},ButtonCSS:{id:"ButtonCSS",src:"../game/css/button.css"},MainCSS:{id:"MainCSS",src:"../game/css/main.css"},GameCSS:{id:"GameCSS",src:"../game/css/game.css"},"GUI CSS":{id:"GUI CSS",src:"../game/css/gui.css"},FullScreenCSS:{id:"FullScreenCSS",src:"../game/css/fullscreen.css"}},classes:{Game:{id:"Game",src:"../engine/game.js"},ComponentFactory:{id:"ComponentFactory",src:"../engine/factory.js"},Entity:{id:"Entity",src:"../engine/entity.js"},Scene:{id:"Scene",src:"../engine/scene.js"},"Collision-Shape":{id:"Collision-Shape",src:"../engine/collision-shape.js"},"Collision-Data-Container":{id:"Collision-Data-Container",src:"../engine/collision-data-container.js"},AABB:{id:"AABB",src:"../engine/aabb.js"},Vector2D:{id:"Vector2D",src:"../engine/vector2D.js"}},components:{"asset-loader":{id:"asset-loader",src:"../engine/components/asset-loader.js"},"enable-ios-audio":{id:"enable-ios-audio",src:"../engine/components/enable-ios-audio.js"},"handler-collision":{id:"handler-collision",src:"../engine/components/handler-collision.js"},"handler-box2d":{id:"handler-box2d",src:"../engine/components/handler-box2d.js"},"handler-controller":{id:"handler-controller",src:"../engine/components/handler-controller.js"},"tiled-loader":{id:"tiled-loader",src:"../engine/components/tiled-loader.js"},"handler-render-createjs":{id:"handler-render-createjs",src:"../engine/components/handler-render-createjs.js"},"handler-render-dom":{id:"handler-render-dom",src:"../engine/components/handler-render-dom.js"},"handler-ai":{id:"handler-ai",src:"../engine/components/handler-ai.js"},"handler-logic":{id:"handler-logic",src:"../engine/components/handler-logic.js"},camera:{id:"camera",src:"../engine/components/camera.js"},"collision-group":{id:"collision-group",src:"../engine/components/collision-group.js"},audio:{id:"audio",src:"../engine/components/audio.js"},"broadcast-events":{id:"broadcast-events",src:"../engine/components/broadcast-events.js"},"change-scene":{id:"change-scene",src:"../engine/components/change-scene.js"},"dom-element":{id:"dom-element",src:"../engine/components/dom-element.js"},"entity-container":{id:"entity-container",src:"../engine/components/entity-container.js"},"entity-controller":{id:"entity-controller",src:"../engine/components/entity-controller.js"},fullscreen:{id:"fullscreen",src:"../engine/components/fullscreen.js"},"render-debug":{id:"render-debug",src:"../engine/components/render-debug.js"},"render-tiles":{id:"render-tiles",src:"../engine/components/render-tiles.js"},"render-animation":{id:"render-animation",src:"../engine/components/render-animation.js"},"render-image":{id:"render-image",src:"../engine/components/render-image.js"},"logic-button":{id:"logic-button",src:"../engine/components/logic-button.js"},"logic-directional-movement":{id:"logic-directional-movement",src:"../engine/components/logic-directional-movement.js"},"logic-gravity":{id:"logic-gravity",src:"../engine/components/logic-gravity.js"},"logic-jump":{id:"logic-jump",src:"../engine/components/logic-jump.js"},counter:{id:"counter",src:"../engine/components/counter.js"},"logic-timer":{id:"logic-timer",src:"../engine/components/logic-timer.js"},"logic-portal":{id:"logic-portal",src:"../engine/components/logic-portal.js"},"collision-basic":{id:"collision-basic",src:"../engine/components/collision-basic.js"},"collision-tiles":{id:"collision-tiles",src:"../engine/components/collision-tiles.js"},"collision-box2d":{id:"collision-box2d",src:"../engine/components/collision-box2d.js"},"logic-fps-counter":{id:"logic-fps-counter",src:"../engine/components/logic-fps-counter.js"},"render-gui":{id:"render-gui",src:"../game/components/render-gui.js"},"render-counter":{id:"render-counter",src:"../game/components/render-counter.js"},"render-clock":{id:"render-clock",src:"../game/components/render-clock.js"},"logic-hero":{id:"logic-hero",src:"../game/components/logic-hero.js"},"logic-gui":{id:"logic-gui",src:"../game/components/logic-gui.js"}},entities:{"action-layer":{id:"action-layer",components:[{type:"handler-controller"},{type:"handler-ai"},{type:"handler-logic"},{type:"handler-box2d"},{type:"camera",width:640},{type:"handler-render-createjs",autoClear:true},{type:"entity-container"},{type:"tiled-loader",level:"level-1",entityPositionX:"center",entityPositionY:"center"}]},"desktop-interface-layer":{id:"desktop-interface-layer",filter:{excludes:["mobile"]},components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"button-mute"},{type:"button-fullscreen"},{type:"button-play"},{type:"gui"},{type:"fps-counter"}],childEvents:["time-elapsed"]}]},"multitouch-interface-layer":{id:"multitouch-interface-layer",filter:{includes:["mobile","multitouch"]},components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"button-fullscreen"},{type:"button-jump"},{type:"button-pickaxe"},{type:"button-left"},{type:"button-right"},{type:"gui"},{type:"fps-counter"}],childEvents:["gui-gem-collected","time-elapsed"]}]},"touch-interface-layer":{id:"touch-interface-layer",filter:{includes:["mobile","touch"],excludes:["multitouch"]},components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"button-fullscreen"},{type:"button-jump-left"},{type:"button-jump-right"},{type:"button-jump",properties:{className:"game-button jump-center-button"}},{type:"button-left"},{type:"button-right"},{type:"gui"},{type:"fps-counter"}],childEvents:["time-elapsed"]}]},"tile-layer":{id:"tile-layer",components:[{type:"render-tiles",spriteSheet:"import",imageMap:"import"},{type:"collision-tiles",collisionMap:"import"}]},"render-layer":{id:"render-layer",components:[{type:"render-tiles",spriteSheet:"import",imageMap:"import"}]},"collision-layer":{id:"collision-layer",components:[{type:"collision-tiles",collisionMap:"import"}]},"button-fullscreen":{id:"button-fullscreen",components:[{type:"dom-element",element:"div",className:"button-fullscreen",onmouseup:"toggle-fullscreen",ontouchend:"toggle-fullscreen"},{type:"fullscreen"}]},"button-jump":{id:"button-jump",components:[{type:"dom-element",element:"div",className:"game-button jump-button",onmousedown:"start-jump",ontouchstart:"start-jump",onmouseup:"stop-jump",ontouchend:"stop-jump",ontouchcancel:"stop-jump"},{type:"broadcast-events",events:{"start-jump":"button-jump:down","stop-jump":"button-jump:up"}}]},"button-jump-left":{id:"button-jump-left",components:[{type:"dom-element",element:"div",className:"game-button jump-left-button",onmousedown:"start-jump",ontouchstart:"start-jump",onmouseup:"stop-jump",ontouchend:"stop-jump",ontouchcancel:"stop-jump"},{type:"broadcast-events",events:{"start-jump":["button-jump:down","button-left:down"],"stop-jump":["button-jump:up","button-left:up"]}}]},"button-jump-right":{id:"button-jump-right",components:[{type:"dom-element",element:"div",className:"game-button jump-right-button",onmousedown:"start-jump",ontouchstart:"start-jump",onmouseup:"stop-jump",ontouchend:"stop-jump",ontouchcancel:"stop-jump"},{type:"broadcast-events",events:{"start-jump":["button-jump:down","button-right:down"],"stop-jump":["button-jump:up","button-right:up"]}}]},"button-left":{id:"button-left",components:[{type:"dom-element",element:"div",className:"game-button go-left-button",onmousedown:"start-move",ontouchstart:"start-move",onmouseup:"stop-move",ontouchend:"stop-move",ontouchcancel:"stop-move"},{type:"broadcast-events",events:{"start-move":"button-left:down","stop-move":"button-left:up"}}]},"button-play-game":{id:"button-play-game",components:[{type:"dom-element",element:"div",innerHTML:"Play Game",className:"menu-button",onmouseup:"new-scene",ontouchend:"new-scene"},{type:"change-scene",scene:"scene-level-1",transition:"fade-to-black"}]},"button-right":{id:"button-right",components:[{type:"dom-element",element:"div",className:"game-button go-right-button",onmousedown:"start-move",ontouchstart:"start-move",onmouseup:"stop-move",ontouchend:"stop-move",ontouchcancel:"stop-move"},{type:"broadcast-events",events:{"start-move":"button-right:down","stop-move":"button-right:up"}}]},"button-mute":{id:"button-mute",components:[{type:"logic-button",toggle:true,state:"pressed"},{type:"dom-element",element:"div",className:"game-button mute-button",updateClassName:true,onmouseup:["audio-mute-toggle","mouseup"],ontouchend:["audio-mute-toggle","mouseup"]},{type:"audio"}],properties:{x:10,y:10,z:400,width:400,height:400}},hero:{id:"hero",components:[{type:"entity-controller",controlMap:{"button-jump":"jump","key:z":"jump","key:space":"jump","key:up-arrow":"jump","key:w":"jump","key:left-arrow":"go-left","key:a":"go-left","button-left":"go-left","key:right-arrow":"go-right","key:d":"go-right","button-right":"go-right"}},{type:"logic-gravity"},{type:"logic-jump"},{type:"logic-hero"},{type:"logic-directional-movement",speed:2},{type:"collision-basic",collisionType:"hero",solidCollisions:{block:"hit-solid",dirt:"hit-solid",tiles:"hit-solid"}},{type:"render-animation",mirror:"true",animationMap:{falling:"jumping",moving:"walking","default":"standing"},spriteSheet:{framerate:15,images:["mookie"],frames:{width:65,height:83,regY:82,regX:33},animations:{standing:[2],walking:{frames:[3,0,1,2]},jumping:{frames:[0]}}}},{type:"audio",audioMap:{"ground, moving":{sound:"walk",loop:5000},"just-jumped":"jump"}}],properties:{alwaysOn:true,z:200,width:80,height:240,camera:"forward"}},block:{id:"block",components:[{type:"logic-gravity"},{type:"logic-pushable"},{type:"collision-basic",collisionType:"block",solidCollisions:{block:"hit-solid",dirt:"hit-solid",hero:["push-entity","hit-solid"],tiles:"hit-solid",beetle:"hit-solid",briar:"hit-solid"}},{type:"render-image",image:"sprites",source:{width:72,height:72,y:432,x:144},regX:36,regY:72}],properties:{z:50,width:220,height:240}},"progress-bar":{id:"progress-bar",components:[{type:"dom-element",element:"div",className:"progress-bar",innerHTML:"Loading..."},{type:"entity-container",entities:[{id:"container",components:[{type:"change-scene",scene:"menu",message:"complete"},{type:"asset-loader",useXHR:false}]}]}]},"level-portal":{id:"level-portal",components:[{type:"logic-portal"},{type:"collision-basic",collisionType:"portal",immobile:true,softCollisions:{hero:"occupied-portal"}},{type:"change-scene",transition:"fade-to-black"}],properties:{z:0}},"title-screen":{id:"title-screen",components:[{type:"dom-element",element:"div",className:"title-screen"}]},gui:{id:"gui",components:[{type:"logic-gui"},{type:"entity-container",entities:[{}],childEvents:["handle-logic","handle-render","handle-render-load"]}]},"fps-counter":{id:"fps-counter",components:[{type:"logic-fps-counter"},{type:"dom-element",className:"fps-counter",style:{position:"absolute",left:"0.5em",top:"0.5em",color:"white",fontSize:"2em",fontWeight:"bold",fontFamily:"Arial",pointerEvents:"none",zIndex:11}}]},ball:{id:"ball",components:[{type:"logic-gravity"},{type:"collision-basic",collisionType:"ball",solidCollisions:{ball:"hit-solid",hero:"hit-solid",tiles:"hit-solid"},shapeType:"circle"},{type:"render-debug"}],properties:{z:50,width:240,height:240}},"fancy-box":{id:"fancy-box",components:[{type:"collision-box2d",body:{type:"dynamic",fixtureDefinition:{density:1,friction:0.5,restitution:0.2},shapes:[{halfWidth:15,halfHeight:15}]}},{type:"render-image",image:"entities",source:{width:30,height:30,y:0,x:0},regX:15,regY:15,rotate:true}],properties:{}},"static-square-peg":{id:"static-square-peg",components:[{type:"collision-box2d",body:{type:"static",fixtureDefinition:{density:1,friction:0.5,restitution:0.2},shapes:[{halfWidth:15,halfHeight:15}]}},{type:"render-image",image:"entities",source:{width:30,height:30,y:30,x:0},regX:15,regY:15,rotate:true}],properties:{}},"static-round-peg":{id:"static-round-peg",components:[{type:"collision-box2d",body:{type:"static",fixtureDefinition:{density:1,friction:0.5,restitution:0.2},shapes:[{radius:10}]}},{type:"render-image",image:"entities",source:{width:30,height:30,y:0,x:30},regX:15,regY:15,rotate:true}],properties:{}}},scenes:{load:{layers:[{id:"load-layer",components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"title-screen"},{type:"progress-bar"}],childEvents:["link-entity"]}]}],id:"load"},menu:{layers:[{id:"menu-layer",components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"handler-controller"},{type:"entity-container",entities:[{type:"title-screen"},{type:"button-play-game"}]}]},{id:"enable-ios-audio-layer",filter:{includes:["iOS"]},components:[{type:"enable-ios-audio",audioId:"combined"}]}],id:"menu"},"scene-level-1":{layers:[{type:"action-layer"}],id:"scene-level-1"}},levels:{"level-1":{height:16,layers:[{data:[5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5,5,8,6,7,7,5,5,5,8,7,7,7,8,5,7,6,6,7,8,8,5,5],height:16,name:"background",opacity:1,type:"tilelayer",visible:true,width:22,x:0,y:0},{height:16,name:"entities",objects:[{gid:2,height:0,name:"",properties:{},type:"",visible:true,width:0,x:133,y:183},{gid:2,height:0,name:"",properties:{},type:"",visible:true,width:0,x:224,y:213},{gid:2,height:0,name:"",properties:{},type:"",visible:true,width:0,x:258,y:289},{gid:2,height:0,name:"",properties:{},type:"",visible:true,width:0,x:225,y:371},{gid:2,height:0,name:"",properties:{},type:"",visible:true,width:0,x:336,y:181},{gid:3,height:0,name:"",properties:{},type:"",visible:true,width:0,x:390,y:300},{gid:3,height:0,name:"",properties:{},type:"",visible:true,width:0,x:466,y:245},{gid:3,height:0,name:"",properties:{},type:"",visible:true,width:0,x:45,y:302},{gid:3,height:0,name:"",properties:{},type:"",visible:true,width:0,x:114,y:391},{gid:3,height:0,name:"",properties:{},type:"",visible:true,width:0,x:175,y:467},{gid:3,height:0,name:"",properties:{},type:"",visible:true,width:0,x:305,y:449},{gid:1,height:0,name:"",properties:{},type:"",visible:true,width:0,x:60,y:60},{gid:1,height:0,name:"",properties:{},type:"",visible:true,width:0,x:150,y:90},{gid:1,height:0,name:"",properties:{},type:"",visible:true,width:0,x:240,y:90},{gid:1,height:0,name:"",properties:{},type:"",visible:true,width:0,x:222,y:34},{gid:1,height:0,name:"",properties:{},type:"",visible:true,width:0,x:334,y:61},{gid:1,height:0,name:"",properties:{},type:"",visible:true,width:0,x:447,y:60}],opacity:1,type:"objectgroup",visible:true,width:22,x:0,y:0}],orientation:"orthogonal",properties:{},tileheight:30,tilesets:[{firstgid:1,image:"../game/images/entities.png",imageheight:60,imagewidth:60,margin:0,name:"entities",properties:{},spacing:0,tileheight:30,tileproperties:{"0":{entity:"fancy-box"},"1":{entity:"static-round-peg"},"2":{entity:"static-square-peg"}},tilewidth:30},{firstgid:5,image:"../game/images/tiles.png",imageheight:60,imagewidth:60,margin:0,name:"tiles",properties:{},spacing:0,tileheight:30,tilewidth:30}],tilewidth:30,version:1,width:22,id:"level-1"}},debug:false};var e={};(function(h,g){function f(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(k,j,i){i.get instanceof Function&&k.__defineGetter__(j,i.get);i.set instanceof Function&&k.__defineSetter__(j,i.set)}}h.inherit=function(j,i){f.prototype=i.prototype;j.prototype=new f;j.prototype.constructor=j};h.generateCallback=function(j,i){return function(){i.apply(j,arguments)}};h.NVector=function(k){if(k===g){k=0}for(var j=Array(k||0),i=0;i<k;++i){j[i]=0}return j};h.is=function(j,i){if(j===null){return false}if(i instanceof Function&&j instanceof i){return true}if(j.constructor.__implements!=g&&j.constructor.__implements[i]){return true}return false};h.parseUInt=function(i){return Math.abs(parseInt(i))}})(e);var b=Array,a=e.NVector;if(typeof e==="undefined"){e={}}if(typeof e.Collision==="undefined"){e.Collision={}}if(typeof e.Collision.Shapes==="undefined"){e.Collision.Shapes={}}if(typeof e.Common==="undefined"){e.Common={}}if(typeof e.Common.Math==="undefined"){e.Common.Math={}}if(typeof e.Dynamics==="undefined"){e.Dynamics={}}if(typeof e.Dynamics.Contacts==="undefined"){e.Dynamics.Contacts={}}if(typeof e.Dynamics.Controllers==="undefined"){e.Dynamics.Controllers={}}if(typeof e.Dynamics.Joints==="undefined"){e.Dynamics.Joints={}}(function(){function bo(){bo.b2AABB.apply(this,arguments)}function bn(){bn.b2Bound.apply(this,arguments)}function bh(){bh.b2BoundValues.apply(this,arguments);this.constructor===bh&&this.b2BoundValues.apply(this,arguments)}function at(){at.b2Collision.apply(this,arguments)}function aw(){aw.b2ContactID.apply(this,arguments);this.constructor===aw&&this.b2ContactID.apply(this,arguments)}function bv(){bv.b2ContactPoint.apply(this,arguments)}function a5(){a5.b2Distance.apply(this,arguments)}function aD(){aD.b2DistanceInput.apply(this,arguments)}function bu(){bu.b2DistanceOutput.apply(this,arguments)}function a9(){a9.b2DistanceProxy.apply(this,arguments)}function a4(){a4.b2DynamicTree.apply(this,arguments);this.constructor===a4&&this.b2DynamicTree.apply(this,arguments)}function bf(){bf.b2DynamicTreeBroadPhase.apply(this,arguments)}function bg(){bg.b2DynamicTreeNode.apply(this,arguments)}function bl(){bl.b2DynamicTreePair.apply(this,arguments)}function a3(){a3.b2Manifold.apply(this,arguments);this.constructor===a3&&this.b2Manifold.apply(this,arguments)}function a1(){a1.b2ManifoldPoint.apply(this,arguments);this.constructor===a1&&this.b2ManifoldPoint.apply(this,arguments)}function aJ(){aJ.b2Point.apply(this,arguments)}function ar(){ar.b2RayCastInput.apply(this,arguments);this.constructor===ar&&this.b2RayCastInput.apply(this,arguments)}function ay(){ay.b2RayCastOutput.apply(this,arguments)}function br(){br.b2Segment.apply(this,arguments)}function bm(){bm.b2SeparationFunction.apply(this,arguments)}function bd(){bd.b2Simplex.apply(this,arguments);this.constructor===bd&&this.b2Simplex.apply(this,arguments)}function bq(){bq.b2SimplexCache.apply(this,arguments)}function a8(){a8.b2SimplexVertex.apply(this,arguments)}function be(){be.b2TimeOfImpact.apply(this,arguments)}function a7(){a7.b2TOIInput.apply(this,arguments)}function bA(){bA.b2WorldManifold.apply(this,arguments);this.constructor===bA&&this.b2WorldManifold.apply(this,arguments)}function aZ(){aZ.ClipVertex.apply(this,arguments)}function aS(){aS.Features.apply(this,arguments)}function aN(){aN.b2CircleShape.apply(this,arguments);this.constructor===aN&&this.b2CircleShape.apply(this,arguments)}function aI(){aI.b2EdgeChainDef.apply(this,arguments);this.constructor===aI&&this.b2EdgeChainDef.apply(this,arguments)}function aK(){aK.b2EdgeShape.apply(this,arguments);this.constructor===aK&&this.b2EdgeShape.apply(this,arguments)}function aE(){aE.b2MassData.apply(this,arguments)}function aC(){aC.b2PolygonShape.apply(this,arguments);this.constructor===aC&&this.b2PolygonShape.apply(this,arguments)}function aF(){aF.b2Shape.apply(this,arguments);this.constructor===aF&&this.b2Shape.apply(this,arguments)}function aW(){aW.b2Color.apply(this,arguments);this.constructor===aW&&this.b2Color.apply(this,arguments)}function aT(){aT.b2Settings.apply(this,arguments)}function aO(){aO.b2Mat22.apply(this,arguments);this.constructor===aO&&this.b2Mat22.apply(this,arguments)}function aV(){aV.b2Mat33.apply(this,arguments);this.constructor===aV&&this.b2Mat33.apply(this,arguments)}function aQ(){aQ.b2Math.apply(this,arguments)}function aP(){aP.b2Sweep.apply(this,arguments)}function aH(){aH.b2Transform.apply(this,arguments);this.constructor===aH&&this.b2Transform.apply(this,arguments)}function aB(){aB.b2Vec2.apply(this,arguments);this.constructor===aB&&this.b2Vec2.apply(this,arguments)}function aA(){aA.b2Vec3.apply(this,arguments);this.constructor===aA&&this.b2Vec3.apply(this,arguments)}function ax(){ax.b2Body.apply(this,arguments);this.constructor===ax&&this.b2Body.apply(this,arguments)}function az(){az.b2BodyDef.apply(this,arguments);this.constructor===az&&this.b2BodyDef.apply(this,arguments)}function av(){av.b2ContactFilter.apply(this,arguments)}function bt(){bt.b2ContactImpulse.apply(this,arguments)}function bi(){bi.b2ContactListener.apply(this,arguments)}function a6(){a6.b2ContactManager.apply(this,arguments);this.constructor===a6&&this.b2ContactManager.apply(this,arguments)}function bb(){bb.b2DebugDraw.apply(this,arguments);this.constructor===bb&&this.b2DebugDraw.apply(this,arguments)}function a2(){a2.b2DestructionListener.apply(this,arguments)}function bF(){bF.b2FilterData.apply(this,arguments)}function bc(){bc.b2Fixture.apply(this,arguments);this.constructor===bc&&this.b2Fixture.apply(this,arguments)}function aG(){aG.b2FixtureDef.apply(this,arguments);this.constructor===aG&&this.b2FixtureDef.apply(this,arguments)}function ak(){ak.b2Island.apply(this,arguments);this.constructor===ak&&this.b2Island.apply(this,arguments)}function ae(){ae.b2TimeStep.apply(this,arguments)}function ac(){ac.b2World.apply(this,arguments);this.constructor===ac&&this.b2World.apply(this,arguments)}function bN(){bN.b2CircleContact.apply(this,arguments)}function bK(){bK.b2Contact.apply(this,arguments);this.constructor===bK&&this.b2Contact.apply(this,arguments)}function bB(){bB.b2ContactConstraint.apply(this,arguments);this.constructor===bB&&this.b2ContactConstraint.apply(this,arguments)}function bE(){bE.b2ContactConstraintPoint.apply(this,arguments)}function bs(){bs.b2ContactEdge.apply(this,arguments)}function bj(){bj.b2ContactFactory.apply(this,arguments);this.constructor===bj&&this.b2ContactFactory.apply(this,arguments)}function aU(){aU.b2ContactRegister.apply(this,arguments)}function ao(){ao.b2ContactResult.apply(this,arguments)}function aL(){aL.b2ContactSolver.apply(this,arguments);this.constructor===aL&&this.b2ContactSolver.apply(this,arguments)}function ag(){ag.b2EdgeAndCircleContact.apply(this,arguments)}function al(){al.b2NullContact.apply(this,arguments);this.constructor===al&&this.b2NullContact.apply(this,arguments)}function bP(){bP.b2PolyAndCircleContact.apply(this,arguments)}function bH(){bH.b2PolyAndEdgeContact.apply(this,arguments)}function bx(){bx.b2PolygonContact.apply(this,arguments)}function ad(){ad.b2PositionSolverManifold.apply(this,arguments);this.constructor===ad&&this.b2PositionSolverManifold.apply(this,arguments)}function aY(){aY.b2BuoyancyController.apply(this,arguments)}function aq(){aq.b2ConstantAccelController.apply(this,arguments)}function ai(){ai.b2ConstantForceController.apply(this,arguments)}function ab(){ab.b2Controller.apply(this,arguments)}function bJ(){bJ.b2ControllerEdge.apply(this,arguments)}function bz(){bz.b2GravityController.apply(this,arguments)}function a0(){a0.b2TensorDampingController.apply(this,arguments)}function bM(){bM.b2DistanceJoint.apply(this,arguments);this.constructor===bM&&this.b2DistanceJoint.apply(this,arguments)}function bD(){bD.b2DistanceJointDef.apply(this,arguments);this.constructor===bD&&this.b2DistanceJointDef.apply(this,arguments)}function bp(){bp.b2FrictionJoint.apply(this,arguments);this.constructor===bp&&this.b2FrictionJoint.apply(this,arguments)}function aR(){aR.b2FrictionJointDef.apply(this,arguments);this.constructor===aR&&this.b2FrictionJointDef.apply(this,arguments)}function an(){an.b2GearJoint.apply(this,arguments);this.constructor===an&&this.b2GearJoint.apply(this,arguments)}function af(){af.b2GearJointDef.apply(this,arguments);this.constructor===af&&this.b2GearJointDef.apply(this,arguments)}function au(){au.b2Jacobian.apply(this,arguments)}function bO(){bO.b2Joint.apply(this,arguments);this.constructor===bO&&this.b2Joint.apply(this,arguments)}function bG(){bG.b2JointDef.apply(this,arguments);this.constructor===bG&&this.b2JointDef.apply(this,arguments)}function aj(){aj.b2JointEdge.apply(this,arguments)}function bw(){bw.b2LineJoint.apply(this,arguments);this.constructor===bw&&this.b2LineJoint.apply(this,arguments)}function aX(){aX.b2LineJointDef.apply(this,arguments);this.constructor===aX&&this.b2LineJointDef.apply(this,arguments)}function ap(){ap.b2MouseJoint.apply(this,arguments);this.constructor===ap&&this.b2MouseJoint.apply(this,arguments)}function ah(){ah.b2MouseJointDef.apply(this,arguments);this.constructor===ah&&this.b2MouseJointDef.apply(this,arguments)}function i(){i.b2PrismaticJoint.apply(this,arguments);this.constructor===i&&this.b2PrismaticJoint.apply(this,arguments)}function bI(){bI.b2PrismaticJointDef.apply(this,arguments);this.constructor===bI&&this.b2PrismaticJointDef.apply(this,arguments)}function by(){by.b2PulleyJoint.apply(this,arguments);this.constructor===by&&this.b2PulleyJoint.apply(this,arguments)}function bL(){bL.b2PulleyJointDef.apply(this,arguments);this.constructor===bL&&this.b2PulleyJointDef.apply(this,arguments)}function bC(){bC.b2RevoluteJoint.apply(this,arguments);this.constructor===bC&&this.b2RevoluteJoint.apply(this,arguments)}function bk(){bk.b2RevoluteJointDef.apply(this,arguments);this.constructor===bk&&this.b2RevoluteJointDef.apply(this,arguments)}function aM(){aM.b2WeldJoint.apply(this,arguments);this.constructor===aM&&this.b2WeldJoint.apply(this,arguments)}function am(){am.b2WeldJointDef.apply(this,arguments);this.constructor===am&&this.b2WeldJointDef.apply(this,arguments)}e.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";e.Collision.b2AABB=bo;e.Collision.b2Bound=bn;e.Collision.b2BoundValues=bh;e.Collision.b2Collision=at;e.Collision.b2ContactID=aw;e.Collision.b2ContactPoint=bv;e.Collision.b2Distance=a5;e.Collision.b2DistanceInput=aD;e.Collision.b2DistanceOutput=bu;e.Collision.b2DistanceProxy=a9;e.Collision.b2DynamicTree=a4;e.Collision.b2DynamicTreeBroadPhase=bf;e.Collision.b2DynamicTreeNode=bg;e.Collision.b2DynamicTreePair=bl;e.Collision.b2Manifold=a3;e.Collision.b2ManifoldPoint=a1;e.Collision.b2Point=aJ;e.Collision.b2RayCastInput=ar;e.Collision.b2RayCastOutput=ay;e.Collision.b2Segment=br;e.Collision.b2SeparationFunction=bm;e.Collision.b2Simplex=bd;e.Collision.b2SimplexCache=bq;e.Collision.b2SimplexVertex=a8;e.Collision.b2TimeOfImpact=be;e.Collision.b2TOIInput=a7;e.Collision.b2WorldManifold=bA;e.Collision.ClipVertex=aZ;e.Collision.Features=aS;e.Collision.Shapes.b2CircleShape=aN;e.Collision.Shapes.b2EdgeChainDef=aI;e.Collision.Shapes.b2EdgeShape=aK;e.Collision.Shapes.b2MassData=aE;e.Collision.Shapes.b2PolygonShape=aC;e.Collision.Shapes.b2Shape=aF;e.Common.b2internal="Box2D.Common.b2internal";e.Common.b2Color=aW;e.Common.b2Settings=aT;e.Common.Math.b2Mat22=aO;e.Common.Math.b2Mat33=aV;e.Common.Math.b2Math=aQ;e.Common.Math.b2Sweep=aP;e.Common.Math.b2Transform=aH;e.Common.Math.b2Vec2=aB;e.Common.Math.b2Vec3=aA;e.Dynamics.b2Body=ax;e.Dynamics.b2BodyDef=az;e.Dynamics.b2ContactFilter=av;e.Dynamics.b2ContactImpulse=bt;e.Dynamics.b2ContactListener=bi;e.Dynamics.b2ContactManager=a6;e.Dynamics.b2DebugDraw=bb;e.Dynamics.b2DestructionListener=a2;e.Dynamics.b2FilterData=bF;e.Dynamics.b2Fixture=bc;e.Dynamics.b2FixtureDef=aG;e.Dynamics.b2Island=ak;e.Dynamics.b2TimeStep=ae;e.Dynamics.b2World=ac;e.Dynamics.Contacts.b2CircleContact=bN;e.Dynamics.Contacts.b2Contact=bK;e.Dynamics.Contacts.b2ContactConstraint=bB;e.Dynamics.Contacts.b2ContactConstraintPoint=bE;e.Dynamics.Contacts.b2ContactEdge=bs;e.Dynamics.Contacts.b2ContactFactory=bj;e.Dynamics.Contacts.b2ContactRegister=aU;e.Dynamics.Contacts.b2ContactResult=ao;e.Dynamics.Contacts.b2ContactSolver=aL;e.Dynamics.Contacts.b2EdgeAndCircleContact=ag;e.Dynamics.Contacts.b2NullContact=al;e.Dynamics.Contacts.b2PolyAndCircleContact=bP;e.Dynamics.Contacts.b2PolyAndEdgeContact=bH;e.Dynamics.Contacts.b2PolygonContact=bx;e.Dynamics.Contacts.b2PositionSolverManifold=ad;e.Dynamics.Controllers.b2BuoyancyController=aY;e.Dynamics.Controllers.b2ConstantAccelController=aq;e.Dynamics.Controllers.b2ConstantForceController=ai;e.Dynamics.Controllers.b2Controller=ab;e.Dynamics.Controllers.b2ControllerEdge=bJ;e.Dynamics.Controllers.b2GravityController=bz;e.Dynamics.Controllers.b2TensorDampingController=a0;e.Dynamics.Joints.b2DistanceJoint=bM;e.Dynamics.Joints.b2DistanceJointDef=bD;e.Dynamics.Joints.b2FrictionJoint=bp;e.Dynamics.Joints.b2FrictionJointDef=aR;e.Dynamics.Joints.b2GearJoint=an;e.Dynamics.Joints.b2GearJointDef=af;e.Dynamics.Joints.b2Jacobian=au;e.Dynamics.Joints.b2Joint=bO;e.Dynamics.Joints.b2JointDef=bG;e.Dynamics.Joints.b2JointEdge=aj;e.Dynamics.Joints.b2LineJoint=bw;e.Dynamics.Joints.b2LineJointDef=aX;e.Dynamics.Joints.b2MouseJoint=ap;e.Dynamics.Joints.b2MouseJointDef=ah;e.Dynamics.Joints.b2PrismaticJoint=i;e.Dynamics.Joints.b2PrismaticJointDef=bI;e.Dynamics.Joints.b2PulleyJoint=by;e.Dynamics.Joints.b2PulleyJointDef=bL;e.Dynamics.Joints.b2RevoluteJoint=bC;e.Dynamics.Joints.b2RevoluteJointDef=bk;e.Dynamics.Joints.b2WeldJoint=aM;e.Dynamics.Joints.b2WeldJointDef=am})();e.postDefs=[];(function(){var ae=e.Collision.Shapes.b2CircleShape,ad=e.Collision.Shapes.b2PolygonShape,X=e.Collision.Shapes.b2Shape,al=e.Common.b2Settings,am=e.Common.Math.b2Math,ai=e.Common.Math.b2Sweep,s=e.Common.Math.b2Transform,ap=e.Common.Math.b2Vec2,ah=e.Collision.b2AABB,x=e.Collision.b2Bound,r=e.Collision.b2BoundValues,P=e.Collision.b2Collision,T=e.Collision.b2ContactID,ab=e.Collision.b2ContactPoint,m=e.Collision.b2Distance,i=e.Collision.b2DistanceInput,au=e.Collision.b2DistanceOutput,ak=e.Collision.b2DistanceProxy,an=e.Collision.b2DynamicTree,ag=e.Collision.b2DynamicTreeBroadPhase,ac=e.Collision.b2DynamicTreeNode,C=e.Collision.b2DynamicTreePair,af=e.Collision.b2Manifold,v=e.Collision.b2ManifoldPoint,J=e.Collision.b2Point,t=e.Collision.b2RayCastInput,aj=e.Collision.b2RayCastOutput,f=e.Collision.b2Segment,ay=e.Collision.b2SeparationFunction,aw=e.Collision.b2Simplex,at=e.Collision.b2SimplexCache,av=e.Collision.b2SimplexVertex,aq=e.Collision.b2TimeOfImpact,ao=e.Collision.b2TOIInput,ar=e.Collision.b2WorldManifold,aA=e.Collision.ClipVertex,az=e.Collision.Features,ax=e.Collision.IBroadPhase;ah.b2AABB=function(){this.lowerBound=new ap;this.upperBound=new ap};ah.prototype.IsValid=function(){var g=this.upperBound.y-this.lowerBound.y;return g=(g=this.upperBound.x-this.lowerBound.x>=0&&g>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};ah.prototype.GetCenter=function(){return new ap((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};ah.prototype.GetExtents=function(){return new ap((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};ah.prototype.Contains=function(g){var h=true;return h=(h=(h=(h=h&&this.lowerBound.x<=g.lowerBound.x)&&this.lowerBound.y<=g.lowerBound.y)&&g.upperBound.x<=this.upperBound.x)&&g.upperBound.y<=this.upperBound.y};ah.prototype.RayCast=function(p,o){var n=-Number.MAX_VALUE,j=Number.MAX_VALUE,g=o.p1.x,z=o.p1.y,w=o.p2.x-o.p1.x,y=o.p2.y-o.p1.y,u=Math.abs(y),h=p.normal,q=0,k=0,l=q=0;l=0;if(Math.abs(w)<Number.MIN_VALUE){if(g<this.lowerBound.x||this.upperBound.x<g){return false}}else{q=1/w;k=(this.lowerBound.x-g)*q;q=(this.upperBound.x-g)*q;l=-1;if(k>q){l=k;k=q;q=l;l=1}if(k>n){h.x=l;h.y=0;n=k}j=Math.min(j,q);if(n>j){return false}}if(u<Number.MIN_VALUE){if(z<this.lowerBound.y||this.upperBound.y<z){return false}}else{q=1/y;k=(this.lowerBound.y-z)*q;q=(this.upperBound.y-z)*q;l=-1;if(k>q){l=k;k=q;q=l;l=1}if(k>n){h.y=l;h.x=0;n=k}j=Math.min(j,q);if(n>j){return false}}p.fraction=n;return true};ah.prototype.TestOverlap=function(g){var j=g.lowerBound.y-this.upperBound.y,h=this.lowerBound.y-g.upperBound.y;if(g.lowerBound.x-this.upperBound.x>0||j>0){return false}if(this.lowerBound.x-g.upperBound.x>0||h>0){return false}return true};ah.Combine=function(g,j){var h=new ah;h.Combine(g,j);return h};ah.prototype.Combine=function(g,h){this.lowerBound.x=Math.min(g.lowerBound.x,h.lowerBound.x);this.lowerBound.y=Math.min(g.lowerBound.y,h.lowerBound.y);this.upperBound.x=Math.max(g.upperBound.x,h.upperBound.x);this.upperBound.y=Math.max(g.upperBound.y,h.upperBound.y)};x.b2Bound=function(){};x.prototype.IsLower=function(){return(this.value&1)==0};x.prototype.IsUpper=function(){return(this.value&1)==1};x.prototype.Swap=function(h){var k=this.value,j=this.proxy,g=this.stabbingCount;this.value=h.value;this.proxy=h.proxy;this.stabbingCount=h.stabbingCount;h.value=k;h.proxy=j;h.stabbingCount=g};r.b2BoundValues=function(){};r.prototype.b2BoundValues=function(){this.lowerValues=new a;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new a;this.upperValues[0]=0;this.upperValues[1]=0};P.b2Collision=function(){};P.ClipSegmentToLine=function(l,k,j,h){if(h===undefined){h=0}var g,q=0;g=k[0];var o=g.v;g=k[1];var p=g.v,n=j.x*o.x+j.y*o.y-h;g=j.x*p.x+j.y*p.y-h;n<=0&&l[q++].Set(k[0]);g<=0&&l[q++].Set(k[1]);if(n*g<0){j=n/(n-g);g=l[q];g=g.v;g.x=o.x+j*(p.x-o.x);g.y=o.y+j*(p.y-o.y);g=l[q];g.id=(n>0?k[0]:k[1]).id;++q}return q};P.EdgeSeparation=function(q,p,o,k,g){if(o===undefined){o=0}parseInt(q.m_vertexCount);var A=q.m_vertices;q=q.m_normals;var y=parseInt(k.m_vertexCount),z=k.m_vertices,w,h;w=p.R;h=q[o];q=w.col1.x*h.x+w.col2.x*h.y;k=w.col1.y*h.x+w.col2.y*h.y;w=g.R;var u=w.col1.x*q+w.col1.y*k;w=w.col2.x*q+w.col2.y*k;for(var l=0,n=Number.MAX_VALUE,j=0;j<y;++j){h=z[j];h=h.x*u+h.y*w;if(h<n){n=h;l=j}}h=A[o];w=p.R;o=p.position.x+(w.col1.x*h.x+w.col2.x*h.y);p=p.position.y+(w.col1.y*h.x+w.col2.y*h.y);h=z[l];w=g.R;A=g.position.x+(w.col1.x*h.x+w.col2.x*h.y);g=g.position.y+(w.col1.y*h.x+w.col2.y*h.y);A-=o;g-=p;return A*q+g*k};P.FindMaxSeparation=function(u,q,p,k,g){var B=parseInt(q.m_vertexCount),z=q.m_normals,A,y;y=g.R;A=k.m_centroid;var h=g.position.x+(y.col1.x*A.x+y.col2.x*A.y),w=g.position.y+(y.col1.y*A.x+y.col2.y*A.y);y=p.R;A=q.m_centroid;h-=p.position.x+(y.col1.x*A.x+y.col2.x*A.y);w-=p.position.y+(y.col1.y*A.x+y.col2.y*A.y);y=h*p.R.col1.x+w*p.R.col1.y;w=h*p.R.col2.x+w*p.R.col2.y;h=0;for(var l=-Number.MAX_VALUE,o=0;o<B;++o){A=z[o];A=A.x*y+A.y*w;if(A>l){l=A;h=o}}z=P.EdgeSeparation(q,p,h,k,g);A=parseInt(h-1>=0?h-1:B-1);y=P.EdgeSeparation(q,p,A,k,g);w=parseInt(h+1<B?h+1:0);l=P.EdgeSeparation(q,p,w,k,g);var j=o=0,n=0;if(y>z&&y>l){n=-1;o=A;j=y}else{if(l>z){n=1;o=w;j=l}else{u[0]=h;return z}}for(;;){h=n==-1?o-1>=0?o-1:B-1:o+1<B?o+1:0;z=P.EdgeSeparation(q,p,h,k,g);if(z>j){o=h;j=z}else{break}}u[0]=o;return j};P.FindIncidentEdge=function(o,n,l,j,g,y){if(j===undefined){j=0}parseInt(n.m_vertexCount);var u=n.m_normals,w=parseInt(g.m_vertexCount);n=g.m_vertices;g=g.m_normals;var q;q=l.R;l=u[j];u=q.col1.x*l.x+q.col2.x*l.y;var h=q.col1.y*l.x+q.col2.y*l.y;q=y.R;l=q.col1.x*u+q.col1.y*h;h=q.col2.x*u+q.col2.y*h;u=l;q=0;for(var p=Number.MAX_VALUE,k=0;k<w;++k){l=g[k];l=u*l.x+h*l.y;if(l<p){p=l;q=k}}g=parseInt(q);u=parseInt(g+1<w?g+1:0);w=o[0];l=n[g];q=y.R;w.v.x=y.position.x+(q.col1.x*l.x+q.col2.x*l.y);w.v.y=y.position.y+(q.col1.y*l.x+q.col2.y*l.y);w.id.features.referenceEdge=j;w.id.features.incidentEdge=g;w.id.features.incidentVertex=0;w=o[1];l=n[u];q=y.R;w.v.x=y.position.x+(q.col1.x*l.x+q.col2.x*l.y);w.v.y=y.position.y+(q.col1.y*l.x+q.col2.y*l.y);w.id.features.referenceEdge=j;w.id.features.incidentEdge=u;w.id.features.incidentVertex=1};P.MakeClipPointVector=function(){var g=new b(2);g[0]=new aA;g[1]=new aA;return g};P.CollidePolygons=function(w,q,p,k,g){var D;w.m_pointCount=0;var A=q.m_radius+k.m_radius;D=0;P.s_edgeAO[0]=D;var B=P.FindMaxSeparation(P.s_edgeAO,q,p,k,g);D=P.s_edgeAO[0];if(!(B>A)){var z=0;P.s_edgeBO[0]=z;var h=P.FindMaxSeparation(P.s_edgeBO,k,g,q,p);z=P.s_edgeBO[0];if(!(h>A)){var y=0,l=0;if(h>0.98*B+0.001){B=k;k=q;q=g;p=p;y=z;w.m_type=af.e_faceB;l=1}else{B=q;k=k;q=p;p=g;y=D;w.m_type=af.e_faceA;l=0}D=P.s_incidentEdge;P.FindIncidentEdge(D,B,q,y,k,p);z=parseInt(B.m_vertexCount);g=B.m_vertices;B=g[y];var o;o=y+1<z?g[parseInt(y+1)]:g[0];y=P.s_localTangent;y.Set(o.x-B.x,o.y-B.y);y.Normalize();g=P.s_localNormal;g.x=y.y;g.y=-y.x;k=P.s_planePoint;k.Set(0.5*(B.x+o.x),0.5*(B.y+o.y));h=P.s_tangent;z=q.R;h.x=z.col1.x*y.x+z.col2.x*y.y;h.y=z.col1.y*y.x+z.col2.y*y.y;var j=P.s_tangent2;j.x=-h.x;j.y=-h.y;y=P.s_normal;y.x=h.y;y.y=-h.x;var n=P.s_v11,u=P.s_v12;n.x=q.position.x+(z.col1.x*B.x+z.col2.x*B.y);n.y=q.position.y+(z.col1.y*B.x+z.col2.y*B.y);u.x=q.position.x+(z.col1.x*o.x+z.col2.x*o.y);u.y=q.position.y+(z.col1.y*o.x+z.col2.y*o.y);q=y.x*n.x+y.y*n.y;z=h.x*u.x+h.y*u.y+A;o=P.s_clipPoints1;B=P.s_clipPoints2;u=0;u=P.ClipSegmentToLine(o,D,j,-h.x*n.x-h.y*n.y+A);if(!(u<2)){u=P.ClipSegmentToLine(B,o,h,z);if(!(u<2)){w.m_localPlaneNormal.SetV(g);w.m_localPoint.SetV(k);for(k=g=0;k<al.b2_maxManifoldPoints;++k){D=B[k];if(y.x*D.v.x+y.y*D.v.y-q<=A){h=w.m_points[g];z=p.R;j=D.v.x-p.position.x;n=D.v.y-p.position.y;h.m_localPoint.x=j*z.col1.x+n*z.col1.y;h.m_localPoint.y=j*z.col2.x+n*z.col2.y;h.m_id.Set(D.id);h.m_id.features.flip=l;++g}}w.m_pointCount=g}}}}};P.CollideCircles=function(h,p,o,g,n){h.m_pointCount=0;var l,j;l=o.R;j=p.m_p;var k=o.position.x+(l.col1.x*j.x+l.col2.x*j.y);o=o.position.y+(l.col1.y*j.x+l.col2.y*j.y);l=n.R;j=g.m_p;k=n.position.x+(l.col1.x*j.x+l.col2.x*j.y)-k;n=n.position.y+(l.col1.y*j.x+l.col2.y*j.y)-o;l=p.m_radius+g.m_radius;if(!(k*k+n*n>l*l)){h.m_type=af.e_circles;h.m_localPoint.SetV(p.m_p);h.m_localPlaneNormal.SetZero();h.m_pointCount=1;h.m_points[0].m_localPoint.SetV(g.m_p);h.m_points[0].m_id.key=0}};P.CollidePolygonAndCircle=function(q,p,o,k,g){var A=q.m_pointCount=0,y=0,z,w;w=g.R;z=k.m_p;var h=g.position.y+(w.col1.y*z.x+w.col2.y*z.y);A=g.position.x+(w.col1.x*z.x+w.col2.x*z.y)-o.position.x;y=h-o.position.y;w=o.R;o=A*w.col1.x+y*w.col1.y;w=A*w.col2.x+y*w.col2.y;var u=0;h=-Number.MAX_VALUE;g=p.m_radius+k.m_radius;var l=parseInt(p.m_vertexCount),n=p.m_vertices;p=p.m_normals;for(var j=0;j<l;++j){z=n[j];A=o-z.x;y=w-z.y;z=p[j];A=z.x*A+z.y*y;if(A>g){return}if(A>h){h=A;u=j}}A=parseInt(u);y=parseInt(A+1<l?A+1:0);z=n[A];n=n[y];if(h<Number.MIN_VALUE){q.m_pointCount=1;q.m_type=af.e_faceA;q.m_localPlaneNormal.SetV(p[u]);q.m_localPoint.x=0.5*(z.x+n.x);q.m_localPoint.y=0.5*(z.y+n.y)}else{h=(o-n.x)*(z.x-n.x)+(w-n.y)*(z.y-n.y);if((o-z.x)*(n.x-z.x)+(w-z.y)*(n.y-z.y)<=0){if((o-z.x)*(o-z.x)+(w-z.y)*(w-z.y)>g*g){return}q.m_pointCount=1;q.m_type=af.e_faceA;q.m_localPlaneNormal.x=o-z.x;q.m_localPlaneNormal.y=w-z.y;q.m_localPlaneNormal.Normalize();q.m_localPoint.SetV(z)}else{if(h<=0){if((o-n.x)*(o-n.x)+(w-n.y)*(w-n.y)>g*g){return}q.m_pointCount=1;q.m_type=af.e_faceA;q.m_localPlaneNormal.x=o-n.x;q.m_localPlaneNormal.y=w-n.y;q.m_localPlaneNormal.Normalize();q.m_localPoint.SetV(n)}else{u=0.5*(z.x+n.x);z=0.5*(z.y+n.y);h=(o-u)*p[A].x+(w-z)*p[A].y;if(h>g){return}q.m_pointCount=1;q.m_type=af.e_faceA;q.m_localPlaneNormal.x=p[A].x;q.m_localPlaneNormal.y=p[A].y;q.m_localPlaneNormal.Normalize();q.m_localPoint.Set(u,z)}}}q.m_points[0].m_localPoint.SetV(k.m_p);q.m_points[0].m_id.key=0};P.TestOverlap=function(h,o){var n=o.lowerBound,g=h.upperBound,l=n.x-g.x,k=n.y-g.y;n=h.lowerBound;g=o.upperBound;var j=n.y-g.y;if(l>0||k>0){return false}if(n.x-g.x>0||j>0){return false}return true};e.postDefs.push(function(){e.Collision.b2Collision.s_incidentEdge=P.MakeClipPointVector();e.Collision.b2Collision.s_clipPoints1=P.MakeClipPointVector();e.Collision.b2Collision.s_clipPoints2=P.MakeClipPointVector();e.Collision.b2Collision.s_edgeAO=new a(1);e.Collision.b2Collision.s_edgeBO=new a(1);e.Collision.b2Collision.s_localTangent=new ap;e.Collision.b2Collision.s_localNormal=new ap;e.Collision.b2Collision.s_planePoint=new ap;e.Collision.b2Collision.s_normal=new ap;e.Collision.b2Collision.s_tangent=new ap;e.Collision.b2Collision.s_tangent2=new ap;e.Collision.b2Collision.s_v11=new ap;e.Collision.b2Collision.s_v12=new ap;e.Collision.b2Collision.b2CollidePolyTempVec=new ap;e.Collision.b2Collision.b2_nullFeature=255});T.b2ContactID=function(){this.features=new az};T.prototype.b2ContactID=function(){this.features._m_id=this};T.prototype.Set=function(g){this.key=g._key};T.prototype.Copy=function(){var g=new T;g.key=this.key;return g};Object.defineProperty(T.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(T.prototype,"key",{enumerable:false,configurable:true,set:function(g){if(g===undefined){g=0}this._key=g;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});ab.b2ContactPoint=function(){this.position=new ap;this.velocity=new ap;this.normal=new ap;this.id=new T};m.b2Distance=function(){};m.Distance=function(w,q,p){++m.b2_gjkCalls;var k=p.proxyA,g=p.proxyB,D=p.transformA,A=p.transformB,B=m.s_simplex;B.ReadCache(q,k,D,g,A);var z=B.m_vertices,h=m.s_saveA,y=m.s_saveB,l=0;B.GetClosestPoint().LengthSquared();for(var o=0,j,n=0;n<20;){l=B.m_count;for(o=0;o<l;o++){h[o]=z[o].indexA;y[o]=z[o].indexB}switch(B.m_count){case 1:break;case 2:B.Solve2();break;case 3:B.Solve3();break;default:al.b2Assert(false)}if(B.m_count==3){break}j=B.GetClosestPoint();j.LengthSquared();o=B.GetSearchDirection();if(o.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break}j=z[B.m_count];j.indexA=k.GetSupport(am.MulTMV(D.R,o.GetNegative()));j.wA=am.MulX(D,k.GetVertex(j.indexA));j.indexB=g.GetSupport(am.MulTMV(A.R,o));j.wB=am.MulX(A,g.GetVertex(j.indexB));j.w=am.SubtractVV(j.wB,j.wA);++n;++m.b2_gjkIters;var u=false;for(o=0;o<l;o++){if(j.indexA==h[o]&&j.indexB==y[o]){u=true;break}}if(u){break}++B.m_count}m.b2_gjkMaxIters=am.Max(m.b2_gjkMaxIters,n);B.GetWitnessPoints(w.pointA,w.pointB);w.distance=am.SubtractVV(w.pointA,w.pointB).Length();w.iterations=n;B.WriteCache(q);if(p.useRadii){q=k.m_radius;g=g.m_radius;if(w.distance>q+g&&w.distance>Number.MIN_VALUE){w.distance-=q+g;p=am.SubtractVV(w.pointB,w.pointA);p.Normalize();w.pointA.x+=q*p.x;w.pointA.y+=q*p.y;w.pointB.x-=g*p.x;w.pointB.y-=g*p.y}else{j=new ap;j.x=0.5*(w.pointA.x+w.pointB.x);j.y=0.5*(w.pointA.y+w.pointB.y);w.pointA.x=w.pointB.x=j.x;w.pointA.y=w.pointB.y=j.y;w.distance=0}}};e.postDefs.push(function(){e.Collision.b2Distance.s_simplex=new aw;e.Collision.b2Distance.s_saveA=new a(3);e.Collision.b2Distance.s_saveB=new a(3)});i.b2DistanceInput=function(){};au.b2DistanceOutput=function(){this.pointA=new ap;this.pointB=new ap};ak.b2DistanceProxy=function(){};ak.prototype.Set=function(g){switch(g.GetType()){case X.e_circleShape:g=g instanceof ae?g:null;this.m_vertices=new b(1,true);this.m_vertices[0]=g.m_p;this.m_count=1;this.m_radius=g.m_radius;break;case X.e_polygonShape:g=g instanceof ad?g:null;this.m_vertices=g.m_vertices;this.m_count=g.m_vertexCount;this.m_radius=g.m_radius;break;default:al.b2Assert(false)}};ak.prototype.GetSupport=function(h){for(var l=0,k=this.m_vertices[0].x*h.x+this.m_vertices[0].y*h.y,g=1;g<this.m_count;++g){var j=this.m_vertices[g].x*h.x+this.m_vertices[g].y*h.y;if(j>k){l=g;k=j}}return l};ak.prototype.GetSupportVertex=function(h){for(var l=0,k=this.m_vertices[0].x*h.x+this.m_vertices[0].y*h.y,g=1;g<this.m_count;++g){var j=this.m_vertices[g].x*h.x+this.m_vertices[g].y*h.y;if(j>k){l=g;k=j}}return this.m_vertices[l]};ak.prototype.GetVertexCount=function(){return this.m_count};ak.prototype.GetVertex=function(g){if(g===undefined){g=0}al.b2Assert(0<=g&&g<this.m_count);return this.m_vertices[g]};an.b2DynamicTree=function(){};an.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};an.prototype.CreateProxy=function(h,l){var k=this.AllocateNode(),g=al.b2_aabbExtension,j=al.b2_aabbExtension;k.aabb.lowerBound.x=h.lowerBound.x-g;k.aabb.lowerBound.y=h.lowerBound.y-j;k.aabb.upperBound.x=h.upperBound.x+g;k.aabb.upperBound.y=h.upperBound.y+j;k.userData=l;this.InsertLeaf(k);return k};an.prototype.DestroyProxy=function(g){this.RemoveLeaf(g);this.FreeNode(g)};an.prototype.MoveProxy=function(h,k,j){al.b2Assert(h.IsLeaf());if(h.aabb.Contains(k)){return false}this.RemoveLeaf(h);var g=al.b2_aabbExtension+al.b2_aabbMultiplier*(j.x>0?j.x:-j.x);j=al.b2_aabbExtension+al.b2_aabbMultiplier*(j.y>0?j.y:-j.y);h.aabb.lowerBound.x=k.lowerBound.x-g;h.aabb.lowerBound.y=k.lowerBound.y-j;h.aabb.upperBound.x=k.upperBound.x+g;h.aabb.upperBound.y=k.upperBound.y+j;this.InsertLeaf(h);return true};an.prototype.Rebalance=function(h){if(h===undefined){h=0}if(this.m_root!=null){for(var k=0;k<h;k++){for(var j=this.m_root,g=0;j.IsLeaf()==false;){j=this.m_path>>g&1?j.child2:j.child1;g=g+1&31}++this.m_path;this.RemoveLeaf(j);this.InsertLeaf(j)}}};an.prototype.GetFatAABB=function(g){return g.aabb};an.prototype.GetUserData=function(g){return g.userData};an.prototype.Query=function(h,l){if(this.m_root!=null){var k=new b,g=0;for(k[g++]=this.m_root;g>0;){var j=k[--g];if(j.aabb.TestOverlap(l)){if(j.IsLeaf()){if(!h(j)){break}}else{k[g++]=j.child1;k[g++]=j.child2}}}}};an.prototype.RayCast=function(o,n){if(this.m_root!=null){var l=n.p1,j=n.p2,g=am.SubtractVV(l,j);g.Normalize();g=am.CrossFV(1,g);var y=am.AbsV(g),u=n.maxFraction,w=new ah,q=0,h=0;q=l.x+u*(j.x-l.x);h=l.y+u*(j.y-l.y);w.lowerBound.x=Math.min(l.x,q);w.lowerBound.y=Math.min(l.y,h);w.upperBound.x=Math.max(l.x,q);w.upperBound.y=Math.max(l.y,h);var p=new b,k=0;for(p[k++]=this.m_root;k>0;){u=p[--k];if(u.aabb.TestOverlap(w)!=false){q=u.aabb.GetCenter();h=u.aabb.GetExtents();if(!(Math.abs(g.x*(l.x-q.x)+g.y*(l.y-q.y))-y.x*h.x-y.y*h.y>0)){if(u.IsLeaf()){q=new t;q.p1=n.p1;q.p2=n.p2;q.maxFraction=n.maxFraction;u=o(q,u);if(u==0){break}if(u>0){q=l.x+u*(j.x-l.x);h=l.y+u*(j.y-l.y);w.lowerBound.x=Math.min(l.x,q);w.lowerBound.y=Math.min(l.y,h);w.upperBound.x=Math.max(l.x,q);w.upperBound.y=Math.max(l.y,h)}}else{p[k++]=u.child1;p[k++]=u.child2}}}}}};an.prototype.AllocateNode=function(){if(this.m_freeList){var g=this.m_freeList;this.m_freeList=g.parent;g.parent=null;g.child1=null;g.child2=null;return g}return new ac};an.prototype.FreeNode=function(g){g.parent=this.m_freeList;this.m_freeList=g};an.prototype.InsertLeaf=function(h){++this.m_insertionCount;if(this.m_root==null){this.m_root=h;this.m_root.parent=null}else{var k=h.aabb.GetCenter(),j=this.m_root;if(j.IsLeaf()==false){do{var g=j.child1;j=j.child2;j=Math.abs((g.aabb.lowerBound.x+g.aabb.upperBound.x)/2-k.x)+Math.abs((g.aabb.lowerBound.y+g.aabb.upperBound.y)/2-k.y)<Math.abs((j.aabb.lowerBound.x+j.aabb.upperBound.x)/2-k.x)+Math.abs((j.aabb.lowerBound.y+j.aabb.upperBound.y)/2-k.y)?g:j}while(j.IsLeaf()==false)}k=j.parent;g=this.AllocateNode();g.parent=k;g.userData=null;g.aabb.Combine(h.aabb,j.aabb);if(k){if(j.parent.child1==j){k.child1=g}else{k.child2=g}g.child1=j;g.child2=h;j.parent=g;h.parent=g;do{if(k.aabb.Contains(g.aabb)){break}k.aabb.Combine(k.child1.aabb,k.child2.aabb);g=k;k=k.parent}while(k)}else{g.child1=j;g.child2=h;j.parent=g;this.m_root=h.parent=g}}};an.prototype.RemoveLeaf=function(g){if(g==this.m_root){this.m_root=null}else{var j=g.parent,h=j.parent;g=j.child1==g?j.child2:j.child1;if(h){if(h.child1==j){h.child1=g}else{h.child2=g}g.parent=h;for(this.FreeNode(j);h;){j=h.aabb;h.aabb=ah.Combine(h.child1.aabb,h.child2.aabb);if(j.Contains(h.aabb)){break}h=h.parent}}else{this.m_root=g;g.parent=null;this.FreeNode(j)}}};ag.b2DynamicTreeBroadPhase=function(){this.m_tree=new an;this.m_moveBuffer=new b;this.m_pairBuffer=new b;this.m_pairCount=0};ag.prototype.CreateProxy=function(g,j){var h=this.m_tree.CreateProxy(g,j);++this.m_proxyCount;this.BufferMove(h);return h};ag.prototype.DestroyProxy=function(g){this.UnBufferMove(g);--this.m_proxyCount;this.m_tree.DestroyProxy(g)};ag.prototype.MoveProxy=function(g,j,h){this.m_tree.MoveProxy(g,j,h)&&this.BufferMove(g)};ag.prototype.TestOverlap=function(h,k){var j=this.m_tree.GetFatAABB(h),g=this.m_tree.GetFatAABB(k);return j.TestOverlap(g)};ag.prototype.GetUserData=function(g){return this.m_tree.GetUserData(g)};ag.prototype.GetFatAABB=function(g){return this.m_tree.GetFatAABB(g)};ag.prototype.GetProxyCount=function(){return this.m_proxyCount};ag.prototype.UpdatePairs=function(h){var o=this;var n=o.m_pairCount=0,g;for(n=0;n<o.m_moveBuffer.length;++n){g=o.m_moveBuffer[n];var l=o.m_tree.GetFatAABB(g);o.m_tree.Query(function(q){if(q==g){return true}if(o.m_pairCount==o.m_pairBuffer.length){o.m_pairBuffer[o.m_pairCount]=new C}var p=o.m_pairBuffer[o.m_pairCount];p.proxyA=q<g?q:g;p.proxyB=q>=g?q:g;++o.m_pairCount;return true},l)}for(n=o.m_moveBuffer.length=0;n<o.m_pairCount;){l=o.m_pairBuffer[n];var k=o.m_tree.GetUserData(l.proxyA),j=o.m_tree.GetUserData(l.proxyB);h(k,j);for(++n;n<o.m_pairCount;){k=o.m_pairBuffer[n];if(k.proxyA!=l.proxyA||k.proxyB!=l.proxyB){break}++n}}};ag.prototype.Query=function(g,h){this.m_tree.Query(g,h)};ag.prototype.RayCast=function(g,h){this.m_tree.RayCast(g,h)};ag.prototype.Validate=function(){};ag.prototype.Rebalance=function(g){if(g===undefined){g=0}this.m_tree.Rebalance(g)};ag.prototype.BufferMove=function(g){this.m_moveBuffer[this.m_moveBuffer.length]=g};ag.prototype.UnBufferMove=function(g){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(g)),1)};ag.prototype.ComparePairs=function(){return 0};ag.__implements={};ag.__implements[ax]=true;ac.b2DynamicTreeNode=function(){this.aabb=new ah};ac.prototype.IsLeaf=function(){return this.child1==null};C.b2DynamicTreePair=function(){};af.b2Manifold=function(){this.m_pointCount=0};af.prototype.b2Manifold=function(){this.m_points=new b(al.b2_maxManifoldPoints);for(var g=0;g<al.b2_maxManifoldPoints;g++){this.m_points[g]=new v}this.m_localPlaneNormal=new ap;this.m_localPoint=new ap};af.prototype.Reset=function(){for(var g=0;g<al.b2_maxManifoldPoints;g++){(this.m_points[g] instanceof v?this.m_points[g]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};af.prototype.Set=function(g){this.m_pointCount=g.m_pointCount;for(var h=0;h<al.b2_maxManifoldPoints;h++){(this.m_points[h] instanceof v?this.m_points[h]:null).Set(g.m_points[h])}this.m_localPlaneNormal.SetV(g.m_localPlaneNormal);this.m_localPoint.SetV(g.m_localPoint);this.m_type=g.m_type};af.prototype.Copy=function(){var g=new af;g.Set(this);return g};e.postDefs.push(function(){e.Collision.b2Manifold.e_circles=1;e.Collision.b2Manifold.e_faceA=2;e.Collision.b2Manifold.e_faceB=4});v.b2ManifoldPoint=function(){this.m_localPoint=new ap;this.m_id=new T};v.prototype.b2ManifoldPoint=function(){this.Reset()};v.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};v.prototype.Set=function(g){this.m_localPoint.SetV(g.m_localPoint);this.m_normalImpulse=g.m_normalImpulse;this.m_tangentImpulse=g.m_tangentImpulse;this.m_id.Set(g.m_id)};J.b2Point=function(){this.p=new ap};J.prototype.Support=function(){return this.p};J.prototype.GetFirstVertex=function(){return this.p};t.b2RayCastInput=function(){this.p1=new ap;this.p2=new ap};t.prototype.b2RayCastInput=function(g,j,h){if(g===undefined){g=null}if(j===undefined){j=null}if(h===undefined){h=1}g&&this.p1.SetV(g);j&&this.p2.SetV(j);this.maxFraction=h};aj.b2RayCastOutput=function(){this.normal=new ap};f.b2Segment=function(){this.p1=new ap;this.p2=new ap};f.prototype.TestSegment=function(o,n,l,j){if(j===undefined){j=0}var g=l.p1,y=l.p2.x-g.x,u=l.p2.y-g.y;l=this.p2.y-this.p1.y;var w=-(this.p2.x-this.p1.x),q=100*Number.MIN_VALUE,h=-(y*l+u*w);if(h>q){var p=g.x-this.p1.x,k=g.y-this.p1.y;g=p*l+k*w;if(0<=g&&g<=j*h){j=-y*k+u*p;if(-q*h<=j&&j<=h*(1+q)){g/=h;j=Math.sqrt(l*l+w*w);l/=j;w/=j;o[0]=g;n.Set(l,w);return true}}}return false};f.prototype.Extend=function(g){this.ExtendForward(g);this.ExtendBackward(g)};f.prototype.ExtendForward=function(g){var j=this.p2.x-this.p1.x,h=this.p2.y-this.p1.y;g=Math.min(j>0?(g.upperBound.x-this.p1.x)/j:j<0?(g.lowerBound.x-this.p1.x)/j:Number.POSITIVE_INFINITY,h>0?(g.upperBound.y-this.p1.y)/h:h<0?(g.lowerBound.y-this.p1.y)/h:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+j*g;this.p2.y=this.p1.y+h*g};f.prototype.ExtendBackward=function(g){var j=-this.p2.x+this.p1.x,h=-this.p2.y+this.p1.y;g=Math.min(j>0?(g.upperBound.x-this.p2.x)/j:j<0?(g.lowerBound.x-this.p2.x)/j:Number.POSITIVE_INFINITY,h>0?(g.upperBound.y-this.p2.y)/h:h<0?(g.lowerBound.y-this.p2.y)/h:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+j*g;this.p1.y=this.p2.y+h*g};ay.b2SeparationFunction=function(){this.m_localPoint=new ap;this.m_axis=new ap};ay.prototype.Initialize=function(o,n,l,j,g){this.m_proxyA=n;this.m_proxyB=j;var y=parseInt(o.count);al.b2Assert(0<y&&y<3);var u,w,q,h,p=h=q=j=n=0,k=0;p=0;if(y==1){this.m_type=ay.e_points;u=this.m_proxyA.GetVertex(o.indexA[0]);w=this.m_proxyB.GetVertex(o.indexB[0]);y=u;o=l.R;n=l.position.x+(o.col1.x*y.x+o.col2.x*y.y);j=l.position.y+(o.col1.y*y.x+o.col2.y*y.y);y=w;o=g.R;q=g.position.x+(o.col1.x*y.x+o.col2.x*y.y);h=g.position.y+(o.col1.y*y.x+o.col2.y*y.y);this.m_axis.x=q-n;this.m_axis.y=h-j;this.m_axis.Normalize()}else{if(o.indexB[0]==o.indexB[1]){this.m_type=ay.e_faceA;n=this.m_proxyA.GetVertex(o.indexA[0]);j=this.m_proxyA.GetVertex(o.indexA[1]);w=this.m_proxyB.GetVertex(o.indexB[0]);this.m_localPoint.x=0.5*(n.x+j.x);this.m_localPoint.y=0.5*(n.y+j.y);this.m_axis=am.CrossVF(am.SubtractVV(j,n),1);this.m_axis.Normalize();y=this.m_axis;o=l.R;p=o.col1.x*y.x+o.col2.x*y.y;k=o.col1.y*y.x+o.col2.y*y.y;y=this.m_localPoint;o=l.R;n=l.position.x+(o.col1.x*y.x+o.col2.x*y.y);j=l.position.y+(o.col1.y*y.x+o.col2.y*y.y);y=w;o=g.R;q=g.position.x+(o.col1.x*y.x+o.col2.x*y.y);h=g.position.y+(o.col1.y*y.x+o.col2.y*y.y);p=(q-n)*p+(h-j)*k}else{if(o.indexA[0]==o.indexA[0]){this.m_type=ay.e_faceB;q=this.m_proxyB.GetVertex(o.indexB[0]);h=this.m_proxyB.GetVertex(o.indexB[1]);u=this.m_proxyA.GetVertex(o.indexA[0]);this.m_localPoint.x=0.5*(q.x+h.x);this.m_localPoint.y=0.5*(q.y+h.y);this.m_axis=am.CrossVF(am.SubtractVV(h,q),1);this.m_axis.Normalize();y=this.m_axis;o=g.R;p=o.col1.x*y.x+o.col2.x*y.y;k=o.col1.y*y.x+o.col2.y*y.y;y=this.m_localPoint;o=g.R;q=g.position.x+(o.col1.x*y.x+o.col2.x*y.y);h=g.position.y+(o.col1.y*y.x+o.col2.y*y.y);y=u;o=l.R;n=l.position.x+(o.col1.x*y.x+o.col2.x*y.y);j=l.position.y+(o.col1.y*y.x+o.col2.y*y.y);p=(n-q)*p+(j-h)*k}else{n=this.m_proxyA.GetVertex(o.indexA[0]);j=this.m_proxyA.GetVertex(o.indexA[1]);q=this.m_proxyB.GetVertex(o.indexB[0]);h=this.m_proxyB.GetVertex(o.indexB[1]);am.MulX(l,u);u=am.MulMV(l.R,am.SubtractVV(j,n));am.MulX(g,w);p=am.MulMV(g.R,am.SubtractVV(h,q));g=u.x*u.x+u.y*u.y;w=p.x*p.x+p.y*p.y;o=am.SubtractVV(p,u);l=u.x*o.x+u.y*o.y;o=p.x*o.x+p.y*o.y;u=u.x*p.x+u.y*p.y;k=g*w-u*u;p=0;if(k!=0){p=am.Clamp((u*o-l*w)/k,0,1)}if((u*p+o)/w<0){p=am.Clamp((u-l)/g,0,1)}u=new ap;u.x=n.x+p*(j.x-n.x);u.y=n.y+p*(j.y-n.y);w=new ap;w.x=q.x+p*(h.x-q.x);w.y=q.y+p*(h.y-q.y);if(p==0||p==1){this.m_type=ay.e_faceB;this.m_axis=am.CrossVF(am.SubtractVV(h,q),1);this.m_axis.Normalize();this.m_localPoint=w}else{this.m_type=ay.e_faceA;this.m_axis=am.CrossVF(am.SubtractVV(j,n),1);this.m_localPoint=u}}}p<0&&this.m_axis.NegativeSelf()}};ay.prototype.Evaluate=function(h,l){var k,g,j=0;switch(this.m_type){case ay.e_points:k=am.MulTMV(h.R,this.m_axis);g=am.MulTMV(l.R,this.m_axis.GetNegative());k=this.m_proxyA.GetSupportVertex(k);g=this.m_proxyB.GetSupportVertex(g);k=am.MulX(h,k);g=am.MulX(l,g);return j=(g.x-k.x)*this.m_axis.x+(g.y-k.y)*this.m_axis.y;case ay.e_faceA:j=am.MulMV(h.R,this.m_axis);k=am.MulX(h,this.m_localPoint);g=am.MulTMV(l.R,j.GetNegative());g=this.m_proxyB.GetSupportVertex(g);g=am.MulX(l,g);return j=(g.x-k.x)*j.x+(g.y-k.y)*j.y;case ay.e_faceB:j=am.MulMV(l.R,this.m_axis);g=am.MulX(l,this.m_localPoint);k=am.MulTMV(h.R,j.GetNegative());k=this.m_proxyA.GetSupportVertex(k);k=am.MulX(h,k);return j=(k.x-g.x)*j.x+(k.y-g.y)*j.y;default:al.b2Assert(false);return 0}};e.postDefs.push(function(){e.Collision.b2SeparationFunction.e_points=1;e.Collision.b2SeparationFunction.e_faceA=2;e.Collision.b2SeparationFunction.e_faceB=4});aw.b2Simplex=function(){this.m_v1=new av;this.m_v2=new av;this.m_v3=new av;this.m_vertices=new b(3)};aw.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};aw.prototype.ReadCache=function(n,l,k,j,g){al.b2Assert(0<=n.count&&n.count<=3);var u,p;this.m_count=n.count;for(var q=this.m_vertices,o=0;o<this.m_count;o++){var h=q[o];h.indexA=n.indexA[o];h.indexB=n.indexB[o];u=l.GetVertex(h.indexA);p=j.GetVertex(h.indexB);h.wA=am.MulX(k,u);h.wB=am.MulX(g,p);h.w=am.SubtractVV(h.wB,h.wA);h.a=0}if(this.m_count>1){n=n.metric;u=this.GetMetric();if(u<0.5*n||2*n<u||u<Number.MIN_VALUE){this.m_count=0}}if(this.m_count==0){h=q[0];h.indexA=0;h.indexB=0;u=l.GetVertex(0);p=j.GetVertex(0);h.wA=am.MulX(k,u);h.wB=am.MulX(g,p);h.w=am.SubtractVV(h.wB,h.wA);this.m_count=1}};aw.prototype.WriteCache=function(g){g.metric=this.GetMetric();g.count=e.parseUInt(this.m_count);for(var j=this.m_vertices,h=0;h<this.m_count;h++){g.indexA[h]=e.parseUInt(j[h].indexA);g.indexB[h]=e.parseUInt(j[h].indexB)}};aw.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var g=am.SubtractVV(this.m_v2.w,this.m_v1.w);return am.CrossVV(g,this.m_v1.w.GetNegative())>0?am.CrossFV(1,g):am.CrossVF(g,1);default:al.b2Assert(false);return new ap}};aw.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:al.b2Assert(false);return new ap;case 1:return this.m_v1.w;case 2:return new ap(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:al.b2Assert(false);return new ap}};aw.prototype.GetWitnessPoints=function(g,h){switch(this.m_count){case 0:al.b2Assert(false);break;case 1:g.SetV(this.m_v1.wA);h.SetV(this.m_v1.wB);break;case 2:g.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;g.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;h.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;h.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:h.x=g.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;h.y=g.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:al.b2Assert(false)}};aw.prototype.GetMetric=function(){switch(this.m_count){case 0:al.b2Assert(false);return 0;case 1:return 0;case 2:return am.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return am.CrossVV(am.SubtractVV(this.m_v2.w,this.m_v1.w),am.SubtractVV(this.m_v3.w,this.m_v1.w));default:al.b2Assert(false);return 0}};aw.prototype.Solve2=function(){var g=this.m_v1.w,j=this.m_v2.w,h=am.SubtractVV(j,g);g=-(g.x*h.x+g.y*h.y);if(g<=0){this.m_count=this.m_v1.a=1}else{j=j.x*h.x+j.y*h.y;if(j<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else{h=1/(j+g);this.m_v1.a=j*h;this.m_v2.a=g*h;this.m_count=2}}};aw.prototype.Solve3=function(){var n=this.m_v1.w,l=this.m_v2.w,k=this.m_v3.w,j=am.SubtractVV(l,n),g=am.Dot(n,j),w=am.Dot(l,j);g=-g;var q=am.SubtractVV(k,n),u=am.Dot(n,q),p=am.Dot(k,q);u=-u;var h=am.SubtractVV(k,l),o=am.Dot(l,h);h=am.Dot(k,h);o=-o;q=am.CrossVV(j,q);j=q*am.CrossVV(l,k);k=q*am.CrossVV(k,n);n=q*am.CrossVV(n,l);if(g<=0&&u<=0){this.m_count=this.m_v1.a=1}else{if(w>0&&g>0&&n<=0){p=1/(w+g);this.m_v1.a=w*p;this.m_v2.a=g*p;this.m_count=2}else{if(p>0&&u>0&&k<=0){w=1/(p+u);this.m_v1.a=p*w;this.m_v3.a=u*w;this.m_count=2;this.m_v2.Set(this.m_v3)}else{if(w<=0&&o<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else{if(p<=0&&h<=0){this.m_count=this.m_v3.a=1;this.m_v1.Set(this.m_v3)}else{if(h>0&&o>0&&j<=0){w=1/(h+o);this.m_v2.a=h*w;this.m_v3.a=o*w;this.m_count=2;this.m_v1.Set(this.m_v3)}else{w=1/(j+k+n);this.m_v1.a=j*w;this.m_v2.a=k*w;this.m_v3.a=n*w;this.m_count=3}}}}}}};at.b2SimplexCache=function(){this.indexA=new a(3);this.indexB=new a(3)};av.b2SimplexVertex=function(){};av.prototype.Set=function(g){this.wA.SetV(g.wA);this.wB.SetV(g.wB);this.w.SetV(g.w);this.a=g.a;this.indexA=g.indexA;this.indexB=g.indexB};aq.b2TimeOfImpact=function(){};aq.TimeOfImpact=function(y){++aq.b2_toiCalls;var u=y.proxyA,q=y.proxyB,k=y.sweepA,g=y.sweepB;al.b2Assert(k.t0==g.t0);al.b2Assert(1-k.t0>Number.MIN_VALUE);var E=u.m_radius+q.m_radius;y=y.tolerance;var B=0,D=0,A=0;aq.s_cache.count=0;for(aq.s_distanceInput.useRadii=false;;){k.GetTransform(aq.s_xfA,B);g.GetTransform(aq.s_xfB,B);aq.s_distanceInput.proxyA=u;aq.s_distanceInput.proxyB=q;aq.s_distanceInput.transformA=aq.s_xfA;aq.s_distanceInput.transformB=aq.s_xfB;m.Distance(aq.s_distanceOutput,aq.s_cache,aq.s_distanceInput);if(aq.s_distanceOutput.distance<=0){B=1;break}aq.s_fcn.Initialize(aq.s_cache,u,aq.s_xfA,q,aq.s_xfB);var h=aq.s_fcn.Evaluate(aq.s_xfA,aq.s_xfB);if(h<=0){B=1;break}if(D==0){A=h>E?am.Max(E-y,0.75*E):am.Max(h-y,0.02*E)}if(h-A<0.5*y){if(D==0){B=1;break}break}var z=B,n=B,p=1;h=h;k.GetTransform(aq.s_xfA,p);g.GetTransform(aq.s_xfB,p);var j=aq.s_fcn.Evaluate(aq.s_xfA,aq.s_xfB);if(j>=A){B=1;break}for(var o=0;;){var w=0;w=o&1?n+(A-h)*(p-n)/(j-h):0.5*(n+p);k.GetTransform(aq.s_xfA,w);g.GetTransform(aq.s_xfB,w);var l=aq.s_fcn.Evaluate(aq.s_xfA,aq.s_xfB);if(am.Abs(l-A)<0.025*y){z=w;break}if(l>A){n=w;h=l}else{p=w;j=l}++o;++aq.b2_toiRootIters;if(o==50){break}}aq.b2_toiMaxRootIters=am.Max(aq.b2_toiMaxRootIters,o);if(z<(1+100*Number.MIN_VALUE)*B){break}B=z;D++;++aq.b2_toiIters;if(D==1000){break}}aq.b2_toiMaxIters=am.Max(aq.b2_toiMaxIters,D);return B};e.postDefs.push(function(){e.Collision.b2TimeOfImpact.b2_toiCalls=0;e.Collision.b2TimeOfImpact.b2_toiIters=0;e.Collision.b2TimeOfImpact.b2_toiMaxIters=0;e.Collision.b2TimeOfImpact.b2_toiRootIters=0;e.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;e.Collision.b2TimeOfImpact.s_cache=new at;e.Collision.b2TimeOfImpact.s_distanceInput=new i;e.Collision.b2TimeOfImpact.s_xfA=new s;e.Collision.b2TimeOfImpact.s_xfB=new s;e.Collision.b2TimeOfImpact.s_fcn=new ay;e.Collision.b2TimeOfImpact.s_distanceOutput=new au});ao.b2TOIInput=function(){this.proxyA=new ak;this.proxyB=new ak;this.sweepA=new ai;this.sweepB=new ai};ar.b2WorldManifold=function(){this.m_normal=new ap};ar.prototype.b2WorldManifold=function(){this.m_points=new b(al.b2_maxManifoldPoints);for(var g=0;g<al.b2_maxManifoldPoints;g++){this.m_points[g]=new ap}};ar.prototype.Initialize=function(p,o,n,j,g){if(n===undefined){n=0}if(g===undefined){g=0}if(p.m_pointCount!=0){var z=0,w,y,u=0,h=0,q=0,k=0,l=0;w=0;switch(p.m_type){case af.e_circles:y=o.R;w=p.m_localPoint;z=o.position.x+y.col1.x*w.x+y.col2.x*w.y;o=o.position.y+y.col1.y*w.x+y.col2.y*w.y;y=j.R;w=p.m_points[0].m_localPoint;p=j.position.x+y.col1.x*w.x+y.col2.x*w.y;j=j.position.y+y.col1.y*w.x+y.col2.y*w.y;w=p-z;y=j-o;u=w*w+y*y;if(u>Number.MIN_VALUE*Number.MIN_VALUE){u=Math.sqrt(u);this.m_normal.x=w/u;this.m_normal.y=y/u}else{this.m_normal.x=1;this.m_normal.y=0}w=o+n*this.m_normal.y;j=j-g*this.m_normal.y;this.m_points[0].x=0.5*(z+n*this.m_normal.x+(p-g*this.m_normal.x));this.m_points[0].y=0.5*(w+j);break;case af.e_faceA:y=o.R;w=p.m_localPlaneNormal;u=y.col1.x*w.x+y.col2.x*w.y;h=y.col1.y*w.x+y.col2.y*w.y;y=o.R;w=p.m_localPoint;q=o.position.x+y.col1.x*w.x+y.col2.x*w.y;k=o.position.y+y.col1.y*w.x+y.col2.y*w.y;this.m_normal.x=u;this.m_normal.y=h;for(z=0;z<p.m_pointCount;z++){y=j.R;w=p.m_points[z].m_localPoint;l=j.position.x+y.col1.x*w.x+y.col2.x*w.y;w=j.position.y+y.col1.y*w.x+y.col2.y*w.y;this.m_points[z].x=l+0.5*(n-(l-q)*u-(w-k)*h-g)*u;this.m_points[z].y=w+0.5*(n-(l-q)*u-(w-k)*h-g)*h}break;case af.e_faceB:y=j.R;w=p.m_localPlaneNormal;u=y.col1.x*w.x+y.col2.x*w.y;h=y.col1.y*w.x+y.col2.y*w.y;y=j.R;w=p.m_localPoint;q=j.position.x+y.col1.x*w.x+y.col2.x*w.y;k=j.position.y+y.col1.y*w.x+y.col2.y*w.y;this.m_normal.x=-u;this.m_normal.y=-h;for(z=0;z<p.m_pointCount;z++){y=o.R;w=p.m_points[z].m_localPoint;l=o.position.x+y.col1.x*w.x+y.col2.x*w.y;w=o.position.y+y.col1.y*w.x+y.col2.y*w.y;this.m_points[z].x=l+0.5*(g-(l-q)*u-(w-k)*h-n)*u;this.m_points[z].y=w+0.5*(g-(l-q)*u-(w-k)*h-n)*h}}}};aA.ClipVertex=function(){this.v=new ap;this.id=new T};aA.prototype.Set=function(g){this.v.SetV(g.v);this.id.Set(g.id)};az.Features=function(){};Object.defineProperty(az.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(az.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(g){if(g===undefined){g=0}this._referenceEdge=g;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(az.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(az.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(g){if(g===undefined){g=0}this._incidentEdge=g;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(az.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(az.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(g){if(g===undefined){g=0}this._incidentVertex=g;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(az.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(az.prototype,"flip",{enumerable:false,configurable:true,set:function(g){if(g===undefined){g=0}this._flip=g;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var v=e.Common.b2Settings,u=e.Collision.Shapes.b2CircleShape,r=e.Collision.Shapes.b2EdgeChainDef,q=e.Collision.Shapes.b2EdgeShape,t=e.Collision.Shapes.b2MassData,i=e.Collision.Shapes.b2PolygonShape,l=e.Collision.Shapes.b2Shape,h=e.Common.Math.b2Mat22,g=e.Common.Math.b2Math,m=e.Common.Math.b2Transform,k=e.Common.Math.b2Vec2,n=e.Collision.b2Distance,o=e.Collision.b2DistanceInput,s=e.Collision.b2DistanceOutput,j=e.Collision.b2DistanceProxy,f=e.Collision.b2SimplexCache;e.inherit(u,e.Collision.Shapes.b2Shape);u.prototype.__super=e.Collision.Shapes.b2Shape.prototype;u.b2CircleShape=function(){e.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new k};u.prototype.Copy=function(){var p=new u;p.Set(this);return p};u.prototype.Set=function(p){this.__super.Set.call(this,p);if(e.is(p,u)){this.m_p.SetV((p instanceof u?p:null).m_p)}};u.prototype.TestPoint=function(p,y){var w=p.R,x=p.position.x+(w.col1.x*this.m_p.x+w.col2.x*this.m_p.y);w=p.position.y+(w.col1.y*this.m_p.x+w.col2.y*this.m_p.y);x=y.x-x;w=y.y-w;return x*x+w*w<=this.m_radius*this.m_radius};u.prototype.RayCast=function(w,B,F){var p=F.R,C=B.p1.x-(F.position.x+(p.col1.x*this.m_p.x+p.col2.x*this.m_p.y));F=B.p1.y-(F.position.y+(p.col1.y*this.m_p.x+p.col2.y*this.m_p.y));p=B.p2.x-B.p1.x;var y=B.p2.y-B.p1.y,G=C*p+F*y,x=p*p+y*y,A=G*G-x*(C*C+F*F-this.m_radius*this.m_radius);if(A<0||x<Number.MIN_VALUE){return false}G=-(G+Math.sqrt(A));if(0<=G&&G<=B.maxFraction*x){G/=x;w.fraction=G;w.normal.x=C+G*p;w.normal.y=F+G*y;w.normal.Normalize();return true}return false};u.prototype.ComputeAABB=function(p,y){var w=y.R,x=y.position.x+(w.col1.x*this.m_p.x+w.col2.x*this.m_p.y);w=y.position.y+(w.col1.y*this.m_p.x+w.col2.y*this.m_p.y);p.lowerBound.Set(x-this.m_radius,w-this.m_radius);p.upperBound.Set(x+this.m_radius,w+this.m_radius)};u.prototype.ComputeMass=function(p,w){if(w===undefined){w=0}p.mass=w*v.b2_pi*this.m_radius*this.m_radius;p.center.SetV(this.m_p);p.I=p.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};u.prototype.ComputeSubmergedArea=function(p,B,w,A){if(B===undefined){B=0}w=g.MulX(w,this.m_p);var x=-(g.Dot(p,w)-B);if(x<-this.m_radius+Number.MIN_VALUE){return 0}if(x>this.m_radius){A.SetV(w);return Math.PI*this.m_radius*this.m_radius}B=this.m_radius*this.m_radius;var y=x*x;x=B*(Math.asin(x/this.m_radius)+Math.PI/2)+x*Math.sqrt(B-y);B=-2/3*Math.pow(B-y,1.5)/x;A.x=w.x+p.x*B;A.y=w.y+p.y*B;return x};u.prototype.GetLocalPosition=function(){return this.m_p};u.prototype.SetLocalPosition=function(p){this.m_p.SetV(p)};u.prototype.GetRadius=function(){return this.m_radius};u.prototype.SetRadius=function(p){if(p===undefined){p=0}this.m_radius=p};u.prototype.b2CircleShape=function(p){if(p===undefined){p=0}this.__super.b2Shape.call(this);this.m_type=l.e_circleShape;this.m_radius=p};r.b2EdgeChainDef=function(){};r.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};e.inherit(q,e.Collision.Shapes.b2Shape);q.prototype.__super=e.Collision.Shapes.b2Shape.prototype;q.b2EdgeShape=function(){e.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new k;this.m_v1=new k;this.m_v2=new k;this.m_coreV1=new k;this.m_coreV2=new k;this.m_normal=new k;this.m_direction=new k;this.m_cornerDir1=new k;this.m_cornerDir2=new k};q.prototype.TestPoint=function(){return false};q.prototype.RayCast=function(x,F,I){var w,G=F.p2.x-F.p1.x,B=F.p2.y-F.p1.y;w=I.R;var J=I.position.x+(w.col1.x*this.m_v1.x+w.col2.x*this.m_v1.y),A=I.position.y+(w.col1.y*this.m_v1.x+w.col2.y*this.m_v1.y),C=I.position.y+(w.col1.y*this.m_v2.x+w.col2.y*this.m_v2.y)-A;I=-(I.position.x+(w.col1.x*this.m_v2.x+w.col2.x*this.m_v2.y)-J);w=100*Number.MIN_VALUE;var y=-(G*C+B*I);if(y>w){J=F.p1.x-J;var p=F.p1.y-A;A=J*C+p*I;if(0<=A&&A<=F.maxFraction*y){F=-G*p+B*J;if(-w*y<=F&&F<=y*(1+w)){A/=y;x.fraction=A;F=Math.sqrt(C*C+I*I);x.normal.x=C/F;x.normal.y=I/F;return true}}}return false};q.prototype.ComputeAABB=function(p,B){var w=B.R,A=B.position.x+(w.col1.x*this.m_v1.x+w.col2.x*this.m_v1.y),x=B.position.y+(w.col1.y*this.m_v1.x+w.col2.y*this.m_v1.y),y=B.position.x+(w.col1.x*this.m_v2.x+w.col2.x*this.m_v2.y);w=B.position.y+(w.col1.y*this.m_v2.x+w.col2.y*this.m_v2.y);if(A<y){p.lowerBound.x=A;p.upperBound.x=y}else{p.lowerBound.x=y;p.upperBound.x=A}if(x<w){p.lowerBound.y=x;p.upperBound.y=w}else{p.lowerBound.y=w;p.upperBound.y=x}};q.prototype.ComputeMass=function(p){p.mass=0;p.center.SetV(this.m_v1);p.I=0};q.prototype.ComputeSubmergedArea=function(p,C,w,B){if(C===undefined){C=0}var x=new k(p.x*C,p.y*C),A=g.MulX(w,this.m_v1);w=g.MulX(w,this.m_v2);var y=g.Dot(p,A)-C;p=g.Dot(p,w)-C;if(y>0){if(p>0){return 0}else{A.x=-p/(y-p)*A.x+y/(y-p)*w.x;A.y=-p/(y-p)*A.y+y/(y-p)*w.y}}else{if(p>0){w.x=-p/(y-p)*A.x+y/(y-p)*w.x;w.y=-p/(y-p)*A.y+y/(y-p)*w.y}}B.x=(x.x+A.x+w.x)/3;B.y=(x.y+A.y+w.y)/3;return 0.5*((A.x-x.x)*(w.y-x.y)-(A.y-x.y)*(w.x-x.x))};q.prototype.GetLength=function(){return this.m_length};q.prototype.GetVertex1=function(){return this.m_v1};q.prototype.GetVertex2=function(){return this.m_v2};q.prototype.GetCoreVertex1=function(){return this.m_coreV1};q.prototype.GetCoreVertex2=function(){return this.m_coreV2};q.prototype.GetNormalVector=function(){return this.m_normal};q.prototype.GetDirectionVector=function(){return this.m_direction};q.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};q.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};q.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};q.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};q.prototype.GetFirstVertex=function(p){var w=p.R;return new k(p.position.x+(w.col1.x*this.m_coreV1.x+w.col2.x*this.m_coreV1.y),p.position.y+(w.col1.y*this.m_coreV1.x+w.col2.y*this.m_coreV1.y))};q.prototype.GetNextEdge=function(){return this.m_nextEdge};q.prototype.GetPrevEdge=function(){return this.m_prevEdge};q.prototype.Support=function(p,C,w){if(C===undefined){C=0}if(w===undefined){w=0}var B=p.R,x=p.position.x+(B.col1.x*this.m_coreV1.x+B.col2.x*this.m_coreV1.y),A=p.position.y+(B.col1.y*this.m_coreV1.x+B.col2.y*this.m_coreV1.y),y=p.position.x+(B.col1.x*this.m_coreV2.x+B.col2.x*this.m_coreV2.y);p=p.position.y+(B.col1.y*this.m_coreV2.x+B.col2.y*this.m_coreV2.y);if(x*C+A*w>y*C+p*w){this.s_supportVec.x=x;this.s_supportVec.y=A}else{this.s_supportVec.x=y;this.s_supportVec.y=p}return this.s_supportVec};q.prototype.b2EdgeShape=function(p,w){this.__super.b2Shape.call(this);this.m_type=l.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=p;this.m_v2=w;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-v.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-v.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-v.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-v.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};q.prototype.SetPrevEdge=function(p,y,w,x){this.m_prevEdge=p;this.m_coreV1=y;this.m_cornerDir1=w;this.m_cornerConvex1=x};q.prototype.SetNextEdge=function(p,y,w,x){this.m_nextEdge=p;this.m_coreV2=y;this.m_cornerDir2=w;this.m_cornerConvex2=x};t.b2MassData=function(){this.mass=0;this.center=new k(0,0);this.I=0};e.inherit(i,e.Collision.Shapes.b2Shape);i.prototype.__super=e.Collision.Shapes.b2Shape.prototype;i.b2PolygonShape=function(){e.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};i.prototype.Copy=function(){var p=new i;p.Set(this);return p};i.prototype.Set=function(p){this.__super.Set.call(this,p);if(e.is(p,i)){p=p instanceof i?p:null;this.m_centroid.SetV(p.m_centroid);this.m_vertexCount=p.m_vertexCount;this.Reserve(this.m_vertexCount);for(var w=0;w<this.m_vertexCount;w++){this.m_vertices[w].SetV(p.m_vertices[w]);this.m_normals[w].SetV(p.m_normals[w])}}};i.prototype.SetAsArray=function(p,A){if(A===undefined){A=0}var w=new b,y=0,x;for(y=0;y<p.length;++y){x=p[y];w.push(x)}this.SetAsVector(w,A)};i.AsArray=function(p,x){if(x===undefined){x=0}var w=new i;w.SetAsArray(p,x);return w};i.prototype.SetAsVector=function(p,A){if(A===undefined){A=0}if(A==0){A=p.length}v.b2Assert(2<=A);this.m_vertexCount=A;this.Reserve(A);var w=0;for(w=0;w<this.m_vertexCount;w++){this.m_vertices[w].SetV(p[w])}for(w=0;w<this.m_vertexCount;++w){var y=parseInt(w),x=parseInt(w+1<this.m_vertexCount?w+1:0);y=g.SubtractVV(this.m_vertices[x],this.m_vertices[y]);v.b2Assert(y.LengthSquared()>Number.MIN_VALUE);this.m_normals[w].SetV(g.CrossVF(y,1));this.m_normals[w].Normalize()}this.m_centroid=i.ComputeCentroid(this.m_vertices,this.m_vertexCount)};i.AsVector=function(p,x){if(x===undefined){x=0}var w=new i;w.SetAsVector(p,x);return w};i.prototype.SetAsBox=function(p,w){if(p===undefined){p=0}if(w===undefined){w=0}this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-p,-w);this.m_vertices[1].Set(p,-w);this.m_vertices[2].Set(p,w);this.m_vertices[3].Set(-p,w);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};i.AsBox=function(p,x){if(p===undefined){p=0}if(x===undefined){x=0}var w=new i;w.SetAsBox(p,x);return w};i.prototype.SetAsOrientedBox=function(p,y,w,x){if(p===undefined){p=0}if(y===undefined){y=0}if(w===undefined){w=null}if(x===undefined){x=0}this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-p,-y);this.m_vertices[1].Set(p,-y);this.m_vertices[2].Set(p,y);this.m_vertices[3].Set(-p,y);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=w;p=new m;p.position=w;p.R.Set(x);for(w=0;w<this.m_vertexCount;++w){this.m_vertices[w]=g.MulX(p,this.m_vertices[w]);this.m_normals[w]=g.MulMV(p.R,this.m_normals[w])}};i.AsOrientedBox=function(p,A,w,y){if(p===undefined){p=0}if(A===undefined){A=0}if(w===undefined){w=null}if(y===undefined){y=0}var x=new i;x.SetAsOrientedBox(p,A,w,y);return x};i.prototype.SetAsEdge=function(p,w){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(p);this.m_vertices[1].SetV(w);this.m_centroid.x=0.5*(p.x+w.x);this.m_centroid.y=0.5*(p.y+w.y);this.m_normals[0]=g.CrossVF(g.SubtractVV(w,p),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};i.AsEdge=function(p,x){var w=new i;w.SetAsEdge(p,x);return w};i.prototype.TestPoint=function(p,F){var w;w=p.R;for(var C=F.x-p.position.x,x=F.y-p.position.y,B=C*w.col1.x+x*w.col1.y,A=C*w.col2.x+x*w.col2.y,y=0;y<this.m_vertexCount;++y){w=this.m_vertices[y];C=B-w.x;x=A-w.y;w=this.m_normals[y];if(w.x*C+w.y*x>0){return false}}return true};i.prototype.RayCast=function(y,I,K){var w=0,J=I.maxFraction,C=0,L=0,B,F;C=I.p1.x-K.position.x;L=I.p1.y-K.position.y;B=K.R;var A=C*B.col1.x+L*B.col1.y,p=C*B.col2.x+L*B.col2.y;C=I.p2.x-K.position.x;L=I.p2.y-K.position.y;B=K.R;I=C*B.col1.x+L*B.col1.y-A;B=C*B.col2.x+L*B.col2.y-p;for(var x=parseInt(-1),G=0;G<this.m_vertexCount;++G){F=this.m_vertices[G];C=F.x-A;L=F.y-p;F=this.m_normals[G];C=F.x*C+F.y*L;L=F.x*I+F.y*B;if(L==0){if(C<0){return false}}else{if(L<0&&C<w*L){w=C/L;x=G}else{if(L>0&&C<J*L){J=C/L}}}if(J<w-Number.MIN_VALUE){return false}}if(x>=0){y.fraction=w;B=K.R;F=this.m_normals[x];y.normal.x=B.col1.x*F.x+B.col2.x*F.y;y.normal.y=B.col1.y*F.x+B.col2.y*F.y;return true}return false};i.prototype.ComputeAABB=function(w,C){for(var G=C.R,p=this.m_vertices[0],F=C.position.x+(G.col1.x*p.x+G.col2.x*p.y),A=C.position.y+(G.col1.y*p.x+G.col2.y*p.y),I=F,y=A,B=1;B<this.m_vertexCount;++B){p=this.m_vertices[B];var x=C.position.x+(G.col1.x*p.x+G.col2.x*p.y);p=C.position.y+(G.col1.y*p.x+G.col2.y*p.y);F=F<x?F:x;A=A<p?A:p;I=I>x?I:x;y=y>p?y:p}w.lowerBound.x=F-this.m_radius;w.lowerBound.y=A-this.m_radius;w.upperBound.x=I+this.m_radius;w.upperBound.y=y+this.m_radius};i.prototype.ComputeMass=function(A,L){if(L===undefined){L=0}if(this.m_vertexCount==2){A.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x);A.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y);A.mass=0;A.I=0}else{for(var P=0,w=0,M=0,I=0,Q=1/3,F=0;F<this.m_vertexCount;++F){var J=this.m_vertices[F],C=F+1<this.m_vertexCount?this.m_vertices[parseInt(F+1)]:this.m_vertices[0],p=J.x-0,x=J.y-0,K=C.x-0,G=C.y-0,y=p*G-x*K,B=0.5*y;M+=B;P+=B*Q*(0+J.x+C.x);w+=B*Q*(0+J.y+C.y);J=p;x=x;K=K;G=G;I+=y*(Q*(0.25*(J*J+K*J+K*K)+(0*J+0*K))+0+(Q*(0.25*(x*x+G*x+G*G)+(0*x+0*G))+0))}A.mass=L*M;P*=1/M;w*=1/M;A.center.Set(P,w);A.I=L*I}};i.prototype.ComputeSubmergedArea=function(x,F,I,w){if(F===undefined){F=0}var G=g.MulTMV(I.R,x),B=F-g.Dot(x,I.position),J=new a,A=0,C=parseInt(-1);F=parseInt(-1);var y=false;for(x=x=0;x<this.m_vertexCount;++x){J[x]=g.Dot(G,this.m_vertices[x])-B;var p=J[x]<-Number.MIN_VALUE;if(x>0){if(p){if(!y){C=x-1;A++}}else{if(y){F=x-1;A++}}}y=p}switch(A){case 0:if(y){x=new t;this.ComputeMass(x,1);w.SetV(g.MulX(I,x.center));return x.mass}else{return 0}case 1:if(C==-1){C=this.m_vertexCount-1}else{F=this.m_vertexCount-1}}x=parseInt((C+1)%this.m_vertexCount);G=parseInt((F+1)%this.m_vertexCount);B=(0-J[C])/(J[x]-J[C]);J=(0-J[F])/(J[G]-J[F]);C=new k(this.m_vertices[C].x*(1-B)+this.m_vertices[x].x*B,this.m_vertices[C].y*(1-B)+this.m_vertices[x].y*B);F=new k(this.m_vertices[F].x*(1-J)+this.m_vertices[G].x*J,this.m_vertices[F].y*(1-J)+this.m_vertices[G].y*J);J=0;B=new k;A=this.m_vertices[x];for(x=x;x!=G;){x=(x+1)%this.m_vertexCount;y=x==G?F:this.m_vertices[x];p=0.5*((A.x-C.x)*(y.y-C.y)-(A.y-C.y)*(y.x-C.x));J+=p;B.x+=p*(C.x+A.x+y.x)/3;B.y+=p*(C.y+A.y+y.y)/3;A=y}B.Multiply(1/J);w.SetV(g.MulX(I,B));return J};i.prototype.GetVertexCount=function(){return this.m_vertexCount};i.prototype.GetVertices=function(){return this.m_vertices};i.prototype.GetNormals=function(){return this.m_normals};i.prototype.GetSupport=function(p){for(var A=0,w=this.m_vertices[0].x*p.x+this.m_vertices[0].y*p.y,y=1;y<this.m_vertexCount;++y){var x=this.m_vertices[y].x*p.x+this.m_vertices[y].y*p.y;if(x>w){A=y;w=x}}return A};i.prototype.GetSupportVertex=function(p){for(var A=0,w=this.m_vertices[0].x*p.x+this.m_vertices[0].y*p.y,y=1;y<this.m_vertexCount;++y){var x=this.m_vertices[y].x*p.x+this.m_vertices[y].y*p.y;if(x>w){A=y;w=x}}return this.m_vertices[A]};i.prototype.Validate=function(){return false};i.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=l.e_polygonShape;this.m_centroid=new k;this.m_vertices=new b;this.m_normals=new b};i.prototype.Reserve=function(p){if(p===undefined){p=0}for(var w=parseInt(this.m_vertices.length);w<p;w++){this.m_vertices[w]=new k;this.m_normals[w]=new k}};i.ComputeCentroid=function(w,B){if(B===undefined){B=0}for(var F=new k,p=0,C=1/3,y=0;y<B;++y){var G=w[y],x=y+1<B?w[parseInt(y+1)]:w[0],A=0.5*((G.x-0)*(x.y-0)-(G.y-0)*(x.x-0));p+=A;F.x+=A*C*(0+G.x+x.x);F.y+=A*C*(0+G.y+x.y)}F.x*=1/p;F.y*=1/p;return F};i.ComputeOBB=function(M,B,F){if(F===undefined){F=0}var I=0,C=new b(F+1);for(I=0;I<F;++I){C[I]=B[I]}C[F]=C[0];B=Number.MAX_VALUE;for(I=1;I<=F;++I){var y=C[parseInt(I-1)],G=C[I].x-y.x,x=C[I].y-y.y,A=Math.sqrt(G*G+x*x);G/=A;x/=A;for(var w=-x,U=G,p=A=Number.MAX_VALUE,T=-Number.MAX_VALUE,Q=-Number.MAX_VALUE,L=0;L<F;++L){var P=C[L].x-y.x,K=C[L].y-y.y,J=G*P+x*K;P=w*P+U*K;if(J<A){A=J}if(P<p){p=P}if(J>T){T=J}if(P>Q){Q=P}}L=(T-A)*(Q-p);if(L<0.95*B){B=L;M.R.col1.x=G;M.R.col1.y=x;M.R.col2.x=w;M.R.col2.y=U;G=0.5*(A+T);x=0.5*(p+Q);w=M.R;M.center.x=y.x+(w.col1.x*G+w.col2.x*x);M.center.y=y.y+(w.col1.y*G+w.col2.y*x);M.extents.x=0.5*(T-A);M.extents.y=0.5*(Q-p)}}};e.postDefs.push(function(){e.Collision.Shapes.b2PolygonShape.s_mat=new h});l.b2Shape=function(){};l.prototype.Copy=function(){return null};l.prototype.Set=function(p){this.m_radius=p.m_radius};l.prototype.GetType=function(){return this.m_type};l.prototype.TestPoint=function(){return false};l.prototype.RayCast=function(){return false};l.prototype.ComputeAABB=function(){};l.prototype.ComputeMass=function(){};l.prototype.ComputeSubmergedArea=function(){return 0};l.TestOverlap=function(p,A,w,y){var x=new o;x.proxyA=new j;x.proxyA.Set(p);x.proxyB=new j;x.proxyB.Set(w);x.transformA=A;x.transformB=y;x.useRadii=true;p=new f;p.count=0;A=new s;n.Distance(A,p,x);return A.distance<10*Number.MIN_VALUE};l.prototype.b2Shape=function(){this.m_type=l.e_unknownShape;this.m_radius=v.b2_linearSlop};e.postDefs.push(function(){e.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);e.Collision.Shapes.b2Shape.e_circleShape=0;e.Collision.Shapes.b2Shape.e_polygonShape=1;e.Collision.Shapes.b2Shape.e_edgeShape=2;e.Collision.Shapes.b2Shape.e_shapeTypeCount=3;e.Collision.Shapes.b2Shape.e_hitCollide=1;e.Collision.Shapes.b2Shape.e_missCollide=0;e.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var h=e.Common.b2Color,g=e.Common.b2Settings,f=e.Common.Math.b2Math;h.b2Color=function(){this._b=this._g=this._r=0};h.prototype.b2Color=function(k,j,i){if(k===undefined){k=0}if(j===undefined){j=0}if(i===undefined){i=0}this._r=e.parseUInt(255*f.Clamp(k,0,1));this._g=e.parseUInt(255*f.Clamp(j,0,1));this._b=e.parseUInt(255*f.Clamp(i,0,1))};h.prototype.Set=function(k,j,i){if(k===undefined){k=0}if(j===undefined){j=0}if(i===undefined){i=0}this._r=e.parseUInt(255*f.Clamp(k,0,1));this._g=e.parseUInt(255*f.Clamp(j,0,1));this._b=e.parseUInt(255*f.Clamp(i,0,1))};Object.defineProperty(h.prototype,"r",{enumerable:false,configurable:true,set:function(i){if(i===undefined){i=0}this._r=e.parseUInt(255*f.Clamp(i,0,1))}});Object.defineProperty(h.prototype,"g",{enumerable:false,configurable:true,set:function(i){if(i===undefined){i=0}this._g=e.parseUInt(255*f.Clamp(i,0,1))}});Object.defineProperty(h.prototype,"b",{enumerable:false,configurable:true,set:function(i){if(i===undefined){i=0}this._b=e.parseUInt(255*f.Clamp(i,0,1))}});Object.defineProperty(h.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});g.b2Settings=function(){};g.b2MixFriction=function(j,i){if(j===undefined){j=0}if(i===undefined){i=0}return Math.sqrt(j*i)};g.b2MixRestitution=function(j,i){if(j===undefined){j=0}if(i===undefined){i=0}return j>i?j:i};g.b2Assert=function(i){if(!i){throw"Assertion Failed"}};e.postDefs.push(function(){e.Common.b2Settings.VERSION="2.1alpha";e.Common.b2Settings.USHRT_MAX=65535;e.Common.b2Settings.b2_pi=Math.PI;e.Common.b2Settings.b2_maxManifoldPoints=2;e.Common.b2Settings.b2_aabbExtension=0.1;e.Common.b2Settings.b2_aabbMultiplier=2;e.Common.b2Settings.b2_polygonRadius=2*g.b2_linearSlop;e.Common.b2Settings.b2_linearSlop=0.005;e.Common.b2Settings.b2_angularSlop=2/180*g.b2_pi;e.Common.b2Settings.b2_toiSlop=8*g.b2_linearSlop;e.Common.b2Settings.b2_maxTOIContactsPerIsland=32;e.Common.b2Settings.b2_maxTOIJointsPerIsland=32;e.Common.b2Settings.b2_velocityThreshold=1;e.Common.b2Settings.b2_maxLinearCorrection=0.2;e.Common.b2Settings.b2_maxAngularCorrection=8/180*g.b2_pi;e.Common.b2Settings.b2_maxTranslation=2;e.Common.b2Settings.b2_maxTranslationSquared=g.b2_maxTranslation*g.b2_maxTranslation;e.Common.b2Settings.b2_maxRotation=0.5*g.b2_pi;e.Common.b2Settings.b2_maxRotationSquared=g.b2_maxRotation*g.b2_maxRotation;e.Common.b2Settings.b2_contactBaumgarte=0.2;e.Common.b2Settings.b2_timeToSleep=0.5;e.Common.b2Settings.b2_linearSleepTolerance=0.01;e.Common.b2Settings.b2_angularSleepTolerance=2/180*g.b2_pi})})();(function(){var k=e.Common.Math.b2Mat22,j=e.Common.Math.b2Mat33,h=e.Common.Math.b2Math,l=e.Common.Math.b2Sweep,g=e.Common.Math.b2Transform,f=e.Common.Math.b2Vec2,i=e.Common.Math.b2Vec3;k.b2Mat22=function(){this.col1=new f;this.col2=new f};k.prototype.b2Mat22=function(){this.SetIdentity()};k.FromAngle=function(m){if(m===undefined){m=0}var n=new k;n.Set(m);return n};k.FromVV=function(n,o){var m=new k;m.SetVV(n,o);return m};k.prototype.Set=function(m){if(m===undefined){m=0}var n=Math.cos(m);m=Math.sin(m);this.col1.x=n;this.col2.x=-m;this.col1.y=m;this.col2.y=n};k.prototype.SetVV=function(m,n){this.col1.SetV(m);this.col2.SetV(n)};k.prototype.Copy=function(){var m=new k;m.SetM(this);return m};k.prototype.SetM=function(m){this.col1.SetV(m.col1);this.col2.SetV(m.col2)};k.prototype.AddM=function(m){this.col1.x+=m.col1.x;this.col1.y+=m.col1.y;this.col2.x+=m.col2.x;this.col2.y+=m.col2.y};k.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};k.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};k.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};k.prototype.GetInverse=function(q){var s=this.col1.x,o=this.col2.x,n=this.col1.y,r=this.col2.y,m=s*r-o*n;if(m!=0){m=1/m}q.col1.x=m*r;q.col2.x=-m*o;q.col1.y=-m*n;q.col2.y=m*s;return q};k.prototype.Solve=function(s,u,r){if(u===undefined){u=0}if(r===undefined){r=0}var o=this.col1.x,t=this.col2.x,n=this.col1.y,q=this.col2.y,m=o*q-t*n;if(m!=0){m=1/m}s.x=m*(q*u-t*r);s.y=m*(o*r-n*u);return s};k.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};j.b2Mat33=function(){this.col1=new i;this.col2=new i;this.col3=new i};j.prototype.b2Mat33=function(n,o,m){if(n===undefined){n=null}if(o===undefined){o=null}if(m===undefined){m=null}if(!n&&!o&&!m){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(n);this.col2.SetV(o);this.col3.SetV(m)}};j.prototype.SetVVV=function(n,o,m){this.col1.SetV(n);this.col2.SetV(o);this.col3.SetV(m)};j.prototype.Copy=function(){return new j(this.col1,this.col2,this.col3)};j.prototype.SetM=function(m){this.col1.SetV(m.col1);this.col2.SetV(m.col2);this.col3.SetV(m.col3)};j.prototype.AddM=function(m){this.col1.x+=m.col1.x;this.col1.y+=m.col1.y;this.col1.z+=m.col1.z;this.col2.x+=m.col2.x;this.col2.y+=m.col2.y;this.col2.z+=m.col2.z;this.col3.x+=m.col3.x;this.col3.y+=m.col3.y;this.col3.z+=m.col3.z};j.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};j.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};j.prototype.Solve22=function(s,u,r){if(u===undefined){u=0}if(r===undefined){r=0}var o=this.col1.x,t=this.col2.x,n=this.col1.y,q=this.col2.y,m=o*q-t*n;if(m!=0){m=1/m}s.x=m*(q*u-t*r);s.y=m*(o*r-n*u);return s};j.prototype.Solve33=function(q,o,v,s){if(o===undefined){o=0}if(v===undefined){v=0}if(s===undefined){s=0}var w=this.col1.x,y=this.col1.y,A=this.col1.z,r=this.col2.x,n=this.col2.y,t=this.col2.z,x=this.col3.x,E=this.col3.y,m=this.col3.z,C=w*(n*m-t*E)+y*(t*x-r*m)+A*(r*E-n*x);if(C!=0){C=1/C}q.x=C*(o*(n*m-t*E)+v*(t*x-r*m)+s*(r*E-n*x));q.y=C*(w*(v*m-s*E)+y*(s*x-o*m)+A*(o*E-v*x));q.z=C*(w*(n*s-t*v)+y*(t*o-r*s)+A*(r*v-n*o));return q};h.b2Math=function(){};h.IsValid=function(m){if(m===undefined){m=0}return isFinite(m)};h.Dot=function(m,n){return m.x*n.x+m.y*n.y};h.CrossVV=function(m,n){return m.x*n.y-m.y*n.x};h.CrossVF=function(m,n){if(n===undefined){n=0}return new f(n*m.y,-n*m.x)};h.CrossFV=function(m,n){if(m===undefined){m=0}return new f(-m*n.y,m*n.x)};h.MulMV=function(m,n){return new f(m.col1.x*n.x+m.col2.x*n.y,m.col1.y*n.x+m.col2.y*n.y)};h.MulTMV=function(m,n){return new f(h.Dot(n,m.col1),h.Dot(n,m.col2))};h.MulX=function(n,o){var m=h.MulMV(n.R,o);m.x+=n.position.x;m.y+=n.position.y;return m};h.MulXT=function(o,q){var n=h.SubtractVV(q,o.position),m=n.x*o.R.col1.x+n.y*o.R.col1.y;n.y=n.x*o.R.col2.x+n.y*o.R.col2.y;n.x=m;return n};h.AddVV=function(m,n){return new f(m.x+n.x,m.y+n.y)};h.SubtractVV=function(m,n){return new f(m.x-n.x,m.y-n.y)};h.Distance=function(o,q){var n=o.x-q.x,m=o.y-q.y;return Math.sqrt(n*n+m*m)};h.DistanceSquared=function(o,q){var n=o.x-q.x,m=o.y-q.y;return n*n+m*m};h.MulFV=function(m,n){if(m===undefined){m=0}return new f(m*n.x,m*n.y)};h.AddMM=function(m,n){return k.FromVV(h.AddVV(m.col1,n.col1),h.AddVV(m.col2,n.col2))};h.MulMM=function(m,n){return k.FromVV(h.MulMV(m,n.col1),h.MulMV(m,n.col2))};h.MulTMM=function(o,q){var n=new f(h.Dot(o.col1,q.col1),h.Dot(o.col2,q.col1)),m=new f(h.Dot(o.col1,q.col2),h.Dot(o.col2,q.col2));return k.FromVV(n,m)};h.Abs=function(m){if(m===undefined){m=0}return m>0?m:-m};h.AbsV=function(m){return new f(h.Abs(m.x),h.Abs(m.y))};h.AbsM=function(m){return k.FromVV(h.AbsV(m.col1),h.AbsV(m.col2))};h.Min=function(m,n){if(m===undefined){m=0}if(n===undefined){n=0}return m<n?m:n};h.MinV=function(m,n){return new f(h.Min(m.x,n.x),h.Min(m.y,n.y))};h.Max=function(m,n){if(m===undefined){m=0}if(n===undefined){n=0}return m>n?m:n};h.MaxV=function(m,n){return new f(h.Max(m.x,n.x),h.Max(m.y,n.y))};h.Clamp=function(n,o,m){if(n===undefined){n=0}if(o===undefined){o=0}if(m===undefined){m=0}return n<o?o:n>m?m:n};h.ClampV=function(n,o,m){return h.MaxV(o,h.MinV(n,m))};h.Swap=function(n,o){var m=n[0];n[0]=o[0];o[0]=m};h.Random=function(){return Math.random()*2-1};h.RandomRange=function(n,o){if(n===undefined){n=0}if(o===undefined){o=0}var m=Math.random();return m=(o-n)*m+n};h.NextPowerOfTwo=function(m){if(m===undefined){m=0}m|=m>>1&2147483647;m|=m>>2&1073741823;m|=m>>4&268435455;m|=m>>8&16777215;m|=m>>16&65535;return m+1};h.IsPowerOfTwo=function(m){if(m===undefined){m=0}return m>0&&(m&m-1)==0};e.postDefs.push(function(){e.Common.Math.b2Math.b2Vec2_zero=new f(0,0);e.Common.Math.b2Math.b2Mat22_identity=k.FromVV(new f(1,0),new f(0,1));e.Common.Math.b2Math.b2Transform_identity=new g(h.b2Vec2_zero,h.b2Mat22_identity)});l.b2Sweep=function(){this.localCenter=new f;this.c0=new f;this.c=new f};l.prototype.Set=function(m){this.localCenter.SetV(m.localCenter);this.c0.SetV(m.c0);this.c.SetV(m.c);this.a0=m.a0;this.a=m.a;this.t0=m.t0};l.prototype.Copy=function(){var m=new l;m.localCenter.SetV(this.localCenter);m.c0.SetV(this.c0);m.c.SetV(this.c);m.a0=this.a0;m.a=this.a;m.t0=this.t0;return m};l.prototype.GetTransform=function(n,o){if(o===undefined){o=0}n.position.x=(1-o)*this.c0.x+o*this.c.x;n.position.y=(1-o)*this.c0.y+o*this.c.y;n.R.Set((1-o)*this.a0+o*this.a);var m=n.R;n.position.x-=m.col1.x*this.localCenter.x+m.col2.x*this.localCenter.y;n.position.y-=m.col1.y*this.localCenter.x+m.col2.y*this.localCenter.y};l.prototype.Advance=function(m){if(m===undefined){m=0}if(this.t0<m&&1-this.t0>Number.MIN_VALUE){var n=(m-this.t0)/(1-this.t0);this.c0.x=(1-n)*this.c0.x+n*this.c.x;this.c0.y=(1-n)*this.c0.y+n*this.c.y;this.a0=(1-n)*this.a0+n*this.a;this.t0=m}};g.b2Transform=function(){this.position=new f;this.R=new k};g.prototype.b2Transform=function(m,n){if(m===undefined){m=null}if(n===undefined){n=null}if(m){this.position.SetV(m);this.R.SetM(n)}};g.prototype.Initialize=function(m,n){this.position.SetV(m);this.R.SetM(n)};g.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};g.prototype.Set=function(m){this.position.SetV(m.position);this.R.SetM(m.R)};g.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};f.b2Vec2=function(){};f.prototype.b2Vec2=function(m,n){if(m===undefined){m=0}if(n===undefined){n=0}this.x=m;this.y=n};f.prototype.SetZero=function(){this.y=this.x=0};f.prototype.Set=function(m,n){if(m===undefined){m=0}if(n===undefined){n=0}this.x=m;this.y=n};f.prototype.SetV=function(m){this.x=m.x;this.y=m.y};f.prototype.GetNegative=function(){return new f(-this.x,-this.y)};f.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};f.Make=function(m,n){if(m===undefined){m=0}if(n===undefined){n=0}return new f(m,n)};f.prototype.Copy=function(){return new f(this.x,this.y)};f.prototype.Add=function(m){this.x+=m.x;this.y+=m.y};f.prototype.Subtract=function(m){this.x-=m.x;this.y-=m.y};f.prototype.Multiply=function(m){if(m===undefined){m=0}this.x*=m;this.y*=m};f.prototype.MulM=function(m){var n=this.x;this.x=m.col1.x*n+m.col2.x*this.y;this.y=m.col1.y*n+m.col2.y*this.y};f.prototype.MulTM=function(m){var n=h.Dot(this,m.col1);this.y=h.Dot(this,m.col2);this.x=n};f.prototype.CrossVF=function(m){if(m===undefined){m=0}var n=this.x;this.x=m*this.y;this.y=-m*n};f.prototype.CrossFV=function(m){if(m===undefined){m=0}var n=this.x;this.x=-m*this.y;this.y=m*n};f.prototype.MinV=function(m){this.x=this.x<m.x?this.x:m.x;this.y=this.y<m.y?this.y:m.y};f.prototype.MaxV=function(m){this.x=this.x>m.x?this.x:m.x;this.y=this.y>m.y?this.y:m.y};f.prototype.Abs=function(){if(this.x<0){this.x=-this.x}if(this.y<0){this.y=-this.y}};f.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};f.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};f.prototype.Normalize=function(){var m=Math.sqrt(this.x*this.x+this.y*this.y);if(m<Number.MIN_VALUE){return 0}var n=1/m;this.x*=n;this.y*=n;return m};f.prototype.IsValid=function(){return h.IsValid(this.x)&&h.IsValid(this.y)};i.b2Vec3=function(){};i.prototype.b2Vec3=function(n,o,m){if(n===undefined){n=0}if(o===undefined){o=0}if(m===undefined){m=0}this.x=n;this.y=o;this.z=m};i.prototype.SetZero=function(){this.x=this.y=this.z=0};i.prototype.Set=function(n,o,m){if(n===undefined){n=0}if(o===undefined){o=0}if(m===undefined){m=0}this.x=n;this.y=o;this.z=m};i.prototype.SetV=function(m){this.x=m.x;this.y=m.y;this.z=m.z};i.prototype.GetNegative=function(){return new i(-this.x,-this.y,-this.z)};i.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};i.prototype.Copy=function(){return new i(this.x,this.y,this.z)};i.prototype.Add=function(m){this.x+=m.x;this.y+=m.y;this.z+=m.z};i.prototype.Subtract=function(m){this.x-=m.x;this.y-=m.y;this.z-=m.z};i.prototype.Multiply=function(m){if(m===undefined){m=0}this.x*=m;this.y*=m;this.z*=m}})();(function(){var ah=e.Common.Math.b2Math,af=e.Common.Math.b2Sweep,X=e.Common.Math.b2Transform,ab=e.Common.Math.b2Vec2,ae=e.Common.b2Color,am=e.Common.b2Settings,r=e.Collision.b2AABB,an=e.Collision.b2ContactPoint,al=e.Collision.b2DynamicTreeBroadPhase,v=e.Collision.b2RayCastInput,m=e.Collision.b2RayCastOutput,J=e.Collision.Shapes.b2CircleShape,P=e.Collision.Shapes.b2EdgeShape,ac=e.Collision.Shapes.b2MassData,i=e.Collision.Shapes.b2PolygonShape,g=e.Collision.Shapes.b2Shape,ar=e.Dynamics.b2Body,T=e.Dynamics.b2BodyDef,ag=e.Dynamics.b2ContactFilter,aj=e.Dynamics.b2ContactImpulse,ad=e.Dynamics.b2ContactListener,x=e.Dynamics.b2ContactManager,ai=e.Dynamics.b2DebugDraw,t=e.Dynamics.b2DestructionListener,C=e.Dynamics.b2FilterData,s=e.Dynamics.b2Fixture,aw=e.Dynamics.b2FixtureDef,f=e.Dynamics.b2Island,av=e.Dynamics.b2TimeStep,au=e.Dynamics.b2World,aq=e.Dynamics.Contacts.b2Contact,at=e.Dynamics.Contacts.b2ContactFactory,ao=e.Dynamics.Contacts.b2ContactSolver,ak=e.Dynamics.Joints.b2Joint,ap=e.Dynamics.Joints.b2PulleyJoint;ar.b2Body=function(){this.m_xf=new X;this.m_sweep=new af;this.m_linearVelocity=new ab;this.m_force=new ab};ar.prototype.connectEdges=function(j,o,k){if(k===undefined){k=0}var h=Math.atan2(o.GetDirectionVector().y,o.GetDirectionVector().x);k=ah.MulFV(Math.tan((h-k)*0.5),o.GetDirectionVector());k=ah.SubtractVV(k,o.GetNormalVector());k=ah.MulFV(am.b2_toiSlop,k);k=ah.AddVV(k,o.GetVertex1());var n=ah.AddVV(j.GetDirectionVector(),o.GetDirectionVector());n.Normalize();var l=ah.Dot(j.GetDirectionVector(),o.GetNormalVector())>0;j.SetNextEdge(o,k,n,l);o.SetPrevEdge(j,k,n,l);return h};ar.prototype.CreateFixture=function(h){if(this.m_world.IsLocked()==true){return null}var j=new s;j.Create(this,this.m_xf,h);this.m_flags&ar.e_activeFlag&&j.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);j.m_next=this.m_fixtureList;this.m_fixtureList=j;++this.m_fixtureCount;j.m_body=this;j.m_density>0&&this.ResetMassData();this.m_world.m_flags|=au.e_newFixture;return j};ar.prototype.CreateFixture2=function(h,k){if(k===undefined){k=0}var j=new aw;j.shape=h;j.density=k;return this.CreateFixture(j)};ar.prototype.DestroyFixture=function(j){if(this.m_world.IsLocked()!=true){for(var n=this.m_fixtureList,k=null;n!=null;){if(n==j){if(k){k.m_next=j.m_next}else{this.m_fixtureList=j.m_next}break}k=n;n=n.m_next}for(n=this.m_contactList;n;){k=n.contact;n=n.next;var h=k.GetFixtureA(),l=k.GetFixtureB();if(j==h||j==l){this.m_world.m_contactManager.Destroy(k)}}this.m_flags&ar.e_activeFlag&&j.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);j.Destroy();j.m_body=null;j.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};ar.prototype.SetPositionAndAngle=function(j,l){if(l===undefined){l=0}var k;if(this.m_world.IsLocked()!=true){this.m_xf.R.Set(l);this.m_xf.position.SetV(j);k=this.m_xf.R;var h=this.m_sweep.localCenter;this.m_sweep.c.x=k.col1.x*h.x+k.col2.x*h.y;this.m_sweep.c.y=k.col1.y*h.x+k.col2.y*h.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=l;h=this.m_world.m_contactManager.m_broadPhase;for(k=this.m_fixtureList;k;k=k.m_next){k.Synchronize(h,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()}};ar.prototype.SetTransform=function(h){this.SetPositionAndAngle(h.position,h.GetAngle())};ar.prototype.GetTransform=function(){return this.m_xf};ar.prototype.GetPosition=function(){return this.m_xf.position};ar.prototype.SetPosition=function(h){this.SetPositionAndAngle(h,this.GetAngle())};ar.prototype.GetAngle=function(){return this.m_sweep.a};ar.prototype.SetAngle=function(h){if(h===undefined){h=0}this.SetPositionAndAngle(this.GetPosition(),h)};ar.prototype.GetWorldCenter=function(){return this.m_sweep.c};ar.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};ar.prototype.SetLinearVelocity=function(h){this.m_type!=ar.b2_staticBody&&this.m_linearVelocity.SetV(h)};ar.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};ar.prototype.SetAngularVelocity=function(h){if(h===undefined){h=0}if(this.m_type!=ar.b2_staticBody){this.m_angularVelocity=h}};ar.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};ar.prototype.GetDefinition=function(){var h=new T;h.type=this.GetType();h.allowSleep=(this.m_flags&ar.e_allowSleepFlag)==ar.e_allowSleepFlag;h.angle=this.GetAngle();h.angularDamping=this.m_angularDamping;h.angularVelocity=this.m_angularVelocity;h.fixedRotation=(this.m_flags&ar.e_fixedRotationFlag)==ar.e_fixedRotationFlag;h.bullet=(this.m_flags&ar.e_bulletFlag)==ar.e_bulletFlag;h.awake=(this.m_flags&ar.e_awakeFlag)==ar.e_awakeFlag;h.linearDamping=this.m_linearDamping;h.linearVelocity.SetV(this.GetLinearVelocity());h.position=this.GetPosition();h.userData=this.GetUserData();return h};ar.prototype.ApplyForce=function(h,j){if(this.m_type==ar.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_force.x+=h.x;this.m_force.y+=h.y;this.m_torque+=(j.x-this.m_sweep.c.x)*h.y-(j.y-this.m_sweep.c.y)*h.x}};ar.prototype.ApplyTorque=function(h){if(h===undefined){h=0}if(this.m_type==ar.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_torque+=h}};ar.prototype.ApplyImpulse=function(h,j){if(this.m_type==ar.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_linearVelocity.x+=this.m_invMass*h.x;this.m_linearVelocity.y+=this.m_invMass*h.y;this.m_angularVelocity+=this.m_invI*((j.x-this.m_sweep.c.x)*h.y-(j.y-this.m_sweep.c.y)*h.x)}};ar.prototype.Split=function(k){for(var q=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),j=this.GetWorldCenter(),p=this.m_world.CreateBody(this.GetDefinition()),o,h=this.m_fixtureList;h;){if(k(h)){var l=h.m_next;if(o){o.m_next=l}else{this.m_fixtureList=l}this.m_fixtureCount--;h.m_next=p.m_fixtureList;p.m_fixtureList=h;p.m_fixtureCount++;h.m_body=p;h=l}else{o=h;h=h.m_next}}this.ResetMassData();p.ResetMassData();o=this.GetWorldCenter();k=p.GetWorldCenter();o=ah.AddVV(q,ah.CrossFV(n,ah.SubtractVV(o,j)));q=ah.AddVV(q,ah.CrossFV(n,ah.SubtractVV(k,j)));this.SetLinearVelocity(o);p.SetLinearVelocity(q);this.SetAngularVelocity(n);p.SetAngularVelocity(n);this.SynchronizeFixtures();p.SynchronizeFixtures();return p};ar.prototype.Merge=function(j){var n;for(n=j.m_fixtureList;n;){var k=n.m_next;j.m_fixtureCount--;n.m_next=this.m_fixtureList;this.m_fixtureList=n;this.m_fixtureCount++;n.m_body=l;n=k}h.m_fixtureCount=0;var h=this,l=j;h.GetWorldCenter();l.GetWorldCenter();h.GetLinearVelocity().Copy();l.GetLinearVelocity().Copy();h.GetAngularVelocity();l.GetAngularVelocity();h.ResetMassData();this.SynchronizeFixtures()};ar.prototype.GetMass=function(){return this.m_mass};ar.prototype.GetInertia=function(){return this.m_I};ar.prototype.GetMassData=function(h){h.mass=this.m_mass;h.I=this.m_I;h.center.SetV(this.m_sweep.localCenter)};ar.prototype.SetMassData=function(h){am.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()!=true){if(this.m_type==ar.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=h.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(h.I>0&&(this.m_flags&ar.e_fixedRotationFlag)==0){this.m_I=h.I-this.m_mass*(h.center.x*h.center.x+h.center.y*h.center.y);this.m_invI=1/this.m_I}var j=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(h.center);this.m_sweep.c0.SetV(ah.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-j.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-j.x)}}};ar.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==ar.b2_staticBody||this.m_type==ar.b2_kinematicBody)){for(var h=ab.Make(0,0),k=this.m_fixtureList;k;k=k.m_next){if(k.m_density!=0){var j=k.GetMassData();this.m_mass+=j.mass;h.x+=j.center.x*j.mass;h.y+=j.center.y*j.mass;this.m_I+=j.I}}if(this.m_mass>0){this.m_invMass=1/this.m_mass;h.x*=this.m_invMass;h.y*=this.m_invMass}else{this.m_invMass=this.m_mass=1}if(this.m_I>0&&(this.m_flags&ar.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(h.x*h.x+h.y*h.y);this.m_I*=this.m_inertiaScale;am.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_invI=this.m_I=0}k=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(h);this.m_sweep.c0.SetV(ah.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-k.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-k.x)}};ar.prototype.GetWorldPoint=function(h){var j=this.m_xf.R;h=new ab(j.col1.x*h.x+j.col2.x*h.y,j.col1.y*h.x+j.col2.y*h.y);h.x+=this.m_xf.position.x;h.y+=this.m_xf.position.y;return h};ar.prototype.GetWorldVector=function(h){return ah.MulMV(this.m_xf.R,h)};ar.prototype.GetLocalPoint=function(h){return ah.MulXT(this.m_xf,h)};ar.prototype.GetLocalVector=function(h){return ah.MulTMV(this.m_xf.R,h)};ar.prototype.GetLinearVelocityFromWorldPoint=function(h){return new ab(this.m_linearVelocity.x-this.m_angularVelocity*(h.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(h.x-this.m_sweep.c.x))};ar.prototype.GetLinearVelocityFromLocalPoint=function(h){var j=this.m_xf.R;h=new ab(j.col1.x*h.x+j.col2.x*h.y,j.col1.y*h.x+j.col2.y*h.y);h.x+=this.m_xf.position.x;h.y+=this.m_xf.position.y;return new ab(this.m_linearVelocity.x-this.m_angularVelocity*(h.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(h.x-this.m_sweep.c.x))};ar.prototype.GetLinearDamping=function(){return this.m_linearDamping};ar.prototype.SetLinearDamping=function(h){if(h===undefined){h=0}this.m_linearDamping=h};ar.prototype.GetAngularDamping=function(){return this.m_angularDamping};ar.prototype.SetAngularDamping=function(h){if(h===undefined){h=0}this.m_angularDamping=h};ar.prototype.SetType=function(h){if(h===undefined){h=0}if(this.m_type!=h){this.m_type=h;this.ResetMassData();if(this.m_type==ar.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(h=this.m_contactList;h;h=h.next){h.contact.FlagForFiltering()}}};ar.prototype.GetType=function(){return this.m_type};ar.prototype.SetBullet=function(h){if(h){this.m_flags|=ar.e_bulletFlag}else{this.m_flags&=~ar.e_bulletFlag}};ar.prototype.IsBullet=function(){return(this.m_flags&ar.e_bulletFlag)==ar.e_bulletFlag};ar.prototype.SetSleepingAllowed=function(h){if(h){this.m_flags|=ar.e_allowSleepFlag}else{this.m_flags&=~ar.e_allowSleepFlag;this.SetAwake(true)}};ar.prototype.SetAwake=function(h){if(h){this.m_flags|=ar.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~ar.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};ar.prototype.IsAwake=function(){return(this.m_flags&ar.e_awakeFlag)==ar.e_awakeFlag};ar.prototype.SetFixedRotation=function(h){if(h){this.m_flags|=ar.e_fixedRotationFlag}else{this.m_flags&=~ar.e_fixedRotationFlag}this.ResetMassData()};ar.prototype.IsFixedRotation=function(){return(this.m_flags&ar.e_fixedRotationFlag)==ar.e_fixedRotationFlag};ar.prototype.SetActive=function(h){if(h!=this.IsActive()){var j;if(h){this.m_flags|=ar.e_activeFlag;h=this.m_world.m_contactManager.m_broadPhase;for(j=this.m_fixtureList;j;j=j.m_next){j.CreateProxy(h,this.m_xf)}}else{this.m_flags&=~ar.e_activeFlag;h=this.m_world.m_contactManager.m_broadPhase;for(j=this.m_fixtureList;j;j=j.m_next){j.DestroyProxy(h)}for(h=this.m_contactList;h;){j=h;h=h.next;this.m_world.m_contactManager.Destroy(j.contact)}this.m_contactList=null}}};ar.prototype.IsActive=function(){return(this.m_flags&ar.e_activeFlag)==ar.e_activeFlag};ar.prototype.IsSleepingAllowed=function(){return(this.m_flags&ar.e_allowSleepFlag)==ar.e_allowSleepFlag};ar.prototype.GetFixtureList=function(){return this.m_fixtureList};ar.prototype.GetJointList=function(){return this.m_jointList};ar.prototype.GetControllerList=function(){return this.m_controllerList};ar.prototype.GetContactList=function(){return this.m_contactList};ar.prototype.GetNext=function(){return this.m_next};ar.prototype.GetUserData=function(){return this.m_userData};ar.prototype.SetUserData=function(h){this.m_userData=h};ar.prototype.GetWorld=function(){return this.m_world};ar.prototype.b2Body=function(j,l){this.m_flags=0;if(j.bullet){this.m_flags|=ar.e_bulletFlag}if(j.fixedRotation){this.m_flags|=ar.e_fixedRotationFlag}if(j.allowSleep){this.m_flags|=ar.e_allowSleepFlag}if(j.awake){this.m_flags|=ar.e_awakeFlag}if(j.active){this.m_flags|=ar.e_activeFlag}this.m_world=l;this.m_xf.position.SetV(j.position);this.m_xf.R.Set(j.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=j.angle;var k=this.m_xf.R,h=this.m_sweep.localCenter;this.m_sweep.c.x=k.col1.x*h.x+k.col2.x*h.y;this.m_sweep.c.y=k.col1.y*h.x+k.col2.y*h.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(j.linearVelocity);this.m_angularVelocity=j.angularVelocity;this.m_linearDamping=j.linearDamping;this.m_angularDamping=j.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=j.type;if(this.m_type==ar.b2_dynamicBody){this.m_invMass=this.m_mass=1}else{this.m_invMass=this.m_mass=0}this.m_invI=this.m_I=0;this.m_inertiaScale=j.inertiaScale;this.m_userData=j.userData;this.m_fixtureList=null;this.m_fixtureCount=0};ar.prototype.SynchronizeFixtures=function(){var h=ar.s_xf1;h.R.Set(this.m_sweep.a0);var k=h.R,j=this.m_sweep.localCenter;h.position.x=this.m_sweep.c0.x-(k.col1.x*j.x+k.col2.x*j.y);h.position.y=this.m_sweep.c0.y-(k.col1.y*j.x+k.col2.y*j.y);j=this.m_world.m_contactManager.m_broadPhase;for(k=this.m_fixtureList;k;k=k.m_next){k.Synchronize(j,h,this.m_xf)}};ar.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var h=this.m_xf.R,j=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(h.col1.x*j.x+h.col2.x*j.y);this.m_xf.position.y=this.m_sweep.c.y-(h.col1.y*j.x+h.col2.y*j.y)};ar.prototype.ShouldCollide=function(h){if(this.m_type!=ar.b2_dynamicBody&&h.m_type!=ar.b2_dynamicBody){return false}for(var j=this.m_jointList;j;j=j.next){if(j.other==h){if(j.joint.m_collideConnected==false){return false}}}return true};ar.prototype.Advance=function(h){if(h===undefined){h=0}this.m_sweep.Advance(h);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};e.postDefs.push(function(){e.Dynamics.b2Body.s_xf1=new X;e.Dynamics.b2Body.e_islandFlag=1;e.Dynamics.b2Body.e_awakeFlag=2;e.Dynamics.b2Body.e_allowSleepFlag=4;e.Dynamics.b2Body.e_bulletFlag=8;e.Dynamics.b2Body.e_fixedRotationFlag=16;e.Dynamics.b2Body.e_activeFlag=32;e.Dynamics.b2Body.b2_staticBody=0;e.Dynamics.b2Body.b2_kinematicBody=1;e.Dynamics.b2Body.b2_dynamicBody=2});T.b2BodyDef=function(){this.position=new ab;this.linearVelocity=new ab};T.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=true;this.bullet=this.fixedRotation=false;this.type=ar.b2_staticBody;this.active=true;this.inertiaScale=1};ag.b2ContactFilter=function(){};ag.prototype.ShouldCollide=function(j,l){var k=j.GetFilterData(),h=l.GetFilterData();if(k.groupIndex==h.groupIndex&&k.groupIndex!=0){return k.groupIndex>0}return(k.maskBits&h.categoryBits)!=0&&(k.categoryBits&h.maskBits)!=0};ag.prototype.RayCollide=function(h,j){if(!h){return true}return this.ShouldCollide(h instanceof s?h:null,j)};e.postDefs.push(function(){e.Dynamics.b2ContactFilter.b2_defaultFilter=new ag});aj.b2ContactImpulse=function(){this.normalImpulses=new a(am.b2_maxManifoldPoints);this.tangentImpulses=new a(am.b2_maxManifoldPoints)};ad.b2ContactListener=function(){};ad.prototype.BeginContact=function(){};ad.prototype.EndContact=function(){};ad.prototype.PreSolve=function(){};ad.prototype.PostSolve=function(){};e.postDefs.push(function(){e.Dynamics.b2ContactListener.b2_defaultListener=new ad});x.b2ContactManager=function(){};x.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=ag.b2_defaultFilter;this.m_contactListener=ad.b2_defaultListener;this.m_contactFactory=new at(this.m_allocator);this.m_broadPhase=new al};x.prototype.AddPair=function(q,o){var k=q instanceof s?q:null,p=o instanceof s?o:null,n=k.GetBody(),l=p.GetBody();if(n!=l){for(var j=l.GetContactList();j;){if(j.other==n){var h=j.contact.GetFixtureA(),u=j.contact.GetFixtureB();if(h==k&&u==p){return}if(h==p&&u==k){return}}j=j.next}if(l.ShouldCollide(n)!=false){if(this.m_contactFilter.ShouldCollide(k,p)!=false){j=this.m_contactFactory.Create(k,p);k=j.GetFixtureA();p=j.GetFixtureB();n=k.m_body;l=p.m_body;j.m_prev=null;j.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=j}this.m_world.m_contactList=j;j.m_nodeA.contact=j;j.m_nodeA.other=l;j.m_nodeA.prev=null;j.m_nodeA.next=n.m_contactList;if(n.m_contactList!=null){n.m_contactList.prev=j.m_nodeA}n.m_contactList=j.m_nodeA;j.m_nodeB.contact=j;j.m_nodeB.other=n;j.m_nodeB.prev=null;j.m_nodeB.next=l.m_contactList;if(l.m_contactList!=null){l.m_contactList.prev=j.m_nodeB}l.m_contactList=j.m_nodeB;++this.m_world.m_contactCount}}}};x.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(e.generateCallback(this,this.AddPair))};x.prototype.Destroy=function(h){var k=h.GetFixtureA(),j=h.GetFixtureB();k=k.GetBody();j=j.GetBody();h.IsTouching()&&this.m_contactListener.EndContact(h);if(h.m_prev){h.m_prev.m_next=h.m_next}if(h.m_next){h.m_next.m_prev=h.m_prev}if(h==this.m_world.m_contactList){this.m_world.m_contactList=h.m_next}if(h.m_nodeA.prev){h.m_nodeA.prev.next=h.m_nodeA.next}if(h.m_nodeA.next){h.m_nodeA.next.prev=h.m_nodeA.prev}if(h.m_nodeA==k.m_contactList){k.m_contactList=h.m_nodeA.next}if(h.m_nodeB.prev){h.m_nodeB.prev.next=h.m_nodeB.next}if(h.m_nodeB.next){h.m_nodeB.next.prev=h.m_nodeB.prev}if(h.m_nodeB==j.m_contactList){j.m_contactList=h.m_nodeB.next}this.m_contactFactory.Destroy(h);--this.m_contactCount};x.prototype.Collide=function(){for(var j=this.m_world.m_contactList;j;){var n=j.GetFixtureA(),k=j.GetFixtureB(),h=n.GetBody(),l=k.GetBody();if(h.IsAwake()==false&&l.IsAwake()==false){j=j.GetNext()}else{if(j.m_flags&aq.e_filterFlag){if(l.ShouldCollide(h)==false){n=j;j=n.GetNext();this.Destroy(n);continue}if(this.m_contactFilter.ShouldCollide(n,k)==false){n=j;j=n.GetNext();this.Destroy(n);continue}j.m_flags&=~aq.e_filterFlag}if(this.m_broadPhase.TestOverlap(n.m_proxy,k.m_proxy)==false){n=j;j=n.GetNext();this.Destroy(n)}else{j.Update(this.m_contactListener);j=j.GetNext()}}}};e.postDefs.push(function(){e.Dynamics.b2ContactManager.s_evalCP=new an});ai.b2DebugDraw=function(){};ai.prototype.b2DebugDraw=function(){};ai.prototype.SetFlags=function(){};ai.prototype.GetFlags=function(){};ai.prototype.AppendFlags=function(){};ai.prototype.ClearFlags=function(){};ai.prototype.SetSprite=function(){};ai.prototype.GetSprite=function(){};ai.prototype.SetDrawScale=function(){};ai.prototype.GetDrawScale=function(){};ai.prototype.SetLineThickness=function(){};ai.prototype.GetLineThickness=function(){};ai.prototype.SetAlpha=function(){};ai.prototype.GetAlpha=function(){};ai.prototype.SetFillAlpha=function(){};ai.prototype.GetFillAlpha=function(){};ai.prototype.SetXFormScale=function(){};ai.prototype.GetXFormScale=function(){};ai.prototype.DrawPolygon=function(){};ai.prototype.DrawSolidPolygon=function(){};ai.prototype.DrawCircle=function(){};ai.prototype.DrawSolidCircle=function(){};ai.prototype.DrawSegment=function(){};ai.prototype.DrawTransform=function(){};e.postDefs.push(function(){e.Dynamics.b2DebugDraw.e_shapeBit=1;e.Dynamics.b2DebugDraw.e_jointBit=2;e.Dynamics.b2DebugDraw.e_aabbBit=4;e.Dynamics.b2DebugDraw.e_pairBit=8;e.Dynamics.b2DebugDraw.e_centerOfMassBit=16;e.Dynamics.b2DebugDraw.e_controllerBit=32});t.b2DestructionListener=function(){};t.prototype.SayGoodbyeJoint=function(){};t.prototype.SayGoodbyeFixture=function(){};C.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};C.prototype.Copy=function(){var h=new C;h.categoryBits=this.categoryBits;h.maskBits=this.maskBits;h.groupIndex=this.groupIndex;return h};s.b2Fixture=function(){this.m_filter=new C};s.prototype.GetType=function(){return this.m_shape.GetType()};s.prototype.GetShape=function(){return this.m_shape};s.prototype.SetSensor=function(j){if(this.m_isSensor!=j){this.m_isSensor=j;if(this.m_body!=null){for(j=this.m_body.GetContactList();j;){var l=j.contact,k=l.GetFixtureA(),h=l.GetFixtureB();if(k==this||h==this){l.SetSensor(k.IsSensor()||h.IsSensor())}j=j.next}}}};s.prototype.IsSensor=function(){return this.m_isSensor};s.prototype.SetFilterData=function(j){this.m_filter=j.Copy();if(!this.m_body){for(j=this.m_body.GetContactList();j;){var l=j.contact,k=l.GetFixtureA(),h=l.GetFixtureB();if(k==this||h==this){l.FlagForFiltering()}j=j.next}}};s.prototype.GetFilterData=function(){return this.m_filter.Copy()};s.prototype.GetBody=function(){return this.m_body};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetUserData=function(){return this.m_userData};s.prototype.SetUserData=function(h){this.m_userData=h};s.prototype.TestPoint=function(h){return this.m_shape.TestPoint(this.m_body.GetTransform(),h)};s.prototype.RayCast=function(h,j){return this.m_shape.RayCast(h,j,this.m_body.GetTransform())};s.prototype.GetMassData=function(h){if(h===undefined){h=null}if(h==null){h=new ac}this.m_shape.ComputeMass(h,this.m_density);return h};s.prototype.SetDensity=function(h){if(h===undefined){h=0}this.m_density=h};s.prototype.GetDensity=function(){return this.m_density};s.prototype.GetFriction=function(){return this.m_friction};s.prototype.SetFriction=function(h){if(h===undefined){h=0}this.m_friction=h};s.prototype.GetRestitution=function(){return this.m_restitution};s.prototype.SetRestitution=function(h){if(h===undefined){h=0}this.m_restitution=h};s.prototype.GetAABB=function(){return this.m_aabb};s.prototype.b2Fixture=function(){this.m_aabb=new r;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};s.prototype.Create=function(h,k,j){this.m_userData=j.userData;this.m_friction=j.friction;this.m_restitution=j.restitution;this.m_body=h;this.m_next=null;this.m_filter=j.filter.Copy();this.m_isSensor=j.isSensor;this.m_shape=j.shape.Copy();this.m_density=j.density};s.prototype.Destroy=function(){this.m_shape=null};s.prototype.CreateProxy=function(h,j){this.m_shape.ComputeAABB(this.m_aabb,j);this.m_proxy=h.CreateProxy(this.m_aabb,this)};s.prototype.DestroyProxy=function(h){if(this.m_proxy!=null){h.DestroyProxy(this.m_proxy);this.m_proxy=null}};s.prototype.Synchronize=function(j,n,k){if(this.m_proxy){var h=new r,l=new r;this.m_shape.ComputeAABB(h,n);this.m_shape.ComputeAABB(l,k);this.m_aabb.Combine(h,l);n=ah.SubtractVV(k.position,n.position);j.MoveProxy(this.m_proxy,this.m_aabb,n)}};aw.b2FixtureDef=function(){this.filter=new C};aw.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};f.b2Island=function(){};f.prototype.b2Island=function(){this.m_bodies=new b;this.m_contacts=new b;this.m_joints=new b};f.prototype.Initialize=function(k,p,l,j,o,n){if(k===undefined){k=0}if(p===undefined){p=0}if(l===undefined){l=0}var h=0;this.m_bodyCapacity=k;this.m_contactCapacity=p;this.m_jointCapacity=l;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=j;this.m_listener=o;this.m_contactSolver=n;for(h=this.m_bodies.length;h<k;h++){this.m_bodies[h]=null}for(h=this.m_contacts.length;h<p;h++){this.m_contacts[h]=null}for(h=this.m_joints.length;h<l;h++){this.m_joints[h]=null}};f.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};f.prototype.Solve=function(k,q,n){var j=0,p=0,o;for(j=0;j<this.m_bodyCount;++j){p=this.m_bodies[j];if(p.GetType()==ar.b2_dynamicBody){p.m_linearVelocity.x+=k.dt*(q.x+p.m_invMass*p.m_force.x);p.m_linearVelocity.y+=k.dt*(q.y+p.m_invMass*p.m_force.y);p.m_angularVelocity+=k.dt*p.m_invI*p.m_torque;p.m_linearVelocity.Multiply(ah.Clamp(1-k.dt*p.m_linearDamping,0,1));p.m_angularVelocity*=ah.Clamp(1-k.dt*p.m_angularDamping,0,1)}}this.m_contactSolver.Initialize(k,this.m_contacts,this.m_contactCount,this.m_allocator);q=this.m_contactSolver;q.InitVelocityConstraints(k);for(j=0;j<this.m_jointCount;++j){o=this.m_joints[j];o.InitVelocityConstraints(k)}for(j=0;j<k.velocityIterations;++j){for(p=0;p<this.m_jointCount;++p){o=this.m_joints[p];o.SolveVelocityConstraints(k)}q.SolveVelocityConstraints()}for(j=0;j<this.m_jointCount;++j){o=this.m_joints[j];o.FinalizeVelocityConstraints()}q.FinalizeVelocityConstraints();for(j=0;j<this.m_bodyCount;++j){p=this.m_bodies[j];if(p.GetType()!=ar.b2_staticBody){var h=k.dt*p.m_linearVelocity.x,l=k.dt*p.m_linearVelocity.y;if(h*h+l*l>am.b2_maxTranslationSquared){p.m_linearVelocity.Normalize();p.m_linearVelocity.x*=am.b2_maxTranslation*k.inv_dt;p.m_linearVelocity.y*=am.b2_maxTranslation*k.inv_dt}h=k.dt*p.m_angularVelocity;if(h*h>am.b2_maxRotationSquared){p.m_angularVelocity=p.m_angularVelocity<0?-am.b2_maxRotation*k.inv_dt:am.b2_maxRotation*k.inv_dt}p.m_sweep.c0.SetV(p.m_sweep.c);p.m_sweep.a0=p.m_sweep.a;p.m_sweep.c.x+=k.dt*p.m_linearVelocity.x;p.m_sweep.c.y+=k.dt*p.m_linearVelocity.y;p.m_sweep.a+=k.dt*p.m_angularVelocity;p.SynchronizeTransform()}}for(j=0;j<k.positionIterations;++j){h=q.SolvePositionConstraints(am.b2_contactBaumgarte);l=true;for(p=0;p<this.m_jointCount;++p){o=this.m_joints[p];o=o.SolvePositionConstraints(am.b2_contactBaumgarte);l=l&&o}if(h&&l){break}}this.Report(q.m_constraints);if(n){n=Number.MAX_VALUE;q=am.b2_linearSleepTolerance*am.b2_linearSleepTolerance;h=am.b2_angularSleepTolerance*am.b2_angularSleepTolerance;for(j=0;j<this.m_bodyCount;++j){p=this.m_bodies[j];if(p.GetType()!=ar.b2_staticBody){if((p.m_flags&ar.e_allowSleepFlag)==0){n=p.m_sleepTime=0}if((p.m_flags&ar.e_allowSleepFlag)==0||p.m_angularVelocity*p.m_angularVelocity>h||ah.Dot(p.m_linearVelocity,p.m_linearVelocity)>q){n=p.m_sleepTime=0}else{p.m_sleepTime+=k.dt;n=ah.Min(n,p.m_sleepTime)}}}if(n>=am.b2_timeToSleep){for(j=0;j<this.m_bodyCount;++j){p=this.m_bodies[j];p.SetAwake(false)}}}};f.prototype.SolveTOI=function(k){var p=0,l=0;this.m_contactSolver.Initialize(k,this.m_contacts,this.m_contactCount,this.m_allocator);var j=this.m_contactSolver;for(p=0;p<this.m_jointCount;++p){this.m_joints[p].InitVelocityConstraints(k)}for(p=0;p<k.velocityIterations;++p){j.SolveVelocityConstraints();for(l=0;l<this.m_jointCount;++l){this.m_joints[l].SolveVelocityConstraints(k)}}for(p=0;p<this.m_bodyCount;++p){l=this.m_bodies[p];if(l.GetType()!=ar.b2_staticBody){var o=k.dt*l.m_linearVelocity.x,n=k.dt*l.m_linearVelocity.y;if(o*o+n*n>am.b2_maxTranslationSquared){l.m_linearVelocity.Normalize();l.m_linearVelocity.x*=am.b2_maxTranslation*k.inv_dt;l.m_linearVelocity.y*=am.b2_maxTranslation*k.inv_dt}o=k.dt*l.m_angularVelocity;if(o*o>am.b2_maxRotationSquared){l.m_angularVelocity=l.m_angularVelocity<0?-am.b2_maxRotation*k.inv_dt:am.b2_maxRotation*k.inv_dt}l.m_sweep.c0.SetV(l.m_sweep.c);l.m_sweep.a0=l.m_sweep.a;l.m_sweep.c.x+=k.dt*l.m_linearVelocity.x;l.m_sweep.c.y+=k.dt*l.m_linearVelocity.y;l.m_sweep.a+=k.dt*l.m_angularVelocity;l.SynchronizeTransform()}}for(p=0;p<k.positionIterations;++p){o=j.SolvePositionConstraints(0.75);n=true;for(l=0;l<this.m_jointCount;++l){var h=this.m_joints[l].SolvePositionConstraints(am.b2_contactBaumgarte);n=n&&h}if(o&&n){break}}this.Report(j.m_constraints)};f.prototype.Report=function(j){if(this.m_listener!=null){for(var n=0;n<this.m_contactCount;++n){for(var k=this.m_contacts[n],h=j[n],l=0;l<h.pointCount;++l){f.s_impulse.normalImpulses[l]=h.points[l].normalImpulse;f.s_impulse.tangentImpulses[l]=h.points[l].tangentImpulse}this.m_listener.PostSolve(k,f.s_impulse)}}};f.prototype.AddBody=function(h){h.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=h};f.prototype.AddContact=function(h){this.m_contacts[this.m_contactCount++]=h};f.prototype.AddJoint=function(h){this.m_joints[this.m_jointCount++]=h};e.postDefs.push(function(){e.Dynamics.b2Island.s_impulse=new aj});av.b2TimeStep=function(){};av.prototype.Set=function(h){this.dt=h.dt;this.inv_dt=h.inv_dt;this.positionIterations=h.positionIterations;this.velocityIterations=h.velocityIterations;this.warmStarting=h.warmStarting};au.b2World=function(){this.s_stack=new b;this.m_contactManager=new x;this.m_contactSolver=new ao;this.m_island=new f};au.prototype.b2World=function(h,j){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;au.m_warmStarting=true;au.m_continuousPhysics=true;this.m_allowSleep=j;this.m_gravity=h;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new T)};au.prototype.SetDestructionListener=function(h){this.m_destructionListener=h};au.prototype.SetContactFilter=function(h){this.m_contactManager.m_contactFilter=h};au.prototype.SetContactListener=function(h){this.m_contactManager.m_contactListener=h};au.prototype.SetDebugDraw=function(h){this.m_debugDraw=h};au.prototype.SetBroadPhase=function(j){var l=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=j;for(var k=this.m_bodyList;k;k=k.m_next){for(var h=k.m_fixtureList;h;h=h.m_next){h.m_proxy=j.CreateProxy(l.GetFatAABB(h.m_proxy),h)}}};au.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};au.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};au.prototype.CreateBody=function(h){if(this.IsLocked()==true){return null}h=new ar(h,this);h.m_prev=null;if(h.m_next=this.m_bodyList){this.m_bodyList.m_prev=h}this.m_bodyList=h;++this.m_bodyCount;return h};au.prototype.DestroyBody=function(h){if(this.IsLocked()!=true){for(var k=h.m_jointList;k;){var j=k;k=k.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(j.joint);this.DestroyJoint(j.joint)}for(k=h.m_controllerList;k;){j=k;k=k.nextController;j.controller.RemoveBody(h)}for(k=h.m_contactList;k;){j=k;k=k.next;this.m_contactManager.Destroy(j.contact)}h.m_contactList=null;for(k=h.m_fixtureList;k;){j=k;k=k.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(j);j.DestroyProxy(this.m_contactManager.m_broadPhase);j.Destroy()}h.m_fixtureList=null;h.m_fixtureCount=0;if(h.m_prev){h.m_prev.m_next=h.m_next}if(h.m_next){h.m_next.m_prev=h.m_prev}if(h==this.m_bodyList){this.m_bodyList=h.m_next}--this.m_bodyCount}};au.prototype.CreateJoint=function(j){var l=ak.Create(j,null);l.m_prev=null;if(l.m_next=this.m_jointList){this.m_jointList.m_prev=l}this.m_jointList=l;++this.m_jointCount;l.m_edgeA.joint=l;l.m_edgeA.other=l.m_bodyB;l.m_edgeA.prev=null;if(l.m_edgeA.next=l.m_bodyA.m_jointList){l.m_bodyA.m_jointList.prev=l.m_edgeA}l.m_bodyA.m_jointList=l.m_edgeA;l.m_edgeB.joint=l;l.m_edgeB.other=l.m_bodyA;l.m_edgeB.prev=null;if(l.m_edgeB.next=l.m_bodyB.m_jointList){l.m_bodyB.m_jointList.prev=l.m_edgeB}l.m_bodyB.m_jointList=l.m_edgeB;var k=j.bodyA,h=j.bodyB;if(j.collideConnected==false){for(j=h.GetContactList();j;){j.other==k&&j.contact.FlagForFiltering();j=j.next}}return l};au.prototype.DestroyJoint=function(j){var l=j.m_collideConnected;if(j.m_prev){j.m_prev.m_next=j.m_next}if(j.m_next){j.m_next.m_prev=j.m_prev}if(j==this.m_jointList){this.m_jointList=j.m_next}var k=j.m_bodyA,h=j.m_bodyB;k.SetAwake(true);h.SetAwake(true);if(j.m_edgeA.prev){j.m_edgeA.prev.next=j.m_edgeA.next}if(j.m_edgeA.next){j.m_edgeA.next.prev=j.m_edgeA.prev}if(j.m_edgeA==k.m_jointList){k.m_jointList=j.m_edgeA.next}j.m_edgeA.prev=null;j.m_edgeA.next=null;if(j.m_edgeB.prev){j.m_edgeB.prev.next=j.m_edgeB.next}if(j.m_edgeB.next){j.m_edgeB.next.prev=j.m_edgeB.prev}if(j.m_edgeB==h.m_jointList){h.m_jointList=j.m_edgeB.next}j.m_edgeB.prev=null;j.m_edgeB.next=null;ak.Destroy(j,null);--this.m_jointCount;if(l==false){for(j=h.GetContactList();j;){j.other==k&&j.contact.FlagForFiltering();j=j.next}}};au.prototype.AddController=function(h){h.m_next=this.m_controllerList;h.m_prev=null;this.m_controllerList=h;h.m_world=this;this.m_controllerCount++;return h};au.prototype.RemoveController=function(h){if(h.m_prev){h.m_prev.m_next=h.m_next}if(h.m_next){h.m_next.m_prev=h.m_prev}if(this.m_controllerList==h){this.m_controllerList=h.m_next}this.m_controllerCount--};au.prototype.CreateController=function(h){if(h.m_world!=this){throw Error("Controller can only be a member of one world")}h.m_next=this.m_controllerList;h.m_prev=null;if(this.m_controllerList){this.m_controllerList.m_prev=h}this.m_controllerList=h;++this.m_controllerCount;h.m_world=this;return h};au.prototype.DestroyController=function(h){h.Clear();if(h.m_next){h.m_next.m_prev=h.m_prev}if(h.m_prev){h.m_prev.m_next=h.m_next}if(h==this.m_controllerList){this.m_controllerList=h.m_next}--this.m_controllerCount};au.prototype.SetWarmStarting=function(h){au.m_warmStarting=h};au.prototype.SetContinuousPhysics=function(h){au.m_continuousPhysics=h};au.prototype.GetBodyCount=function(){return this.m_bodyCount};au.prototype.GetJointCount=function(){return this.m_jointCount};au.prototype.GetContactCount=function(){return this.m_contactCount};au.prototype.SetGravity=function(h){this.m_gravity=h};au.prototype.GetGravity=function(){return this.m_gravity};au.prototype.GetGroundBody=function(){return this.m_groundBody};au.prototype.Step=function(j,l,k){if(j===undefined){j=0}if(l===undefined){l=0}if(k===undefined){k=0}if(this.m_flags&au.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~au.e_newFixture}this.m_flags|=au.e_locked;var h=au.s_timestep2;h.dt=j;h.velocityIterations=l;h.positionIterations=k;h.inv_dt=j>0?1/j:0;h.dtRatio=this.m_inv_dt0*j;h.warmStarting=au.m_warmStarting;this.m_contactManager.Collide();h.dt>0&&this.Solve(h);au.m_continuousPhysics&&h.dt>0&&this.SolveTOI(h);if(h.dt>0){this.m_inv_dt0=h.inv_dt}this.m_flags&=~au.e_locked};au.prototype.ClearForces=function(){for(var h=this.m_bodyList;h;h=h.m_next){h.m_force.SetZero();h.m_torque=0}};au.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var k=this.m_debugDraw.GetFlags(),p,l,j;new ab;new ab;new ab;var o;new r;new r;o=[new ab,new ab,new ab,new ab];var n=new ae(0,0,0);if(k&ai.e_shapeBit){for(p=this.m_bodyList;p;p=p.m_next){o=p.m_xf;for(l=p.GetFixtureList();l;l=l.m_next){j=l.GetShape();if(p.IsActive()==false){n.Set(0.5,0.5,0.3)}else{if(p.GetType()==ar.b2_staticBody){n.Set(0.5,0.9,0.5)}else{if(p.GetType()==ar.b2_kinematicBody){n.Set(0.5,0.5,0.9)}else{p.IsAwake()==false?n.Set(0.6,0.6,0.6):n.Set(0.9,0.7,0.7)}}}this.DrawShape(j,o,n)}}}if(k&ai.e_jointBit){for(p=this.m_jointList;p;p=p.m_next){this.DrawJoint(p)}}if(k&ai.e_controllerBit){for(p=this.m_controllerList;p;p=p.m_next){p.Draw(this.m_debugDraw)}}if(k&ai.e_pairBit){n.Set(0.3,0.9,0.9);for(p=this.m_contactManager.m_contactList;p;p=p.GetNext()){j=p.GetFixtureA();l=p.GetFixtureB();j=j.GetAABB().GetCenter();l=l.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(j,l,n)}}if(k&ai.e_aabbBit){j=this.m_contactManager.m_broadPhase;o=[new ab,new ab,new ab,new ab];for(p=this.m_bodyList;p;p=p.GetNext()){if(p.IsActive()!=false){for(l=p.GetFixtureList();l;l=l.GetNext()){var h=j.GetFatAABB(l.m_proxy);o[0].Set(h.lowerBound.x,h.lowerBound.y);o[1].Set(h.upperBound.x,h.lowerBound.y);o[2].Set(h.upperBound.x,h.upperBound.y);o[3].Set(h.lowerBound.x,h.upperBound.y);this.m_debugDraw.DrawPolygon(o,4,n)}}}}if(k&ai.e_centerOfMassBit){for(p=this.m_bodyList;p;p=p.m_next){o=au.s_xf;o.R=p.m_xf.R;o.position=p.GetWorldCenter();this.m_debugDraw.DrawTransform(o)}}}};au.prototype.QueryAABB=function(h,k){var j=this.m_contactManager.m_broadPhase;j.Query(function(l){return h(j.GetUserData(l))},k)};au.prototype.QueryShape=function(j,n,k){if(k===undefined){k=null}if(k==null){k=new X;k.SetIdentity()}var h=this.m_contactManager.m_broadPhase,l=new r;n.ComputeAABB(l,k);h.Query(function(o){o=h.GetUserData(o) instanceof s?h.GetUserData(o):null;if(g.TestOverlap(n,k,o.GetShape(),o.GetBody().GetTransform())){return j(o)}return true},l)};au.prototype.QueryPoint=function(j,l){var k=this.m_contactManager.m_broadPhase,h=new r;h.lowerBound.Set(l.x-am.b2_linearSlop,l.y-am.b2_linearSlop);h.upperBound.Set(l.x+am.b2_linearSlop,l.y+am.b2_linearSlop);k.Query(function(n){n=k.GetUserData(n) instanceof s?k.GetUserData(n):null;if(n.TestPoint(l)){return j(n)}return true},h)};au.prototype.RayCast=function(j,o,k){var h=this.m_contactManager.m_broadPhase,n=new m,l=new v(o,k);h.RayCast(function(p,y){var w=h.GetUserData(y);w=w instanceof s?w:null;if(w.RayCast(n,p)){var q=n.fraction,u=new ab((1-q)*o.x+q*k.x,(1-q)*o.y+q*k.y);return j(w,u,n.normal,q)}return p.maxFraction},l)};au.prototype.RayCastOne=function(h,k){var j;this.RayCast(function(n,p,o,l){if(l===undefined){l=0}j=n;return l},h,k);return j};au.prototype.RayCastAll=function(h,k){var j=new b;this.RayCast(function(l){j[j.length]=l;return 1},h,k);return j};au.prototype.GetBodyList=function(){return this.m_bodyList};au.prototype.GetJointList=function(){return this.m_jointList};au.prototype.GetContactList=function(){return this.m_contactList};au.prototype.IsLocked=function(){return(this.m_flags&au.e_locked)>0};au.prototype.Solve=function(k){for(var q,n=this.m_controllerList;n;n=n.m_next){n.Step(k)}n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(q=this.m_bodyList;q;q=q.m_next){q.m_flags&=~ar.e_islandFlag}for(var j=this.m_contactList;j;j=j.m_next){j.m_flags&=~aq.e_islandFlag}for(j=this.m_jointList;j;j=j.m_next){j.m_islandFlag=false}parseInt(this.m_bodyCount);j=this.s_stack;for(var p=this.m_bodyList;p;p=p.m_next){if(!(p.m_flags&ar.e_islandFlag)){if(!(p.IsAwake()==false||p.IsActive()==false)){if(p.GetType()!=ar.b2_staticBody){n.Clear();var o=0;j[o++]=p;for(p.m_flags|=ar.e_islandFlag;o>0;){q=j[--o];n.AddBody(q);q.IsAwake()==false&&q.SetAwake(true);if(q.GetType()!=ar.b2_staticBody){for(var h,l=q.m_contactList;l;l=l.next){if(!(l.contact.m_flags&aq.e_islandFlag)){if(!(l.contact.IsSensor()==true||l.contact.IsEnabled()==false||l.contact.IsTouching()==false)){n.AddContact(l.contact);l.contact.m_flags|=aq.e_islandFlag;h=l.other;if(!(h.m_flags&ar.e_islandFlag)){j[o++]=h;h.m_flags|=ar.e_islandFlag}}}}for(q=q.m_jointList;q;q=q.next){if(q.joint.m_islandFlag!=true){h=q.other;if(h.IsActive()!=false){n.AddJoint(q.joint);q.joint.m_islandFlag=true;if(!(h.m_flags&ar.e_islandFlag)){j[o++]=h;h.m_flags|=ar.e_islandFlag}}}}}}n.Solve(k,this.m_gravity,this.m_allowSleep);for(o=0;o<n.m_bodyCount;++o){q=n.m_bodies[o];if(q.GetType()==ar.b2_staticBody){q.m_flags&=~ar.e_islandFlag}}}}}}for(o=0;o<j.length;++o){if(!j[o]){break}j[o]=null}for(q=this.m_bodyList;q;q=q.m_next){q.IsAwake()==false||q.IsActive()==false||q.GetType()!=ar.b2_staticBody&&q.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};au.prototype.SolveTOI=function(q){var o,k,p,n=this.m_island;n.Initialize(this.m_bodyCount,am.b2_maxTOIContactsPerIsland,am.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var l=au.s_queue;for(o=this.m_bodyList;o;o=o.m_next){o.m_flags&=~ar.e_islandFlag;o.m_sweep.t0=0}for(p=this.m_contactList;p;p=p.m_next){p.m_flags&=~(aq.e_toiFlag|aq.e_islandFlag)}for(p=this.m_jointList;p;p=p.m_next){p.m_islandFlag=false}for(;;){var j=null,h=1;for(p=this.m_contactList;p;p=p.m_next){if(!(p.IsSensor()==true||p.IsEnabled()==false||p.IsContinuous()==false)){o=1;if(p.m_flags&aq.e_toiFlag){o=p.m_toi}else{o=p.m_fixtureA;k=p.m_fixtureB;o=o.m_body;k=k.m_body;if((o.GetType()!=ar.b2_dynamicBody||o.IsAwake()==false)&&(k.GetType()!=ar.b2_dynamicBody||k.IsAwake()==false)){continue}var u=o.m_sweep.t0;if(o.m_sweep.t0<k.m_sweep.t0){u=k.m_sweep.t0;o.m_sweep.Advance(u)}else{if(k.m_sweep.t0<o.m_sweep.t0){u=o.m_sweep.t0;k.m_sweep.Advance(u)}}o=p.ComputeTOI(o.m_sweep,k.m_sweep);am.b2Assert(0<=o&&o<=1);if(o>0&&o<1){o=(1-o)*u+o;if(o>1){o=1}}p.m_toi=o;p.m_flags|=aq.e_toiFlag}if(Number.MIN_VALUE<o&&o<h){j=p;h=o}}}if(j==null||1-100*Number.MIN_VALUE<h){break}o=j.m_fixtureA;k=j.m_fixtureB;o=o.m_body;k=k.m_body;au.s_backupA.Set(o.m_sweep);au.s_backupB.Set(k.m_sweep);o.Advance(h);k.Advance(h);j.Update(this.m_contactManager.m_contactListener);j.m_flags&=~aq.e_toiFlag;if(j.IsSensor()==true||j.IsEnabled()==false){o.m_sweep.Set(au.s_backupA);k.m_sweep.Set(au.s_backupB);o.SynchronizeTransform();k.SynchronizeTransform()}else{if(j.IsTouching()!=false){o=o;if(o.GetType()!=ar.b2_dynamicBody){o=k}n.Clear();j=p=0;l[p+j++]=o;for(o.m_flags|=ar.e_islandFlag;j>0;){o=l[p++];--j;n.AddBody(o);o.IsAwake()==false&&o.SetAwake(true);if(o.GetType()==ar.b2_dynamicBody){for(k=o.m_contactList;k;k=k.next){if(n.m_contactCount==n.m_contactCapacity){break}if(!(k.contact.m_flags&aq.e_islandFlag)){if(!(k.contact.IsSensor()==true||k.contact.IsEnabled()==false||k.contact.IsTouching()==false)){n.AddContact(k.contact);k.contact.m_flags|=aq.e_islandFlag;u=k.other;if(!(u.m_flags&ar.e_islandFlag)){if(u.GetType()!=ar.b2_staticBody){u.Advance(h);u.SetAwake(true)}l[p+j]=u;++j;u.m_flags|=ar.e_islandFlag}}}}for(o=o.m_jointList;o;o=o.next){if(n.m_jointCount!=n.m_jointCapacity){if(o.joint.m_islandFlag!=true){u=o.other;if(u.IsActive()!=false){n.AddJoint(o.joint);o.joint.m_islandFlag=true;if(!(u.m_flags&ar.e_islandFlag)){if(u.GetType()!=ar.b2_staticBody){u.Advance(h);u.SetAwake(true)}l[p+j]=u;++j;u.m_flags|=ar.e_islandFlag}}}}}}}p=au.s_timestep;p.warmStarting=false;p.dt=(1-h)*q.dt;p.inv_dt=1/p.dt;p.dtRatio=0;p.velocityIterations=q.velocityIterations;p.positionIterations=q.positionIterations;n.SolveTOI(p);for(h=h=0;h<n.m_bodyCount;++h){o=n.m_bodies[h];o.m_flags&=~ar.e_islandFlag;if(o.IsAwake()!=false){if(o.GetType()==ar.b2_dynamicBody){o.SynchronizeFixtures();for(k=o.m_contactList;k;k=k.next){k.contact.m_flags&=~aq.e_toiFlag}}}}for(h=0;h<n.m_contactCount;++h){p=n.m_contacts[h];p.m_flags&=~(aq.e_toiFlag|aq.e_islandFlag)}for(h=0;h<n.m_jointCount;++h){p=n.m_joints[h];p.m_islandFlag=false}this.m_contactManager.FindNewContacts()}}}};au.prototype.DrawJoint=function(k){var q=k.GetBodyA(),n=k.GetBodyB(),j=q.m_xf.position,p=n.m_xf.position,o=k.GetAnchorA(),h=k.GetAnchorB(),l=au.s_jointColor;switch(k.m_type){case ak.e_distanceJoint:this.m_debugDraw.DrawSegment(o,h,l);break;case ak.e_pulleyJoint:q=k instanceof ap?k:null;k=q.GetGroundAnchorA();q=q.GetGroundAnchorB();this.m_debugDraw.DrawSegment(k,o,l);this.m_debugDraw.DrawSegment(q,h,l);this.m_debugDraw.DrawSegment(k,q,l);break;case ak.e_mouseJoint:this.m_debugDraw.DrawSegment(o,h,l);break;default:q!=this.m_groundBody&&this.m_debugDraw.DrawSegment(j,o,l);this.m_debugDraw.DrawSegment(o,h,l);n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(p,h,l)}};au.prototype.DrawShape=function(j,o,k){switch(j.m_type){case g.e_circleShape:var h=j instanceof J?j:null;this.m_debugDraw.DrawSolidCircle(ah.MulX(o,h.m_p),h.m_radius,o.R.col1,k);break;case g.e_polygonShape:h=0;h=j instanceof i?j:null;j=parseInt(h.GetVertexCount());var n=h.GetVertices(),l=new b(j);for(h=0;h<j;++h){l[h]=ah.MulX(o,n[h])}this.m_debugDraw.DrawSolidPolygon(l,j,k);break;case g.e_edgeShape:h=j instanceof P?j:null;this.m_debugDraw.DrawSegment(ah.MulX(o,h.GetVertex1()),ah.MulX(o,h.GetVertex2()),k)}};e.postDefs.push(function(){e.Dynamics.b2World.s_timestep2=new av;e.Dynamics.b2World.s_xf=new X;e.Dynamics.b2World.s_backupA=new af;e.Dynamics.b2World.s_backupB=new af;e.Dynamics.b2World.s_timestep=new av;e.Dynamics.b2World.s_queue=new b;e.Dynamics.b2World.s_jointColor=new ae(0.5,0.8,0.8);e.Dynamics.b2World.e_newFixture=1;e.Dynamics.b2World.e_locked=2})})();(function(){var ad=e.Collision.Shapes.b2CircleShape,ab=e.Collision.Shapes.b2EdgeShape,C=e.Collision.Shapes.b2PolygonShape,J=e.Collision.Shapes.b2Shape,X=e.Dynamics.Contacts.b2CircleContact,ah=e.Dynamics.Contacts.b2Contact,m=e.Dynamics.Contacts.b2ContactConstraint,ai=e.Dynamics.Contacts.b2ContactConstraintPoint,ag=e.Dynamics.Contacts.b2ContactEdge,q=e.Dynamics.Contacts.b2ContactFactory,j=e.Dynamics.Contacts.b2ContactRegister,t=e.Dynamics.Contacts.b2ContactResult,v=e.Dynamics.Contacts.b2ContactSolver,P=e.Dynamics.Contacts.b2EdgeAndCircleContact,i=e.Dynamics.Contacts.b2NullContact,g=e.Dynamics.Contacts.b2PolyAndCircleContact,ak=e.Dynamics.Contacts.b2PolyAndEdgeContact,x=e.Dynamics.Contacts.b2PolygonContact,ac=e.Dynamics.Contacts.b2PositionSolverManifold,af=e.Dynamics.b2Body,T=e.Dynamics.b2TimeStep,r=e.Common.b2Settings,ae=e.Common.Math.b2Mat22,o=e.Common.Math.b2Math,s=e.Common.Math.b2Vec2,n=e.Collision.b2Collision,an=e.Collision.b2ContactID,f=e.Collision.b2Manifold,am=e.Collision.b2TimeOfImpact,al=e.Collision.b2TOIInput,aj=e.Collision.b2WorldManifold;e.inherit(X,e.Dynamics.Contacts.b2Contact);X.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype;X.b2CircleContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};X.Create=function(){return new X};X.Destroy=function(){};X.prototype.Reset=function(h,k){this.__super.Reset.call(this,h,k)};X.prototype.Evaluate=function(){var h=this.m_fixtureA.GetBody(),k=this.m_fixtureB.GetBody();n.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape() instanceof ad?this.m_fixtureA.GetShape():null,h.m_xf,this.m_fixtureB.GetShape() instanceof ad?this.m_fixtureB.GetShape():null,k.m_xf)};ah.b2Contact=function(){this.m_nodeA=new ag;this.m_nodeB=new ag;this.m_manifold=new f;this.m_oldManifold=new f};ah.prototype.GetManifold=function(){return this.m_manifold};ah.prototype.GetWorldManifold=function(k){var p=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),u=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape();k.Initialize(this.m_manifold,p.GetTransform(),u.m_radius,l.GetTransform(),h.m_radius)};ah.prototype.IsTouching=function(){return(this.m_flags&ah.e_touchingFlag)==ah.e_touchingFlag};ah.prototype.IsContinuous=function(){return(this.m_flags&ah.e_continuousFlag)==ah.e_continuousFlag};ah.prototype.SetSensor=function(h){if(h){this.m_flags|=ah.e_sensorFlag}else{this.m_flags&=~ah.e_sensorFlag}};ah.prototype.IsSensor=function(){return(this.m_flags&ah.e_sensorFlag)==ah.e_sensorFlag};ah.prototype.SetEnabled=function(h){if(h){this.m_flags|=ah.e_enabledFlag}else{this.m_flags&=~ah.e_enabledFlag}};ah.prototype.IsEnabled=function(){return(this.m_flags&ah.e_enabledFlag)==ah.e_enabledFlag};ah.prototype.GetNext=function(){return this.m_next};ah.prototype.GetFixtureA=function(){return this.m_fixtureA};ah.prototype.GetFixtureB=function(){return this.m_fixtureB};ah.prototype.FlagForFiltering=function(){this.m_flags|=ah.e_filterFlag};ah.prototype.b2Contact=function(){};ah.prototype.Reset=function(h,l){if(h===undefined){h=null}if(l===undefined){l=null}this.m_flags=ah.e_enabledFlag;if(!h||!l){this.m_fixtureB=this.m_fixtureA=null}else{if(h.IsSensor()||l.IsSensor()){this.m_flags|=ah.e_sensorFlag}var k=h.GetBody(),p=l.GetBody();if(k.GetType()!=af.b2_dynamicBody||k.IsBullet()||p.GetType()!=af.b2_dynamicBody||p.IsBullet()){this.m_flags|=ah.e_continuousFlag}this.m_fixtureA=h;this.m_fixtureB=l;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};ah.prototype.Update=function(p){var k=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=k;this.m_flags|=ah.e_enabledFlag;var h=false;k=(this.m_flags&ah.e_touchingFlag)==ah.e_touchingFlag;var l=this.m_fixtureA.m_body,B=this.m_fixtureB.m_body,z=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&ah.e_sensorFlag){if(z){h=this.m_fixtureA.GetShape();z=this.m_fixtureB.GetShape();l=l.GetTransform();B=B.GetTransform();h=J.TestOverlap(h,l,z,B)}this.m_manifold.m_pointCount=0}else{if(l.GetType()!=af.b2_dynamicBody||l.IsBullet()||B.GetType()!=af.b2_dynamicBody||B.IsBullet()){this.m_flags|=ah.e_continuousFlag}else{this.m_flags&=~ah.e_continuousFlag}if(z){this.Evaluate();h=this.m_manifold.m_pointCount>0;for(z=0;z<this.m_manifold.m_pointCount;++z){var u=this.m_manifold.m_points[z];u.m_normalImpulse=0;u.m_tangentImpulse=0;for(var A=u.m_id,y=0;y<this.m_oldManifold.m_pointCount;++y){var w=this.m_oldManifold.m_points[y];if(w.m_id.key==A.key){u.m_normalImpulse=w.m_normalImpulse;u.m_tangentImpulse=w.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(h!=k){l.SetAwake(true);B.SetAwake(true)}}if(h){this.m_flags|=ah.e_touchingFlag}else{this.m_flags&=~ah.e_touchingFlag}k==false&&h==true&&p.BeginContact(this);k==true&&h==false&&p.EndContact(this);(this.m_flags&ah.e_sensorFlag)==0&&p.PreSolve(this,this.m_oldManifold)};ah.prototype.Evaluate=function(){};ah.prototype.ComputeTOI=function(h,k){ah.s_input.proxyA.Set(this.m_fixtureA.GetShape());ah.s_input.proxyB.Set(this.m_fixtureB.GetShape());ah.s_input.sweepA=h;ah.s_input.sweepB=k;ah.s_input.tolerance=r.b2_linearSlop;return am.TimeOfImpact(ah.s_input)};e.postDefs.push(function(){e.Dynamics.Contacts.b2Contact.e_sensorFlag=1;e.Dynamics.Contacts.b2Contact.e_continuousFlag=2;e.Dynamics.Contacts.b2Contact.e_islandFlag=4;e.Dynamics.Contacts.b2Contact.e_toiFlag=8;e.Dynamics.Contacts.b2Contact.e_touchingFlag=16;e.Dynamics.Contacts.b2Contact.e_enabledFlag=32;e.Dynamics.Contacts.b2Contact.e_filterFlag=64;e.Dynamics.Contacts.b2Contact.s_input=new al});m.b2ContactConstraint=function(){this.localPlaneNormal=new s;this.localPoint=new s;this.normal=new s;this.normalMass=new ae;this.K=new ae};m.prototype.b2ContactConstraint=function(){this.points=new b(r.b2_maxManifoldPoints);for(var h=0;h<r.b2_maxManifoldPoints;h++){this.points[h]=new ai}};ai.b2ContactConstraintPoint=function(){this.localPoint=new s;this.rA=new s;this.rB=new s};ag.b2ContactEdge=function(){};q.b2ContactFactory=function(){};q.prototype.b2ContactFactory=function(h){this.m_allocator=h;this.InitializeRegisters()};q.prototype.AddType=function(h,l,k,p){if(k===undefined){k=0}if(p===undefined){p=0}this.m_registers[k][p].createFcn=h;this.m_registers[k][p].destroyFcn=l;this.m_registers[k][p].primary=true;if(k!=p){this.m_registers[p][k].createFcn=h;this.m_registers[p][k].destroyFcn=l;this.m_registers[p][k].primary=false}};q.prototype.InitializeRegisters=function(){this.m_registers=new b(J.e_shapeTypeCount);for(var h=0;h<J.e_shapeTypeCount;h++){this.m_registers[h]=new b(J.e_shapeTypeCount);for(var k=0;k<J.e_shapeTypeCount;k++){this.m_registers[h][k]=new j}}this.AddType(X.Create,X.Destroy,J.e_circleShape,J.e_circleShape);this.AddType(g.Create,g.Destroy,J.e_polygonShape,J.e_circleShape);this.AddType(x.Create,x.Destroy,J.e_polygonShape,J.e_polygonShape);this.AddType(P.Create,P.Destroy,J.e_edgeShape,J.e_circleShape);this.AddType(ak.Create,ak.Destroy,J.e_polygonShape,J.e_edgeShape)};q.prototype.Create=function(h,l){var k=parseInt(h.GetType()),p=parseInt(l.GetType());k=this.m_registers[k][p];if(k.pool){p=k.pool;k.pool=p.m_next;k.poolCount--;p.Reset(h,l);return p}p=k.createFcn;if(p!=null){if(k.primary){p=p(this.m_allocator);p.Reset(h,l)}else{p=p(this.m_allocator);p.Reset(l,h)}return p}else{return null}};q.prototype.Destroy=function(h){if(h.m_manifold.m_pointCount>0){h.m_fixtureA.m_body.SetAwake(true);h.m_fixtureB.m_body.SetAwake(true)}var l=parseInt(h.m_fixtureA.GetType()),k=parseInt(h.m_fixtureB.GetType());l=this.m_registers[l][k];l.poolCount++;h.m_next=l.pool;l.pool=h;l=l.destroyFcn;l(h,this.m_allocator)};j.b2ContactRegister=function(){};t.b2ContactResult=function(){this.position=new s;this.normal=new s;this.id=new an};v.b2ContactSolver=function(){this.m_step=new T;this.m_constraints=new b};v.prototype.b2ContactSolver=function(){};v.prototype.Initialize=function(L,H,F,I){if(F===undefined){F=0}var S;this.m_step.Set(L);this.m_allocator=I;L=0;for(this.m_constraintCount=F;this.m_constraints.length<this.m_constraintCount;){this.m_constraints[this.m_constraints.length]=new m}for(L=0;L<F;++L){S=H[L];I=S.m_fixtureA;var Q=S.m_fixtureB,M=I.m_shape.m_radius,R=Q.m_shape.m_radius,O=I.m_body,N=Q.m_body,K=S.GetManifold(),E=r.b2MixFriction(I.GetFriction(),Q.GetFriction()),B=r.b2MixRestitution(I.GetRestitution(),Q.GetRestitution()),z=O.m_linearVelocity.x,A=O.m_linearVelocity.y,y=N.m_linearVelocity.x,D=N.m_linearVelocity.y,w=O.m_angularVelocity,k=N.m_angularVelocity;r.b2Assert(K.m_pointCount>0);v.s_worldManifold.Initialize(K,O.m_xf,M,N.m_xf,R);Q=v.s_worldManifold.m_normal.x;S=v.s_worldManifold.m_normal.y;I=this.m_constraints[L];I.bodyA=O;I.bodyB=N;I.manifold=K;I.normal.x=Q;I.normal.y=S;I.pointCount=K.m_pointCount;I.friction=E;I.restitution=B;I.localPlaneNormal.x=K.m_localPlaneNormal.x;I.localPlaneNormal.y=K.m_localPlaneNormal.y;I.localPoint.x=K.m_localPoint.x;I.localPoint.y=K.m_localPoint.y;I.radius=M+R;I.type=K.m_type;for(M=0;M<I.pointCount;++M){E=K.m_points[M];R=I.points[M];R.normalImpulse=E.m_normalImpulse;R.tangentImpulse=E.m_tangentImpulse;R.localPoint.SetV(E.m_localPoint);E=R.rA.x=v.s_worldManifold.m_points[M].x-O.m_sweep.c.x;B=R.rA.y=v.s_worldManifold.m_points[M].y-O.m_sweep.c.y;var u=R.rB.x=v.s_worldManifold.m_points[M].x-N.m_sweep.c.x,h=R.rB.y=v.s_worldManifold.m_points[M].y-N.m_sweep.c.y,l=E*S-B*Q,p=u*S-h*Q;l*=l;p*=p;R.normalMass=1/(O.m_invMass+N.m_invMass+O.m_invI*l+N.m_invI*p);var G=O.m_mass*O.m_invMass+N.m_mass*N.m_invMass;G+=O.m_mass*O.m_invI*l+N.m_mass*N.m_invI*p;R.equalizedMass=1/G;p=S;G=-Q;l=E*G-B*p;p=u*G-h*p;l*=l;p*=p;R.tangentMass=1/(O.m_invMass+N.m_invMass+O.m_invI*l+N.m_invI*p);R.velocityBias=0;E=I.normal.x*(y+-k*h-z- -w*B)+I.normal.y*(D+k*u-A-w*E);if(E<-r.b2_velocityThreshold){R.velocityBias+=-I.restitution*E}}if(I.pointCount==2){D=I.points[0];y=I.points[1];K=O.m_invMass;O=O.m_invI;z=N.m_invMass;N=N.m_invI;A=D.rA.x*S-D.rA.y*Q;D=D.rB.x*S-D.rB.y*Q;w=y.rA.x*S-y.rA.y*Q;y=y.rB.x*S-y.rB.y*Q;Q=K+z+O*A*A+N*D*D;S=K+z+O*w*w+N*y*y;N=K+z+O*A*w+N*D*y;if(Q*Q<100*(Q*S-N*N)){I.K.col1.Set(Q,N);I.K.col2.Set(N,S);I.K.GetInverse(I.normalMass)}else{I.pointCount=1}}}};v.prototype.InitVelocityConstraints=function(E){for(var A=0;A<this.m_constraintCount;++A){var z=this.m_constraints[A],B=z.bodyA,L=z.bodyB,I=B.m_invMass,F=B.m_invI,K=L.m_invMass,H=L.m_invI,G=z.normal.x,D=z.normal.y,y=D,u=-G,l=0,p=0;if(E.warmStarting){p=z.pointCount;for(l=0;l<p;++l){var k=z.points[l];k.normalImpulse*=E.dtRatio;k.tangentImpulse*=E.dtRatio;var w=k.normalImpulse*G+k.tangentImpulse*y,h=k.normalImpulse*D+k.tangentImpulse*u;B.m_angularVelocity-=F*(k.rA.x*h-k.rA.y*w);B.m_linearVelocity.x-=I*w;B.m_linearVelocity.y-=I*h;L.m_angularVelocity+=H*(k.rB.x*h-k.rB.y*w);L.m_linearVelocity.x+=K*w;L.m_linearVelocity.y+=K*h}}else{p=z.pointCount;for(l=0;l<p;++l){B=z.points[l];B.normalImpulse=0;B.tangentImpulse=0}}}};v.prototype.SolveVelocityConstraints=function(){for(var L=0,H,F=0,I=0,S=0,Q=I=I=F=F=0,M=F=F=0,R=F=S=0,O=0,N,K=0;K<this.m_constraintCount;++K){S=this.m_constraints[K];var E=S.bodyA,B=S.bodyB,z=E.m_angularVelocity,A=B.m_angularVelocity,y=E.m_linearVelocity,D=B.m_linearVelocity,w=E.m_invMass,k=E.m_invI,u=B.m_invMass,h=B.m_invI;R=S.normal.x;var l=O=S.normal.y;N=-R;M=S.friction;for(L=0;L<S.pointCount;L++){H=S.points[L];F=D.x-A*H.rB.y-y.x+z*H.rA.y;I=D.y+A*H.rB.x-y.y-z*H.rA.x;F=F*l+I*N;F=H.tangentMass*-F;I=M*H.normalImpulse;I=o.Clamp(H.tangentImpulse+F,-I,I);F=I-H.tangentImpulse;Q=F*l;F=F*N;y.x-=w*Q;y.y-=w*F;z-=k*(H.rA.x*F-H.rA.y*Q);D.x+=u*Q;D.y+=u*F;A+=h*(H.rB.x*F-H.rB.y*Q);H.tangentImpulse=I}parseInt(S.pointCount);if(S.pointCount==1){H=S.points[0];F=D.x+-A*H.rB.y-y.x- -z*H.rA.y;I=D.y+A*H.rB.x-y.y-z*H.rA.x;S=F*R+I*O;F=-H.normalMass*(S-H.velocityBias);I=H.normalImpulse+F;I=I>0?I:0;F=I-H.normalImpulse;Q=F*R;F=F*O;y.x-=w*Q;y.y-=w*F;z-=k*(H.rA.x*F-H.rA.y*Q);D.x+=u*Q;D.y+=u*F;A+=h*(H.rB.x*F-H.rB.y*Q);H.normalImpulse=I}else{H=S.points[0];L=S.points[1];F=H.normalImpulse;M=L.normalImpulse;var p=(D.x-A*H.rB.y-y.x+z*H.rA.y)*R+(D.y+A*H.rB.x-y.y-z*H.rA.x)*O,G=(D.x-A*L.rB.y-y.x+z*L.rA.y)*R+(D.y+A*L.rB.x-y.y-z*L.rA.x)*O;I=p-H.velocityBias;Q=G-L.velocityBias;N=S.K;I-=N.col1.x*F+N.col2.x*M;for(Q-=N.col1.y*F+N.col2.y*M;;){N=S.normalMass;l=-(N.col1.x*I+N.col2.x*Q);N=-(N.col1.y*I+N.col2.y*Q);if(l>=0&&N>=0){F=l-F;M=N-M;S=F*R;F=F*O;R=M*R;O=M*O;y.x-=w*(S+R);y.y-=w*(F+O);z-=k*(H.rA.x*F-H.rA.y*S+L.rA.x*O-L.rA.y*R);D.x+=u*(S+R);D.y+=u*(F+O);A+=h*(H.rB.x*F-H.rB.y*S+L.rB.x*O-L.rB.y*R);H.normalImpulse=l;L.normalImpulse=N;break}l=-H.normalMass*I;N=0;G=S.K.col1.y*l+Q;if(l>=0&&G>=0){F=l-F;M=N-M;S=F*R;F=F*O;R=M*R;O=M*O;y.x-=w*(S+R);y.y-=w*(F+O);z-=k*(H.rA.x*F-H.rA.y*S+L.rA.x*O-L.rA.y*R);D.x+=u*(S+R);D.y+=u*(F+O);A+=h*(H.rB.x*F-H.rB.y*S+L.rB.x*O-L.rB.y*R);H.normalImpulse=l;L.normalImpulse=N;break}l=0;N=-L.normalMass*Q;p=S.K.col2.x*N+I;if(N>=0&&p>=0){F=l-F;M=N-M;S=F*R;F=F*O;R=M*R;O=M*O;y.x-=w*(S+R);y.y-=w*(F+O);z-=k*(H.rA.x*F-H.rA.y*S+L.rA.x*O-L.rA.y*R);D.x+=u*(S+R);D.y+=u*(F+O);A+=h*(H.rB.x*F-H.rB.y*S+L.rB.x*O-L.rB.y*R);H.normalImpulse=l;L.normalImpulse=N;break}N=l=0;p=I;G=Q;if(p>=0&&G>=0){F=l-F;M=N-M;S=F*R;F=F*O;R=M*R;O=M*O;y.x-=w*(S+R);y.y-=w*(F+O);z-=k*(H.rA.x*F-H.rA.y*S+L.rA.x*O-L.rA.y*R);D.x+=u*(S+R);D.y+=u*(F+O);A+=h*(H.rB.x*F-H.rB.y*S+L.rB.x*O-L.rB.y*R);H.normalImpulse=l;L.normalImpulse=N;break}break}}E.m_angularVelocity=z;B.m_angularVelocity=A}};v.prototype.FinalizeVelocityConstraints=function(){for(var k=0;k<this.m_constraintCount;++k){for(var p=this.m_constraints[k],l=p.manifold,w=0;w<p.pointCount;++w){var h=l.m_points[w],u=p.points[w];h.m_normalImpulse=u.normalImpulse;h.m_tangentImpulse=u.tangentImpulse}}};v.prototype.SolvePositionConstraints=function(E){if(E===undefined){E=0}for(var A=0,z=0;z<this.m_constraintCount;z++){var B=this.m_constraints[z],L=B.bodyA,I=B.bodyB,F=L.m_mass*L.m_invMass,K=L.m_mass*L.m_invI,H=I.m_mass*I.m_invMass,G=I.m_mass*I.m_invI;v.s_psm.Initialize(B);for(var D=v.s_psm.m_normal,y=0;y<B.pointCount;y++){var u=B.points[y],l=v.s_psm.m_points[y],p=v.s_psm.m_separations[y],k=l.x-L.m_sweep.c.x,w=l.y-L.m_sweep.c.y,h=l.x-I.m_sweep.c.x;l=l.y-I.m_sweep.c.y;A=A<p?A:p;p=o.Clamp(E*(p+r.b2_linearSlop),-r.b2_maxLinearCorrection,0);p=-u.equalizedMass*p;u=p*D.x;p=p*D.y;L.m_sweep.c.x-=F*u;L.m_sweep.c.y-=F*p;L.m_sweep.a-=K*(k*p-w*u);L.SynchronizeTransform();I.m_sweep.c.x+=H*u;I.m_sweep.c.y+=H*p;I.m_sweep.a+=G*(h*p-l*u);I.SynchronizeTransform()}}return A>-1.5*r.b2_linearSlop};e.postDefs.push(function(){e.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new aj;e.Dynamics.Contacts.b2ContactSolver.s_psm=new ac});e.inherit(P,e.Dynamics.Contacts.b2Contact);P.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype;P.b2EdgeAndCircleContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};P.Create=function(){return new P};P.Destroy=function(){};P.prototype.Reset=function(h,k){this.__super.Reset.call(this,h,k)};P.prototype.Evaluate=function(){var h=this.m_fixtureA.GetBody(),k=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape() instanceof ab?this.m_fixtureA.GetShape():null,h.m_xf,this.m_fixtureB.GetShape() instanceof ad?this.m_fixtureB.GetShape():null,k.m_xf)};P.prototype.b2CollideEdgeAndCircle=function(){};e.inherit(i,e.Dynamics.Contacts.b2Contact);i.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype;i.b2NullContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};i.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};i.prototype.Evaluate=function(){};e.inherit(g,e.Dynamics.Contacts.b2Contact);g.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype;g.b2PolyAndCircleContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};g.Create=function(){return new g};g.Destroy=function(){};g.prototype.Reset=function(h,k){this.__super.Reset.call(this,h,k);r.b2Assert(h.GetType()==J.e_polygonShape);r.b2Assert(k.GetType()==J.e_circleShape)};g.prototype.Evaluate=function(){var h=this.m_fixtureA.m_body,k=this.m_fixtureB.m_body;n.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape() instanceof C?this.m_fixtureA.GetShape():null,h.m_xf,this.m_fixtureB.GetShape() instanceof ad?this.m_fixtureB.GetShape():null,k.m_xf)};e.inherit(ak,e.Dynamics.Contacts.b2Contact);ak.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype;ak.b2PolyAndEdgeContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};ak.Create=function(){return new ak};ak.Destroy=function(){};ak.prototype.Reset=function(h,k){this.__super.Reset.call(this,h,k);r.b2Assert(h.GetType()==J.e_polygonShape);r.b2Assert(k.GetType()==J.e_edgeShape)};ak.prototype.Evaluate=function(){var h=this.m_fixtureA.GetBody(),k=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape() instanceof C?this.m_fixtureA.GetShape():null,h.m_xf,this.m_fixtureB.GetShape() instanceof ab?this.m_fixtureB.GetShape():null,k.m_xf)};ak.prototype.b2CollidePolyAndEdge=function(){};e.inherit(x,e.Dynamics.Contacts.b2Contact);x.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype;x.b2PolygonContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};x.Create=function(){return new x};x.Destroy=function(){};x.prototype.Reset=function(h,k){this.__super.Reset.call(this,h,k)};x.prototype.Evaluate=function(){var h=this.m_fixtureA.GetBody(),k=this.m_fixtureB.GetBody();n.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape() instanceof C?this.m_fixtureA.GetShape():null,h.m_xf,this.m_fixtureB.GetShape() instanceof C?this.m_fixtureB.GetShape():null,k.m_xf)};ac.b2PositionSolverManifold=function(){};ac.prototype.b2PositionSolverManifold=function(){this.m_normal=new s;this.m_separations=new a(r.b2_maxManifoldPoints);this.m_points=new b(r.b2_maxManifoldPoints);for(var h=0;h<r.b2_maxManifoldPoints;h++){this.m_points[h]=new s}};ac.prototype.Initialize=function(l){r.b2Assert(l.pointCount>0);var w=0,u=0,z=0,k,y=0,p=0;switch(l.type){case f.e_circles:k=l.bodyA.m_xf.R;z=l.localPoint;w=l.bodyA.m_xf.position.x+(k.col1.x*z.x+k.col2.x*z.y);u=l.bodyA.m_xf.position.y+(k.col1.y*z.x+k.col2.y*z.y);k=l.bodyB.m_xf.R;z=l.points[0].localPoint;y=l.bodyB.m_xf.position.x+(k.col1.x*z.x+k.col2.x*z.y);k=l.bodyB.m_xf.position.y+(k.col1.y*z.x+k.col2.y*z.y);z=y-w;p=k-u;var h=z*z+p*p;if(h>Number.MIN_VALUE*Number.MIN_VALUE){h=Math.sqrt(h);this.m_normal.x=z/h;this.m_normal.y=p/h}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=0.5*(w+y);this.m_points[0].y=0.5*(u+k);this.m_separations[0]=z*this.m_normal.x+p*this.m_normal.y-l.radius;break;case f.e_faceA:k=l.bodyA.m_xf.R;z=l.localPlaneNormal;this.m_normal.x=k.col1.x*z.x+k.col2.x*z.y;this.m_normal.y=k.col1.y*z.x+k.col2.y*z.y;k=l.bodyA.m_xf.R;z=l.localPoint;y=l.bodyA.m_xf.position.x+(k.col1.x*z.x+k.col2.x*z.y);p=l.bodyA.m_xf.position.y+(k.col1.y*z.x+k.col2.y*z.y);k=l.bodyB.m_xf.R;for(w=0;w<l.pointCount;++w){z=l.points[w].localPoint;u=l.bodyB.m_xf.position.x+(k.col1.x*z.x+k.col2.x*z.y);z=l.bodyB.m_xf.position.y+(k.col1.y*z.x+k.col2.y*z.y);this.m_separations[w]=(u-y)*this.m_normal.x+(z-p)*this.m_normal.y-l.radius;this.m_points[w].x=u;this.m_points[w].y=z}break;case f.e_faceB:k=l.bodyB.m_xf.R;z=l.localPlaneNormal;this.m_normal.x=k.col1.x*z.x+k.col2.x*z.y;this.m_normal.y=k.col1.y*z.x+k.col2.y*z.y;k=l.bodyB.m_xf.R;z=l.localPoint;y=l.bodyB.m_xf.position.x+(k.col1.x*z.x+k.col2.x*z.y);p=l.bodyB.m_xf.position.y+(k.col1.y*z.x+k.col2.y*z.y);k=l.bodyA.m_xf.R;for(w=0;w<l.pointCount;++w){z=l.points[w].localPoint;u=l.bodyA.m_xf.position.x+(k.col1.x*z.x+k.col2.x*z.y);z=l.bodyA.m_xf.position.y+(k.col1.y*z.x+k.col2.y*z.y);this.m_separations[w]=(u-y)*this.m_normal.x+(z-p)*this.m_normal.y-l.radius;this.m_points[w].Set(u,z)}this.m_normal.x*=-1;this.m_normal.y*=-1}};e.postDefs.push(function(){e.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new s;e.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new s})})();(function(){var q=e.Common.Math.b2Mat22,o=e.Common.Math.b2Math,m=e.Common.Math.b2Vec2,l=e.Common.b2Color,n=e.Dynamics.Controllers.b2BuoyancyController,h=e.Dynamics.Controllers.b2ConstantAccelController,j=e.Dynamics.Controllers.b2ConstantForceController,g=e.Dynamics.Controllers.b2Controller,f=e.Dynamics.Controllers.b2ControllerEdge,k=e.Dynamics.Controllers.b2GravityController,i=e.Dynamics.Controllers.b2TensorDampingController;e.inherit(n,e.Dynamics.Controllers.b2Controller);n.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype;n.b2BuoyancyController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new m(0,-1);this.density=this.offset=0;this.velocity=new m(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};n.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var v=this.m_bodyList;v;v=v.nextBody){var x=v.body;if(x.IsAwake()!=false){for(var y=new m,s=new m,r=0,t=0,w=x.GetFixtureList();w;w=w.GetNext()){var B=new m,p=w.GetShape().ComputeSubmergedArea(this.normal,this.offset,x.GetTransform(),B);r+=p;y.x+=p*B.x;y.y+=p*B.y;var A=0;A=1;t+=p*A;s.x+=p*B.x*A;s.y+=p*B.y*A}y.x/=r;y.y/=r;s.x/=t;s.y/=t;if(!(r<Number.MIN_VALUE)){t=this.gravity.GetNegative();t.Multiply(this.density*r);x.ApplyForce(t,s);s=x.GetLinearVelocityFromWorldPoint(y);s.Subtract(this.velocity);s.Multiply(-this.linearDrag*r);x.ApplyForce(s,y);x.ApplyTorque(-x.GetInertia()/x.GetMass()*r*x.GetAngularVelocity()*this.angularDrag)}}}}};n.prototype.Draw=function(t){var r=new m,s=new m;r.x=this.normal.x*this.offset+this.normal.y*1000;r.y=this.normal.y*this.offset-this.normal.x*1000;s.x=this.normal.x*this.offset-this.normal.y*1000;s.y=this.normal.y*this.offset+this.normal.x*1000;var p=new l(0,0,1);t.DrawSegment(r,s,p)};e.inherit(h,e.Dynamics.Controllers.b2Controller);h.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype;h.b2ConstantAccelController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new m(0,0)};h.prototype.Step=function(s){s=new m(this.A.x*s.dt,this.A.y*s.dt);for(var p=this.m_bodyList;p;p=p.nextBody){var r=p.body;r.IsAwake()&&r.SetLinearVelocity(new m(r.GetLinearVelocity().x+s.x,r.GetLinearVelocity().y+s.y))}};e.inherit(j,e.Dynamics.Controllers.b2Controller);j.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype;j.b2ConstantForceController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new m(0,0)};j.prototype.Step=function(){for(var r=this.m_bodyList;r;r=r.nextBody){var p=r.body;p.IsAwake()&&p.ApplyForce(this.F,p.GetWorldCenter())}};g.b2Controller=function(){};g.prototype.Step=function(){};g.prototype.Draw=function(){};g.prototype.AddBody=function(r){var p=new f;p.controller=this;p.body=r;p.nextBody=this.m_bodyList;p.prevBody=null;this.m_bodyList=p;if(p.nextBody){p.nextBody.prevBody=p}this.m_bodyCount++;p.nextController=r.m_controllerList;p.prevController=null;r.m_controllerList=p;if(p.nextController){p.nextController.prevController=p}r.m_controllerCount++};g.prototype.RemoveBody=function(r){for(var p=r.m_controllerList;p&&p.controller!=this;){p=p.nextController}if(p.prevBody){p.prevBody.nextBody=p.nextBody}if(p.nextBody){p.nextBody.prevBody=p.prevBody}if(p.nextController){p.nextController.prevController=p.prevController}if(p.prevController){p.prevController.nextController=p.nextController}if(this.m_bodyList==p){this.m_bodyList=p.nextBody}if(r.m_controllerList==p){r.m_controllerList=p.nextController}r.m_controllerCount--;this.m_bodyCount--};g.prototype.Clear=function(){for(;this.m_bodyList;){this.RemoveBody(this.m_bodyList.body)}};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetWorld=function(){return this.m_world};g.prototype.GetBodyList=function(){return this.m_bodyList};f.b2ControllerEdge=function(){};e.inherit(k,e.Dynamics.Controllers.b2Controller);k.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype;k.b2GravityController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};k.prototype.Step=function(){var v=null,x=null,y=null,s=0,r=null,t=null,w=null,B=0,p=0,A=0;B=null;if(this.invSqr){for(v=this.m_bodyList;v;v=v.nextBody){x=v.body;y=x.GetWorldCenter();s=x.GetMass();for(r=this.m_bodyList;r!=v;r=r.nextBody){t=r.body;w=t.GetWorldCenter();B=w.x-y.x;p=w.y-y.y;A=B*B+p*p;if(!(A<Number.MIN_VALUE)){B=new m(B,p);B.Multiply(this.G/A/Math.sqrt(A)*s*t.GetMass());x.IsAwake()&&x.ApplyForce(B,y);B.Multiply(-1);t.IsAwake()&&t.ApplyForce(B,w)}}}}else{for(v=this.m_bodyList;v;v=v.nextBody){x=v.body;y=x.GetWorldCenter();s=x.GetMass();for(r=this.m_bodyList;r!=v;r=r.nextBody){t=r.body;w=t.GetWorldCenter();B=w.x-y.x;p=w.y-y.y;A=B*B+p*p;if(!(A<Number.MIN_VALUE)){B=new m(B,p);B.Multiply(this.G/A*s*t.GetMass());x.IsAwake()&&x.ApplyForce(B,y);B.Multiply(-1);t.IsAwake()&&t.ApplyForce(B,w)}}}}};e.inherit(i,e.Dynamics.Controllers.b2Controller);i.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype;i.b2TensorDampingController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new q;this.maxTimestep=0};i.prototype.SetAxisAligned=function(r,p){if(r===undefined){r=0}if(p===undefined){p=0}this.T.col1.x=-r;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-p;this.maxTimestep=r>0||p>0?1/Math.max(r,p):0};i.prototype.Step=function(t){t=t.dt;if(!(t<=Number.MIN_VALUE)){if(t>this.maxTimestep&&this.maxTimestep>0){t=this.maxTimestep}for(var r=this.m_bodyList;r;r=r.nextBody){var s=r.body;if(s.IsAwake()){var p=s.GetWorldVector(o.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity())));s.SetLinearVelocity(new m(s.GetLinearVelocity().x+p.x*t,s.GetLinearVelocity().y+p.y*t))}}}}})();(function(){var ab=e.Common.b2Settings,T=e.Common.Math.b2Mat22,v=e.Common.Math.b2Mat33,x=e.Common.Math.b2Math,P=e.Common.Math.b2Vec2,af=e.Common.Math.b2Vec3,j=e.Dynamics.Joints.b2DistanceJoint,ag=e.Dynamics.Joints.b2DistanceJointDef,ae=e.Dynamics.Joints.b2FrictionJoint,n=e.Dynamics.Joints.b2FrictionJointDef,i=e.Dynamics.Joints.b2GearJoint,r=e.Dynamics.Joints.b2GearJointDef,s=e.Dynamics.Joints.b2Jacobian,C=e.Dynamics.Joints.b2Joint,h=e.Dynamics.Joints.b2JointDef,g=e.Dynamics.Joints.b2JointEdge,ah=e.Dynamics.Joints.b2LineJoint,t=e.Dynamics.Joints.b2LineJointDef,X=e.Dynamics.Joints.b2MouseJoint,ad=e.Dynamics.Joints.b2MouseJointDef,J=e.Dynamics.Joints.b2PrismaticJoint,o=e.Dynamics.Joints.b2PrismaticJointDef,ac=e.Dynamics.Joints.b2PulleyJoint,m=e.Dynamics.Joints.b2PulleyJointDef,q=e.Dynamics.Joints.b2RevoluteJoint,l=e.Dynamics.Joints.b2RevoluteJointDef,ai=e.Dynamics.Joints.b2WeldJoint,f=e.Dynamics.Joints.b2WeldJointDef;e.inherit(j,e.Dynamics.Joints.b2Joint);j.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;j.b2DistanceJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new P;this.m_localAnchor2=new P;this.m_u=new P};j.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};j.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};j.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_impulse*this.m_u.x,k*this.m_impulse*this.m_u.y)};j.prototype.GetReactionTorque=function(){return 0};j.prototype.GetLength=function(){return this.m_length};j.prototype.SetLength=function(k){if(k===undefined){k=0}this.m_length=k};j.prototype.GetFrequency=function(){return this.m_frequencyHz};j.prototype.SetFrequency=function(k){if(k===undefined){k=0}this.m_frequencyHz=k};j.prototype.GetDampingRatio=function(){return this.m_dampingRatio};j.prototype.SetDampingRatio=function(k){if(k===undefined){k=0}this.m_dampingRatio=k};j.prototype.b2DistanceJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_length=k.length;this.m_frequencyHz=k.frequencyHz;this.m_dampingRatio=k.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};j.prototype.InitVelocityConstraints=function(B){var z,w=0,y=this.m_bodyA,p=this.m_bodyB;z=y.m_xf.R;var k=this.m_localAnchor1.x-y.m_sweep.localCenter.x,u=this.m_localAnchor1.y-y.m_sweep.localCenter.y;w=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;k=w;z=p.m_xf.R;var F=this.m_localAnchor2.x-p.m_sweep.localCenter.x,D=this.m_localAnchor2.y-p.m_sweep.localCenter.y;w=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=w;this.m_u.x=p.m_sweep.c.x+F-y.m_sweep.c.x-k;this.m_u.y=p.m_sweep.c.y+D-y.m_sweep.c.y-u;w=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);w>ab.b2_linearSlop?this.m_u.Multiply(1/w):this.m_u.SetZero();z=k*this.m_u.y-u*this.m_u.x;var A=F*this.m_u.y-D*this.m_u.x;z=y.m_invMass+y.m_invI*z*z+p.m_invMass+p.m_invI*A*A;this.m_mass=z!=0?1/z:0;if(this.m_frequencyHz>0){w=w-this.m_length;A=2*Math.PI*this.m_frequencyHz;var E=this.m_mass*A*A;this.m_gamma=B.dt*(2*this.m_mass*this.m_dampingRatio*A+B.dt*E);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=w*B.dt*E*this.m_gamma;this.m_mass=z+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(B.warmStarting){this.m_impulse*=B.dtRatio;B=this.m_impulse*this.m_u.x;z=this.m_impulse*this.m_u.y;y.m_linearVelocity.x-=y.m_invMass*B;y.m_linearVelocity.y-=y.m_invMass*z;y.m_angularVelocity-=y.m_invI*(k*z-u*B);p.m_linearVelocity.x+=p.m_invMass*B;p.m_linearVelocity.y+=p.m_invMass*z;p.m_angularVelocity+=p.m_invI*(F*z-D*B)}else{this.m_impulse=0}};j.prototype.SolveVelocityConstraints=function(){var A,w=this.m_bodyA,p=this.m_bodyB;A=w.m_xf.R;var u=this.m_localAnchor1.x-w.m_sweep.localCenter.x,z=this.m_localAnchor1.y-w.m_sweep.localCenter.y,y=A.col1.x*u+A.col2.x*z;z=A.col1.y*u+A.col2.y*z;u=y;A=p.m_xf.R;var B=this.m_localAnchor2.x-p.m_sweep.localCenter.x,k=this.m_localAnchor2.y-p.m_sweep.localCenter.y;y=A.col1.x*B+A.col2.x*k;k=A.col1.y*B+A.col2.y*k;B=y;y=-this.m_mass*(this.m_u.x*(p.m_linearVelocity.x+-p.m_angularVelocity*k-(w.m_linearVelocity.x+-w.m_angularVelocity*z))+this.m_u.y*(p.m_linearVelocity.y+p.m_angularVelocity*B-(w.m_linearVelocity.y+w.m_angularVelocity*u))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=y;A=y*this.m_u.x;y=y*this.m_u.y;w.m_linearVelocity.x-=w.m_invMass*A;w.m_linearVelocity.y-=w.m_invMass*y;w.m_angularVelocity-=w.m_invI*(u*y-z*A);p.m_linearVelocity.x+=p.m_invMass*A;p.m_linearVelocity.y+=p.m_invMass*y;p.m_angularVelocity+=p.m_invI*(B*y-k*A)};j.prototype.SolvePositionConstraints=function(){var B;if(this.m_frequencyHz>0){return true}var z=this.m_bodyA,w=this.m_bodyB;B=z.m_xf.R;var y=this.m_localAnchor1.x-z.m_sweep.localCenter.x,p=this.m_localAnchor1.y-z.m_sweep.localCenter.y,k=B.col1.x*y+B.col2.x*p;p=B.col1.y*y+B.col2.y*p;y=k;B=w.m_xf.R;var u=this.m_localAnchor2.x-w.m_sweep.localCenter.x,E=this.m_localAnchor2.y-w.m_sweep.localCenter.y;k=B.col1.x*u+B.col2.x*E;E=B.col1.y*u+B.col2.y*E;u=k;k=w.m_sweep.c.x+u-z.m_sweep.c.x-y;var D=w.m_sweep.c.y+E-z.m_sweep.c.y-p;B=Math.sqrt(k*k+D*D);k/=B;D/=B;B=B-this.m_length;B=x.Clamp(B,-ab.b2_maxLinearCorrection,ab.b2_maxLinearCorrection);var A=-this.m_mass*B;this.m_u.Set(k,D);k=A*this.m_u.x;D=A*this.m_u.y;z.m_sweep.c.x-=z.m_invMass*k;z.m_sweep.c.y-=z.m_invMass*D;z.m_sweep.a-=z.m_invI*(y*D-p*k);w.m_sweep.c.x+=w.m_invMass*k;w.m_sweep.c.y+=w.m_invMass*D;w.m_sweep.a+=w.m_invI*(u*D-E*k);z.SynchronizeTransform();w.SynchronizeTransform();return x.Abs(B)<ab.b2_linearSlop};e.inherit(ag,e.Dynamics.Joints.b2JointDef);ag.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;ag.b2DistanceJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new P;this.localAnchorB=new P};ag.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};ag.prototype.Initialize=function(w,u,k,p){this.bodyA=w;this.bodyB=u;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(p));w=p.x-k.x;k=p.y-k.y;this.length=Math.sqrt(w*w+k*k);this.dampingRatio=this.frequencyHz=0};e.inherit(ae,e.Dynamics.Joints.b2Joint);ae.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;ae.b2FrictionJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new P;this.m_localAnchorB=new P;this.m_linearMass=new T;this.m_linearImpulse=new P};ae.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};ae.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};ae.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_linearImpulse.x,k*this.m_linearImpulse.y)};ae.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_angularImpulse};ae.prototype.SetMaxForce=function(k){if(k===undefined){k=0}this.m_maxForce=k};ae.prototype.GetMaxForce=function(){return this.m_maxForce};ae.prototype.SetMaxTorque=function(k){if(k===undefined){k=0}this.m_maxTorque=k};ae.prototype.GetMaxTorque=function(){return this.m_maxTorque};ae.prototype.b2FrictionJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchorA.SetV(k.localAnchorA);this.m_localAnchorB.SetV(k.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=k.maxForce;this.m_maxTorque=k.maxTorque};ae.prototype.InitVelocityConstraints=function(D){var z,w=0,y=this.m_bodyA,p=this.m_bodyB;z=y.m_xf.R;var k=this.m_localAnchorA.x-y.m_sweep.localCenter.x,u=this.m_localAnchorA.y-y.m_sweep.localCenter.y;w=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;k=w;z=p.m_xf.R;var G=this.m_localAnchorB.x-p.m_sweep.localCenter.x,E=this.m_localAnchorB.y-p.m_sweep.localCenter.y;w=z.col1.x*G+z.col2.x*E;E=z.col1.y*G+z.col2.y*E;G=w;z=y.m_invMass;w=p.m_invMass;var A=y.m_invI,F=p.m_invI,B=new T;B.col1.x=z+w;B.col2.x=0;B.col1.y=0;B.col2.y=z+w;B.col1.x+=A*u*u;B.col2.x+=-A*k*u;B.col1.y+=-A*k*u;B.col2.y+=A*k*k;B.col1.x+=F*E*E;B.col2.x+=-F*G*E;B.col1.y+=-F*G*E;B.col2.y+=F*G*G;B.GetInverse(this.m_linearMass);this.m_angularMass=A+F;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(D.warmStarting){this.m_linearImpulse.x*=D.dtRatio;this.m_linearImpulse.y*=D.dtRatio;this.m_angularImpulse*=D.dtRatio;D=this.m_linearImpulse;y.m_linearVelocity.x-=z*D.x;y.m_linearVelocity.y-=z*D.y;y.m_angularVelocity-=A*(k*D.y-u*D.x+this.m_angularImpulse);p.m_linearVelocity.x+=w*D.x;p.m_linearVelocity.y+=w*D.y;p.m_angularVelocity+=F*(G*D.y-E*D.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};ae.prototype.SolveVelocityConstraints=function(K){var F,D=0,E=this.m_bodyA,z=this.m_bodyB,y=E.m_linearVelocity,A=E.m_angularVelocity,N=z.m_linearVelocity,L=z.m_angularVelocity,G=E.m_invMass,M=z.m_invMass,I=E.m_invI,H=z.m_invI;F=E.m_xf.R;var B=this.m_localAnchorA.x-E.m_sweep.localCenter.x,w=this.m_localAnchorA.y-E.m_sweep.localCenter.y;D=F.col1.x*B+F.col2.x*w;w=F.col1.y*B+F.col2.y*w;B=D;F=z.m_xf.R;var u=this.m_localAnchorB.x-z.m_sweep.localCenter.x,k=this.m_localAnchorB.y-z.m_sweep.localCenter.y;D=F.col1.x*u+F.col2.x*k;k=F.col1.y*u+F.col2.y*k;u=D;F=0;D=-this.m_angularMass*(L-A);var p=this.m_angularImpulse;F=K.dt*this.m_maxTorque;this.m_angularImpulse=x.Clamp(this.m_angularImpulse+D,-F,F);D=this.m_angularImpulse-p;A-=I*D;L+=H*D;F=x.MulMV(this.m_linearMass,new P(-(N.x-L*k-y.x+A*w),-(N.y+L*u-y.y-A*B)));D=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(F);F=K.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>F*F){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(F)}F=x.SubtractVV(this.m_linearImpulse,D);y.x-=G*F.x;y.y-=G*F.y;A-=I*(B*F.y-w*F.x);N.x+=M*F.x;N.y+=M*F.y;L+=H*(u*F.y-k*F.x);E.m_angularVelocity=A;z.m_angularVelocity=L};ae.prototype.SolvePositionConstraints=function(){return true};e.inherit(n,e.Dynamics.Joints.b2JointDef);n.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;n.b2FrictionJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new P;this.localAnchorB=new P};n.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_frictionJoint;this.maxTorque=this.maxForce=0};n.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(k))};e.inherit(i,e.Dynamics.Joints.b2Joint);i.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;i.b2GearJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new P;this.m_groundAnchor2=new P;this.m_localAnchor1=new P;this.m_localAnchor2=new P;this.m_J=new s};i.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};i.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};i.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_impulse*this.m_J.linearB.x,k*this.m_impulse*this.m_J.linearB.y)};i.prototype.GetReactionTorque=function(y){if(y===undefined){y=0}var u=this.m_bodyB.m_xf.R,k=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,p=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,w=u.col1.x*k+u.col2.x*p;p=u.col1.y*k+u.col2.y*p;k=w;return y*(this.m_impulse*this.m_J.angularB-k*this.m_impulse*this.m_J.linearB.y+p*this.m_impulse*this.m_J.linearB.x)};i.prototype.GetRatio=function(){return this.m_ratio};i.prototype.SetRatio=function(k){if(k===undefined){k=0}this.m_ratio=k};i.prototype.b2GearJoint=function(y){this.__super.b2Joint.call(this,y);var u=parseInt(y.joint1.m_type),k=parseInt(y.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var p=0,w=0;this.m_ground1=y.joint1.GetBodyA();this.m_bodyA=y.joint1.GetBodyB();if(u==C.e_revoluteJoint){this.m_revolute1=y.joint1 instanceof q?y.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);p=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=y.joint1 instanceof J?y.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);p=this.m_prismatic1.GetJointTranslation()}this.m_ground2=y.joint2.GetBodyA();this.m_bodyB=y.joint2.GetBodyB();if(k==C.e_revoluteJoint){this.m_revolute2=y.joint2 instanceof q?y.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);w=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=y.joint2 instanceof J?y.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);w=this.m_prismatic2.GetJointTranslation()}this.m_ratio=y.ratio;this.m_constant=p+this.m_ratio*w;this.m_impulse=0};i.prototype.InitVelocityConstraints=function(B){var z=this.m_ground1,w=this.m_ground2,y=this.m_bodyA,p=this.m_bodyB,k=0,u=0,F=0,D=0,A=F=0,E=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;E+=y.m_invI}else{z=z.m_xf.R;u=this.m_prismatic1.m_localXAxis1;k=z.col1.x*u.x+z.col2.x*u.y;u=z.col1.y*u.x+z.col2.y*u.y;z=y.m_xf.R;F=this.m_localAnchor1.x-y.m_sweep.localCenter.x;D=this.m_localAnchor1.y-y.m_sweep.localCenter.y;A=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=A;F=F*u-D*k;this.m_J.linearA.Set(-k,-u);this.m_J.angularA=-F;E+=y.m_invMass+y.m_invI*F*F}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;E+=this.m_ratio*this.m_ratio*p.m_invI}else{z=w.m_xf.R;u=this.m_prismatic2.m_localXAxis1;k=z.col1.x*u.x+z.col2.x*u.y;u=z.col1.y*u.x+z.col2.y*u.y;z=p.m_xf.R;F=this.m_localAnchor2.x-p.m_sweep.localCenter.x;D=this.m_localAnchor2.y-p.m_sweep.localCenter.y;A=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=A;F=F*u-D*k;this.m_J.linearB.Set(-this.m_ratio*k,-this.m_ratio*u);this.m_J.angularB=-this.m_ratio*F;E+=this.m_ratio*this.m_ratio*(p.m_invMass+p.m_invI*F*F)}this.m_mass=E>0?1/E:0;if(B.warmStarting){y.m_linearVelocity.x+=y.m_invMass*this.m_impulse*this.m_J.linearA.x;y.m_linearVelocity.y+=y.m_invMass*this.m_impulse*this.m_J.linearA.y;y.m_angularVelocity+=y.m_invI*this.m_impulse*this.m_J.angularA;p.m_linearVelocity.x+=p.m_invMass*this.m_impulse*this.m_J.linearB.x;p.m_linearVelocity.y+=p.m_invMass*this.m_impulse*this.m_J.linearB.y;p.m_angularVelocity+=p.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};i.prototype.SolveVelocityConstraints=function(){var u=this.m_bodyA,p=this.m_bodyB,k=-this.m_mass*this.m_J.Compute(u.m_linearVelocity,u.m_angularVelocity,p.m_linearVelocity,p.m_angularVelocity);this.m_impulse+=k;u.m_linearVelocity.x+=u.m_invMass*k*this.m_J.linearA.x;u.m_linearVelocity.y+=u.m_invMass*k*this.m_J.linearA.y;u.m_angularVelocity+=u.m_invI*k*this.m_J.angularA;p.m_linearVelocity.x+=p.m_invMass*k*this.m_J.linearB.x;p.m_linearVelocity.y+=p.m_invMass*k*this.m_J.linearB.y;p.m_angularVelocity+=p.m_invI*k*this.m_J.angularB};i.prototype.SolvePositionConstraints=function(){var w=this.m_bodyA,u=this.m_bodyB,k=0,p=0;k=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();p=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();k=-this.m_mass*(this.m_constant-(k+this.m_ratio*p));w.m_sweep.c.x+=w.m_invMass*k*this.m_J.linearA.x;w.m_sweep.c.y+=w.m_invMass*k*this.m_J.linearA.y;w.m_sweep.a+=w.m_invI*k*this.m_J.angularA;u.m_sweep.c.x+=u.m_invMass*k*this.m_J.linearB.x;u.m_sweep.c.y+=u.m_invMass*k*this.m_J.linearB.y;u.m_sweep.a+=u.m_invI*k*this.m_J.angularB;w.SynchronizeTransform();u.SynchronizeTransform();return 0<ab.b2_linearSlop};e.inherit(r,e.Dynamics.Joints.b2JointDef);r.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;r.b2GearJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};r.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};s.b2Jacobian=function(){this.linearA=new P;this.linearB=new P};s.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};s.prototype.Set=function(w,u,k,p){if(u===undefined){u=0}if(p===undefined){p=0}this.linearA.SetV(w);this.angularA=u;this.linearB.SetV(k);this.angularB=p};s.prototype.Compute=function(w,u,k,p){if(u===undefined){u=0}if(p===undefined){p=0}return this.linearA.x*w.x+this.linearA.y*w.y+this.angularA*u+(this.linearB.x*k.x+this.linearB.y*k.y)+this.angularB*p};C.b2Joint=function(){this.m_edgeA=new g;this.m_edgeB=new g;this.m_localCenterA=new P;this.m_localCenterB=new P};C.prototype.GetType=function(){return this.m_type};C.prototype.GetAnchorA=function(){return null};C.prototype.GetAnchorB=function(){return null};C.prototype.GetReactionForce=function(){return null};C.prototype.GetReactionTorque=function(){return 0};C.prototype.GetBodyA=function(){return this.m_bodyA};C.prototype.GetBodyB=function(){return this.m_bodyB};C.prototype.GetNext=function(){return this.m_next};C.prototype.GetUserData=function(){return this.m_userData};C.prototype.SetUserData=function(k){this.m_userData=k};C.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};C.Create=function(p){var k=null;switch(p.type){case C.e_distanceJoint:k=new j(p instanceof ag?p:null);break;case C.e_mouseJoint:k=new X(p instanceof ad?p:null);break;case C.e_prismaticJoint:k=new J(p instanceof o?p:null);break;case C.e_revoluteJoint:k=new q(p instanceof l?p:null);break;case C.e_pulleyJoint:k=new ac(p instanceof m?p:null);break;case C.e_gearJoint:k=new i(p instanceof r?p:null);break;case C.e_lineJoint:k=new ah(p instanceof t?p:null);break;case C.e_weldJoint:k=new ai(p instanceof f?p:null);break;case C.e_frictionJoint:k=new ae(p instanceof n?p:null)}return k};C.Destroy=function(){};C.prototype.b2Joint=function(k){ab.b2Assert(k.bodyA!=k.bodyB);this.m_type=k.type;this.m_next=this.m_prev=null;this.m_bodyA=k.bodyA;this.m_bodyB=k.bodyB;this.m_collideConnected=k.collideConnected;this.m_islandFlag=false;this.m_userData=k.userData};C.prototype.InitVelocityConstraints=function(){};C.prototype.SolveVelocityConstraints=function(){};C.prototype.FinalizeVelocityConstraints=function(){};C.prototype.SolvePositionConstraints=function(){return false};e.postDefs.push(function(){e.Dynamics.Joints.b2Joint.e_unknownJoint=0;e.Dynamics.Joints.b2Joint.e_revoluteJoint=1;e.Dynamics.Joints.b2Joint.e_prismaticJoint=2;e.Dynamics.Joints.b2Joint.e_distanceJoint=3;e.Dynamics.Joints.b2Joint.e_pulleyJoint=4;e.Dynamics.Joints.b2Joint.e_mouseJoint=5;e.Dynamics.Joints.b2Joint.e_gearJoint=6;e.Dynamics.Joints.b2Joint.e_lineJoint=7;e.Dynamics.Joints.b2Joint.e_weldJoint=8;e.Dynamics.Joints.b2Joint.e_frictionJoint=9;e.Dynamics.Joints.b2Joint.e_inactiveLimit=0;e.Dynamics.Joints.b2Joint.e_atLowerLimit=1;e.Dynamics.Joints.b2Joint.e_atUpperLimit=2;e.Dynamics.Joints.b2Joint.e_equalLimits=3});h.b2JointDef=function(){};h.prototype.b2JointDef=function(){this.type=C.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=false};g.b2JointEdge=function(){};e.inherit(ah,e.Dynamics.Joints.b2Joint);ah.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;ah.b2LineJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new P;this.m_localAnchor2=new P;this.m_localXAxis1=new P;this.m_localYAxis1=new P;this.m_axis=new P;this.m_perp=new P;this.m_K=new T;this.m_impulse=new P};ah.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};ah.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};ah.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),k*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};ah.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.y};ah.prototype.GetJointTranslation=function(){var w=this.m_bodyA,u=this.m_bodyB,k=w.GetWorldPoint(this.m_localAnchor1),p=u.GetWorldPoint(this.m_localAnchor2);u=p.x-k.x;k=p.y-k.y;w=w.GetWorldVector(this.m_localXAxis1);return w.x*u+w.y*k};ah.prototype.GetJointSpeed=function(){var B=this.m_bodyA,z=this.m_bodyB,w;w=B.m_xf.R;var y=this.m_localAnchor1.x-B.m_sweep.localCenter.x,p=this.m_localAnchor1.y-B.m_sweep.localCenter.y,k=w.col1.x*y+w.col2.x*p;p=w.col1.y*y+w.col2.y*p;y=k;w=z.m_xf.R;var u=this.m_localAnchor2.x-z.m_sweep.localCenter.x,F=this.m_localAnchor2.y-z.m_sweep.localCenter.y;k=w.col1.x*u+w.col2.x*F;F=w.col1.y*u+w.col2.y*F;u=k;w=z.m_sweep.c.x+u-(B.m_sweep.c.x+y);k=z.m_sweep.c.y+F-(B.m_sweep.c.y+p);var D=B.GetWorldVector(this.m_localXAxis1),A=B.m_linearVelocity,E=z.m_linearVelocity;B=B.m_angularVelocity;z=z.m_angularVelocity;return w*-B*D.y+k*B*D.x+(D.x*(E.x+-z*F-A.x- -B*p)+D.y*(E.y+z*u-A.y-B*y))};ah.prototype.IsLimitEnabled=function(){return this.m_enableLimit};ah.prototype.EnableLimit=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=k};ah.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};ah.prototype.GetUpperLimit=function(){return this.m_upperTranslation};ah.prototype.SetLimits=function(p,k){if(p===undefined){p=0}if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=p;this.m_upperTranslation=k};ah.prototype.IsMotorEnabled=function(){return this.m_enableMotor};ah.prototype.EnableMotor=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=k};ah.prototype.SetMotorSpeed=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k};ah.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};ah.prototype.SetMaxMotorForce=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=k};ah.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};ah.prototype.GetMotorForce=function(){return this.m_motorImpulse};ah.prototype.b2LineJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_localXAxis1.SetV(k.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=k.lowerTranslation;this.m_upperTranslation=k.upperTranslation;this.m_maxMotorForce=k.maxMotorForce;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=C.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};ah.prototype.InitVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y,p=0;this.m_localCenterA.SetV(z.GetLocalCenter());this.m_localCenterB.SetV(w.GetLocalCenter());var k=z.GetTransform();w.GetTransform();y=z.m_xf.R;var u=this.m_localAnchor1.x-this.m_localCenterA.x,E=this.m_localAnchor1.y-this.m_localCenterA.y;p=y.col1.x*u+y.col2.x*E;E=y.col1.y*u+y.col2.y*E;u=p;y=w.m_xf.R;var D=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;p=y.col1.x*D+y.col2.x*A;A=y.col1.y*D+y.col2.y*A;D=p;y=w.m_sweep.c.x+D-z.m_sweep.c.x-u;p=w.m_sweep.c.y+A-z.m_sweep.c.y-E;this.m_invMassA=z.m_invMass;this.m_invMassB=w.m_invMass;this.m_invIA=z.m_invI;this.m_invIB=w.m_invI;this.m_axis.SetV(x.MulMV(k.R,this.m_localXAxis1));this.m_a1=(y+u)*this.m_axis.y-(p+E)*this.m_axis.x;this.m_a2=D*this.m_axis.y-A*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(x.MulMV(k.R,this.m_localYAxis1));this.m_s1=(y+u)*this.m_perp.y-(p+E)*this.m_perp.x;this.m_s2=D*this.m_perp.y-A*this.m_perp.x;k=this.m_invMassA;u=this.m_invMassB;E=this.m_invIA;D=this.m_invIB;this.m_K.col1.x=k+u+E*this.m_s1*this.m_s1+D*this.m_s2*this.m_s2;this.m_K.col1.y=E*this.m_s1*this.m_a1+D*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=k+u+E*this.m_a1*this.m_a1+D*this.m_a2*this.m_a2;if(this.m_enableLimit){y=this.m_axis.x*y+this.m_axis.y*p;if(x.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*ab.b2_linearSlop){this.m_limitState=C.e_equalLimits}else{if(y<=this.m_lowerTranslation){if(this.m_limitState!=C.e_atLowerLimit){this.m_limitState=C.e_atLowerLimit;this.m_impulse.y=0}}else{if(y>=this.m_upperTranslation){if(this.m_limitState!=C.e_atUpperLimit){this.m_limitState=C.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=C.e_inactiveLimit;this.m_impulse.y=0}}}}else{this.m_limitState=C.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(B.warmStarting){this.m_impulse.x*=B.dtRatio;this.m_impulse.y*=B.dtRatio;this.m_motorImpulse*=B.dtRatio;B=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;y=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;p=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;k=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;z.m_linearVelocity.x-=this.m_invMassA*B;z.m_linearVelocity.y-=this.m_invMassA*y;z.m_angularVelocity-=this.m_invIA*p;w.m_linearVelocity.x+=this.m_invMassB*B;w.m_linearVelocity.y+=this.m_invMassB*y;w.m_angularVelocity+=this.m_invIB*k}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};ah.prototype.SolveVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y=z.m_linearVelocity,p=z.m_angularVelocity,k=w.m_linearVelocity,u=w.m_angularVelocity,F=0,D=0,A=0,E=0;if(this.m_enableMotor&&this.m_limitState!=C.e_equalLimits){E=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p));F=this.m_motorImpulse;D=B.dt*this.m_maxMotorForce;this.m_motorImpulse=x.Clamp(this.m_motorImpulse+E,-D,D);E=this.m_motorImpulse-F;F=E*this.m_axis.x;D=E*this.m_axis.y;A=E*this.m_a1;E=E*this.m_a2;y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E}D=this.m_perp.x*(k.x-y.x)+this.m_perp.y*(k.y-y.y)+this.m_s2*u-this.m_s1*p;if(this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit){A=this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p;F=this.m_impulse.Copy();B=this.m_K.Solve(new P,-D,-A);this.m_impulse.Add(B);if(this.m_limitState==C.e_atLowerLimit){this.m_impulse.y=x.Max(this.m_impulse.y,0)}else{if(this.m_limitState==C.e_atUpperLimit){this.m_impulse.y=x.Min(this.m_impulse.y,0)}}D=-D-(this.m_impulse.y-F.y)*this.m_K.col2.x;A=0;A=this.m_K.col1.x!=0?D/this.m_K.col1.x+F.x:F.x;this.m_impulse.x=A;B.x=this.m_impulse.x-F.x;B.y=this.m_impulse.y-F.y;F=B.x*this.m_perp.x+B.y*this.m_axis.x;D=B.x*this.m_perp.y+B.y*this.m_axis.y;A=B.x*this.m_s1+B.y*this.m_a1;E=B.x*this.m_s2+B.y*this.m_a2}else{B=0;B=this.m_K.col1.x!=0?-D/this.m_K.col1.x:0;this.m_impulse.x+=B;F=B*this.m_perp.x;D=B*this.m_perp.y;A=B*this.m_s1;E=B*this.m_s2}y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E;z.m_linearVelocity.SetV(y);z.m_angularVelocity=p;w.m_linearVelocity.SetV(k);w.m_angularVelocity=u};ah.prototype.SolvePositionConstraints=function(){var G=this.m_bodyA,B=this.m_bodyB,z=G.m_sweep.c,A=G.m_sweep.a,u=B.m_sweep.c,p=B.m_sweep.a,w,K=0,H=0,D=0,I=0,F=w=0,E=0;H=false;var y=0,k=T.FromAngle(A);D=T.FromAngle(p);w=k;E=this.m_localAnchor1.x-this.m_localCenterA.x;var M=this.m_localAnchor1.y-this.m_localCenterA.y;K=w.col1.x*E+w.col2.x*M;M=w.col1.y*E+w.col2.y*M;E=K;w=D;D=this.m_localAnchor2.x-this.m_localCenterB.x;I=this.m_localAnchor2.y-this.m_localCenterB.y;K=w.col1.x*D+w.col2.x*I;I=w.col1.y*D+w.col2.y*I;D=K;w=u.x+D-z.x-E;K=u.y+I-z.y-M;if(this.m_enableLimit){this.m_axis=x.MulMV(k,this.m_localXAxis1);this.m_a1=(w+E)*this.m_axis.y-(K+M)*this.m_axis.x;this.m_a2=D*this.m_axis.y-I*this.m_axis.x;var L=this.m_axis.x*w+this.m_axis.y*K;if(x.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*ab.b2_linearSlop){y=x.Clamp(L,-ab.b2_maxLinearCorrection,ab.b2_maxLinearCorrection);F=x.Abs(L);H=true}else{if(L<=this.m_lowerTranslation){y=x.Clamp(L-this.m_lowerTranslation+ab.b2_linearSlop,-ab.b2_maxLinearCorrection,0);F=this.m_lowerTranslation-L;H=true}else{if(L>=this.m_upperTranslation){y=x.Clamp(L-this.m_upperTranslation+ab.b2_linearSlop,0,ab.b2_maxLinearCorrection);F=L-this.m_upperTranslation;H=true}}}}this.m_perp=x.MulMV(k,this.m_localYAxis1);this.m_s1=(w+E)*this.m_perp.y-(K+M)*this.m_perp.x;this.m_s2=D*this.m_perp.y-I*this.m_perp.x;k=new P;M=this.m_perp.x*w+this.m_perp.y*K;F=x.Max(F,x.Abs(M));E=0;if(H){H=this.m_invMassA;D=this.m_invMassB;I=this.m_invIA;w=this.m_invIB;this.m_K.col1.x=H+D+I*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2;this.m_K.col1.y=I*this.m_s1*this.m_a1+w*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=H+D+I*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2;this.m_K.Solve(k,-M,-y)}else{H=this.m_invMassA;D=this.m_invMassB;I=this.m_invIA;w=this.m_invIB;y=H+D+I*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2;H=0;H=y!=0?-M/y:0;k.x=H;k.y=0}y=k.x*this.m_perp.x+k.y*this.m_axis.x;H=k.x*this.m_perp.y+k.y*this.m_axis.y;M=k.x*this.m_s1+k.y*this.m_a1;k=k.x*this.m_s2+k.y*this.m_a2;z.x-=this.m_invMassA*y;z.y-=this.m_invMassA*H;A-=this.m_invIA*M;u.x+=this.m_invMassB*y;u.y+=this.m_invMassB*H;p+=this.m_invIB*k;G.m_sweep.a=A;B.m_sweep.a=p;G.SynchronizeTransform();B.SynchronizeTransform();return F<=ab.b2_linearSlop&&E<=ab.b2_angularSlop};e.inherit(t,e.Dynamics.Joints.b2JointDef);t.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;t.b2LineJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new P;this.localAnchorB=new P;this.localAxisA=new P};t.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};t.prototype.Initialize=function(w,u,k,p){this.bodyA=w;this.bodyB=u;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.localAxisA=this.bodyA.GetLocalVector(p)};e.inherit(X,e.Dynamics.Joints.b2Joint);X.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;X.b2MouseJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new T;this.K1=new T;this.K2=new T;this.m_localAnchor=new P;this.m_target=new P;this.m_impulse=new P;this.m_mass=new T;this.m_C=new P};X.prototype.GetAnchorA=function(){return this.m_target};X.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};X.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_impulse.x,k*this.m_impulse.y)};X.prototype.GetReactionTorque=function(){return 0};X.prototype.GetTarget=function(){return this.m_target};X.prototype.SetTarget=function(k){this.m_bodyB.IsAwake()==false&&this.m_bodyB.SetAwake(true);this.m_target=k};X.prototype.GetMaxForce=function(){return this.m_maxForce};X.prototype.SetMaxForce=function(k){if(k===undefined){k=0}this.m_maxForce=k};X.prototype.GetFrequency=function(){return this.m_frequencyHz};X.prototype.SetFrequency=function(k){if(k===undefined){k=0}this.m_frequencyHz=k};X.prototype.GetDampingRatio=function(){return this.m_dampingRatio};X.prototype.SetDampingRatio=function(k){if(k===undefined){k=0}this.m_dampingRatio=k};X.prototype.b2MouseJoint=function(w){this.__super.b2Joint.call(this,w);this.m_target.SetV(w.target);var u=this.m_target.x-this.m_bodyB.m_xf.position.x,k=this.m_target.y-this.m_bodyB.m_xf.position.y,p=this.m_bodyB.m_xf.R;this.m_localAnchor.x=u*p.col1.x+k*p.col1.y;this.m_localAnchor.y=u*p.col2.x+k*p.col2.y;this.m_maxForce=w.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=w.frequencyHz;this.m_dampingRatio=w.dampingRatio;this.m_gamma=this.m_beta=0};X.prototype.InitVelocityConstraints=function(z){var u=this.m_bodyB,k=u.GetMass(),p=2*Math.PI*this.m_frequencyHz,y=k*p*p;this.m_gamma=z.dt*(2*k*this.m_dampingRatio*p+z.dt*y);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=z.dt*y*this.m_gamma;y=u.m_xf.R;k=this.m_localAnchor.x-u.m_sweep.localCenter.x;p=this.m_localAnchor.y-u.m_sweep.localCenter.y;var w=y.col1.x*k+y.col2.x*p;p=y.col1.y*k+y.col2.y*p;k=w;y=u.m_invMass;w=u.m_invI;this.K1.col1.x=y;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=y;this.K2.col1.x=w*p*p;this.K2.col2.x=-w*k*p;this.K2.col1.y=-w*k*p;this.K2.col2.y=w*k*k;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=u.m_sweep.c.x+k-this.m_target.x;this.m_C.y=u.m_sweep.c.y+p-this.m_target.y;u.m_angularVelocity*=0.98;this.m_impulse.x*=z.dtRatio;this.m_impulse.y*=z.dtRatio;u.m_linearVelocity.x+=y*this.m_impulse.x;u.m_linearVelocity.y+=y*this.m_impulse.y;u.m_angularVelocity+=w*(k*this.m_impulse.y-p*this.m_impulse.x)};X.prototype.SolveVelocityConstraints=function(A){var w=this.m_bodyB,p,u=0,z=0;p=w.m_xf.R;var y=this.m_localAnchor.x-w.m_sweep.localCenter.x,B=this.m_localAnchor.y-w.m_sweep.localCenter.y;u=p.col1.x*y+p.col2.x*B;B=p.col1.y*y+p.col2.y*B;y=u;u=w.m_linearVelocity.x+-w.m_angularVelocity*B;var k=w.m_linearVelocity.y+w.m_angularVelocity*y;p=this.m_mass;u=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;z=k+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;k=-(p.col1.x*u+p.col2.x*z);z=-(p.col1.y*u+p.col2.y*z);p=this.m_impulse.x;u=this.m_impulse.y;this.m_impulse.x+=k;this.m_impulse.y+=z;A=A.dt*this.m_maxForce;this.m_impulse.LengthSquared()>A*A&&this.m_impulse.Multiply(A/this.m_impulse.Length());k=this.m_impulse.x-p;z=this.m_impulse.y-u;w.m_linearVelocity.x+=w.m_invMass*k;w.m_linearVelocity.y+=w.m_invMass*z;w.m_angularVelocity+=w.m_invI*(y*z-B*k)};X.prototype.SolvePositionConstraints=function(){return true};e.inherit(ad,e.Dynamics.Joints.b2JointDef);ad.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;ad.b2MouseJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new P};ad.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};e.inherit(J,e.Dynamics.Joints.b2Joint);J.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;J.b2PrismaticJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new P;this.m_localAnchor2=new P;this.m_localXAxis1=new P;this.m_localYAxis1=new P;this.m_axis=new P;this.m_perp=new P;this.m_K=new v;this.m_impulse=new af};J.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};J.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};J.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),k*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};J.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.y};J.prototype.GetJointTranslation=function(){var w=this.m_bodyA,u=this.m_bodyB,k=w.GetWorldPoint(this.m_localAnchor1),p=u.GetWorldPoint(this.m_localAnchor2);u=p.x-k.x;k=p.y-k.y;w=w.GetWorldVector(this.m_localXAxis1);return w.x*u+w.y*k};J.prototype.GetJointSpeed=function(){var B=this.m_bodyA,z=this.m_bodyB,w;w=B.m_xf.R;var y=this.m_localAnchor1.x-B.m_sweep.localCenter.x,p=this.m_localAnchor1.y-B.m_sweep.localCenter.y,k=w.col1.x*y+w.col2.x*p;p=w.col1.y*y+w.col2.y*p;y=k;w=z.m_xf.R;var u=this.m_localAnchor2.x-z.m_sweep.localCenter.x,F=this.m_localAnchor2.y-z.m_sweep.localCenter.y;k=w.col1.x*u+w.col2.x*F;F=w.col1.y*u+w.col2.y*F;u=k;w=z.m_sweep.c.x+u-(B.m_sweep.c.x+y);k=z.m_sweep.c.y+F-(B.m_sweep.c.y+p);var D=B.GetWorldVector(this.m_localXAxis1),A=B.m_linearVelocity,E=z.m_linearVelocity;B=B.m_angularVelocity;z=z.m_angularVelocity;return w*-B*D.y+k*B*D.x+(D.x*(E.x+-z*F-A.x- -B*p)+D.y*(E.y+z*u-A.y-B*y))};J.prototype.IsLimitEnabled=function(){return this.m_enableLimit};J.prototype.EnableLimit=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=k};J.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};J.prototype.GetUpperLimit=function(){return this.m_upperTranslation};J.prototype.SetLimits=function(p,k){if(p===undefined){p=0}if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=p;this.m_upperTranslation=k};J.prototype.IsMotorEnabled=function(){return this.m_enableMotor};J.prototype.EnableMotor=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=k};J.prototype.SetMotorSpeed=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k};J.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};J.prototype.SetMaxMotorForce=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=k};J.prototype.GetMotorForce=function(){return this.m_motorImpulse};J.prototype.b2PrismaticJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_localXAxis1.SetV(k.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=k.lowerTranslation;this.m_upperTranslation=k.upperTranslation;this.m_maxMotorForce=k.maxMotorForce;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=C.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};J.prototype.InitVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y,p=0;this.m_localCenterA.SetV(z.GetLocalCenter());this.m_localCenterB.SetV(w.GetLocalCenter());var k=z.GetTransform();w.GetTransform();y=z.m_xf.R;var u=this.m_localAnchor1.x-this.m_localCenterA.x,E=this.m_localAnchor1.y-this.m_localCenterA.y;p=y.col1.x*u+y.col2.x*E;E=y.col1.y*u+y.col2.y*E;u=p;y=w.m_xf.R;var D=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;p=y.col1.x*D+y.col2.x*A;A=y.col1.y*D+y.col2.y*A;D=p;y=w.m_sweep.c.x+D-z.m_sweep.c.x-u;p=w.m_sweep.c.y+A-z.m_sweep.c.y-E;this.m_invMassA=z.m_invMass;this.m_invMassB=w.m_invMass;this.m_invIA=z.m_invI;this.m_invIB=w.m_invI;this.m_axis.SetV(x.MulMV(k.R,this.m_localXAxis1));this.m_a1=(y+u)*this.m_axis.y-(p+E)*this.m_axis.x;this.m_a2=D*this.m_axis.y-A*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE){this.m_motorMass=1/this.m_motorMass}this.m_perp.SetV(x.MulMV(k.R,this.m_localYAxis1));this.m_s1=(y+u)*this.m_perp.y-(p+E)*this.m_perp.x;this.m_s2=D*this.m_perp.y-A*this.m_perp.x;k=this.m_invMassA;u=this.m_invMassB;E=this.m_invIA;D=this.m_invIB;this.m_K.col1.x=k+u+E*this.m_s1*this.m_s1+D*this.m_s2*this.m_s2;this.m_K.col1.y=E*this.m_s1+D*this.m_s2;this.m_K.col1.z=E*this.m_s1*this.m_a1+D*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=E+D;this.m_K.col2.z=E*this.m_a1+D*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=k+u+E*this.m_a1*this.m_a1+D*this.m_a2*this.m_a2;if(this.m_enableLimit){y=this.m_axis.x*y+this.m_axis.y*p;if(x.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*ab.b2_linearSlop){this.m_limitState=C.e_equalLimits}else{if(y<=this.m_lowerTranslation){if(this.m_limitState!=C.e_atLowerLimit){this.m_limitState=C.e_atLowerLimit;this.m_impulse.z=0}}else{if(y>=this.m_upperTranslation){if(this.m_limitState!=C.e_atUpperLimit){this.m_limitState=C.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=C.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=C.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(B.warmStarting){this.m_impulse.x*=B.dtRatio;this.m_impulse.y*=B.dtRatio;this.m_motorImpulse*=B.dtRatio;B=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;y=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;p=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;k=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;z.m_linearVelocity.x-=this.m_invMassA*B;z.m_linearVelocity.y-=this.m_invMassA*y;z.m_angularVelocity-=this.m_invIA*p;w.m_linearVelocity.x+=this.m_invMassB*B;w.m_linearVelocity.y+=this.m_invMassB*y;w.m_angularVelocity+=this.m_invIB*k}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};J.prototype.SolveVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y=z.m_linearVelocity,p=z.m_angularVelocity,k=w.m_linearVelocity,u=w.m_angularVelocity,F=0,D=0,A=0,E=0;if(this.m_enableMotor&&this.m_limitState!=C.e_equalLimits){E=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p));F=this.m_motorImpulse;B=B.dt*this.m_maxMotorForce;this.m_motorImpulse=x.Clamp(this.m_motorImpulse+E,-B,B);E=this.m_motorImpulse-F;F=E*this.m_axis.x;D=E*this.m_axis.y;A=E*this.m_a1;E=E*this.m_a2;y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E}A=this.m_perp.x*(k.x-y.x)+this.m_perp.y*(k.y-y.y)+this.m_s2*u-this.m_s1*p;D=u-p;if(this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit){B=this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p;F=this.m_impulse.Copy();B=this.m_K.Solve33(new af,-A,-D,-B);this.m_impulse.Add(B);if(this.m_limitState==C.e_atLowerLimit){this.m_impulse.z=x.Max(this.m_impulse.z,0)}else{if(this.m_limitState==C.e_atUpperLimit){this.m_impulse.z=x.Min(this.m_impulse.z,0)}}A=-A-(this.m_impulse.z-F.z)*this.m_K.col3.x;D=-D-(this.m_impulse.z-F.z)*this.m_K.col3.y;D=this.m_K.Solve22(new P,A,D);D.x+=F.x;D.y+=F.y;this.m_impulse.x=D.x;this.m_impulse.y=D.y;B.x=this.m_impulse.x-F.x;B.y=this.m_impulse.y-F.y;B.z=this.m_impulse.z-F.z;F=B.x*this.m_perp.x+B.z*this.m_axis.x;D=B.x*this.m_perp.y+B.z*this.m_axis.y;A=B.x*this.m_s1+B.y+B.z*this.m_a1;E=B.x*this.m_s2+B.y+B.z*this.m_a2}else{B=this.m_K.Solve22(new P,-A,-D);this.m_impulse.x+=B.x;this.m_impulse.y+=B.y;F=B.x*this.m_perp.x;D=B.x*this.m_perp.y;A=B.x*this.m_s1+B.y;E=B.x*this.m_s2+B.y}y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E;z.m_linearVelocity.SetV(y);z.m_angularVelocity=p;w.m_linearVelocity.SetV(k);w.m_angularVelocity=u};J.prototype.SolvePositionConstraints=function(){var G=this.m_bodyA,B=this.m_bodyB,z=G.m_sweep.c,A=G.m_sweep.a,u=B.m_sweep.c,p=B.m_sweep.a,w,K=0,H=0,D=0,I=K=w=0,F=0;H=false;var E=0,y=T.FromAngle(A),k=T.FromAngle(p);w=y;F=this.m_localAnchor1.x-this.m_localCenterA.x;var M=this.m_localAnchor1.y-this.m_localCenterA.y;K=w.col1.x*F+w.col2.x*M;M=w.col1.y*F+w.col2.y*M;F=K;w=k;k=this.m_localAnchor2.x-this.m_localCenterB.x;D=this.m_localAnchor2.y-this.m_localCenterB.y;K=w.col1.x*k+w.col2.x*D;D=w.col1.y*k+w.col2.y*D;k=K;w=u.x+k-z.x-F;K=u.y+D-z.y-M;if(this.m_enableLimit){this.m_axis=x.MulMV(y,this.m_localXAxis1);this.m_a1=(w+F)*this.m_axis.y-(K+M)*this.m_axis.x;this.m_a2=k*this.m_axis.y-D*this.m_axis.x;var L=this.m_axis.x*w+this.m_axis.y*K;if(x.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*ab.b2_linearSlop){E=x.Clamp(L,-ab.b2_maxLinearCorrection,ab.b2_maxLinearCorrection);I=x.Abs(L);H=true}else{if(L<=this.m_lowerTranslation){E=x.Clamp(L-this.m_lowerTranslation+ab.b2_linearSlop,-ab.b2_maxLinearCorrection,0);I=this.m_lowerTranslation-L;H=true}else{if(L>=this.m_upperTranslation){E=x.Clamp(L-this.m_upperTranslation+ab.b2_linearSlop,0,ab.b2_maxLinearCorrection);I=L-this.m_upperTranslation;H=true}}}}this.m_perp=x.MulMV(y,this.m_localYAxis1);this.m_s1=(w+F)*this.m_perp.y-(K+M)*this.m_perp.x;this.m_s2=k*this.m_perp.y-D*this.m_perp.x;y=new af;M=this.m_perp.x*w+this.m_perp.y*K;k=p-A-this.m_refAngle;I=x.Max(I,x.Abs(M));F=x.Abs(k);if(H){H=this.m_invMassA;D=this.m_invMassB;w=this.m_invIA;K=this.m_invIB;this.m_K.col1.x=H+D+w*this.m_s1*this.m_s1+K*this.m_s2*this.m_s2;this.m_K.col1.y=w*this.m_s1+K*this.m_s2;this.m_K.col1.z=w*this.m_s1*this.m_a1+K*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=w+K;this.m_K.col2.z=w*this.m_a1+K*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=H+D+w*this.m_a1*this.m_a1+K*this.m_a2*this.m_a2;this.m_K.Solve33(y,-M,-k,-E)}else{H=this.m_invMassA;D=this.m_invMassB;w=this.m_invIA;K=this.m_invIB;E=w*this.m_s1+K*this.m_s2;L=w+K;this.m_K.col1.Set(H+D+w*this.m_s1*this.m_s1+K*this.m_s2*this.m_s2,E,0);this.m_K.col2.Set(E,L,0);E=this.m_K.Solve22(new P,-M,-k);y.x=E.x;y.y=E.y;y.z=0}E=y.x*this.m_perp.x+y.z*this.m_axis.x;H=y.x*this.m_perp.y+y.z*this.m_axis.y;M=y.x*this.m_s1+y.y+y.z*this.m_a1;y=y.x*this.m_s2+y.y+y.z*this.m_a2;z.x-=this.m_invMassA*E;z.y-=this.m_invMassA*H;A-=this.m_invIA*M;u.x+=this.m_invMassB*E;u.y+=this.m_invMassB*H;p+=this.m_invIB*y;G.m_sweep.a=A;B.m_sweep.a=p;G.SynchronizeTransform();B.SynchronizeTransform();return I<=ab.b2_linearSlop&&F<=ab.b2_angularSlop};e.inherit(o,e.Dynamics.Joints.b2JointDef);o.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;o.b2PrismaticJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new P;this.localAnchorB=new P;this.localAxisA=new P};o.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};o.prototype.Initialize=function(w,u,k,p){this.bodyA=w;this.bodyB=u;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.localAxisA=this.bodyA.GetLocalVector(p);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};e.inherit(ac,e.Dynamics.Joints.b2Joint);ac.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;ac.b2PulleyJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new P;this.m_groundAnchor2=new P;this.m_localAnchor1=new P;this.m_localAnchor2=new P;this.m_u1=new P;this.m_u2=new P};ac.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};ac.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};ac.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_impulse*this.m_u2.x,k*this.m_impulse*this.m_u2.y)};ac.prototype.GetReactionTorque=function(){return 0};ac.prototype.GetGroundAnchorA=function(){var k=this.m_ground.m_xf.position.Copy();k.Add(this.m_groundAnchor1);return k};ac.prototype.GetGroundAnchorB=function(){var k=this.m_ground.m_xf.position.Copy();k.Add(this.m_groundAnchor2);return k};ac.prototype.GetLength1=function(){var p=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),k=p.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);p=p.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(k*k+p*p)};ac.prototype.GetLength2=function(){var p=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),k=p.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);p=p.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(k*k+p*p)};ac.prototype.GetRatio=function(){return this.m_ratio};ac.prototype.b2PulleyJoint=function(k){this.__super.b2Joint.call(this,k);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=k.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=k.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=k.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=k.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_ratio=k.ratio;this.m_constant=k.lengthA+this.m_ratio*k.lengthB;this.m_maxLength1=x.Min(k.maxLengthA,this.m_constant-this.m_ratio*ac.b2_minPulleyLength);this.m_maxLength2=x.Min(k.maxLengthB,(this.m_constant-ac.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};ac.prototype.InitVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y;y=z.m_xf.R;var p=this.m_localAnchor1.x-z.m_sweep.localCenter.x,k=this.m_localAnchor1.y-z.m_sweep.localCenter.y,u=y.col1.x*p+y.col2.x*k;k=y.col1.y*p+y.col2.y*k;p=u;y=w.m_xf.R;var F=this.m_localAnchor2.x-w.m_sweep.localCenter.x,D=this.m_localAnchor2.y-w.m_sweep.localCenter.y;u=y.col1.x*F+y.col2.x*D;D=y.col1.y*F+y.col2.y*D;F=u;y=w.m_sweep.c.x+F;u=w.m_sweep.c.y+D;var A=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,E=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(z.m_sweep.c.x+p-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),z.m_sweep.c.y+k-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(y-A,u-E);y=this.m_u1.Length();u=this.m_u2.Length();y>ab.b2_linearSlop?this.m_u1.Multiply(1/y):this.m_u1.SetZero();u>ab.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero();if(this.m_constant-y-this.m_ratio*u>0){this.m_state=C.e_inactiveLimit;this.m_impulse=0}else{this.m_state=C.e_atUpperLimit}if(y<this.m_maxLength1){this.m_limitState1=C.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=C.e_atUpperLimit}if(u<this.m_maxLength2){this.m_limitState2=C.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=C.e_atUpperLimit}y=p*this.m_u1.y-k*this.m_u1.x;u=F*this.m_u2.y-D*this.m_u2.x;this.m_limitMass1=z.m_invMass+z.m_invI*y*y;this.m_limitMass2=w.m_invMass+w.m_invI*u*u;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(B.warmStarting){this.m_impulse*=B.dtRatio;this.m_limitImpulse1*=B.dtRatio;this.m_limitImpulse2*=B.dtRatio;B=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;y=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;z.m_linearVelocity.x+=z.m_invMass*B;z.m_linearVelocity.y+=z.m_invMass*y;z.m_angularVelocity+=z.m_invI*(p*y-k*B);w.m_linearVelocity.x+=w.m_invMass*u;w.m_linearVelocity.y+=w.m_invMass*A;w.m_angularVelocity+=w.m_invI*(F*A-D*u)}else{this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0}};ac.prototype.SolveVelocityConstraints=function(){var B=this.m_bodyA,z=this.m_bodyB,w;w=B.m_xf.R;var y=this.m_localAnchor1.x-B.m_sweep.localCenter.x,p=this.m_localAnchor1.y-B.m_sweep.localCenter.y,k=w.col1.x*y+w.col2.x*p;p=w.col1.y*y+w.col2.y*p;y=k;w=z.m_xf.R;var u=this.m_localAnchor2.x-z.m_sweep.localCenter.x,E=this.m_localAnchor2.y-z.m_sweep.localCenter.y;k=w.col1.x*u+w.col2.x*E;E=w.col1.y*u+w.col2.y*E;u=k;var D=k=w=0,A=0;w=A=w=A=D=k=w=0;if(this.m_state==C.e_atUpperLimit){w=B.m_linearVelocity.x+-B.m_angularVelocity*p;k=B.m_linearVelocity.y+B.m_angularVelocity*y;D=z.m_linearVelocity.x+-z.m_angularVelocity*E;A=z.m_linearVelocity.y+z.m_angularVelocity*u;w=-(this.m_u1.x*w+this.m_u1.y*k)-this.m_ratio*(this.m_u2.x*D+this.m_u2.y*A);A=this.m_pulleyMass*-w;w=this.m_impulse;this.m_impulse=x.Max(0,this.m_impulse+A);A=this.m_impulse-w;w=-A*this.m_u1.x;k=-A*this.m_u1.y;D=-this.m_ratio*A*this.m_u2.x;A=-this.m_ratio*A*this.m_u2.y;B.m_linearVelocity.x+=B.m_invMass*w;B.m_linearVelocity.y+=B.m_invMass*k;B.m_angularVelocity+=B.m_invI*(y*k-p*w);z.m_linearVelocity.x+=z.m_invMass*D;z.m_linearVelocity.y+=z.m_invMass*A;z.m_angularVelocity+=z.m_invI*(u*A-E*D)}if(this.m_limitState1==C.e_atUpperLimit){w=B.m_linearVelocity.x+-B.m_angularVelocity*p;k=B.m_linearVelocity.y+B.m_angularVelocity*y;w=-(this.m_u1.x*w+this.m_u1.y*k);A=-this.m_limitMass1*w;w=this.m_limitImpulse1;this.m_limitImpulse1=x.Max(0,this.m_limitImpulse1+A);A=this.m_limitImpulse1-w;w=-A*this.m_u1.x;k=-A*this.m_u1.y;B.m_linearVelocity.x+=B.m_invMass*w;B.m_linearVelocity.y+=B.m_invMass*k;B.m_angularVelocity+=B.m_invI*(y*k-p*w)}if(this.m_limitState2==C.e_atUpperLimit){D=z.m_linearVelocity.x+-z.m_angularVelocity*E;A=z.m_linearVelocity.y+z.m_angularVelocity*u;w=-(this.m_u2.x*D+this.m_u2.y*A);A=-this.m_limitMass2*w;w=this.m_limitImpulse2;this.m_limitImpulse2=x.Max(0,this.m_limitImpulse2+A);A=this.m_limitImpulse2-w;D=-A*this.m_u2.x;A=-A*this.m_u2.y;z.m_linearVelocity.x+=z.m_invMass*D;z.m_linearVelocity.y+=z.m_invMass*A;z.m_angularVelocity+=z.m_invI*(u*A-E*D)}};ac.prototype.SolvePositionConstraints=function(){var G=this.m_bodyA,B=this.m_bodyB,z,A=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,w=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,K=0,H=0,D=0,I=0,F=z=0,E=0,y=0,k=F=y=z=F=z=0;if(this.m_state==C.e_atUpperLimit){z=G.m_xf.R;K=this.m_localAnchor1.x-G.m_sweep.localCenter.x;H=this.m_localAnchor1.y-G.m_sweep.localCenter.y;F=z.col1.x*K+z.col2.x*H;H=z.col1.y*K+z.col2.y*H;K=F;z=B.m_xf.R;D=this.m_localAnchor2.x-B.m_sweep.localCenter.x;I=this.m_localAnchor2.y-B.m_sweep.localCenter.y;F=z.col1.x*D+z.col2.x*I;I=z.col1.y*D+z.col2.y*I;D=F;z=G.m_sweep.c.x+K;F=G.m_sweep.c.y+H;E=B.m_sweep.c.x+D;y=B.m_sweep.c.y+I;this.m_u1.Set(z-A,F-u);this.m_u2.Set(E-p,y-w);z=this.m_u1.Length();F=this.m_u2.Length();z>ab.b2_linearSlop?this.m_u1.Multiply(1/z):this.m_u1.SetZero();F>ab.b2_linearSlop?this.m_u2.Multiply(1/F):this.m_u2.SetZero();z=this.m_constant-z-this.m_ratio*F;k=x.Max(k,-z);z=x.Clamp(z+ab.b2_linearSlop,-ab.b2_maxLinearCorrection,0);y=-this.m_pulleyMass*z;z=-y*this.m_u1.x;F=-y*this.m_u1.y;E=-this.m_ratio*y*this.m_u2.x;y=-this.m_ratio*y*this.m_u2.y;G.m_sweep.c.x+=G.m_invMass*z;G.m_sweep.c.y+=G.m_invMass*F;G.m_sweep.a+=G.m_invI*(K*F-H*z);B.m_sweep.c.x+=B.m_invMass*E;B.m_sweep.c.y+=B.m_invMass*y;B.m_sweep.a+=B.m_invI*(D*y-I*E);G.SynchronizeTransform();B.SynchronizeTransform()}if(this.m_limitState1==C.e_atUpperLimit){z=G.m_xf.R;K=this.m_localAnchor1.x-G.m_sweep.localCenter.x;H=this.m_localAnchor1.y-G.m_sweep.localCenter.y;F=z.col1.x*K+z.col2.x*H;H=z.col1.y*K+z.col2.y*H;K=F;z=G.m_sweep.c.x+K;F=G.m_sweep.c.y+H;this.m_u1.Set(z-A,F-u);z=this.m_u1.Length();if(z>ab.b2_linearSlop){this.m_u1.x*=1/z;this.m_u1.y*=1/z}else{this.m_u1.SetZero()}z=this.m_maxLength1-z;k=x.Max(k,-z);z=x.Clamp(z+ab.b2_linearSlop,-ab.b2_maxLinearCorrection,0);y=-this.m_limitMass1*z;z=-y*this.m_u1.x;F=-y*this.m_u1.y;G.m_sweep.c.x+=G.m_invMass*z;G.m_sweep.c.y+=G.m_invMass*F;G.m_sweep.a+=G.m_invI*(K*F-H*z);G.SynchronizeTransform()}if(this.m_limitState2==C.e_atUpperLimit){z=B.m_xf.R;D=this.m_localAnchor2.x-B.m_sweep.localCenter.x;I=this.m_localAnchor2.y-B.m_sweep.localCenter.y;F=z.col1.x*D+z.col2.x*I;I=z.col1.y*D+z.col2.y*I;D=F;E=B.m_sweep.c.x+D;y=B.m_sweep.c.y+I;this.m_u2.Set(E-p,y-w);F=this.m_u2.Length();if(F>ab.b2_linearSlop){this.m_u2.x*=1/F;this.m_u2.y*=1/F}else{this.m_u2.SetZero()}z=this.m_maxLength2-F;k=x.Max(k,-z);z=x.Clamp(z+ab.b2_linearSlop,-ab.b2_maxLinearCorrection,0);y=-this.m_limitMass2*z;E=-y*this.m_u2.x;y=-y*this.m_u2.y;B.m_sweep.c.x+=B.m_invMass*E;B.m_sweep.c.y+=B.m_invMass*y;B.m_sweep.a+=B.m_invI*(D*y-I*E);B.SynchronizeTransform()}return k<ab.b2_linearSlop};e.postDefs.push(function(){e.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});e.inherit(m,e.Dynamics.Joints.b2JointDef);m.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;m.b2PulleyJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new P;this.groundAnchorB=new P;this.localAnchorA=new P;this.localAnchorB=new P};m.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=true};m.prototype.Initialize=function(z,u,k,p,y,w,A){if(A===undefined){A=0}this.bodyA=z;this.bodyB=u;this.groundAnchorA.SetV(k);this.groundAnchorB.SetV(p);this.localAnchorA=this.bodyA.GetLocalPoint(y);this.localAnchorB=this.bodyB.GetLocalPoint(w);z=y.x-k.x;k=y.y-k.y;this.lengthA=Math.sqrt(z*z+k*k);k=w.x-p.x;p=w.y-p.y;this.lengthB=Math.sqrt(k*k+p*p);this.ratio=A;A=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=A-this.ratio*ac.b2_minPulleyLength;this.maxLengthB=(A-ac.b2_minPulleyLength)/this.ratio};e.inherit(q,e.Dynamics.Joints.b2Joint);q.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;q.b2RevoluteJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new T;this.K1=new T;this.K2=new T;this.K3=new T;this.impulse3=new af;this.impulse2=new P;this.reduced=new P;this.m_localAnchor1=new P;this.m_localAnchor2=new P;this.m_impulse=new af;this.m_mass=new v};q.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};q.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};q.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_impulse.x,k*this.m_impulse.y)};q.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.z};q.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};q.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};q.prototype.IsLimitEnabled=function(){return this.m_enableLimit};q.prototype.EnableLimit=function(k){this.m_enableLimit=k};q.prototype.GetLowerLimit=function(){return this.m_lowerAngle};q.prototype.GetUpperLimit=function(){return this.m_upperAngle};q.prototype.SetLimits=function(p,k){if(p===undefined){p=0}if(k===undefined){k=0}this.m_lowerAngle=p;this.m_upperAngle=k};q.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};q.prototype.EnableMotor=function(k){this.m_enableMotor=k};q.prototype.SetMotorSpeed=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k};q.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};q.prototype.SetMaxMotorTorque=function(k){if(k===undefined){k=0}this.m_maxMotorTorque=k};q.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};q.prototype.b2RevoluteJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_referenceAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=k.lowerAngle;this.m_upperAngle=k.upperAngle;this.m_maxMotorTorque=k.maxMotorTorque;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=C.e_inactiveLimit};q.prototype.InitVelocityConstraints=function(D){var z=this.m_bodyA,w=this.m_bodyB,y,p=0;y=z.m_xf.R;var k=this.m_localAnchor1.x-z.m_sweep.localCenter.x,u=this.m_localAnchor1.y-z.m_sweep.localCenter.y;p=y.col1.x*k+y.col2.x*u;u=y.col1.y*k+y.col2.y*u;k=p;y=w.m_xf.R;var G=this.m_localAnchor2.x-w.m_sweep.localCenter.x,E=this.m_localAnchor2.y-w.m_sweep.localCenter.y;p=y.col1.x*G+y.col2.x*E;E=y.col1.y*G+y.col2.y*E;G=p;y=z.m_invMass;p=w.m_invMass;var A=z.m_invI,F=w.m_invI;this.m_mass.col1.x=y+p+u*u*A+E*E*F;this.m_mass.col2.x=-u*k*A-E*G*F;this.m_mass.col3.x=-u*A-E*F;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=y+p+k*k*A+G*G*F;this.m_mass.col3.y=k*A+G*F;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=A+F;this.m_motorMass=1/(A+F);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var B=w.m_sweep.a-z.m_sweep.a-this.m_referenceAngle;if(x.Abs(this.m_upperAngle-this.m_lowerAngle)<2*ab.b2_angularSlop){this.m_limitState=C.e_equalLimits}else{if(B<=this.m_lowerAngle){if(this.m_limitState!=C.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=C.e_atLowerLimit}else{if(B>=this.m_upperAngle){if(this.m_limitState!=C.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=C.e_atUpperLimit}else{this.m_limitState=C.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=C.e_inactiveLimit}if(D.warmStarting){this.m_impulse.x*=D.dtRatio;this.m_impulse.y*=D.dtRatio;this.m_motorImpulse*=D.dtRatio;D=this.m_impulse.x;B=this.m_impulse.y;z.m_linearVelocity.x-=y*D;z.m_linearVelocity.y-=y*B;z.m_angularVelocity-=A*(k*B-u*D+this.m_motorImpulse+this.m_impulse.z);w.m_linearVelocity.x+=p*D;w.m_linearVelocity.y+=p*B;w.m_angularVelocity+=F*(G*B-E*D+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};q.prototype.SolveVelocityConstraints=function(G){var B=this.m_bodyA,z=this.m_bodyB,A=0,u=A=0,p=0,w=0,K=0,H=B.m_linearVelocity,D=B.m_angularVelocity,I=z.m_linearVelocity,F=z.m_angularVelocity,E=B.m_invMass,y=z.m_invMass,k=B.m_invI,M=z.m_invI;if(this.m_enableMotor&&this.m_limitState!=C.e_equalLimits){u=this.m_motorMass*-(F-D-this.m_motorSpeed);p=this.m_motorImpulse;w=G.dt*this.m_maxMotorTorque;this.m_motorImpulse=x.Clamp(this.m_motorImpulse+u,-w,w);u=this.m_motorImpulse-p;D-=k*u;F+=M*u}if(this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit){G=B.m_xf.R;u=this.m_localAnchor1.x-B.m_sweep.localCenter.x;p=this.m_localAnchor1.y-B.m_sweep.localCenter.y;A=G.col1.x*u+G.col2.x*p;p=G.col1.y*u+G.col2.y*p;u=A;G=z.m_xf.R;w=this.m_localAnchor2.x-z.m_sweep.localCenter.x;K=this.m_localAnchor2.y-z.m_sweep.localCenter.y;A=G.col1.x*w+G.col2.x*K;K=G.col1.y*w+G.col2.y*K;w=A;G=I.x+-F*K-H.x- -D*p;var L=I.y+F*w-H.y-D*u;this.m_mass.Solve33(this.impulse3,-G,-L,-(F-D));if(this.m_limitState==C.e_equalLimits){this.m_impulse.Add(this.impulse3)}else{if(this.m_limitState==C.e_atLowerLimit){A=this.m_impulse.z+this.impulse3.z;if(A<0){this.m_mass.Solve22(this.reduced,-G,-L);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else{if(this.m_limitState==C.e_atUpperLimit){A=this.m_impulse.z+this.impulse3.z;if(A>0){this.m_mass.Solve22(this.reduced,-G,-L);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}}}H.x-=E*this.impulse3.x;H.y-=E*this.impulse3.y;D-=k*(u*this.impulse3.y-p*this.impulse3.x+this.impulse3.z);I.x+=y*this.impulse3.x;I.y+=y*this.impulse3.y;F+=M*(w*this.impulse3.y-K*this.impulse3.x+this.impulse3.z)}else{G=B.m_xf.R;u=this.m_localAnchor1.x-B.m_sweep.localCenter.x;p=this.m_localAnchor1.y-B.m_sweep.localCenter.y;A=G.col1.x*u+G.col2.x*p;p=G.col1.y*u+G.col2.y*p;u=A;G=z.m_xf.R;w=this.m_localAnchor2.x-z.m_sweep.localCenter.x;K=this.m_localAnchor2.y-z.m_sweep.localCenter.y;A=G.col1.x*w+G.col2.x*K;K=G.col1.y*w+G.col2.y*K;w=A;this.m_mass.Solve22(this.impulse2,-(I.x+-F*K-H.x- -D*p),-(I.y+F*w-H.y-D*u));this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;H.x-=E*this.impulse2.x;H.y-=E*this.impulse2.y;D-=k*(u*this.impulse2.y-p*this.impulse2.x);I.x+=y*this.impulse2.x;I.y+=y*this.impulse2.y;F+=M*(w*this.impulse2.y-K*this.impulse2.x)}B.m_linearVelocity.SetV(H);B.m_angularVelocity=D;z.m_linearVelocity.SetV(I);z.m_angularVelocity=F};q.prototype.SolvePositionConstraints=function(){var G=0,B,z=this.m_bodyA,A=this.m_bodyB,u=0,p=B=0,w=0,K=0;if(this.m_enableLimit&&this.m_limitState!=C.e_inactiveLimit){G=A.m_sweep.a-z.m_sweep.a-this.m_referenceAngle;var H=0;if(this.m_limitState==C.e_equalLimits){G=x.Clamp(G-this.m_lowerAngle,-ab.b2_maxAngularCorrection,ab.b2_maxAngularCorrection);H=-this.m_motorMass*G;u=x.Abs(G)}else{if(this.m_limitState==C.e_atLowerLimit){G=G-this.m_lowerAngle;u=-G;G=x.Clamp(G+ab.b2_angularSlop,-ab.b2_maxAngularCorrection,0);H=-this.m_motorMass*G}else{if(this.m_limitState==C.e_atUpperLimit){u=G=G-this.m_upperAngle;G=x.Clamp(G-ab.b2_angularSlop,0,ab.b2_maxAngularCorrection);H=-this.m_motorMass*G}}}z.m_sweep.a-=z.m_invI*H;A.m_sweep.a+=A.m_invI*H;z.SynchronizeTransform();A.SynchronizeTransform()}B=z.m_xf.R;H=this.m_localAnchor1.x-z.m_sweep.localCenter.x;G=this.m_localAnchor1.y-z.m_sweep.localCenter.y;p=B.col1.x*H+B.col2.x*G;G=B.col1.y*H+B.col2.y*G;H=p;B=A.m_xf.R;var D=this.m_localAnchor2.x-A.m_sweep.localCenter.x,I=this.m_localAnchor2.y-A.m_sweep.localCenter.y;p=B.col1.x*D+B.col2.x*I;I=B.col1.y*D+B.col2.y*I;D=p;w=A.m_sweep.c.x+D-z.m_sweep.c.x-H;K=A.m_sweep.c.y+I-z.m_sweep.c.y-G;var F=w*w+K*K;B=Math.sqrt(F);p=z.m_invMass;var E=A.m_invMass,y=z.m_invI,k=A.m_invI,L=10*ab.b2_linearSlop;if(F>L*L){F=1/(p+E);w=F*-w;K=F*-K;z.m_sweep.c.x-=0.5*p*w;z.m_sweep.c.y-=0.5*p*K;A.m_sweep.c.x+=0.5*E*w;A.m_sweep.c.y+=0.5*E*K;w=A.m_sweep.c.x+D-z.m_sweep.c.x-H;K=A.m_sweep.c.y+I-z.m_sweep.c.y-G}this.K1.col1.x=p+E;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=p+E;this.K2.col1.x=y*G*G;this.K2.col2.x=-y*H*G;this.K2.col1.y=-y*H*G;this.K2.col2.y=y*H*H;this.K3.col1.x=k*I*I;this.K3.col2.x=-k*D*I;this.K3.col1.y=-k*D*I;this.K3.col2.y=k*D*D;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(q.tImpulse,-w,-K);w=q.tImpulse.x;K=q.tImpulse.y;z.m_sweep.c.x-=z.m_invMass*w;z.m_sweep.c.y-=z.m_invMass*K;z.m_sweep.a-=z.m_invI*(H*K-G*w);A.m_sweep.c.x+=A.m_invMass*w;A.m_sweep.c.y+=A.m_invMass*K;A.m_sweep.a+=A.m_invI*(D*K-I*w);z.SynchronizeTransform();A.SynchronizeTransform();return B<=ab.b2_linearSlop&&u<=ab.b2_angularSlop};e.postDefs.push(function(){e.Dynamics.Joints.b2RevoluteJoint.tImpulse=new P});e.inherit(l,e.Dynamics.Joints.b2JointDef);l.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;l.b2RevoluteJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new P;this.localAnchorB=new P};l.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false};l.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};e.inherit(ai,e.Dynamics.Joints.b2Joint);ai.prototype.__super=e.Dynamics.Joints.b2Joint.prototype;ai.b2WeldJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new P;this.m_localAnchorB=new P;this.m_impulse=new af;this.m_mass=new v};ai.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};ai.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};ai.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new P(k*this.m_impulse.x,k*this.m_impulse.y)};ai.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.z};ai.prototype.b2WeldJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchorA.SetV(k.localAnchorA);this.m_localAnchorB.SetV(k.localAnchorB);this.m_referenceAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_mass=new v};ai.prototype.InitVelocityConstraints=function(B){var z,w=0,y=this.m_bodyA,p=this.m_bodyB;z=y.m_xf.R;var k=this.m_localAnchorA.x-y.m_sweep.localCenter.x,u=this.m_localAnchorA.y-y.m_sweep.localCenter.y;w=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;k=w;z=p.m_xf.R;var F=this.m_localAnchorB.x-p.m_sweep.localCenter.x,D=this.m_localAnchorB.y-p.m_sweep.localCenter.y;w=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=w;z=y.m_invMass;w=p.m_invMass;var A=y.m_invI,E=p.m_invI;this.m_mass.col1.x=z+w+u*u*A+D*D*E;this.m_mass.col2.x=-u*k*A-D*F*E;this.m_mass.col3.x=-u*A-D*E;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=z+w+k*k*A+F*F*E;this.m_mass.col3.y=k*A+F*E;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=A+E;if(B.warmStarting){this.m_impulse.x*=B.dtRatio;this.m_impulse.y*=B.dtRatio;this.m_impulse.z*=B.dtRatio;y.m_linearVelocity.x-=z*this.m_impulse.x;y.m_linearVelocity.y-=z*this.m_impulse.y;y.m_angularVelocity-=A*(k*this.m_impulse.y-u*this.m_impulse.x+this.m_impulse.z);p.m_linearVelocity.x+=w*this.m_impulse.x;p.m_linearVelocity.y+=w*this.m_impulse.y;p.m_angularVelocity+=E*(F*this.m_impulse.y-D*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};ai.prototype.SolveVelocityConstraints=function(){var K,F=0,D=this.m_bodyA,E=this.m_bodyB,z=D.m_linearVelocity,y=D.m_angularVelocity,A=E.m_linearVelocity,N=E.m_angularVelocity,L=D.m_invMass,G=E.m_invMass,M=D.m_invI,I=E.m_invI;K=D.m_xf.R;var H=this.m_localAnchorA.x-D.m_sweep.localCenter.x,B=this.m_localAnchorA.y-D.m_sweep.localCenter.y;F=K.col1.x*H+K.col2.x*B;B=K.col1.y*H+K.col2.y*B;H=F;K=E.m_xf.R;var w=this.m_localAnchorB.x-E.m_sweep.localCenter.x,u=this.m_localAnchorB.y-E.m_sweep.localCenter.y;F=K.col1.x*w+K.col2.x*u;u=K.col1.y*w+K.col2.y*u;w=F;K=A.x-N*u-z.x+y*B;F=A.y+N*w-z.y-y*H;var k=N-y,p=new af;this.m_mass.Solve33(p,-K,-F,-k);this.m_impulse.Add(p);z.x-=L*p.x;z.y-=L*p.y;y-=M*(H*p.y-B*p.x+p.z);A.x+=G*p.x;A.y+=G*p.y;N+=I*(w*p.y-u*p.x+p.z);D.m_angularVelocity=y;E.m_angularVelocity=N};ai.prototype.SolvePositionConstraints=function(){var G,B=0,z=this.m_bodyA,A=this.m_bodyB;G=z.m_xf.R;var u=this.m_localAnchorA.x-z.m_sweep.localCenter.x,p=this.m_localAnchorA.y-z.m_sweep.localCenter.y;B=G.col1.x*u+G.col2.x*p;p=G.col1.y*u+G.col2.y*p;u=B;G=A.m_xf.R;var w=this.m_localAnchorB.x-A.m_sweep.localCenter.x,K=this.m_localAnchorB.y-A.m_sweep.localCenter.y;B=G.col1.x*w+G.col2.x*K;K=G.col1.y*w+G.col2.y*K;w=B;G=z.m_invMass;B=A.m_invMass;var H=z.m_invI,D=A.m_invI,I=A.m_sweep.c.x+w-z.m_sweep.c.x-u,F=A.m_sweep.c.y+K-z.m_sweep.c.y-p,E=A.m_sweep.a-z.m_sweep.a-this.m_referenceAngle,y=10*ab.b2_linearSlop,k=Math.sqrt(I*I+F*F),L=x.Abs(E);if(k>y){H*=1;D*=1}this.m_mass.col1.x=G+B+p*p*H+K*K*D;this.m_mass.col2.x=-p*u*H-K*w*D;this.m_mass.col3.x=-p*H-K*D;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=G+B+u*u*H+w*w*D;this.m_mass.col3.y=u*H+w*D;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=H+D;y=new af;this.m_mass.Solve33(y,-I,-F,-E);z.m_sweep.c.x-=G*y.x;z.m_sweep.c.y-=G*y.y;z.m_sweep.a-=H*(u*y.y-p*y.x+y.z);A.m_sweep.c.x+=B*y.x;A.m_sweep.c.y+=B*y.y;A.m_sweep.a+=D*(w*y.y-K*y.x+y.z);z.SynchronizeTransform();A.SynchronizeTransform();return k<=ab.b2_linearSlop&&L<=ab.b2_angularSlop};e.inherit(f,e.Dynamics.Joints.b2JointDef);f.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype;f.b2WeldJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new P;this.localAnchorB=new P};f.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=C.e_weldJoint;this.referenceAngle=0};f.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(k));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var f=e.Dynamics.b2DebugDraw;f.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var g=this;this.m_sprite={graphics:{clear:function(){g.m_ctx.clearRect(0,0,g.m_ctx.canvas.width,g.m_ctx.canvas.height)}}}};f.prototype._color=function(h,g){return"rgba("+((h&16711680)>>16)+","+((h&65280)>>8)+","+(h&255)+","+g+")"};f.prototype.b2DebugDraw=function(){this.m_drawFlags=0};f.prototype.SetFlags=function(g){if(g===undefined){g=0}this.m_drawFlags=g};f.prototype.GetFlags=function(){return this.m_drawFlags};f.prototype.AppendFlags=function(g){if(g===undefined){g=0}this.m_drawFlags|=g};f.prototype.ClearFlags=function(g){if(g===undefined){g=0}this.m_drawFlags&=~g};f.prototype.SetSprite=function(g){this.m_ctx=g};f.prototype.GetSprite=function(){return this.m_ctx};f.prototype.SetDrawScale=function(g){if(g===undefined){g=0}this.m_drawScale=g};f.prototype.GetDrawScale=function(){return this.m_drawScale};f.prototype.SetLineThickness=function(g){if(g===undefined){g=0}this.m_lineThickness=g;this.m_ctx.strokeWidth=g};f.prototype.GetLineThickness=function(){return this.m_lineThickness};f.prototype.SetAlpha=function(g){if(g===undefined){g=0}this.m_alpha=g};f.prototype.GetAlpha=function(){return this.m_alpha};f.prototype.SetFillAlpha=function(g){if(g===undefined){g=0}this.m_fillAlpha=g};f.prototype.GetFillAlpha=function(){return this.m_fillAlpha};f.prototype.SetXFormScale=function(g){if(g===undefined){g=0}this.m_xformScale=g};f.prototype.GetXFormScale=function(){return this.m_xformScale};f.prototype.DrawPolygon=function(j,i,k){if(i){var h=this.m_ctx,g=this.m_drawScale;h.beginPath();h.strokeStyle=this._color(k.color,this.m_alpha);h.moveTo(j[0].x*g,j[0].y*g);for(k=1;k<i;k++){h.lineTo(j[k].x*g,j[k].y*g)}h.lineTo(j[0].x*g,j[0].y*g);h.closePath();h.stroke()}};f.prototype.DrawSolidPolygon=function(j,i,k){if(i){var h=this.m_ctx,g=this.m_drawScale;h.beginPath();h.strokeStyle=this._color(k.color,this.m_alpha);h.fillStyle=this._color(k.color,this.m_fillAlpha);h.moveTo(j[0].x*g,j[0].y*g);for(k=1;k<i;k++){h.lineTo(j[k].x*g,j[k].y*g)}h.lineTo(j[0].x*g,j[0].y*g);h.closePath();h.fill();h.stroke()}};f.prototype.DrawCircle=function(j,i,k){if(i){var h=this.m_ctx,g=this.m_drawScale;h.beginPath();h.strokeStyle=this._color(k.color,this.m_alpha);h.arc(j.x*g,j.y*g,i*g,0,Math.PI*2,true);h.closePath();h.stroke()}};f.prototype.DrawSolidCircle=function(k,i,n,h){if(i){var g=this.m_ctx,j=this.m_drawScale,l=k.x*j,m=k.y*j;g.moveTo(0,0);g.beginPath();g.strokeStyle=this._color(h.color,this.m_alpha);g.fillStyle=this._color(h.color,this.m_fillAlpha);g.arc(l,m,i*j,0,Math.PI*2,true);g.moveTo(l,m);g.lineTo((k.x+n.x*i)*j,(k.y+n.y*i)*j);g.closePath();g.fill();g.stroke()}};f.prototype.DrawSegment=function(j,i,k){var h=this.m_ctx,g=this.m_drawScale;h.strokeStyle=this._color(k.color,this.m_alpha);h.beginPath();h.moveTo(j.x*g,j.y*g);h.lineTo(i.x*g,i.y*g);h.closePath();h.stroke()};f.prototype.DrawTransform=function(h){var g=this.m_ctx,i=this.m_drawScale;g.beginPath();g.strokeStyle=this._color(16711680,this.m_alpha);g.moveTo(h.position.x*i,h.position.y*i);g.lineTo((h.position.x+this.m_xformScale*h.R.col1.x)*i,(h.position.y+this.m_xformScale*h.R.col1.y)*i);g.strokeStyle=this._color(65280,this.m_alpha);g.moveTo(h.position.x*i,h.position.y*i);g.lineTo((h.position.x+this.m_xformScale*h.R.col2.x)*i,(h.position.y+this.m_xformScale*h.R.col2.y)*i);g.closePath();g.stroke()}})();var c;for(c=0;c<e.postDefs.length;++c){e.postDefs[c]()}delete e.postDefs;(function(){var l=navigator.userAgent.toLowerCase(),q=document.createElement("audio"),t={canvas:false,touch:!!("ontouchstart" in window),iPod:(l.search("ipod")>-1),iPhone:(l.search("iphone")>-1),iPad:(l.search("ipad")>-1),safari:(l.search("safari")>-1),ie:(l.search("msie")>-1),firefox:(l.search("firefox")>-1),android:(l.search("android")>-1),chrome:(l.search("chrome")>-1),silk:(l.search("silk")>-1),iOS:false,mobile:false,desktop:false,multitouch:false,ogg:true,m4a:true,mp3:true},s=d.settings.aspects,f={},p=0,o=0,n=0,h=false,m="";t.iOS=t.iPod||t.iPhone||t.iPad;t.mobile=t.iOS||t.android||t.silk;t.desktop=!t.mobile;if(t.touch){if(t.android){if(parseInt(l.slice(l.indexOf("android")+8))>2){t.multitouch=true}}else{t.multitouch=true}}if((q.canPlayType)&&!(!!q.canPlayType&&""!=q.canPlayType('audio/ogg; codecs="vorbis"'))){t.ogg=false;if(t.ie||!(!!q.canPlayType&&""!=q.canPlayType("audio/mp4"))){t.m4a=false}}var g=document.createElement("canvas");try{t.canvas=!!(g.getContext("2d"))}catch(r){t.canvas=!!(g.getContext)}delete g;d.settings.aspects=f;d.settings.aspects={};for(p in s){h=false;m="";for(o in s[p]){m+=" "+o;for(n in s[p][o]){if(l.search(s[p][o][n])>-1){d.settings.aspects[o]=true;h=true;break}}if(h){break}}if(!h){console.warn("This browser doesn't support any of the following: "+m)}}d.settings.supports=t})();(function(g){if(g&&!g.console){var f=g.console={};f.log=f.warn=f.error=function(){}}})(window);window.addEventListener("load",function(){if(d.settings&&d.settings.global&&(d.settings.global.autoLoad!==false)){new d.classes.game(d.settings)}},false);d.classes={};d.classes.game=(function(){var h=function(i,j){return function(k){j(i,k)}};var f=function(n,l){var j=document.createElement("div"),o=null;d.game=this;this.currentScene=undefined;this.loaded=null;this.settings=n;if(!n.aspects){n.aspects=d.settings.aspects}if(!n.supports){n.supports=d.settings.supports}if(!n.classes){n.classes=d.settings.classes}if(!n.components){n.components=d.settings.components}if(document.getElementById(n.global.rootElement||"root")){o=document.getElementById(n.global.rootElement||"root")}else{o=document.createElement("div");o.id=n.global.rootElement||"root";document.getElementsByTagName("body")[0].appendChild(o)}for(var m in n.supports){if(n.supports[m]){o.className+=" supports-"+m}}j.id="inner-"+o.id;o.appendChild(j);this.rootElement=j;this.containerElement=o;this.loadScene(n.global.initialScene);var k=this,p=null;if(n.debug){p=function(i,q){k.currentScene.trigger(i,q)}}else{p=function(i,q){k.currentScene.trigger(i,q);q.preventDefault()}}this.bindings=[];this.addEventListener(window,"keydown",p);this.addEventListener(window,"keyup",p);if(n.global.aspectRatio){p=function(t,u){var r=j;var s=n.global.aspectRatio;var v=o.offsetWidth;var q=o.offsetHeight;if(n.global.maxWidth&&(n.global.maxWidth<v)){v=n.global.maxWidth}var i=v/q;if(i>s){r.style.height=q+"px";v=q*s;r.style.width=v+"px"}else{r.style.width=v+"px";q=v/s;r.style.height=q+"px"}if(n.global.resizeFont){o.style.fontSize=Math.round(v/100)+"px"}r.style.marginTop="-"+Math.round(q/2)+"px";r.style.marginLeft="-"+Math.round(v/2)+"px";r.style.top="50%";r.style.left="50%";k.currentScene.trigger(t,u)};p("resize")}else{if(n.global.resizeFont){p=function(i,q){o.style.fontSize=parseInt(k.rootElement.offsetWidth/100)+"px";k.currentScene.trigger(i,q)};p("resize")}}this.addEventListener(window,"orientationchange",p);this.addEventListener(window,"resize",p);if(l){l(this)}createjs.Ticker.timingMode="raf";createjs.Ticker.setFPS(n.global.fps||60);this.tickWrapper=function(i){k.tick(i)};createjs.Ticker.addEventListener("tick",this.tickWrapper)};var g=f.prototype;g.tick=function(i){if(this.loadedScene){this.loadedScene.trigger("tick",i)}if(this.currentScene){this.currentScene.trigger("tick",i)}};g.loadScene=function(i,n,m,l){var j=this;this.inTransition=true;this.leavingScene=this.currentScene;if(l){this.loadNextScene(i);return}switch(n){case"fade-to-black":var k=document.createElement("div");this.rootElement.appendChild(k);k.style.width="100%";k.style.height="100%";k.style.position="absolute";k.style.zIndex="12";k.style.opacity="0";k.style.background="#000";new createjs.Tween(k.style).to({opacity:0},500).to({opacity:1},500).call(function(o){if(!this.loaded){j.loadNextScene(i,m)}j.completeSceneTransition(m)}).wait(500).to({opacity:0},500).call(function(o){j.rootElement.removeChild(k);k=undefined});break;case"instant":default:if(!this.loaded){j.loadNextScene(i,m)}this.completeSceneTransition(m)}};g.loadNextScene=function(i,k){var j=null;if(typeof i==="string"){j=this.settings.scenes[i]}else{j=i}this.loaded=i;this.loadedScene=new d.classes.scene(j,this.rootElement);console.log("Scene loaded: "+i);this.loadedScene.trigger("scene-loaded",k)};g.completeSceneTransition=function(j){var i=this.loaded;this.currentScene=this.loadedScene;this.loadedScene=null;this.loaded=false;this.inTransition=false;if(this.leavingScene){this.leavingScene.destroy();this.leavingScene=false}console.log("Scene live: "+i);this.currentScene.trigger("scene-live",j)};g.addEventListener=function(i,j,k){this.bindings[j]={element:i,event:j,callback:h(j,k)};i.addEventListener(j,this.bindings[j].callback,true)};g.destroy=function(){createjs.Ticker.removeEventListener("tick",this.tickWrapper);for(var i in this.bindings){this.bindings[i].element.removeEventListener(this.bindings[i].event,this.bindings[i].callback)}this.bindings.length=0};return f})();(function(f){f.components={};f.createComponentClass=function(i){var g=function(l,m){return function(o,n){l[m](o,n)}},h=function(l,p){var q=null,o="",n="",m=null;this.owner=l;this.listeners=[];this.publicMethods={};this.type=i.id;if(i.events){for(q in i.events){m=g(this,q);this.addListener(q,m);if(p.aliases){for(var o in p.aliases){if(p.aliases[o]===q){this.addListener(o,m)}}}}}if(i.publicMethods){for(q in i.publicMethods){n=q;if(p.aliases){for(var o in p.aliases){if(p.aliases[o]===q){n=o}}}this.addMethod(n,i.publicMethods[q])}}if(this.constructor){this.constructor(p)}},k=null,j=h.prototype;j.constructor=i.constructor;if(i.events){for(k in i.events){j[k]=i.events[k]}}if(i.methods){for(k in i.methods){if(k==="destroy"){j["___"+k]=i.methods[k]}else{j[k]=i.methods[k]}}}if(i.publicMethods){for(k in i.publicMethods){j[k]=i.publicMethods[k]}}j.toString=function(){return"[component "+this.type+"]"};j.destroy=function(){for(k in this.publicMethods){this.removeMethod(k)}this.removeListeners(this.listeners);if(this.___destroy){this.___destroy()}};j.setProperty=function(m,l){this[m]=l};j.addListeners=function(m){for(var l in m){this.addListener(m[l])}};j.removeListeners=function(m){if(!m){m=this.listeners}for(var l in m){this.removeListener(l,m[l])}};j.addListener=function(l,n){var m=n||g(this,l);this.owner.bind(l,m);this.listeners[l]=m};j.addMethod=function(m,n){var l=this;if(this.owner[m]){console.warn(owner.type+': Entity already has a method called "'+m+'". Method not added.')}else{this.owner[m]=function(){return n.apply(l,arguments)};this.publicMethods[m]=n}};j.removeListener=function(l,m){this.owner.unbind(l,m)};j.removeMethod=function(l){if(!this.owner[l]){console.warn(owner.type+': Entity does not have a method called "'+l+'".')}else{delete this.owner[l]}delete this.publicMethods[l]};f.components[i.id]=h}})(d);d.classes.entity=(function(){var f=function(k,i){var q=this,n=undefined,m=undefined,j=k||{},h=j.components||[],p=j.properties||{},o=i||{},l=o.properties||{};q.components=[];q.messages=[];q.loopCheck=[];q.unbindLater=[];q.type=j.id;this.setProperty(p);this.setProperty(l);this.bind("set-property",function(r){q.setProperty(r)});if(!q.state){q.state={}}q.lastState={};for(n in h){m=h[n];if(d.components[m.type]){q.addComponent(new d.components[m.type](q,m))}else{console.warn("Component '"+m.type+"' is not defined.",m)}}q.trigger("load")};var g=f.prototype;g.toString=function(){return"[entity "+this.type+"]"};g.addComponent=function(h){this.components.push(h);return h};g.removeComponent=function(i){for(var h in this.components){if(this.components[h]===i){this.components.splice(h,1);i.destroy();return i}}return false};g.bind=function(i,h){if(!this.messages[i]){this.messages[i]=[]}this.messages[i].push(h)};g.unbind=function(k,i){var l=false,h=0;if(this.loopCheck.length){for(h=0;h<this.loopCheck.length;h++){if(this.loopCheck[h]===k){l=true;break}}}if(l){this.unbindLater.push({event:k,func:i})}else{this.safelyUnbind(k,i)}};g.safelyUnbind=function(j,i){if(!this.messages[j]){this.messages[j]=[]}for(var h in this.messages[j]){if(this.messages[j][h]===i){this.messages[j].splice(h,1);break}}};g.trigger=function(k,m,h){var j=0,l=0;if(typeof k==="string"){return this.triggerEvent(k,m,h)}else{if(k.length){for(;j<k.length;j++){l+=this.trigger(k[j],m,h)}return l}else{if(k.event){return this.triggerEvent(k.event,k.message||m,h)}else{console.warn('Event incorrectly formatted: must be string, array, or object containing an "event" property.');return 0}}}};g.triggerEvent=function(m,n,h){var l=0,k=0;if(this.debug||h||(n&&n.debug)){if(this.messages[m]&&this.messages[m].length){console.log('Entity "'+this.type+'": Event "'+m+'" has '+this.messages[m].length+" subscriber"+((this.messages[m].length>1)?"s":"")+".",n)}else{console.warn('Entity "'+this.type+'": Event "'+m+'" has no subscribers.',n)}}for(l=0;l<this.loopCheck.length;l++){if(this.loopCheck[l]===m){throw"Endless loop detected for '"+m+"'."}}l=0;this.loopCheck.push(m);if(this.messages[m]){for(l=0;l<this.messages[m].length;l++){this.messages[m][l](n,h)}}this.loopCheck.length=this.loopCheck.length-1;if(!this.loopCheck.length&&this.unbindLater.length){for(k=0;k<this.unbindLater.length;k++){this.safelyUnbind(this.unbindLater[k].event,this.unbindLater[k].func)}this.unbindLater.length=0}return l};g.setProperty=function(i){var h="";for(h in i){this[h]=i[h]}};g.getMessageIds=function(){var h=[];for(var i in this.messages){h.push(i)}return h};g.destroy=function(){for(var h in this.components){this.components[h].destroy()}this.components.length=0};return f})();d.classes.scene=(function(){var g=function(k,h){var n=k.layers,o=true,r=false,q=false,l=null;this.storedMessages=[];this.rootElement=h;this.layers=[];for(var p in n){r=n[p];q={rootElement:this.rootElement,parent:this};if(r.properties){for(m in r.properties){q[m]=r.properties[m]}}if(r.type){r=d.game.settings.entities[r.type]}o=true;if(r.filter){if(r.filter.includes){o=false;for(var j in r.filter.includes){if(d.game.settings.supports[r.filter.includes[j]]){o=true}}}if(r.filter.excludes){for(var j in r.filter.excludes){if(d.game.settings.supports[r.filter.excludes[j]]){o=false}}}}if(o){this.layers.push(new d.classes.entity(r,{properties:q}))}}l=this.storedMessages;this.storedMessages=false;for(var m=0;m<l.length;m++){this.trigger(l[m].message,l[m].value)}l.length=0;this.time=new Date().getTime();this.timeElapsed={name:"",time:0}};var f=g.prototype;f.trigger=function(i,j){var k=0;if(this.storedMessages){this.storedMessages.push({message:i,value:j})}else{if(i==="tick"){k=new Date().getTime();this.timeElapsed.name="Non-Engine";this.timeElapsed.time=k-this.time;this.trigger("time-elapsed",this.timeElapsed);this.time=k}for(var h in this.layers){this.layers[h].trigger(i,j)}if(i==="tick"){k=new Date().getTime();this.timeElapsed.name="Engine Total";this.timeElapsed.time=k-this.time;this.trigger("time-elapsed",this.timeElapsed);this.time=k}}};f.destroy=function(){for(var h in this.layers){this.layers[h].destroy()}this.layers.length=0};return g})();d.classes.collisionShape=(function(){var f=function(i,j,l){var n=j.regX,m=j.regY;this.owner=i;this.collisionType=l;this.width=j.width||j.radius||0;this.height=j.height||j.radius||0;this.radius=j.radius||0;if(typeof n!=="number"){n=this.width/2}if(typeof m!=="number"){m=this.height/2}this.offsetX=j.offsetX||((this.width/2)-n);this.offsetY=j.offsetY||((this.height/2)-m);if(i){this.x=i.x+this.offsetX;this.y=i.y+this.offsetY}else{this.x=j.x+this.offsetX;this.y=j.y+this.offsetY}this.type=j.type||"rectangle";this.subType="";this.points=j.points;this.aABB=undefined;var k=0;var h=0;switch(this.type){case"circle":k=h=this.radius*2;break;case"rectangle":k=this.width;h=this.height;break;case"triangle":if(this.points[0][1]==this.points[1][1]&&this.points[0][0]==this.points[2][0]){if(this.points[0][0]<this.points[1][0]){this.subType="tl";k=this.points[1][0]-this.points[0][0];h=this.points[2][1]-this.points[0][1]}else{this.subType="br";k=this.points[0][0]-this.points[1][0];h=this.points[0][1]-this.points[2][1]}}else{if(this.points[0][1]==this.points[2][1]&&this.points[0][0]==this.points[1][0]){if(this.points[0][1]<this.points[1][1]){this.subType="tr";k=this.points[0][0]-this.points[2][0];h=this.points[1][1]-this.points[0][1]}else{this.subType="bl";k=this.points[2][0]-this.points[0][0];h=this.points[0][1]-this.points[1][1]}}}}this.aABB=new d.classes.aABB(this.x,this.y,k,h)};var g=f.prototype;g.update=function(i,h){this.x=i+this.offsetX;this.y=h+this.offsetY;this.aABB.move(this.x,this.y)};g.moveX=function(h){this.x=h;this.aABB.moveX(this.x)};g.moveY=function(h){this.y=h;this.aABB.moveY(this.y)};g.moveXBy=function(h){this.x+=h;this.aABB.moveX(this.x)};g.moveYBy=function(h){this.y+=h;this.aABB.moveY(this.y)};g.getXY=function(){return[this.x,this.y]};g.getX=function(){return this.x};g.getY=function(){return this.y};g.getAABB=function(){return this.aABB};g.getXOffset=function(){return this.offsetX};g.getYOffset=function(){return this.offsetY};g.setXWithEntityX=function(h){this.x=h+this.offsetX;this.aABB.moveX(this.x)};g.setYWithEntityY=function(h){this.y=h+this.offsetY;this.aABB.moveY(this.y)};g.destroy=function(){this.aABB=undefined;this.points=undefined};return f})();d.classes.collisionData=(function(){var g=function(j,n,h,l,o,m,k,i){this.occurred=j||false;this.direction=n||null;this.position=h||null;this.deltaMovement=l||null;this.aABB=o||null;this.thisShape=m||null;this.thatShape=k||null;this.vector=i||null};var f=g.prototype;f.copy=function(h){this.occurred=h.occurred;this.direction=h.direction;this.position=h.position;this.deltaMovement=h.deltaMovement;this.aABB=h.aABB;this.thisShape=h.thisShape;this.thatShape=h.thatShape;this.vector=h.vector};f.clear=function(){this.occurred=false;this.direction=null;this.position=null;this.deltaMovement=null;this.aABB=null;this.thisShape=null;this.thatShape=null;this.vector=null};return g})();d.classes.collisionDataContainer=(function(){var f=function(){this.xData=[new d.classes.collisionData(),new d.classes.collisionData()];this.yData=[new d.classes.collisionData(),new d.classes.collisionData()];this.xCount=0;this.yCount=0;this.xDeltaMovement=Infinity;this.yDeltaMovement=Infinity};var g=f.prototype;g.getXEntry=function(h){return this.xData[h]};g.getYEntry=function(h){return this.yData[h]};g.tryToAddX=function(h){if(h.deltaMovement<this.xDeltaMovement){this.xDeltaMovement=h.deltaMovement;this.xData[0].copy(h);this.xCount=1;return true}else{if(h.deltaMovement==this.xDeltaMovement){this.ensureRoomX();this.xData[this.xCount].copy(h);this.xCount++;return true}}return false};g.tryToAddY=function(h){if(h.deltaMovement<this.yDeltaMovement){this.yDeltaMovement=h.deltaMovement;this.yData[0].copy(h);this.yCount=1;return true}else{if(h.deltaMovement==this.yDeltaMovement){this.ensureRoomY();this.yData[this.yCount].copy(h);this.yCount++;return true}}return false};g.ensureRoomX=function(){var i=this.xData.length*2;if(this.xData.length<=this.xCount){for(var h=this.xData.length;h<i;h++){this.xData[h]=new d.classes.collisionData()}}};g.ensureRoomY=function(){var i=this.yData.length*2;if(this.yData.length<=this.yCount){for(var h=this.yData.length;h<i;h++){this.yData[h]=new d.classes.collisionData()}}};g.reset=function(){this.xCount=0;this.yCount=0;this.xDeltaMovement=Infinity;this.yDeltaMovement=Infinity};return f})();d.classes.aABB=(function(){var g=function(i,k,j,h){this.empty=true;this.setAll(i,k,j,h)};var f=g.prototype;f.setAll=function(i,k,j,h){this.empty=false;this.x=i;this.y=k;this.width=j||0;this.height=h||0;this.halfWidth=this.width/2;this.halfHeight=this.height/2;if(typeof i==="undefined"){this.empty=true}else{this.left=-this.halfWidth+this.x;this.right=this.halfWidth+this.x}if(typeof k==="undefined"){this.empty=true}else{this.top=-this.halfHeight+this.y;this.bottom=this.halfHeight+this.y}return this};f.set=function(h){this.empty=h.empty;this.x=h.x;this.y=h.y;this.width=h.width;this.height=h.height;this.halfWidth=h.halfWidth;this.halfHeight=h.halfHeight;this.left=h.left;this.right=h.right;this.top=h.top;this.bottom=h.bottom;return this};f.reset=function(){this.empty=true;return this};f.include=function(h){if(h){if(this.empty){this.set(h)}else{if(this.left>h.left){this.left=h.left}if(this.right<h.right){this.right=h.right}if(this.top>h.top){this.top=h.top}if(this.bottom<h.bottom){this.bottom=h.bottom}this.width=this.right-this.left;this.height=this.bottom-this.top;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=this.left+this.halfWidth;this.y=this.top+this.halfHeight}}};f.move=function(h,i){this.moveX(h);this.moveY(i);return this};f.moveX=function(h){this.x=h;this.left=-this.halfWidth+this.x;this.right=this.halfWidth+this.x;return this};f.moveY=function(h){this.y=h;this.top=-this.halfHeight+this.y;this.bottom=this.halfHeight+this.y;return this};f.moveXBy=function(h){this.x+=h;this.left=-this.halfWidth+this.x;this.right=this.halfWidth+this.x;return this};f.moveYBy=function(h){this.y+=h;this.top=-this.halfHeight+this.y;this.bottom=this.halfHeight+this.y;return this};f.getCopy=function(){return new g(this.x,this.y,this.width,this.height)};f.matches=function(i,k,j,h){return !((this.x!==i)||(this.y!==k)||(this.width!==j)||(this.height!==h))};f.contains=function(h){return !((h.top<this.top)||(h.bottom>this.bottom)||(h.left<this.left)||(h.right>this.right))};f.intersects=function(h){return !((h.bottom<this.top)||(h.top>this.bottom)||(h.right<this.left)||(h.left>this.right))};return g})();d.classes.vector2D=(function(){var f=function(h,i){this.x=h||0;this.y=i||0};var g=f.prototype;g.set=function(h,i){this.x=h;this.y=i;return this};g.copyValues=function(h){this.x=h.x;this.y=h.y;return this};g.setX=function(h){this.x=h;return this};g.setY=function(h){this.y=h;return this};g.getX=function(){return this.x};g.getY=function(){return this.y};g.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))};g.direction=function(){var h=this.magnitude();var i=0;if(h!=0){i=Math.acos(this.x/h);if(this.y<0){i=(Math.PI*2)-i}}return i};g.getUnit=function(){var h=this.magnitude();if(h==0){return new d.classes.vector2D(0,0)}else{return new d.classes.vector2D(this.x/h,this.y/h)}};g.getInverse=function(){return new d.classes.vector2D(-this.x,-this.y)};g.normalize=function(){var h=this.magnitude();if(h!=0){this.x/=h;this.y/=h}return this};g.rotate=function(i){var h=this.x;var j=this.y;this.x=h*Math.cos(i)-j*Math.sin(i);this.y=h*Math.sin(i)+j*Math.cos(i);return this};g.add=function(h,i){this.x+=h;this.y+=i;return this};g.addVector=function(h){this.x+=h.x;this.y+=h.y;return this};g.subtractVector=function(h){this.x-=h.x;this.y-=h.y;return this};g.scale=function(h){this.x*=h;this.y*=h;return this};g.dot=function(h){return this.x*h.x+this.y*h.y};g.shortestAngleTo=function(h){return Math.acos(this.dot(h)/(this.magnitude()*h.magnitude()))};g.scalarProjection=function(i){var j=0;var h=null;if(typeof i=="number"){j=i}else{h=i;j=this.shortestAngleTo(h)}return this.magnitude()*Math.cos(j)};g.copy=function(){return new f(this.x,this.y)};return f})();d.components={};(function(){return d.createComponentClass({id:"asset-loader",constructor:function(f){this.useXHR=true;if(f.useXHR===false){this.useXHR=false}this.assets=f.assets||d.game.settings.assets;this.progressBar=f.progressBar||false;this.message={complete:false,total:0,progress:0,fraction:0}},events:{load:function(){var p=this,f=function(q,s){var j=0,r=false;for(j in s){if(s[j].id===q.id){r=true;break}}if(!r){s.push(q)}},n=new createjs.LoadQueue(this.useXHR),m=[],o=d.game.settings.global.nativeAssetResolution||0,h=d.game.settings.scale=o?Math.min(1,Math.max(window.screen.width,window.screen.height)*(window.devicePixelRatio||1)/o):1,g=function(s,j,x){var i=x||1,t=j||1,u=Math.ceil((s.width/t)*h)*t,v=Math.ceil((s.height/i)*h)*i,q=document.createElement("canvas"),w=q.getContext("2d");q.width=u;q.height=v;q.scaleX=u/s.width;q.scaleY=v/s.height;w.drawImage(s,0,0,s.width,s.height,0,0,u,v);return q};n.addEventListener("fileload",function(q){var j=q.item,r=j.data,i=j.tag;if(q.item.type=="image"){if(o&&(h!==1)){if(r){i=g(i,r.columns,r.rows)}else{i=g(i)}}}d.assets[q.item.id]=i;p.message.progress+=1;p.message.fraction=p.message.progress/p.message.total;if(p.message.progress===p.message.total){p.message.complete=true}p.owner.trigger("fileload",p.message)});n.addEventListener("complete",function(i){p.owner.trigger("complete")});for(var l in this.assets){if(typeof this.assets[l].src==="string"){f(this.assets[l],m)}else{for(var k in this.assets[l].src){if(d.game.settings.aspects[k]&&this.assets[l].src[k]){if(typeof this.assets[l].src[k]==="string"){this.assets[l].src=this.assets[l].src[k];f(this.assets[l],m)}else{this.assets[l].data=this.assets[l].src[k].data||this.assets[l].data;this.assets[l].assetId=this.assets[l].src[k].assetId;this.assets[l].src=this.assets[l].src[k].src;f({id:this.assets[l].assetId||this.assets[l].id,src:this.assets[l].src},m)}break}}if(typeof this.assets[l].src!=="string"){if(this.assets[l].src["default"]){if(typeof this.assets[l].src["default"]==="string"){this.assets[l].src=this.assets[l].src["default"];f(this.assets[l],m)}else{this.assets[l].data=this.assets[l].src["default"].data||this.assets[l].data;this.assets[l].assetId=this.assets[l].src["default"].assetId;this.assets[l].src=this.assets[l].src["default"].src;f({id:this.assets[l].assetId||this.assets[l].id,src:this.assets[l].src},m)}}else{console.warn("Asset has no valid source for this browser.",this.assets[l])}}}}createjs.HTMLAudioPlugin.isSupported=function(){createjs.HTMLAudioPlugin.generateCapabilities();var i=createjs.HTMLAudioPlugin.tag;if(i==null||createjs.HTMLAudioPlugin.capabilities==null){return false}return true};createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);p.message.total=m.length;n.installPlugin(createjs.Sound);n.loadManifest(m);d.assets=[]},fileload:function(g){var f=null;if(this.progressBar){f=document.getElementById(this.progressBar);if(f){f=f.style;f.width=(g.fraction*100)+"%";f.backgroundSize=((1/g.fraction)*100)+"%"}}}}})})();d.components["enable-ios-audio"]=(function(){var i=false,g=function(j,l){var k=this;this.owner=j;if(!i){this.touchOverlay=document.createElement("div");this.touchOverlay.style.width="100%";this.touchOverlay.style.height="100%";this.touchOverlay.style.position="absolute";this.touchOverlay.style.zIndex="20";this.owner.rootElement.appendChild(this.touchOverlay);f(this.touchOverlay,l.audioId,function(){k.removeComponent()})}else{this.removeComponent()}},f=function(k,j,m){var n=false,l=false;i=true;l=function(r){var q=createjs.Sound.play(j),p=function(){q.removeEventListener("succeeded",p);q.pause()},o=function(){q.removeEventListener("ready",o);if(n){n()}};if(q.playState!=="playFailed"){q.stop()}else{q.addEventListener("succeeded",p);q.addEventListener("ready",o);try{q.play()}catch(r){n=function(){console.log("i");n=false;q.play()}}}k.removeEventListener("touchstart",l,false);if(m){m()}};k.addEventListener("touchstart",l,false)},h=g.prototype;h.removeComponent=function(){this.owner.removeComponent(this)};h.destroy=function(){if(this.touchOverlay){this.owner.rootElement.removeChild(this.touchOverlay)}this.touchOverlay=undefined};return g})();(function(){var f={entity:null,type:null,x:0,y:0,hitType:null,myType:null},i={x:0,y:0,relative:false},k=function(l){l.x=0;l.y=0;l.relative=false},h=new d.classes.collisionDataContainer(),j=function(m,l){if(m.left>=l.right){return false}if(m.right<=l.left){return false}if(m.top>=l.bottom){return false}if(m.bottom<=l.top){return false}return true},g=function(o,n){var p=0;var s=0;var l=undefined;var r=undefined;var u=0;var t=0;var q=undefined;var m=0;if(o.type=="rectangle"&&n.type=="rectangle"){return true}else{if(o.type=="circle"&&n.type=="circle"){p=Math.pow((o.x-n.x),2)+Math.pow((o.y-n.y),2);s=Math.pow((o.radius+n.radius),2);if(p<=s){return true}}else{if(o.type=="circle"&&n.type=="rectangle"||o.type=="rectangle"&&n.type=="circle"){if(o.type=="circle"){l=o;r=n}else{l=n;r=o}q=r.getAABB();u=Math.abs(l.x-r.x);t=Math.abs(l.y-r.y);if(u>=(q.halfWidth+l.radius)){return false}if(t>=(q.halfHeight+l.radius)){return false}if(u<(q.halfWidth)){return true}if(t<(q.halfHeight)){return true}m=Math.pow((u-q.halfWidth),2)+Math.pow((t-q.halfHeight),2);if(m<Math.pow(l.radius,2)){return true}}}}return false};return d.createComponentClass({id:"handler-collision",constructor:function(l){this.entitiesByType={};this.entitiesByTypeLive={};this.solidEntities=[];this.solidEntitiesLive=[];this.softEntities=[];this.softEntitiesLive=[];this.allEntities=[];this.allEntitiesLive=[];this.groupsLive=[];this.nonColliders=[];this.terrain=undefined;this.aabb=new d.classes.aABB(this.owner.x,this.owner.y);this.prevAABB=new d.classes.aABB(this.owner.x,this.owner.y);this.owner.previousX=this.owner.previousX||this.owner.x;this.owner.previousY=this.owner.previousY||this.owner.y;this.updateLiveList=true;this.cameraLogicAABB=new d.classes.aABB(0,0);this.cameraCollisionAABB=new d.classes.aABB(0,0);this.timeElapsed={name:"Col",time:0}},events:{"child-entity-added":function(l){this["add-collision-entity"](l)},"add-collision-entity":function(n){var p=0,o=n.collisionTypes,l=false,m=false;if((n.type=="tile-layer")||(n.type=="collision-layer")){this.terrain=n;this.updateLiveList=true}else{if(o){for(;p<o.length;p++){if(!this.entitiesByType[o[p]]){this.entitiesByType[o[p]]=[];this.entitiesByTypeLive[o[p]]=[]}this.entitiesByType[o[p]][this.entitiesByType[o[p]].length]=n;if(n.solidCollisions[o[p]].length&&!n.immobile){l=true}if(n.softCollisions[o[p]].length){m=true}}if(l&&!n.immobile){this.solidEntities[this.solidEntities.length]=n}if(m){this.softEntities[this.softEntities.length]=n}this.allEntities[this.allEntities.length]=n;this.updateLiveList=true}}},"child-entity-removed":function(l){this["remove-collision-entity"](l)},"remove-collision-entity":function(o){var l=0,r=0,p=0,q=o.collisionTypes,m=false,n=false;if(q){for(;r<q.length;r++){for(l in this.entitiesByType[q[r]]){if(this.entitiesByType[q[r]][l]===o){this.entitiesByType[q[r]].splice(l,1);break}}if(o.solidCollisions[q[r]].length){m=true}if(o.softCollisions[q[r]].length){n=true}}if(m){for(l in this.solidEntities){if(this.solidEntities[l]===o){this.solidEntities.splice(l,1);break}}}if(n){for(l in this.softEntities){if(this.softEntities[l]===o){this.softEntities.splice(l,1);break}}}for(p=0;p<this.allEntities.length;p++){if(this.allEntities[p]===o){this.allEntities.splice(p,1);break}}this.updateLiveList=true}},"check-collision-group":function(m){var l=new Date().getTime();if(m.camera){this.checkCamera(m.camera)}this.timeElapsed.name="Col-Cam";this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);l+=this.timeElapsed.time;this.prepareCollisions(m);this.timeElapsed.name="Col-Prep";this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);l+=this.timeElapsed.time;this.checkGroupCollisions();this.timeElapsed.name="Col-Group";this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);l+=this.timeElapsed.time;this.checkSolidCollisions();this.timeElapsed.name="Col-Solid";this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);l+=this.timeElapsed.time;this.resolveNonCollisions(m);this.timeElapsed.name="Col-None";this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);l+=this.timeElapsed.time;this.checkSoftCollisions(m);this.timeElapsed.name="Col-Soft";this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);l+=this.timeElapsed.time}},methods:{checkCamera:(function(){var l=function(n,m){return n.collisionGroup.getAllEntities()-m.collisionGroup.getAllEntities()};return function(G,B){var E=0,D=0,o=0,H=null,m=null,K=null,q=null,C=G.width,z=G.height,u=G.left+C/2,s=G.top+z/2,J=G.bufferLeft,r=G.bufferRight,A=G.bufferTop,t=G.bufferBottom,n=undefined,w=undefined,I=j,p=this.cameraLogicAABB,F=this.cameraCollisionAABB,v=null;C+=J+r;z+=A+t;if(this.updateLiveList||!p.matches(u,s,C,z)){p.setAll(u,s,C,z);if(this.updateLiveList||!F.contains(p)){this.updateLiveList=false;m=this.allEntitiesLive;m.length=0;q=this.solidEntitiesLive;q.length=0;K=this.softEntitiesLive;K.length=0;groups=this.groupsLive;groups.length=0;o=this.allEntities.length;for(E=0;E<o;E++){w=this.allEntities[E];if(w.alwaysOn||w.checkCollision||I(w.getAABB(),p)){w.checkCollision=false;m[m.length]=w;v=w.collisionTypes;if(w!==this.owner){if(!w.immobile){for(D=0;D<v.length;D++){if(w.solidCollisions[v[D]].length){q[q.length]=w;break}}}}for(D=0;D<v.length;D++){if(w.softCollisions[v[D]].length){K[K.length]=w;break}}if(w.collisionGroup){groups.push(w)}}}groups.sort(l);F.setAll(u,s,C+J+r,z+A+t);for(E in this.entitiesByType){n=this.entitiesByType[E];H=this.entitiesByTypeLive[E];H.length=0;o=n.length;for(D=0;D<o;D++){w=n[D];if(w.alwaysOn||I(w.getAABB(),F)){H[H.length]=w}}}}}}})(),prepareCollisions:function(n){var m=null;this.nonColliders.length=0;for(var l=this.allEntitiesLive.length-1;l>-1;l--){m=this.allEntitiesLive[l];m.triggerEvent("prepare-for-collision",n);if(!m.collides){this.nonColliders.push(m)}}},resolveNonCollisions:function(o){var m=null,n=i;n.relative=false;for(var l=this.nonColliders.length-1;l>-1;l--){m=this.nonColliders[l];n.x=m.x;n.y=m.y;m.trigger("relocate-entity",n)}},checkGroupCollisions:(function(){var l=function(o,r,p,q,m,t,s,n){f.entity=r;f.myType=p;f.type=q;f.x=m;f.y=t;f.direction=n;f.hitType=s;o.triggerEvent("hit-by-"+q,f);if(r){f.entity=o;f.type=p;f.myType=q;f.x=-m;f.y=-t;f.direction=n.getInverse();f.hitType=s;r.triggerEvent("hit-by-"+p,f)}};return function(){var o=this.groupsLive;for(var m=o.length-1;m>-1;m--){if(o[m].collisionGroup.getSize()>1){h.reset();k(i);i=this.checkSolidEntityCollision(o[m],o[m].collisionGroup,h,i);for(var n=0;n<h.xCount;n++){messageData=h.getXEntry(n);l(messageData.thisShape.owner,messageData.thatShape.owner,messageData.thisShape.collisionType,messageData.thatShape.collisionType,messageData.direction,0,"solid",messageData.vector)}for(n=0;n<h.yCount;n++){messageData=h.getYEntry(n);l(messageData.thisShape.owner,messageData.thatShape.owner,messageData.thisShape.collisionType,messageData.thatShape.collisionType,0,messageData.direction,"solid",messageData.vector)}}}}})(),checkSolidCollisions:(function(){var l=function(o,r,p,q,m,t,s,n){f.entity=r;f.myType=p;f.type=q;f.x=m;f.y=t;f.direction=n;f.hitType=s;o.triggerEvent("hit-by-"+q,f);if(r){f.entity=o;f.type=p;f.myType=q;f.x=-m;f.y=-t;f.direction=n.getInverse();f.hitType=s;r.triggerEvent("hit-by-"+p,f)}};return function(){var o=null,p=this.solidEntitiesLive;for(var m=p.length-1;m>-1;m--){h.reset();k(i);i=this.checkSolidEntityCollision(p[m],p[m],h,i);for(var n=0;n<h.xCount;n++){o=h.getXEntry(n);l(o.thisShape.owner,o.thatShape.owner,o.thisShape.collisionType,o.thatShape.collisionType,o.direction,0,"solid",o.vector)}for(n=0;n<h.yCount;n++){o=h.getYEntry(n);l(o.thisShape.owner,o.thatShape.owner,o.thisShape.collisionType,o.thatShape.collisionType,0,o.direction,"solid",o.vector)}}}})(),checkSolidEntityCollision:function(w,x,t,z){var y=0,p=0,q=z,n=w.x-w.previousX,l=w.y-w.previousY,v=null,s=0,r=0,o=Infinity,B=Infinity,m=x.getCollisionTypes(),A=false;if(x.getSolidEntities){A=x.getSolidEntities()}q.x=w.x;q.y=w.y;if(n||l){if(w.bullet){for(var u in m){v=x.getAABB(m[u]);o=Math.min(o,v.width);B=Math.min(B,v.height)}y=Math.ceil(Math.max(Math.abs(n)/o,Math.abs(l)/B));y=Math.min(y,100);s=n/y;r=l/y}else{y=1;s=n;r=l}for(p=0;p<y;p++){x.prepareCollision(w.previousX+s,w.previousY+r);q.x=w.x;q.y=w.y;q=this.processCollisionStep(w,x,A,t,q,s,r,m);if((q.x===w.previousX)&&(q.y===w.previousY)){x.relocateEntity(q.x,q.y,t);break}else{x.relocateEntity(q.x,q.y,t)}}}return q},processCollisionStep:(function(){var l=new d.classes.aABB(),m=function(o,n,r,t,s){var q=r.getAABB(t);if(r===o){return false}else{if(r.jumpThrough&&(n.bottom>q.top)){return false}else{if(o.jumpThrough&&(q.bottom>n.top)){return false}else{if(s){for(var p=0;p<s.length;p++){if(r===s[p]){return false}}}}}}return true};return function(I,r,H,t,G,K,J,N){var o=false;var n=[];var x=null;var M=null;var C=null;var s=null;var D="";var v=null;var F=this.getWorldEntities();var L=null;var p=this.getWorldTerrain(),A=r.getSolidCollisions();if(!r.jumpThrough||(J>=0)){for(var E=0;E<N.length;E++){n[E]=[];C=N[E];x=r.getPreviousAABB(C);M=r.getAABB(C);l.reset();l.include(M);l.include(x);for(var w=0;w<A[C].length;w++){D=A[C][w];if(F[D]){L=F[D];for(var u=0;u<L.length;u++){s=L[u];if(m(I,x,s,D,H)&&(j(l,s.getAABB(D)))){v=s.getShapes(D);for(var B=0;B<v.length;B++){n[E].push(v[B])}o=true}}}else{if(p&&(D==="tiles")){v=p.getTileShapes(l,x);for(var B=0;B<v.length;B++){n[E].push(v[B]);o=true}}}}}if(o){G=this.resolveCollisionPosition(I,r,G,n,t,N,K,J)}}return G}})(),resolveCollisionPosition:(function(){var l=new d.classes.collisionData();return function(s,t,p,u,r,n,o,m){if(o!=0){for(var q=0;q<n.length;q++){l.clear();l=this.findMinAxisMovement(s,t,n[q],"x",u[q],l);if(l.occurred){r.tryToAddX(l)}}}if(r.xCount>0){l.copy(r.getXEntry(0));p.x=s.previousX+l.deltaMovement*l.direction}else{p.x=s.x}t.movePreviousX(p.x);if(m!=0){for(var q=0;q<n.length;q++){l.clear();l=this.findMinAxisMovement(s,t,n[q],"y",u[q],l);if(l.occurred){r.tryToAddY(l)}}}if(r.yCount>0){l.copy(r.getYEntry(0));p.y=s.previousY+l.deltaMovement*l.direction}else{p.y=s.y}return p}})(),findMinAxisMovement:(function(){var l=new d.classes.collisionData();return function(s,t,o,n,u,r){var m=t.getShapes(o);var q=t.getPrevShapes(o);for(var p=0;p<m.length;p++){l.clear();l=this.findMinShapeMovementCollision(q[p],m[p],n,u,l);if(l.occurred&&!r.occurred){r.copy(l)}else{if(l.occurred&&r.occurred&&(l.deltaMovement<r.deltaMovement)){r.copy(l)}}}return r}})(),findMinShapeMovementCollision:(function(){var m=function(t,s,n,p,r,q,o){t.occurred=true;t.direction=s;t.position=n;t.deltaMovement=Math.abs(n-p);t.aABB=q.getAABB();t.thisShape=r;t.thatShape=q;t.vector=o.copy()},l=(function(){var n=new d.classes.vector2D(),q={position:0,contactVector:n},t=function(v,u){return Math.sqrt(Math.pow(u,2)-Math.pow(v,2))},p=function(w,u,v){var x=w-u;return x-(x/Math.abs(x))*v},r=function(u,v,w){if(u==="x"){return w.halfWidth+v.halfWidth}else{if(u==="y"){return w.halfHeight+v.halfHeight}}},s=function(v,y,w,u,x){var z=0;if(v==="x"){if(y.y>=w.aABB.top&&y.y<=w.aABB.bottom){return w.aABB.halfWidth+y.radius}else{n.y=p(y.y,w.y,w.aABB.halfHeight);z=w.aABB.halfWidth+t(n.y,y.radius);if(u===y){n.x=-p(y.x-x*z,w.x,w.aABB.halfWidth)/2;n.y=-n.y}else{n.x=p(y.x,w.x-x*z,w.aABB.halfWidth)/2}n.normalize();return z}}else{if(v==="y"){if(y.x>=w.aABB.left&&y.x<=w.aABB.right){return w.aABB.halfHeight+y.radius}else{n.x=p(y.x,w.x,w.aABB.halfWidth);z=w.aABB.halfHeight+t(n.x,y.radius);if(u===y){n.x=-n.x;n.y=-p(y.y-x*z,w.y,w.aABB.halfWidth)/2}else{n.y=p(y.y,w.y-x*z,w.aABB.halfWidth)/2}n.normalize();return z}}}},o=function(u,w,v){if(u==="x"){return t(w.y-v.y,w.radius+v.radius)}else{if(u==="y"){return t(w.x-v.x,w.radius+v.radius)}}};return function(u,x,w,v){if(w.type=="rectangle"){if(v.type=="rectangle"){q.position=v[u]-x*r(u,w.getAABB(),v.getAABB());n.x=0;n.y=0;n[u]=x;return q}else{if(v.type=="circle"){n.x=0;n.y=0;n[u]=x;q.position=v[u]-x*s(u,v,w,w,x);return q}}}else{if(w.type=="circle"){if(v.type=="rectangle"){n.x=0;n.y=0;n[u]=x;q.position=v[u]-x*s(u,w,v,w,x);return q}else{if(v.type=="circle"){q.position=v[u]-x*o(u,w,v);n.x=v.x-w.x;n.y=v.y-w.y;n[u]=v[u]-q.position;n.normalize();return q}}}}}})();return function(q,t,p,u,n){var y=q[p];var w=t[p];var o=q;var v=(y<w)?1:-1;var s=w;var x=null;var z=w;if(y!=w){if(p==="x"){o.moveX(w)}else{if(p==="y"){o.moveY(w)}}for(var r=0;r<u.length;r++){s=w;if(j(o.getAABB(),u[r].getAABB())){if(g(o,u[r])){x=l(p,v,o,u[r]);s=x.position;if(v>0){if(s<z){if(s<y){s=y}z=s;m(n,v,z,y,t,u[r],x.contactVector)}}else{if(s>z){if(s>y){s=y}z=s;m(n,v,z,y,t,u[r],x.contactVector)}}}}}}return n}})(),checkSoftCollisions:function(r){var l=undefined,D=undefined,q=f,C=0,A=0,v=0,p=0,o=0,m=0,s=j,w=null,E=null,u=null,t=null,n=null,F=false,B=this.getWorldEntities();q.x=0;q.y=0;for(p=0;p<this.softEntitiesLive.length;p++){D=this.softEntitiesLive[p];for(C=0;C<D.collisionTypes.length;C++){w=D.softCollisions[D.collisionTypes[C]];for(o=0;o<w.length;o++){u=w[o];E=B[u];if(E){for(m=0;m<E.length;m++){F=false;l=E[m];if((l!==D)&&(s(D.getAABB(D.collisionTypes[C]),l.getAABB(u)))){t=D.getShapes(D.collisionTypes[C]);n=l.getShapes(u);for(A=0;A<t.length;A++){for(v=0;v<n.length;v++){if(g(t[A],n[v])){q.entity=l;q.type=u;q.myType=D.collisionTypes[C];q.shape=n[v];q.hitType="soft";D.trigger("hit-by-"+u,q);q.debug=false;F=true}if(F){break}}if(F){break}}}}}}}}},destroy:function(){this.solidEntities.length=0;this.softEntities.length=0;for(var l in this.entitiesByType){this.entitiesByType[l].length=0}}},publicMethods:{getWorldEntities:function(){return this.entitiesByTypeLive},getWorldTerrain:function(){return this.terrain}}})})();(function(){var l=e.Common.Math.b2Vec2,f=e.Dynamics.b2BodyDef,k=e.Dynamics.b2Body,g=e.Dynamics.b2FixtureDef,i=e.Dynamics.b2Fixture,n=e.Dynamics.b2World,o=e.Collision.Shapes.b2MassData,h=e.Collision.Shapes.b2PolygonShape,m=e.Collision.Shapes.b2CircleShape,j=e.Dynamics.b2DebugDraw;return d.createComponentClass({id:"handler-box2d",constructor:function(q){var t=q.gravity||{x:0,y:10};var s=(typeof q.allowSleep!=="undefined")?q.allowSleep:true;this.simulationFrequency=q.simulationFrequency||1/d.game.settings.global.fps||1/60;this.velocityIterations=q.velocityIterations||10;this.positionIterations=q.positionIterations||10;this.entities=[];var p=0;if(q.debugCanvas&&q.debugCanvas.flags){if(q.debugCanvas.flags.e_aabbBit){p|=j.e_aabbBit}if(q.debugCanvas.flags.e_centerOfMassBit){p|=j.e_centerOfMassBit}if(q.debugCanvas.flags.e_centerOfMassBit){p|=j.e_controllerBit}if(q.debugCanvas.flags.e_jointBit){p|=j.e_jointBit}if(q.debugCanvas.flags.e_pairBit){p|=j.e_pairBit}if(q.debugCanvas.flags.e_shapeBit){p|=j.e_shapeBit}}if(typeof q.debugCanvas==="undefined"){q.debugCanvas={}}var r={id:q.debugCanvas.id||"box2D-debug-canvas",drawScale:q.debugCanvas.drawScale||30,fillAlpha:(typeof q.debugCanvas.fillAlpha!=="undefined")?q.debugCanvas.fillAlpha:0.3,lineThickness:q.debugCanvas.lineThickness||1,flags:(q.debugCanvas.flags)?p:(j.e_shapeBit|j.e_jointBit)};this.world=new n(new l(t.x,t.y),s);this.debugCanvas=document.createElement("canvas");this.debugCanvas.id=r.id;this.ctx=this.debugCanvas.getContext("2d");this.owner.rootElement.appendChild(this.debugCanvas);this.debugDraw=new j();this.debugDraw.SetSprite(document.getElementById(r.id).getContext("2d"));this.debugDraw.SetDrawScale(r.drawScale);this.debugDraw.SetFillAlpha(r.fillAlpha);this.debugDraw.SetLineThickness(r.lineThickness);this.debugDraw.SetFlags(r.flags);this.world.SetDebugDraw(this.debugDraw)},events:{"child-entity-added":function(q){var s=q.getMessageIds();var r={world:this.world,drawScale:this.debugDraw.GetDrawScale()};for(var p=0;p<s.length;p++){if(s[p]=="connect-box2D"){this.entities.push(q);q.trigger("connect-box2D",r);break}}},tick:function(q){this.world.Step(this.simulationFrequency,this.velocityIterations,this.positionIterations);this.world.DrawDebugData();this.world.ClearForces();for(var p=0;p<this.entities.length;p++){this.entities[p].triggerEvent("handle-box2d")}},"camera-update":function(q){if(d.game.settings.debug){var p=(window.devicePixelRatio||1);this.debugCanvas.width=this.debugCanvas.offsetWidth*p;this.debugCanvas.height=this.debugCanvas.offsetHeight*p;this.ctx.restore();this.ctx.save();this.ctx.translate(-q.viewportLeft*q.scaleX*p,-q.viewportTop*q.scaleY*p);this.ctx.scale(q.scaleX*p,q.scaleY*p)}}},methods:{destroy:function(){this.world=null;this.debugCanvas.parentNode.removeChild(this.debugCanvas);this.debugCanvas=null;this.debugDraw=null;this.ctx=null;this.entities=[]}},publicMethods:{}})})();d.components["handler-controller"]=(function(){var f=function(l,k){return function(n){if(n.released){l+=":up"}else{if(n.pressed){l+=":down"}}for(var m=0;m<k.entities.length;m++){k.entities[m].trigger(l,n)}}};var j=function(l,k){return function(n){for(var m=0;m<k.entities.length;m++){k.entities[m].trigger(l,n)}}};var i={kc0:"unknown",kc8:"backspace",kc9:"tab",kc12:"numpad-5-shift",kc13:"enter",kc16:"shift",kc17:"ctrl",kc18:"alt",kc19:"pause",kc20:"caps-lock",kc27:"esc",kc32:"space",kc33:"page-up",kc34:"page-down",kc35:"end",kc36:"home",kc37:"left-arrow",kc38:"up-arrow",kc39:"right-arrow",kc40:"down-arrow",kc42:"numpad-multiply",kc43:"numpad-add",kc44:"print-screen",kc45:"insert",kc46:"delete",kc47:"numpad-division",kc48:"0",kc49:"1",kc50:"2",kc51:"3",kc52:"4",kc53:"5",kc54:"6",kc55:"7",kc56:"8",kc57:"9",kc59:"semicolon",kc61:"equals",kc65:"a",kc66:"b",kc67:"c",kc68:"d",kc69:"e",kc70:"f",kc71:"g",kc72:"h",kc73:"i",kc74:"j",kc75:"k",kc76:"l",kc77:"m",kc78:"n",kc79:"o",kc80:"p",kc81:"q",kc82:"r",kc83:"s",kc84:"t",kc85:"u",kc86:"v",kc87:"w",kc88:"x",kc89:"y",kc90:"z",kc91:"left-windows-start",kc92:"right-windows-start",kc93:"windows-menu",kc96:"back-quote",kc106:"numpad-multiply",kc107:"numpad-add",kc109:"numpad-minus",kc110:"numpad-period",kc111:"numpad-division",kc112:"f1",kc113:"f2",kc114:"f3",kc115:"f4",kc116:"f5",kc117:"f6",kc118:"f7",kc119:"f8",kc120:"f9",kc121:"f10",kc122:"f11",kc123:"f12",kc144:"num-lock",kc145:"scroll-lock",kc186:"semicolon",kc187:"equals",kc188:"comma",kc189:"hyphen",kc190:"period",kc191:"forward-slash",kc192:"back-quote",kc219:"open-bracket",kc220:"back-slash",kc221:"close-bracket",kc222:"quote"};var g=function(k,l){this.owner=k;this.entities=[];this.listeners=[];this.addListeners(["tick","child-entity-added","child-entity-updated","check-inputs","keydown","keyup"]);this.timeElapsed={name:"Controller",time:0}};var h=g.prototype;h.keydown=function(l){for(var k=0;k<this.entities.length;k++){this.entities[k].trigger("key:"+(i["kc"+l.keyCode]||("key-code-"+l.keyCode))+":down",l)}};h.keyup=function(l){for(var k=0;k<this.entities.length;k++){this.entities[k].trigger("key:"+(i["kc"+l.keyCode]||("key-code-"+l.keyCode))+":up",l)}};h.tick=h["check-inputs"]=function(m){var l=new Date().getTime();for(var k=this.entities.length-1;k>-1;k--){if(!this.entities[k].trigger("handle-controller",m)){this.entities.splice(k,1)}}this.timeElapsed.time=new Date().getTime()-l;d.game.currentScene.trigger("time-elapsed",this.timeElapsed)};h["child-entity-added"]=h["child-entity-updated"]=function(l){var n=l.getMessageIds(),p=false;for(var k=0;k<n.length;k++){if(n[k]=="handle-controller"){for(var m=0;m<this.entities.length;m++){if(this.entities[m]==l){p=true;break}}if(!p){if(l.controlMap){for(var o in l.controlMap){if((o.indexOf("key:")<0)&&(o.indexOf("mouse:")<0)){if(!this[o]){this.addListeners([o,o+":up",o+":down"]);this[o]=f(o,this);this[o+":up"]=j(o+":up",this);this[o+":down"]=j(o+":down",this)}}}}this.entities.push(l);l.trigger("controller-load")}break}}};h.destroy=function(){this.removeListeners(this.listeners);this.entities.length=0;this.owner=undefined};h.addListeners=function(l){for(var k in l){this.addListener(l[k])}};h.removeListeners=function(l){for(var k in l){this.removeListener(k,l[k])}};h.addListener=function(l,n){var k=this,m=n||function(p,o){k[l](p,o)};this.owner.bind(l,m);this.listeners[l]=m};h.removeListener=function(k,l){this.owner.unbind(k,l)};return g})();(function(){var f=function(i){var h=!!(536870912&i),g=!!(1073741824&i),j=!!(2147483648&i);if(h&&j){return -3}else{if(h){return -5}else{if(g){return -4}else{return -2}}}};return d.createComponentClass({id:"tiled-loader",constructor:function(g){this.entities=[];this.layerZ=0;this.followEntity=false;this.manuallyLoad=g.manuallyLoad||false;this.level=this.owner.level||g.level||null;this.unitsPerPixel=this.owner.unitsPerPixel||g.unitsPerPixel||1;this.images=this.owner.images||g.images||false;this.imagesScale=this.owner.imagesScale||g.imagesScale||this.unitsPerPixel;this.layerZStep=this.owner.zStep||g.zStep||1000;this.separateTiles=this.owner.separateTiles||g.separateTiles||false;this.entityPositionX=this.owner.entityPositionX||g.entityPositionX||"center";this.entityPositionY=this.owner.entityPositionY||g.entityPositionY||"bottom"},events:{"scene-loaded":function(g){if(!this.manuallyLoad){this["load-level"]({level:this.level||g.level,persistentData:g})}},"load-level":function(i){var j=i.level,h=0,g=false;if(typeof j==="string"){j=d.game.settings.levels[j]}for(;h<j.layers.length;h++){g=this.setupLayer(j.layers[h],j,g);if(this.separateTiles){g=false}}this.owner.trigger("world-loaded",{width:j.width*j.tilewidth*this.unitsPerPixel,height:j.height*j.tileheight*this.unitsPerPixel,camera:this.followEntity});this.owner.removeComponent(this)}},methods:{setupLayer:function(C,h,m){var w=this,q=w.images||[],A=h.tilesets,g=h.tilewidth,n=h.tileheight,j=0,t=0,B=(A[A.length-1].imagewidth/g)*(A[A.length-1].imageheight/n)+A[A.length-1].firstgid,p=0,o=0,s=0,r=undefined,z="",v=undefined,k=undefined,i=true,u=false,l=function(Q){var D=C.width,O=C.height,G=undefined,E=undefined,N=undefined,H=undefined,M=false,F=null,P=null,I=0;G=JSON.parse(JSON.stringify(d.game.settings.entities[Q]));E={};N=[];H=[];if(Q==="collision-layer"){P=[];for(var L=0;L<A.length;L++){F=A[L];if(F.tileproperties){for(var K in F.tileproperties){if(F.tileproperties[K].jumpThrough){P.push(F.firstgid+ +K-1)}}}}}G.properties=G.properties||{};G.properties.width=g*D*w.unitsPerPixel;G.properties.height=n*O*w.unitsPerPixel;G.properties.columns=D;G.properties.rows=O;G.properties.tileWidth=g*w.unitsPerPixel;G.properties.tileHeight=n*w.unitsPerPixel;G.properties.scaleX=w.imagesScale;G.properties.scaleY=w.imagesScale;G.properties.layerZ=w.layerZ;G.properties.z=w.layerZ;for(L=0;L<B;L++){E["tile"+L]=L}for(L=0;L<D;L++){N[L]=[];H[L]=[];for(K=0;K<O;K++){I=+C.data[L+K*D]-1;H[L][K]="tile"+I;if(P){for(var J=0;J<P.length;J++){if(P[J]===(268435455&I)){I=f(I)}break}}N[L][K]=I}}for(L=0;L<G.components.length;L++){if(G.components[L].type==="render-tiles"){M=G.components[L]}if(G.components[L].spriteSheet=="import"){G.components[L].spriteSheet={images:q,frames:{width:g*w.unitsPerPixel/w.imagesScale,height:n*w.unitsPerPixel/w.imagesScale},animations:E}}if(G.components[L].collisionMap=="import"){G.components[L].collisionMap=N}if(G.components[L].imageMap=="import"){G.components[L].imageMap=H}}w.layerZ+=w.layerZStep;if((Q==="render-layer")&&m){m.trigger("add-tiles",M);return m}else{return w.owner.addEntity(new d.classes.entity(G,{properties:{}}))}};if(q.length==0){for(p=0;p<A.length;p++){if(d.assets[A[p].name]){q.push(d.assets[A[p].name])}else{q.push(A[p].image)}}}else{q=q.slice();for(p=0;p<q.length;p++){if(d.assets[q[p]]){q[p]=d.assets[q[p]]}}}if(C.type=="tilelayer"){r="render-layer";if(C.properties&&C.properties.entity){r=C.properties.entity}else{switch(C.name){case"collision":r="collision-layer";break;case"action":r="tile-layer";for(p=0;p<h.layers.length;p++){if(h.layers[p].name==="collision"||(h.layers[p].properties&&h.layers[p].properties.entity==="collision-layer")){i=false}}if(!i){r="render-layer"}break}}if(r==="tile-layer"){l("collision-layer");return l("render-layer",m)}else{if(r==="collision-layer"){l(r,m)}else{return l(r,m)}}}else{if(C.type=="objectgroup"){for(s=0;s<C.objects.length;s++){r=C.objects[s];for(p=0;p<A.length;p++){if(A[p].firstgid>r.gid){break}else{v=A[p]}}z="";if(r.type!==""){z=r.type}else{if(r.name!==""){z=r.name}else{if(v.tileproperties[r.gid-v.firstgid]){if(v.tileproperties[r.gid-v.firstgid].entity){z=v.tileproperties[r.gid-v.firstgid].entity}else{if(v.tileproperties[r.gid-v.firstgid].type){z=v.tileproperties[r.gid-v.firstgid].type}}}}}if(z!==""){k={};if(v.tileproperties&&v.tileproperties[r.gid-v.firstgid]){for(p in v.tileproperties[r.gid-v.firstgid]){u=parseFloat(v.tileproperties[r.gid-v.firstgid][p]);if(u==0||(!!u)){k[p]=u}else{if(v.tileproperties[r.gid-v.firstgid][p]=="true"){k[p]=true}else{if(v.tileproperties[r.gid-v.firstgid][p]=="false"){k[p]=false}else{k[p]=v.tileproperties[r.gid-v.firstgid][p]}}}}}for(p in r.properties){u=parseFloat(r.properties[p]);if(u==0||(!!u)){k[p]=u}else{if(r.properties[p]=="true"){k[p]=true}else{if(r.properties[p]=="false"){k[p]=false}else{k[p]=r.properties[p]}}}}j=k.width=(r.width||g)*this.unitsPerPixel;t=k.height=(r.height||n)*this.unitsPerPixel;if(z&&d.game.settings.entities[z]&&d.game.settings.entities[z].properties){k.width=d.game.settings.entities[z].properties.width||k.width;k.height=d.game.settings.entities[z].properties.height||k.height}k.x=r.x*this.unitsPerPixel;if(this.entityPositionX==="left"){k.regX=0}else{if(this.entityPositionX==="center"){k.regX=k.width/2;k.x+=j/2}else{if(this.entityPositionX==="right"){k.regX=k.width;k.x+=j}}}k.y=r.y*this.unitsPerPixel;if(typeof r.gid==="undefined"){k.y+=k.height}if(this.entityPositionY==="bottom"){k.regY=k.height}else{if(this.entityPositionY==="center"){k.regY=k.height/2;k.y-=t/2}else{if(this.entityPositionY==="top"){k.regY=0;k.y-=t}}}k.scaleX=this.imagesScale;k.scaleY=this.imagesScale;k.layerZ=this.layerZ;if(k.z){k.z+=this.layerZ}else{if(z&&d.game.settings.entities[z]&&d.game.settings.entities[z].properties&&d.game.settings.entities[z].properties.z){k.z=this.layerZ+d.game.settings.entities[z].properties.z}else{k.z=this.layerZ}}k.parent=this.owner;r=this.owner.addEntity(new d.classes.entity(d.game.settings.entities[z],{properties:k}));if(r){if(r.camera){this.followEntity={entity:r,mode:r.camera}}}}}this.layerZ+=this.layerZStep;return false}}},destroy:function(){this.entities.length=0}}})})();(function(){return d.createComponentClass({id:"handler-render-createjs",constructor:function(g){var f=this;this.entities=[];this.canvas=this.owner.canvas=document.createElement("canvas");this.owner.canvasParent=null;if(this.owner.element){this.owner.canvasParent=this.owner.element;this.owner.element.appendChild(this.canvas)}else{this.owner.canvasParent=this.owner.rootElement;this.owner.rootElement.appendChild(this.canvas);this.owner.element=this.canvas}this.stage=new createjs.Stage(this.canvas);if(g.autoClear!==true){this.stage.autoClear=false}if(g.acceptInput){if(g.acceptInput.click||g.acceptInput.touch){this.setupInput(g.acceptInput.touch,g.acceptInput.camera)}}this.camera={left:0,top:0,width:0,height:0,bufferLeft:g.bufferLeft||g.bufferWidth||g.buffer||-1,bufferRight:g.bufferRight||g.bufferWidth||g.buffer||-1,bufferTop:g.bufferTop||g.bufferHeight||g.buffer||-1,bufferBottom:g.bufferBottom||g.bufferHeight||g.buffer||-1};this.timeElapsed={name:"Render",time:0};this.renderMessage={delta:0,stage:this.stage}},events:{"child-entity-added":function(h){var g=this,i=h.getMessageIds();for(var f=0;f<i.length;f++){if((i[f]=="handle-render")||(i[f]=="handle-render-load")){this.entities.push(h);h.trigger("handle-render-load",{stage:g.stage,parentElement:g.owner.rootElement});break}}},"pause-render":function(f){if(f&&f.time){this.paused=f.time}else{this.paused=-1}},"unpause-render":function(){this.paused=0},tick:(function(){var f=function(h,g){return h.z-g.z};return function(j){var k=undefined,i=new Date().getTime(),h=this.renderMessage;h.delta=j.delta;if(this.paused>0){this.paused-=j.delta;if(this.paused<0){this.paused=0}}for(var g=this.entities.length-1;g>-1;g--){if(!this.entities[g].trigger("handle-render",h)){this.entities.splice(g,1)}}if(this.stage){for(var g=this.stage.children.length-1;g>-1;g--){k=this.stage.children[g];if(k.hidden){if(k.visible){k.visible=false}}else{if(k.name!=="entity-managed"){if((k.x>=this.camera.x-this.camera.bufferLeft)&&(k.x<=this.camera.x+this.camera.width+this.camera.bufferRight)&&(k.y>=this.camera.y-this.camera.bufferTop)&&(k.y<=this.camera.y+this.camera.height+this.camera.bufferBottom)){if(!k.visible){k.visible=true}}else{if(k.visible){k.visible=false}}}}if(k.visible){if(k.paused&&!this.paused){k.paused=false}else{if(this.paused){k.paused=true}}}if(!k.scaleX||!k.scaleY||(this.children&&!this.children.length)){console.log("uh oh",k)}}if(this.stage.reorder){this.stage.reorder=false;this.stage.sortChildren(f)}this.timeElapsed.name="Render-Prep";this.timeElapsed.time=new Date().getTime()-i;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);i+=this.timeElapsed.time;this.stage.update(j);this.timeElapsed.name="Render";this.timeElapsed.time=new Date().getTime()-i;d.game.currentScene.trigger("time-elapsed",this.timeElapsed)}}})(),"camera-update":function(g){var f=(window.devicePixelRatio||1);this.camera.x=g.viewportLeft;this.camera.y=g.viewportTop;this.camera.width=g.viewportWidth;this.camera.height=g.viewportHeight;if(this.camera.bufferLeft==-1){this.camera.bufferLeft=this.camera.width/12}if(this.camera.bufferRight==-1){this.camera.bufferRight=this.camera.width/12}if(this.camera.bufferTop==-1){this.camera.bufferTop=this.camera.width/12}if(this.camera.bufferBottom==-1){this.camera.bufferBottom=this.camera.width/12}this.canvas.width=this.canvas.offsetWidth*f;this.canvas.height=this.canvas.offsetHeight*f;this.stage.setTransform(-g.viewportLeft*g.scaleX*f,-g.viewportTop*g.scaleY*f,g.scaleX*f,g.scaleY*f);if(this.moveMouse){this.moveMouse(g)}}},methods:{setupInput:function(n,m){var o=this,f=null,l=0,k=0,i=function(p){f=p;l=p.stageX/o.stage.scaleX+o.camera.x;k=p.stageY/o.stage.scaleY+o.camera.y},g=function(p){i(p);o.owner.trigger("mousedown",{event:p.nativeEvent,x:l,y:k,entity:o.owner});if(m){o.moveMouse=function(){i(f);o.owner.trigger("mousemove",{event:p.nativeEvent,x:l,y:k,entity:o.owner})}}},h=function(p){i(p);o.owner.trigger("mouseup",{event:p.nativeEvent,x:l,y:k,entity:o.owner});if(m){o.moveMouse=null}},j=function(p){i(p);if(p.nativeEvent.which||p.nativeEvent.touches){o.owner.trigger("mousemove",{event:p.nativeEvent,x:l,y:k,entity:o.owner})}};if(n&&createjs.Touch.isSupported()){createjs.Touch.enable(this.stage)}this.stage.addEventListener("stagemousedown",g);this.stage.addEventListener("stagemouseup",h);this.stage.addEventListener("stagemousemove",j);this.removeStageListeners=function(){this.stage.removeEventListener("stagemousedown",g);this.stage.removeEventListener("stagemouseup",h);this.stage.removeEventListener("stagemousemove",j)}},destroy:function(){if(this.removeStageListeners){this.removeStageListeners()}this.stage=undefined;this.owner.canvasParent.removeChild(this.canvas);this.owner.canvasParent=null;this.owner.element=null;this.canvas=undefined;this.entities.length=0}}})})();d.components["handler-render-dom"]=(function(){var f=function(h,m){this.owner=h;this.entities=[];this.listeners=[];this.addListeners(["tick","child-entity-added","render"]);this.element=this.owner.element=document.createElement("div");this.owner.rootElement.appendChild(this.element);this.owner.element=this.element;for(var l in m){if(l==="style"){for(var k in m[l]){this.element.style[k]=m[l][k]}}else{if(l!=="type"){if(l.indexOf("on")===0){this.element[l]=createFunction(m[l],this.owner)}else{this.element[l]=m[l]}}}}},g=f.prototype;g["child-entity-added"]=function(j){var i=this,k=j.getMessageIds();for(var h=0;h<k.length;h++){if((k[h]=="handle-render")||(k[h]=="handle-render-load")){this.entities.push(j);j.trigger("handle-render-load",{element:i.element});break}}};g.tick=g.render=function(i){for(var h=this.entities.length-1;h>-1;h--){if(!this.entities[h].trigger("handle-render",i)){this.entities.splice(h,1)}}};g.destroy=function(){this.removeListeners(this.listeners);this.owner.rootElement.removeChild(this.element);this.owner.element=null;this.element=undefined;this.entities.length=0;this.owner=undefined};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();d.components["handler-ai"]=(function(){var f=function(h,i){this.owner=h;this.entities=[];this.listeners=[];this.addListeners(["child-entity-added","tick"])};var g=f.prototype;g["child-entity-added"]=function(j){var i=this,k=j.getMessageIds();for(var h=0;h<k.length;h++){if(k[h]=="handle-ai"){this.entities.push(j);break}}};g.tick=function(i){for(var h=this.entities.length-1;h>-1;h--){if(!this.entities[h].trigger("handle-ai",i)){this.entities.splice(h,1)}}};g.destroy=function(){this.removeListeners(this.listeners)};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();(function(){var f=function(g){var h=null,i=false;for(h in g.state){if(g.state[h]!==g.lastState[h]){g.lastState[h]=g.state[h];i=true}}return i};return d.createComponentClass({id:"handler-logic",constructor:function(g){this.entities=[];this.activeEntities=this.entities;this.paused=0;this.stepLength=g.stepLength||30;this.leftoverTime=0;this.maximumStepsPerTick=10;this.camera={left:0,top:0,width:0,height:0,bufferLeft:g.bufferLeft||g.bufferWidth||g.buffer||-1,bufferRight:g.bufferRight||g.bufferWidth||g.buffer||-1,bufferTop:g.bufferTop||g.bufferHeight||g.buffer||-1,bufferBottom:g.bufferBottom||g.bufferHeight||g.buffer||-1,active:false};this.message={delta:this.stepLength,tick:null,camera:this.camera,movers:this.activeEntities};this.timeElapsed={name:"Logic",time:0}},events:{"child-entity-added":function(h){var i=h.getMessageIds();for(var g=0;g<i.length;g++){if(i[g]=="handle-logic"){this.entities.push(h);this.updateNeeded=this.camera.active;break}}},"pause-logic":function(g){if(g&&g.time){this.paused=g.time}else{this.paused=-1}},"unpause-logic":function(){this.paused=0},"camera-update":function(g){this.camera.left=g.viewportLeft;this.camera.top=g.viewportTop;this.camera.width=g.viewportWidth;this.camera.height=g.viewportHeight;if(this.camera.bufferLeft==-1){this.camera.bufferLeft=this.camera.width/10}if(this.camera.bufferRight==-1){this.camera.bufferRight=this.camera.width/10}if(this.camera.bufferTop==-1){this.camera.bufferTop=this.camera.width/10}if(this.camera.bufferBottom==-1){this.camera.bufferBottom=this.camera.width/10}this.camera.active=true;this.updateNeeded=true},tick:function(o){var n=0,p=undefined,m=new Date().getTime();this.leftoverTime+=o.delta;n=Math.floor(this.leftoverTime/this.stepLength)||1;this.message.delta=Math.min(this.leftoverTime,this.stepLength);this.leftoverTime=Math.max(this.leftoverTime-(n*this.stepLength),0);if(this.paused>0){this.paused-=o.delta;if(this.paused<0){this.paused=0}}if(!this.paused){if(!this.message.tick){this.message.tick=o}if(this.activeEntities===this.entities){this.message.movers=this.activeEntities=[]}this.activeEntities.length=0;for(var h=this.entities.length-1;h>-1;h--){p=this.entities[h];if(p.alwaysOn||(typeof p.x==="undefined")||((p.x>=this.camera.left-this.camera.bufferLeft)&&(p.x<=this.camera.left+this.camera.width+this.camera.bufferRight)&&(p.y>=this.camera.top-this.camera.bufferTop)&&(p.y<=this.camera.top+this.camera.height+this.camera.bufferBottom))){this.activeEntities.push(p)}}n=Math.min(n,this.maximumStepsPerTick);for(var l=0;l<n;l++){for(var h=this.activeEntities.length-1;h>-1;h--){p=this.activeEntities[h];if(p.triggerEvent("handle-logic",this.message)){if(f(p)){p.trigger("logical-state",p.state)}p.checkCollision=true}else{for(var g=this.entities.length-1;g>-1;g--){if(this.entities[g]===this.activeEntities[h]){this.entities.splice(g,1);this.updateNeeded=this.camera.active;break}}}}this.timeElapsed.name="Logic";this.timeElapsed.time=new Date().getTime()-m;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);m+=this.timeElapsed.time;this.owner.trigger("check-collision-group",this.message);this.timeElapsed.name="Collision";this.timeElapsed.time=new Date().getTime()-m;d.game.currentScene.trigger("time-elapsed",this.timeElapsed);m+=this.timeElapsed.time}}this.timeElapsed.time=new Date().getTime()-m;d.game.currentScene.trigger("time-elapsed",this.timeElapsed)}}})})();(function(){var f=function(g){g.window.viewportTop=g.element.offsetTop;g.window.viewportLeft=g.element.offsetLeft;g.window.viewportWidth=g.element.offsetWidth||g.worldWidth;g.window.viewportHeight=g.element.offsetHeight||g.worldHeight;if(g.scaleWidth){g.world.viewportWidth=g.window.viewportWidth/Math.ceil(g.window.viewportWidth/g.scaleWidth)}if(!g.stretch||g.scaleWidth){g.world.viewportHeight=g.window.viewportHeight*g.world.viewportWidth/g.window.viewportWidth}g.worldPerWindowUnitWidth=g.world.viewportWidth/g.window.viewportWidth;g.worldPerWindowUnitHeight=g.world.viewportHeight/g.window.viewportHeight;g.windowPerWorldUnitWidth=g.window.viewportWidth/g.world.viewportWidth;g.windowPerWorldUnitHeight=g.window.viewportHeight/g.world.viewportHeight;g.viewportUpdate=true};return d.createComponentClass({id:"camera",constructor:function(g){this.entities=[];this.stretch=g.stretch||false;this.transitionX=g.transitionX||g.transition;this.transitionY=g.transitionY||g.transition;if(isNaN(this.transitionX)){this.transitionX=400}if(isNaN(this.transitionY)){this.transitionY=600}this.threshold=g.threshold||1;this.element=null;this.window={viewportTop:0,viewportLeft:0,viewportWidth:0,viewportHeight:0};this.world={viewportWidth:g.width||0,viewportHeight:g.height||0,viewportLeft:g.left||0,viewportTop:g.top||0};this.message={viewportWidth:0,viewportHeight:0,viewportLeft:0,viewportTop:0,scaleX:0,scaleY:0};this.scaleWidth=g.scaleWidth||0;this.worldIsLoaded=false;this.worldWidth=g.worldWidth||0;this.worldHeight=g.worldHeight||0;this.following=undefined;this.state="static";this.bBBorderX=0;this.bBBorderY=0;this.bBInnerWidth=0;this.bBInnerHeight=0;this.setBoundingArea();this.lastLeft=this.world.viewportLeft;this.lastTop=this.world.viewportTop;this.forwardX=0;this.forwardY=0;this.averageOffsetX=0;this.averageOffsetY=0;this.offsetX=0;this.offsetY=0;this.forwardFollower={x:this.lastLeft,y:this.lastTop};this.lastFollow={entity:null,mode:null,offsetX:0,offsetY:0,begin:0};this.direction=true;this.stationary=false;this.viewportUpdate=false},events:{load:function(){this.element=this.owner.canvas||this.owner.element||this.owner.rootElement;this.resize()},"child-entity-added":function(h){var i=h.getMessageIds();for(var g=0;g<i.length;g++){if(i[g]=="camera-update"){this.entities.push(h);this.viewportUpdate=true;if(this.worldIsLoaded){h.trigger("camera-loaded",{width:this.worldWidth,height:this.worldHeight})}break}}},"child-entity-removed":function(h){var g=0;for(g in this.entities){if(this.entities[g]===h){this.entities.splice(g,1);break}}},"world-loaded":function(h){this.worldIsLoaded=true;this.worldWidth=this.owner.worldWidth=h.width;this.worldHeight=this.owner.worldHeight=h.height;if(h.camera){this.follow(h.camera)}for(var g=this.entities.length-1;g>-1;g--){this.entities[g].trigger("camera-loaded",h)}},tick:function(h){switch(this.state){case"following":if(this.followingFunction(this.following,h.delta)){this.viewportUpdate=true}break;case"static":default:break}if(this.viewportUpdate){this.viewportUpdate=false;this.stationary=false;this.message.viewportLeft=this.world.viewportLeft;this.message.viewportTop=this.world.viewportTop;this.message.viewportWidth=this.world.viewportWidth;this.message.viewportHeight=this.world.viewportHeight;this.message.scaleX=this.windowPerWorldUnitWidth;this.message.scaleY=this.windowPerWorldUnitHeight;this.owner.trigger("camera-update",this.message);for(var g=this.entities.length-1;g>-1;g--){if(!this.entities[g].trigger("camera-update",this.message)){this.entities.splice(g,1)}}}else{if(!this.stationary){this.owner.trigger("camera-stationary",this.message);this.stationary=true}}if(this.lastFollow.begin){if(this.lastFollow.begin<new Date().getTime()){this.follow(this.lastFollow)}}},resize:function(){f(this)},relocate:function(g){if(this.move(g.x,g.y)){this.viewportUpdate=true}},orientationchange:function(){f(this)},follow:function(g){if(g.time){if(!this.lastFollow.begin){this.lastFollow.entity=this.following;this.lastFollow.mode=this.mode;this.lastFollow.offsetX=this.offsetX;this.lastFollow.offsetY=this.offsetY}this.lastFollow.begin=new Date().getTime()+g.time}else{if(this.lastFollow.begin){this.lastFollow.begin=0}}this.mode=g.mode;switch(g.mode){case"locked":this.state="following";this.following=g.entity;this.followingFunction=this.lockedFollow;this.offsetX=g.offsetX||0;this.offsetY=g.offsetY||0;break;case"forward":this.state="following";this.followFocused=false;this.following=g.entity;this.lastLeft=g.entity.x;this.lastTop=g.entity.y;this.forwardX=g.movementX||(this.transitionX/10);this.forwardY=g.movementY||0;this.averageOffsetX=0;this.averageOffsetY=0;this.offsetX=g.offsetX||0;this.offsetY=g.offsetY||0;this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following";this.following=g.entity;this.offsetX=g.offsetX||0;this.offsetY=g.offsetY||0;this.setBoundingArea(g.top,g.left,g.width,g.height);this.followingFunction=this.boundingFollow;break;case"static":default:this.state="static";this.following=undefined;this.followingFunction=undefined;break}if(g.begin){g.begin=0}}},methods:{move:function(i,g){var h=this.moveLeft(i);h=this.moveTop(g)||h;return h},moveLeft:function(g){if(Math.abs(this.world.viewportLeft-g)>this.threshold){if(this.worldWidth&&this.worldWidth!=0&&this.worldWidth<this.world.viewportWidth){this.world.viewportLeft=(this.worldWidth-this.world.viewportWidth)/2}else{if(this.worldWidth&&this.worldWidth!=0&&(g+this.world.viewportWidth>this.worldWidth)){this.world.viewportLeft=this.worldWidth-this.world.viewportWidth}else{if(this.worldWidth&&this.worldWidth!=0&&(g<0)){this.world.viewportLeft=0}else{this.world.viewportLeft=g}}}return true}return false},moveTop:function(g){if(Math.abs(this.world.viewportTop-g)>this.threshold){if(this.worldHeight&&this.worldHeight!=0&&this.worldHeight<this.world.viewportHeight){this.world.viewportTop=(this.worldHeight-this.world.viewportHeight)/2}else{if(this.worldHeight&&this.worldHeight!=0&&(g+this.world.viewportHeight>this.worldHeight)){this.world.viewportTop=this.worldHeight-this.world.viewportHeight}else{if(this.worldHeight&&this.worldHeight!=0&&(g<0)){this.world.viewportTop=0}else{this.world.viewportTop=g}}}return true}return false},lockedFollow:function(h,g,k){var o=h.x-(this.world.viewportWidth/2),n=h.y-(this.world.viewportHeight/2),m=(this.transitionX?Math.min(g/this.transitionX,1):1),j=1-m,l=(this.transitionY?Math.min(g/this.transitionY,1):1),i=1-l;return this.move(m*o+j*this.world.viewportLeft,l*n+i*this.world.viewportTop)},forwardFollow:function(i,k){var h=this.forwardFollower,l=15/k,j=false,g=i.x+this.offsetX,m=i.y+this.offsetY;if(this.followFocused&&(this.lastLeft===g)&&(this.lastTop===m)){return this.lockedFollow(h,k)}else{this.averageOffsetX*=0.9;this.averageOffsetY*=0.9;this.averageOffsetX+=0.1*(g-this.lastLeft)*l;this.averageOffsetY+=0.1*(m-this.lastTop)*l;if(Math.abs(this.averageOffsetX)>(this.world.viewportWidth/(this.forwardX*2))){this.averageOffsetX=0}if(Math.abs(this.averageOffsetY)>(this.world.viewportHeight/(this.forwardY*2))){this.averageOffsetY=0}h.x=this.averageOffsetX*this.forwardX+g;h.y=this.averageOffsetY*this.forwardY+m;this.lastLeft=g;this.lastTop=m;j=this.lockedFollow(h,k);if(!this.followFocused&&!j){this.followFocused=true}return j}},setBoundingArea:function(j,i,h,g){this.bBBorderY=(typeof j!=="undefined")?j:this.world.viewportHeight*0.25;this.bBBorderX=(typeof i!=="undefined")?i:this.world.viewportWidth*0.4;this.bBInnerWidth=(typeof h!=="undefined")?h:this.world.viewportWidth-(2*this.bBBorderX);this.bBInnerHeight=(typeof g!=="undefined")?g:this.world.viewportHeight-(2*this.bBBorderY)},boundingFollow:function(i,k){var j=null,h=null,g=(this.transitionX?Math.min(k/this.transitionX,1):1),n=1-g,m=(this.transitionY?Math.min(k/this.transitionY,1):1),l=1-m;if(i.x>this.world.viewportLeft+this.bBBorderX+this.bBInnerWidth){j=i.x-(this.bBBorderX+this.bBInnerWidth)}else{if(i.x<this.world.viewportLeft+this.bBBorderX){j=i.x-this.bBBorderX}}if(i.y>this.world.viewportTop+this.bBBorderY+this.bBInnerHeight){h=i.y-(this.bBBorderY+this.bBInnerHeight)}else{if(i.y<this.world.viewportTop+this.bBBorderY){h=i.y-this.bBBorderY}}if(typeof j!=="null"){j=this.moveLeft(g*j+n*this.world.viewportLeft)}if(typeof h!=="null"){h=this.moveTop(m*h+l*this.world.viewportTop)}return j||h},windowToWorld:function(g){var h=[];h[0]=Math.round((g[0]-this.window.viewportLeft)*this.worldPerWindowUnitWidth);h[1]=Math.round((g[1]-this.window.viewportTop)*this.worldPerWindowUnitHeight);return h},worldToWindow:function(h){var g=[];g[0]=Math.round((h[0]*this.windowPerWorldUnitWidth)+this.window.viewportLeft);g[1]=Math.round((h[1]*this.windowPerWorldUnitHeight)+this.window.viewportTop);return g},destroy:function(){this.entities.length=0}}})})();(function(){var f=function(k,n){var h=0,g=0,l=k.length,m=false;for(;h<n.length;h++){m=false;for(g=0;g<l;g++){if(n[h]===k[g]){m=true;break}}if(!m){k.push(n[h])}}return k};return d.createComponentClass({id:"collision-group",constructor:function(h){var g=this;this.solidEntities=[];this.terrain=undefined;this.aabb=new d.classes.aABB(this.owner.x,this.owner.y);this.prevAABB=new d.classes.aABB(this.owner.x,this.owner.y);this.owner.previousX=this.owner.previousX||this.owner.x;this.owner.previousY=this.owner.previousY||this.owner.y;this.collisionGroup=this.owner.collisionGroup={getAllEntities:function(){var k=0,j=null;for(var i=0;i<g.solidEntities.length;i++){j=g.solidEntities[i];if((j!==g.owner)&&j.collisionGroup){k+=j.collisionGroup.getAllEntities()}else{k+=1}}return k},getSize:function(){return g.solidEntities.length},getCollisionTypes:function(){return g.getCollisionTypes()},getSolidCollisions:function(){return g.getSolidCollisions()},getAABB:function(i){return g.getAABB(i)},getPreviousAABB:function(i){return g.getPreviousAABB(i)},getShapes:function(i){return g.getShapes(i)},getPrevShapes:function(i){return g.getPrevShapes(i)},prepareCollision:function(i,j){return g.prepareCollision(i,j)},relocateEntity:function(i,k,j){return g.relocateEntity(i,k,j)},movePreviousX:function(i){return g.movePreviousX(i)},getSolidEntities:function(){return g.solidEntities},jumpThrough:false}},events:{"child-entity-added":function(g){this["add-collision-entity"](g)},"add-collision-entity":function(g){var j=0,h=g.collisionTypes;if(h){for(;j<h.length;j++){if(g.solidCollisions[h[j]].length&&!g.immobile){this.solidEntities[this.solidEntities.length]=g}}this.updateAABB()}},"child-entity-removed":function(g){this["remove-collision-entity"](g)},"remove-collision-entity":function(h){var g=0,k=0,j=h.collisionTypes;if(j){for(;k<j.length;k++){if(h.solidCollisions[j[k]].length){for(g in this.solidEntities){if(this.solidEntities[g]===h){this.solidEntities.splice(g,1);break}}}}this.updateAABB()}},"relocate-entity":function(g){this.owner.previousX=this.owner.x;this.owner.previousY=this.owner.y;this.updateAABB()}},methods:{getCollisionTypes:function(){var h=null,i=[];for(var g=0;g<this.solidEntities.length;g++){h=this.solidEntities[g];if((h!==this.owner)&&h.collisionGroup){h=h.collisionGroup}i=f(i,h.getCollisionTypes())}return i},getSolidCollisions:function(){var h=null,k={},i=null;for(var g=0;g<this.solidEntities.length;g++){h=this.solidEntities[g];if((h!==this.owner)&&h.collisionGroup){h=h.collisionGroup}i=h.getSolidCollisions();for(var j in i){k[j]=f(k[j]||[],i[j])}}return k},getAABB:function(j){var i=null;if(!j){return this.aabb}else{var h=new d.classes.aABB();for(var g=0;g<this.solidEntities.length;g++){i=this.solidEntities[g];if((i!==this.owner)&&i.collisionGroup){i=i.collisionGroup}h.include(i.getAABB(j))}return h}},getPreviousAABB:function(j){var i=null;if(!j){return this.prevAABB}else{var h=new d.classes.aABB();for(var g=0;g<this.solidEntities.length;g++){i=this.solidEntities[g];if((i!==this.owner)&&i.collisionGroup){i=i.collisionGroup}h.include(i.getPreviousAABB(j))}return h}},updateAABB:function(){this.aabb.reset();for(var g=0;g<this.solidEntities.length;g++){this.aabb.include(((this.solidEntities[g]!==this.owner)&&this.solidEntities[g].getCollisionGroupAABB)?this.solidEntities[g].getCollisionGroupAABB():this.solidEntities[g].getAABB())}},getShapes:function(k){var j=null,h=[],i=null;for(var g=0;g<this.solidEntities.length;g++){j=this.solidEntities[g];if((j!==this.owner)&&j.collisionGroup){j=j.collisionGroup}i=j.getShapes(k);if(i){h=h.concat(i)}}return h},getPrevShapes:function(j){var i=null,h=[];for(var g=0;g<this.solidEntities.length;g++){i=this.solidEntities[g];if((i!==this.owner)&&i.collisionGroup){i=i.collisionGroup}newShapes=i.getPrevShapes(j);if(newShapes){h=h.concat(newShapes)}}return h},prepareCollision:function(h,m){var k=null,j=0,g=0;for(var l=0;l<this.solidEntities.length;l++){k=this.solidEntities[l];k.saveDX=k.x-k.previousX;k.saveDY=k.y-k.previousY;j=k.saveOX=this.owner.previousX-k.previousX;g=k.saveOY=this.owner.previousY-k.previousY;if((k!==this.owner)&&k.collisionGroup){k=k.collisionGroup}k.prepareCollision(h-j,m-g)}},movePreviousX:function(g){var h=null,k=0,j=0;for(;j<this.solidEntities.length;j++){h=this.solidEntities[j];k=h.saveOX;if((h!==this.owner)&&h.collisionGroup){h=h.collisionGroup}h.movePreviousX(g-k)}},relocateEntity:function(g,m,l){var j=null,h=null,k=0;this.owner.saveDX-=g-this.owner.previousX;this.owner.saveDY-=m-this.owner.previousY;for(k=0;k<l.xCount;k++){if(l.getXEntry(k).thisShape.owner===this.owner){this.owner.saveDX=0;break}}for(k=0;k<l.yCount;k++){if(l.getYEntry(k).thisShape.owner===this.owner){this.owner.saveDY=0;break}}for(var k=0;k<this.solidEntities.length;k++){j=h=this.solidEntities[k];if((j!==this.owner)&&j.collisionGroup){j=j.collisionGroup}j.relocateEntity(g-h.saveOX,m-h.saveOY,l);h.x+=h.saveDX;h.y+=h.saveDY;if(h!==this.owner){h.x+=this.owner.saveDX;h.y+=this.owner.saveDY}}},destroy:function(){this.solidEntities.length=0}},publicMethods:{getCollisionGroupAABB:function(){return this.getAABB()},getWorldEntities:function(){return this.owner.parent.getWorldEntities()},getWorldTerrain:function(){return this.owner.parent.getWorldTerrain()}}})})();(function(){var i={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,length:0,next:false,events:false},h={stop:true,playthrough:true},g=function(l,k){return l.time-k.time},j=function(r){var q="",l=undefined,k=null,o=d.game.settings.assets;if(typeof r==="string"){q=r;l={}}else{if(r.length){if(typeof r[0]==="string"){q=r[0];l={next:[]}}else{q=r[0].sound;l={};for(var p in r[0]){l[p]=r[0][p]}if(l.next){l.next=l.next.slice()}else{l.next=[]}}for(var m=1;m<r.length;m++){l.next.push(r[m])}}else{q=r.sound;l={interrupt:r.interrupt,delay:r.delay,offset:r.offset,loop:r.loop,volume:r.volume,pan:r.pan,length:r.length,next:r.next,events:r.events}}}if(o[q].data){for(var n in o[q].data){l[n]=l[n]||o[q].data[n]}}if(o[q].assetId){q=o[q].assetId}return function(C){var E=this,x=undefined,A=false,D=false,t=i.offset,s=0;C=C||l;if(C&&C.stop){if(k){if(C.playthrough){k.remainingLoops=0}else{k.stop();E.removeClip(k)}}}else{if(C){var w=C.interrupt||l.interrupt||i.interrupt,v=C.delay||l.delay||i.delay,z=C.loop||l.loop||i.loop,y=(typeof C.volume!=="undefined")?C.volume:((typeof l.volume!=="undefined")?l.volume:i.volume),B=C.pan||l.pan||i.pan,s=C.length||l.length||i.length;t=C.offset||l.offset||i.offset;A=C.next||l.next||i.next;D=C.events||l.events||i.events;x=k=createjs.Sound.play(q,w,v,t,z,y,B)}else{x=k=createjs.Sound.play(q,i.interrupt,i.delay,i.offset,i.loop,i.volume,i.pan)}if(D){x.sequenceEvents=[];for(var u=0;u<D.length;u++){x.sequenceEvents.push({event:D[u].event,time:+D[u].time+t,message:D[u].message})}x.sequenceEvents.sort(g)}x.addEventListener("complete",function(){E.onComplete(x,A)});if(x.playState==="playFailed"){if(this.owner.debug){console.warn('Unable to play "'+q+'".',x)}}else{if(s){this.timedAudioClips.push({length:s,progress:0,audio:x,next:A})}this.activeAudioClips.push(x)}}}},f=function(l,m){var k=l.replace(/ /g,"").split(",");if(l==="default"){return function(n){return l}}else{return function(o){for(var n=0;n<k.length;n++){if(!o[k[n]]){return false}}return l}}};return d.createComponentClass({id:"audio",constructor:function(l){this.timedAudioClips=[];this.activeAudioClips=[];this.state={};this.stateChange=false;this.currentState=false;this.forcePlaythrough=this.owner.forcePlaythrough||l.forcePlaythrough;if(typeof this.forcePlaythrough!=="boolean"){this.forcePlaythrough=true}if(l.audioMap){this.checkStates=[];for(var k in l.audioMap){this.addListener(k);this[k]=j(l.audioMap[k]);this.checkStates.push(f(k,l.audioMap[k]))}}},events:{"handle-render":function(m){var l=0,k=undefined;newArray=undefined;for(l=0;l<this.activeAudioClips.length;l++){this.checkTimeEvents(this.activeAudioClips[l])}if(this.timedAudioClips.length){newArray=this.timedAudioClips;this.timedAudioClips=[];for(l in newArray){k=newArray[l];k.progress+=m.delta;if(k.progress>=k.length){k.audio.stop();this.onComplete(k.audio,k.next)}else{this.timedAudioClips.push(k)}}}l=0;if(this.stateChange){if(this.checkStates){if(this.currentState){h.playthrough=this.forcePlaythrough;this[this.currentState](h)}this.currentState=false;for(;l<this.checkStates.length;l++){k=this.checkStates[l](this.state);if(k){this.currentState=k;this[this.currentState]();break}}}this.stateChange=false}},"logical-state":function(l){for(var k in l){if(this.state[k]!==l[k]){this.stateChange=true;this.state[k]=l[k]}}},"audio-mute-toggle":function(){createjs.Sound.setMute(!createjs.Sound.getMute())},"audio-stop":function(){for(var k in this.activeAudioClips){this.activeAudioClips[k].stop()}this.activeAudioClips.length=0;this.timedAudioClips.length=0},"audio-mute":function(){createjs.Sound.setMute(true)},"audio-unmute":function(){createjs.Sound.setMute(false)}},methods:{checkTimeEvents:function(k,m){var l=0;if(k.sequenceEvents){l=k.getPosition();while(k.sequenceEvents.length&&(m||(k.sequenceEvents[0].time<=l))){this.owner.trigger(k.sequenceEvents[0].event,k.sequenceEvents[0].message);k.sequenceEvents.splice(0,1)}}},onComplete:function(l,m){this.removeClip(l);this.checkTimeEvents(l,true);this.owner.triggerEvent("clip-complete");if(m&&m.length){if(typeof m==="string"){(j(m)).call(this)}else{var k=m.slice();k.splice(0,1);if(k.length>0){(j(m[0])).call(this,{next:k})}else{(j(m[0])).call(this)}}}else{this.owner.triggerEvent("sequence-complete")}},removeClip:function(k){for(var l in this.activeAudioClips){if(this.activeAudioClips[l]===k){this.activeAudioClips.splice(l,1);break}}},destroy:function(){this["audio-stop"]()}}})})();d.components["broadcast-events"]=(function(){var h=function(k){if(typeof k==="string"){return function(m,l){d.game.currentScene.trigger(k,m,l)}}else{return function(m,l){for(var n in k){d.game.currentScene.trigger(k[n],m,l)}}}};var g=function(k){if(typeof k==="string"){return function(m,l){if(this.owner.parent){this.owner.parent.trigger(k,m,l)}}}else{return function(m,l){for(var n in k){this.owner.parent.trigger(k[n],m,l)}}}};var f=function(k){if(typeof k==="string"){return function(m,l){this.owner.trigger(k,m,l)}}else{return function(m,l){for(var n in k){this.owner.trigger(k[n],m,l)}}}};var i=function(k,l){this.owner=k;this.listeners=[];if(l.events){for(var m in l.events){this[m]=h(l.events[m]);this.addListener(m)}}if(l.parentEvents){for(var m in l.parentEvents){this[m]=g(l.parentEvents[m]);this.addListener(m)}}if(l.renameEvents){for(var m in l.renameEvents){this[m]=f(l.renameEvents[m]);this.addListener(m)}}};var j=i.prototype;j.destroy=function(){this.removeListeners(this.listeners)};j.addListeners=function(l){for(var k in l){this.addListener(l[k])}};j.removeListeners=function(l){for(var k in l){this.removeListener(k,l[k])}};j.addListener=function(l,n){var k=this,m=n||function(p,o){k[l](p,o)};this.owner.bind(l,m);this.listeners[l]=m};j.removeListener=function(k,l){this.owner.unbind(k,l)};return i})();(function(){return d.createComponentClass({id:"change-scene",constructor:function(f){this.scene=this.owner.scene||f.scene;this.transition=this.owner.transition||f.transition||"instant";this.persistentData=f.persistentData||{};if(f.message){this.addListener(f.message);this[f.message]=this["new-scene"]}this.preload=f.preload||false},events:{"scene-live":function(){if(this.preload){d.game.loadScene(this.scene,this.transition,this.persistentData,true)}},"new-scene":function(f){var i=f||this,g=i.scene||this.scene,h=i.transition||this.transition;data=i.persistentData||this.persistentData;d.game.loadScene(g,h,data)},"set-scene":function(f){this.scene=f},"set-persistent-scene-data":function(g){for(var f in g){this.persistentData[f]=g[f]}}}})})();(function(){var f=function(h,g){if(typeof h==="string"){return function(i){g.trigger(h,i);i.preventDefault()}}else{if(h.length){return function(k){for(var j=0;j<h.length;j++){g.trigger(h[j],k)}k.preventDefault()}}else{return function(i){g.trigger(h.event,h.message);i.preventDefault()}}}};return d.createComponentClass({id:"dom-element",constructor:function(l){var g=l.element||"div";this.updateClassName=l.updateClassName||false;this.className="";this.states={};this.stateChange=false;this.potentialParent=l.parent;this.handleRenderLoadMessage=null;this.element=document.createElement(g);if(!this.owner.element){this.owner.element=this.element}this.element.ondragstart=function(){return false};for(var k in l){if(k==="style"){for(var h in l[k]){this.element.style[h]=l[k][h]}}else{if(((k!=="type")||(g==="input"))&&(k!=="element")&&(k!=="parent")&&(k!=="updateClassName")&&(k!=="attributes")&&(k!=="messageMap")){if(k.indexOf("on")===0){this.element[k]=f(l[k],this.owner)}else{this.element[k]=l[k];if(k=="className"){this.className=l[k]}}}}}if(this.owner.className){this.className=this.element.className=this.owner.className}if(this.owner.innerHTML){this.element.innerHTML=this.owner.innerHTML}},events:{"handle-render-load":(function(){var g=function(h,l){var j=0,k=h.getElementsByTagName("*");for(;j<k.length;j++){if(k[j].getAttribute("id")===l){return k[j]}}return document.getElementById(l)};return function(k){if(k.element){if(!this.parentElement){if(this.potentialParent){this.parentElement=g(k.element,this.potentialParent);this.parentElement.appendChild(this.element)}else{this.parentElement=k.element;this.parentElement.appendChild(this.element)}}if(this.owner.entities){var j=this.handleRenderLoadMessage={};for(var i in k){j[i]=k[i]}j.element=this.element;for(var h in this.owner.entities){this.owner.entities[h].trigger("handle-render-load",j)}}}}})(),"child-entity-added":function(g){if(this.handleRenderLoadMessage){g.trigger("handle-render-load",this.handleRenderLoadMessage)}},"set-parent":function(g){if(this.parentElement){this.parentElement.removeChild(this.element)}this.parentElement=g;this.parentElement.appendChild(this.element)},"handle-render":function(j){var g=0,h=this.className;if(this.stateChange&&this.updateClassName){for(g in this.states){if(this.states[g]){h+=" "+g}}this.element.className=h;this.stateChange=false}},"set-attribute":function(h){var g=null;if(h.attribute){this.element.setAttribute(h.attribute,h.value)}else{for(g in h){this.element.setAttribute(g,h[g])}}},"set-style":function(h){var g=null;if(h.attribute){this.element.style[h.attribute]=h.value}else{for(g in h){this.element.style[g]=h[g]}}},"update-content":function(h){var g=h;if(g&&(typeof g.text==="string")){g=g.text}if((typeof g==="string")&&(g!==this.element.innerHTML)){this.element.innerHTML=g}},"logical-state":function(h){for(var g in h){if(this.states[g]!==h[g]){this.stateChange=true;this.states[g]=h[g]}}}},methods:{destroy:function(){if(this.parentElement){this.parentElement.removeChild(this.element);this.parentElement=undefined}if(this.owner.element===this.element){this.owner.element=undefined}this.element=undefined}}})})();(function(){var f=function(g){if(typeof g==="string"){return function(j,i){for(var h=0;h<this.entities.length;h++){this.entities[h].trigger(g,j,i)}}}else{return function(j,i){for(var k in g){for(var h=0;h<this.entities.length;h++){this.entities[h].trigger(g[k],j,i)}}}}};return d.createComponentClass({id:"entity-container",constructor:function(h){var g=this;this.entities=[];this.definedEntities=h.entities;this.owner.entities=g.entities;if(h.childEvents){for(var i in h.childEvents){this[h.childEvents[i]]=f(h.childEvents[i]);this.addListener(h.childEvents[i])}}},events:{load:function(){var m=0,h=0,g=0,n=this.definedEntities,l=null;this.definedEntities=false;if(n){for(m=0;m<n.length;m++){l={properties:{parent:this.owner}};for(h in n[m]){if(h==="properties"){for(g in n[m].properties){l.properties[g]=n[m].properties[g]}}else{l[h]=n[m][h]}}this.addEntity(new d.classes.entity(n[m].id?n[m]:d.game.settings.entities[n[m].type],l))}}},"add-entity":function(h){h.parent=this.owner;h.trigger("adopted");for(var g=0;g<this.entities.length;g++){h.trigger("peer-entity-added",this.entities[g])}for(var g=0;g<this.entities.length;g++){this.entities[g].trigger("peer-entity-added",h)}this.entities.push(h);this.owner.trigger("child-entity-added",h);return h},"remove-entity":function(h){for(var g=0;g<this.entities.length;g++){if(this.entities[g]===h){for(var i=0;i<this.entities.length;i++){if(g!==i){this.entities[i].trigger("peer-entity-removed",h)}}h.parent=null;this.entities.splice(g,1);this.owner.trigger("child-entity-removed",h);h.destroy();return h}}return false}},methods:{destroy:function(){for(var g in this.entities){this.entities[g].destroy()}this.entities.length=0}},publicMethods:{addEntity:function(g){return this["add-entity"](g)},removeEntity:function(g){return this["remove-entity"](g)}}})})();(function(){var g=function(q,p){var o=p.x-q.x,r=p.y-q.y;return Math.sqrt(o*o+r*r)},j=function(r,p,u){var o=p.x-r.x,t=p.y-r.y,q=0,s=Math.PI*2;if(!u){return q}q=Math.acos(o/u);if(t<0){q=s-q}return q},m=[null,null,null,null,["east","south","west","north"],null,null,null,["east","southeast","south","southwest","west","northwest","north","northeast"],null,null,null,null,null,null,null,["east","east-southeast","southeast","south-southeast","south","south-southwest","southwest","west-southwest","west","west-northwest","northwest","north-northwest","north","north-northeast","northeast","east-northeast"]],i=["left-button","middle-button","right-button"],h=function(p,o){this.event=p;this.trigger=o;this.filters=false;this.current=false;this.last=false;this.state=false;this.stateSummary={pressed:false,released:false,triggered:false,over:false}},k=function(o){if(o.length){return function(q){for(var p=0;p<o.length;p++){o[p].state=false}}}else{return function(p){o.state=false}}},l=function(o){if(o.length){return function(q){for(var p=0;p<o.length;p++){o[p].current=true;o[p].state=true;if(q&&(typeof(q.over)!=="undefined")){o[p].over=q.over}}}}else{return function(p){o.current=true;o.state=true;if(p&&(typeof(p.over)!=="undefined")){o.over=p.over}}}},n=function(q,r,p,o){var s=q[r];if(!s){s=q[r]=new h(r,p)}if(o){s.setFilter(o)}return s},f=h.prototype;f.update=function(){var o=0;if(this.current||this.last){this.stateSummary.pressed=this.current;this.stateSummary.released=!this.current&&this.last;this.stateSummary.triggered=this.current&&!this.last;this.stateSummary.over=this.over;if(this.filters){for(;o<this.filters.length;o++){if(this.stateSummary[this.filters[o]]){this.trigger(this.event,this.stateSummary)}}}else{this.trigger(this.event,this.stateSummary)}}this.last=this.current;this.current=this.state};f.setFilter=function(o){if(!this.filters){this.filters=[o]}else{this.filters.push(o)}return this};f.isPressed=function(){return this.current};f.isTriggered=function(){return this.current&&!this.last};f.isReleased=function(){return !this.current&&this.last};return d.createComponentClass({id:"entity-controller",constructor:function(u){var t=0,r=0,p=0,s="",v=undefined,o=this,q=function(w,x){if(!o.paused){o.owner.trigger(w,x)}};this.paused=u.paused||false;if(u&&u.controlMap){this.owner.controlMap=u.controlMap;this.actions={};for(s in u.controlMap){if(typeof u.controlMap[s]==="string"){v=n(this.actions,u.controlMap[s],q)}else{v=[];if(u.controlMap[s].length){for(t=0;t<u.controlMap[s].length;t++){v[t]=n(this.actions,u.controlMap[s][t],q)}}else{p=0;for(r in u.controlMap[s]){if(typeof u.controlMap[s][r]==="string"){v[p]=n(this.actions,u.controlMap[s][r],q,r);p+=1}else{for(t=0;t<u.controlMap[s][r].length;t++){v[p]=n(this.actions,u.controlMap[s][r][t],q,r);p+=1}}}}}this[s+":up"]=k(v);this[s+":down"]=l(v);this.addListener(s+":up");this.addListener(s+":down")}}if(u.joystick){this.joystick={};this.joystick.directions=u.joystick.directions||4;this.joystick.handleEdge=u.joystick.handleEdge||false;this.joystick.innerRadius=u.joystick.innerRadius||0;this.joystick.outerRadius=u.joystick.outerRadius||Infinity}},events:{"handle-controller":function(){var o="";if(this.actions){for(o in this.actions){this.actions[o].update()}}},mousedown:function(o){this.owner.trigger("mouse:"+i[o.event.button||0]+":down",o.event);if(this.joystick){this.owner.trigger("joystick:down",o.event);this.handleJoy(o)}},mouseup:function(o){this.owner.trigger("mouse:"+i[o.event.button||0]+":up",o.event);if(this.joystick){this.owner.trigger("joystick:up",o.event);this.handleJoy(o)}},mousemove:function(o){if(this.actions["mouse:left-button"]&&(this.actions["mouse:left-button"].over!==o.over)){this.actions["mouse:left-button"].over=o.over}if(this.actions["mouse:middle-button"]&&(this.actions["mouse:middle-button"].over!==o.over)){this.actions["mouse:middle-button"].over=o.over}if(this.actions["mouse:right-button"]&&(this.actions["mouse:right-button"].over!==o.over)){this.actions["mouse:right-button"].over=o.over}if(this.joystick){this.handleJoy(o)}},"pause-controls":function(){this.paused=true},"unpause-controls":function(){this.paused=false}},methods:{handleJoy:function(q){var p=Math.PI/(this.joystick.directions/2),t=g(this.owner,q),o=0,s="",r="";if((t>this.joystick.outerRadius)||(t<this.joystick.innerRadius)){return}else{if(!this.paused){o=j(this.owner,q,t);s=m[this.joystick.directions][Math.floor(((o+p/2)%(Math.PI*2))/p)];if(this.joystick.handleEdge){p=Math.PI/this.joystick.directions;r=m[this.joystick.directions*2][Math.floor(((o+p/2)%(Math.PI*2))/p)];if(r!==s){this.owner.trigger(r.replace(s,"").replace("-",""),q)}}this.owner.trigger(s,q);this.owner.trigger("joystick-orientation",o)}}}}})})();(function(){var g=false,h=null,f=function(){g=false;h.className=h.className.replace(/ full-screen/g,"");d.game.bindings.resize.callback()},i=function(){if(g){if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.exitFullscreen){document.exitFullscreen()}}}f()}else{g=true;h.className+=" full-screen";if(h.webkitRequestFullscreen){if(!d.game.settings.supports.safari||d.game.settings.supports.chrome){h.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(h.mozRequestFullScreen){h.mozRequestFullScreen()}else{if(h.requestFullscreen){h.requestFullscreen()}}}d.game.bindings.resize.callback()}};document.addEventListener("fullscreenchange",function(j){if(!document.fullscreenElement){f()}});document.addEventListener("webkitfullscreenchange",function(j){if(!document.webkitFullscreenElement){f()}});document.addEventListener("mozfullscreenchange",function(j){if(!document.mozFullScreenElement){f()}});return d.createComponentClass({id:"fullscreen",constructor:function(j){if(!h){h=d.game.containerElement}},events:{"toggle-fullscreen":i}})})();(function(){var g={aabb:"255,128,255",render:"128,128,128",collision:"255,0,255",group:"0,255,0"},f=function(i,l,k,h,o,m,n){var j=null;switch(i){case"rectangle":j=new createjs.Shape((new createjs.Graphics()).beginFill("rgba("+g[l]+",0.1)").setStrokeStyle(3).beginStroke("rgb("+g[l]+")").rect(0,0,k,h));o+=k/2;m+=h/2;break;case"circle":o+=k/2;m+=k/2;j=new createjs.Shape((new createjs.Graphics()).beginFill("rgba("+g[l]+",0.1)").setStrokeStyle(3).beginStroke("rgb("+g[l]+")").drawCircle(k/2,k/2,k));break}j.regX=o;j.regY=m;j.z=n;return j};return d.createComponentClass({id:"render-debug",constructor:function(h){if(h.acceptInput){this.hover=h.acceptInput.hover||false;this.click=h.acceptInput.click||false}else{this.hover=false;this.click=false}this.regX=h.regX||0;this.regY=h.regY||0;this.stage=undefined;this.shapes=[]},events:{"handle-render-load":function(l){var s=this,q=(this.owner.z||0)+10000,o=0,m=0,k=this.owner.width=this.owner.width||300,r=this.owner.height=this.owner.height||100,p=false,h=null,n=null;this.stage=l.stage;if(this.owner.getAABB){for(m=0;m<this.owner.collisionTypes.length;m++){n=this.owner.getAABB(this.owner.collisionTypes[m]);k=this.initialWidth=n.width;r=this.initialHeight=n.height;h=this.owner.getShapes(this.owner.collisionTypes[m]);this.shapes.push(f("rectangle","aabb",k,r,this.owner.x-n.x,this.owner.y-n.y,q--));this.stage.addChild(this.shapes[this.shapes.length-1]);for(o=0;o<h.length;o++){this.shapes.push(f(h[o].type,"collision",h[o].radius||h[o].width,h[o].height,-h[o].offsetX,-h[o].offsetY,q--));this.stage.addChild(this.shapes[this.shapes.length-1])}}}else{this.shapes.push(f("rectangle","render",k,r,k/2,r/2,q--));this.stage.addChild(this.shapes[0])}if(this.click&&createjs.Touch.isSupported()){createjs.Touch.enable(this.stage)}this.shapes[0].onPress=function(i){if(this.click){s.owner.trigger("mousedown",{event:i.nativeEvent,over:p,x:i.stageX,y:i.stageY,entity:s.owner});i.onMouseUp=function(j){s.owner.trigger("mouseup",{event:j.nativeEvent,over:p,x:j.stageX,y:j.stageY,entity:s.owner})};i.onMouseMove=function(j){s.owner.trigger("mousemove",{event:j.nativeEvent,over:p,x:j.stageX,y:j.stageY,entity:s.owner})}}if(i.nativeEvent.button==2){console.log("This Entity:",s.owner)}};if(this.click){this.shapes[0].onMouseOut=function(){p=false};this.shapes[0].onMouseOver=function(){p=true}}if(this.hover){this.stage.enableMouseOver();this.shapes[0].onMouseOut=function(i){p=false;s.owner.trigger("mouseout",{event:i.nativeEvent,over:p,x:i.stageX,y:i.stageY,entity:s.owner})};this.shapes[0].onMouseOver=function(i){p=true;s.owner.trigger("mouseover",{event:i.nativeEvent,over:p,x:i.stageX,y:i.stageY,entity:s.owner})}}if(!d.game.settings.debug){this.owner.removeComponent(this)}},"handle-render":function(){var j=0;for(j=0;j<this.shapes.length;j++){this.shapes[j].x=this.owner.x;this.shapes[j].y=this.owner.y}if(this.owner.getCollisionGroupAABB){var h=this.owner.getCollisionGroupAABB();if(!this.groupShape){this.groupShape=new createjs.Shape((new createjs.Graphics()).beginFill("rgba(255,255,0,0.2)").rect(0,0,1,1));this.groupShape.regX=0.5;this.groupShape.regY=0.5;this.groupShape.z=(this.owner.z||0)+10000;this.stage.addChild(this.groupShape);console.log(h)}this.groupShape.scaleX=h.width;this.groupShape.scaleY=h.height;this.groupShape.x=h.x;this.groupShape.y=h.y}}},methods:{destroy:function(){var h=0;for(h=0;h<this.shapes.length;h++){this.stage.removeChild(this.shapes[h])}this.shapes.length=0;this.stage=undefined}}})})();(function(){var h=function(k){var i=[document.createElement("canvas"),document.createElement("canvas")],j=0;if(!k.___cache){k.___cache=k.cache;k.cache=function(m,p,n,l,o){j=1-j;this.cacheCanvas=i[j];this.___cache(m,p,n,l,o)}}return k},g={x:1,y:1,t:-1,r:0},f=function(l){var k=+(l.substring(4)),m=g,j=!!(536870912&k),i=!!(1073741824&k),n=!!(2147483648&k);m.t=268435455&k;m.x=1;m.y=1;m.r=0;if(j||i||n){if(j&&i&&n){m.x=-1;m.r=90}else{if(j&&n){m.r=90}else{if(i&&n){m.r=180}else{if(j&&i){m.r=270}else{if(j){m.y=-1;m.r=90}else{if(i){m.y=-1}else{if(n){m.x=-1}}}}}}}}return m};return d.createComponentClass({id:"render-tiles",constructor:function(o){var j=0,i=o.spriteSheet.images.slice(),m=null,n=1,l=1;if(i[0]&&(typeof i[0]==="string")){i=i.slice();for(j=0;j<i.length;j++){if(d.assets[i[j]]){i[j]=d.assets[i[j]]}}}m={images:i,frames:o.spriteSheet.frames,animations:o.spriteSheet.animations};n=m.images[0].scaleX||1;l=m.images[0].scaleY||1;if((n!==1)||(l!==1)){m.frames={width:m.frames.width*n,height:m.frames.height*l,regX:m.frames.regX*n,regY:m.frames.regY*l}}this.controllerEvents=undefined;this.spriteSheet=new createjs.SpriteSheet(m);this.imageMap=o.imageMap||[];this.tiles={};this.tilesToRender=undefined;this.scaleX=((o.scaleX||1)*(this.owner.scaleX||1))/n;this.scaleY=((o.scaleY||1)*(this.owner.scaleY||1))/l;this.tileWidth=o.tileWidth||(this.owner.tileWidth/this.scaleX)||10;this.tileHeight=o.tileHeight||(this.owner.tileHeight/this.scaleY)||10;this.worldWidth=this.tilesWidth=this.tileWidth;this.worldHeight=this.tilesHeight=this.tileHeight;var k=(o.buffer||(this.tileWidth*3/4))*this.scaleX;this.camera={x:-k-1,y:-k-1,buffer:k};this.cache={minX:-1,minY:-1,maxX:-1,maxY:-1};this.doubleBuffer=[null,null];this.currentBuffer=0},events:{"handle-render-load":function(n){var i=0,o=0,l=this.stage=n.stage,k="",j=this.imageMap,m=[];this.tilesToRender=h(new createjs.Container());this.tilesToRender.name="entity-managed";for(i=0;i<j.length;i++){m[i]=[];for(o=0;o<j[i].length;o++){m[i][o]=k=j[i][o];if(!this.tiles[k]){this.tiles[k]=this.createTile(k)}}}this.imageMap=m;this.tilesWidth=i*this.tileWidth;this.tilesHeight=o*this.tileHeight;this.tilesToRender.scaleX=this.scaleX;this.tilesToRender.scaleY=this.scaleY;this.tilesToRender.z=this.owner.z;l.addChild(this.tilesToRender)},"add-tiles":function(l){var i=0,n=0,m=l.imageMap,j="",k=0;if(m){for(i=0;i<this.imageMap.length;i++){for(n=0;n<this.imageMap[i].length;n++){k=m[i][n];j=this.imageMap[i][n];if(this.tiles[j]){delete this.tiles[j]}j=this.imageMap[i][n]+=" "+k;if(!this.tiles[j]){this.tiles[j]=this.createTile(j)}}}}},"camera-loaded":function(i){this.worldWidth=i.width;this.worldHeight=i.height},"camera-update":function(s){var l=0,k=0,r=this.camera.buffer,m=this.cache,i=null,j=null,p=0,n=0,w=0,u=0,z=0,v=0,A=this.convertCamera(s.viewportLeft,this.worldWidth,this.tilesWidth,s.viewportWidth),q=this.convertCamera(s.viewportTop,this.worldHeight,this.tilesHeight,s.viewportHeight),t=Math.floor(A/this.tileWidth)*this.tileWidth,o=Math.floor(q/this.tileHeight)*this.tileHeight,B=null;this.tilesToRender.x=s.viewportLeft-A;this.tilesToRender.y=s.viewportTop-q;if(((Math.abs(this.camera.x-t)>r)||(Math.abs(this.camera.y-o)>r))&&(this.imageMap.length>0)){this.camera.x=t;this.camera.y=o;w=Math.min(Math.ceil((t+s.viewportWidth+r)/(this.tileWidth*this.scaleX)),this.imageMap.length)-1;z=Math.max(Math.floor((t-r)/(this.tileWidth*this.scaleX)),0);u=Math.min(Math.ceil((o+s.viewportHeight+r)/(this.tileHeight*this.scaleY)),this.imageMap[0].length)-1;v=Math.max(Math.floor((o-r)/(this.tileHeight*this.scaleY)),0);if((u>m.maxY)||(v<m.minY)||(w>m.maxX)||(z<m.minX)){if(this.tilesToRender.cacheCanvas){j=this.tilesToRender.cacheCanvas;this.tilesToRender.uncache()}this.tilesToRender.removeChildAt(0);this.tilesToRender.cache(z*this.tileWidth,v*this.tileHeight,(w-z+1)*this.tileWidth,(u-v+1)*this.tileHeight,1);for(l=z;l<=w;l++){for(k=v;k<=u;k++){if((k>m.maxY)||(k<m.minY)||(l>m.maxX)||(l<m.minX)){B=this.tiles[this.imageMap[l][k]];this.tilesToRender.removeChildAt(0);this.tilesToRender.addChild(B);B.x=(l+0.5)*this.tileWidth;B.y=(k+0.5)*this.tileHeight;this.tilesToRender.updateCache("source-over")}}}if(j){i=this.tilesToRender.cacheCanvas.getContext("2d");p=(m.maxX-m.minX+1)*this.tileWidth;n=(m.maxY-m.minY+1)*this.tileHeight;i.drawImage(j,0,0,p,n,(m.minX-z)*this.tileWidth,(m.minY-v)*this.tileHeight,p,n);m.minX=z;m.minY=v;m.maxX=w;m.maxY=u}}}}},methods:{convertCamera:function(l,j,k,i){if((j/this.scaleX)==k){return l}else{return l*(k-i)/((j/this.scaleX)-i)}},createTile:function(n){var l=1,o=n.split(" "),j=null,m=new createjs.Sprite(this.spriteSheet,0),k=f(o[0]);m.x=0;m.y=0;m.regX=this.tileWidth/2;m.regY=this.tileHeight/2;m.scaleX=k.x;m.scaleY=k.y;m.rotation=k.r;m.gotoAndStop("tile"+k.t);for(;l<o.length;l++){if(o[l]!=="tile-1"){if(!j){j=new createjs.Container();j.addChild(m);j.cache(-this.tileWidth/2,-this.tileHeight/2,this.tileWidth,this.tileHeight,1)}k=f(o[l]);m.scaleX=k.x;m.scaleY=k.y;m.rotation=k.r;m.gotoAndStop("tile"+k.t);j.updateCache("source-over")}}if(j){return j}else{m.cache(0,0,this.tileWidth,this.tileHeight,1);return m}},destroy:function(){this.tilesToRender.removeAllChildren();this.stage.removeChild(this.tilesToRender);this.imageMap.length=0;this.tiles=undefined;this.camera=undefined;this.stage=undefined;this.tilesToRender=undefined}}})})();(function(){var g=function(h){return function(i){if(this.animationFinished||(this.lastState>=-1)){this.currentAnimation=h;this.lastState=-1;this.animationFinished=false;this.anim.gotoAndPlay(h)}else{this.waitingAnimation=h;this.waitingState=-1}}},f=function(i,j){var h=i.replace(/ /g,"").split(",");if(i==="default"){return function(k){return j}}else{return function(l){for(var k=0;k<h.length;k++){if(!l[h[k]]){return false}}return j}}};return d.createComponentClass({id:"render-animation",constructor:function(j){var s={framerate:j.spriteSheet.framerate,images:j.spriteSheet.images.slice(),frames:j.spriteSheet.frames,animations:j.spriteSheet.animations},u=this,q=0,k="",p="",h=j.animationMap,o=0,n=0;this.rotate=j.rotate||false;this.mirror=j.mirror||false;this.flip=j.flip||false;if(j.acceptInput){this.hover=j.acceptInput.hover||false;this.click=j.acceptInput.click||false;this.touch=j.acceptInput.touch||false}else{this.hover=false;this.click=false;this.touch=false}this.followThroughs={};if(!h){h={};for(q in s.animations){h[q]=q}}this.checkStates=[];for(var l in h){this.addListener(l);k=h[l];if(k[k.length-1]==="!"){k=k.substring(0,k.length-1);this.followThroughs[k]=true}else{this.followThroughs[k]=false}this[l]=g(k);this.checkStates.push(f(l,k))}p=k;this.stage=undefined;for(q=0;q<s.images.length;q++){s.images[q]=d.assets[s.images[q]]}var t=s.images[0].scaleX||1,r=s.images[0].scaleY||1;if((t!==1)||(r!==1)){if(s.frames.length){var m=[];o=[];n=[];for(var l=0;l<s.frames.length;l++){m.push([s.frames[l][0]*t,s.frames[l][1]*r,s.frames[l][2]*t,s.frames[l][3]*r,s.frames[l][4],s.frames[l][5]*t,s.frames[l][6]*r]);o.push(s.frames[l][5]);n.push(s.frames[l][6])}s.frames=m}else{o=s.frames.regX;n=s.frames.regY;s.frames={width:s.frames.width*t,height:s.frames.height*r,regX:s.frames.regX*t,regY:s.frames.regY*r}}}else{if(s.frames.length){o=[];n=[];for(var l=0;l<s.frames.length;l++){o.push(s.frames[l][5]);n.push(s.frames[l][6])}}else{o=s.frames.regX;n=s.frames.regY}}s=new createjs.SpriteSheet(s);this.anim=new createjs.Sprite(s,0);if(j.pins){this.container=new createjs.Container();this.container.addChild(this.anim);this.anim.z=0;this.addPins(j.pins,o,n)}else{this.container=this.anim}this.pinTo=j.pinTo||false;if(this.pinTo){this.owner.trigger("pin-me",this.pinTo)}this.anim.onAnimationEnd=function(v,i){u.owner.trigger("animation-ended",i);if(u.waitingAnimation){u.currentAnimation=u.waitingAnimation;u.waitingAnimation=false;u.lastState=u.waitingState;u.animationFinished=false;u.anim.gotoAndPlay(u.currentAnimation)}else{u.animationFinished=true}};this.anim.hidden=j.hidden||false;this.currentAnimation=h["default"]||p;this.forcePlaythrough=this.owner.forcePlaythrough||j.forcePlaythrough||false;this.worldScaleX=j.scaleX;this.worldScaleY=j.scaleY;this.imageScaleX=t;this.imageScaleY=r;this.lastOwnerScaleX=this.owner.scaleX;this.lastOwnerScaleY=this.owner.scaleY;this.container.scaleX=(this.worldScaleX||1)*(this.owner.scaleX||1);this.container.scaleY=(this.worldScaleY||1)*(this.owner.scaleY||1);this.anim.scaleX/=this.imageScaleX;this.anim.scaleY/=this.imageScaleY;this.scaleX=this.container.scaleX;this.scaleY=this.container.scaleY;this.skewX=this.owner.skewX||j.skewX;this.skewY=this.owner.skewY||j.skewY;this.offsetZ=j.offsetZ||0;this.state=this.owner.state;this.stateChange=false;this.lastState=-1;this.waitingAnimation=false;this.waitingState=0;this.playWaiting=false;this.animationFinished=false;if(this.currentAnimation){this.anim.gotoAndPlay(this.currentAnimation)}this["logical-state"](this.state)},events:{"handle-render-load":function(h){if(!this.pinTo){this.stage=h.stage;if(!this.stage){return}this.stage.addChild(this.container);this.addInputs()}else{return}},"handle-render":(function(){var h=function(j,i){return j.z-i.z};return function(m){var j=false,k=0,l=null;if(!this.stage){if(!this.pinTo){this["handle-render-load"](m);if(!this.stage){console.warn('No CreateJS Stage, removing render component from "'+this.owner.type+'".');this.owner.removeComponent(this);return}}else{return}}if(this.pinnedTo){if(this.pinnedTo.frames&&this.pinnedTo.frames[this.pinnedTo.animation.currentFrame]){this.container.x=this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].x;this.container.y=this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].y;if(this.container.z!==this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].z){this.stage.reorder=true;this.container.z=this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].z}this.container.visible=true}else{if(this.pinnedTo.defaultPin){this.container.x=this.pinnedTo.defaultPin.x;this.container.y=this.pinnedTo.defaultPin.y;if(this.container.z!==this.pinnedTo.defaultPin.z){this.stage.reorder=true;this.container.z=this.pinnedTo.defaultPin.z}this.container.visible=true}else{this.container.visible=false}}}else{this.container.x=this.owner.x;this.container.y=this.owner.y;if(this.container.z!==(this.owner.z+this.offsetZ)){this.stage.reorder=true;this.container.z=(this.owner.z+this.offsetZ)}if(this.owner.opacity||(this.owner.opacity===0)){this.container.alpha=this.owner.opacity}}if(this.container.reorder){this.container.reorder=false;this.container.sortChildren(h)}if(this.skewX){this.container.skewX=this.skewX}if(this.skewY){this.container.skewY=this.skewY}if(this.owner.scaleX!=this.lastOwnerScaleX||this.owner.scaleY!=this.lastOwnerScaleY){this.container.scaleX=(this.worldScaleX||1)*(this.owner.scaleX||1);this.container.scaleY=(this.worldScaleY||1)*(this.owner.scaleY||1);this.anim.scaleX/=this.imageScaleX;this.anim.scaleY/=this.imageScaleY;this.scaleX=this.container.scaleX;this.scaleY=this.container.scaleY;this.lastOwnerScaleX=this.owner.scaleX;this.lastOwnerScaleY=this.owner.scaleY}if(this.rotate||this.mirror||this.flip){l=((this.owner.orientation*180)/Math.PI+360)%360;if(this.rotate){this.container.rotation=l}if(this.mirror){if((l>90)&&(l<270)){this.container.scaleX=-this.scaleX}else{this.container.scaleX=this.scaleX}}if(this.flip){if(l>180){this.container.scaleY=this.scaleY}else{this.container.scaleY=-this.scaleY}}}if(this.stateChange){if(this.checkStates){for(;k<this.checkStates.length;k++){j=this.checkStates[k](this.state);if(j){if(this.currentAnimation!==j){if(!this.followThroughs[this.currentAnimation]&&(!this.forcePlaythrough||(this.animationFinished||(this.lastState>=+k)))){this.currentAnimation=j;this.lastState=+k;this.animationFinished=false;this.anim.gotoAndPlay(j)}else{this.waitingAnimation=j;this.waitingState=+k}}else{if(this.waitingAnimation&&!this.followThroughs[this.currentAnimation]){this.waitingAnimation=false}}break}}}this.stateChange=false}}})(),"logical-state":function(h){this.stateChange=true;if(h.hidden!==undefined){this.container.hidden=h.hidden}},"hide-animation":function(){this.container.hidden=true},"show-animation":function(){this.container.hidden=false},"pin-me":function(h){if(this.pins&&this.pins[h]){this.owner.trigger("attach-pin",this.pins[h])}},"attach-pin":function(h){if(h.pinId===this.pinTo){this.stage=h.container;this.stage.addChild(this.container);this.addInputs();this.pinnedTo=h}},"remove-pin":function(h){if(h.pinId===this.pinTo){this.stage.removeChild(this.container);this.stage=null;this.pinnedTo=null}}},methods:{addInputs:function(){var h=this,i=false;if(this.click||this.touch){if(this.touch&&createjs.Touch.isSupported()){createjs.Touch.enable(this.stage)}this.anim.addEventListener("mousedown",function(j){h.owner.trigger("mousedown",{event:j.nativeEvent,over:i,x:j.stageX,y:j.stageY,entity:h.owner});j.addEventListener("mouseup",function(k){h.owner.trigger("mouseup",{event:k.nativeEvent,over:i,x:k.stageX,y:k.stageY,entity:h.owner})});j.addEventListener("mousemove",function(k){h.owner.trigger("mousemove",{event:k.nativeEvent,over:i,x:k.stageX,y:k.stageY,entity:h.owner})})});this.anim.addEventListener("mouseout",function(){i=false});this.anim.addEventListener("mouseover",function(){i=true})}if(this.hover){this.stage.enableMouseOver();this.anim.addEventListener("mouseout",function(j){i=false;h.owner.trigger("mouseout",{event:j.nativeEvent,over:i,x:j.stageX,y:j.stageY,entity:h.owner})});this.anim.addEventListener("mouseover",function(j){i=true;h.owner.trigger("mouseover",{event:j.nativeEvent,over:i,x:j.stageX,y:j.stageY,entity:h.owner})})}},addPins:function(l,p,k){var n=0,m=0,h=null,q=0,o=0,r=!((typeof p==="number")&&(typeof k==="number"));if(!r){q=p;o=k}this.pinsToRemove=this.pinsToRemove||[];this.pins={};for(;n<l.length;n++){this.pinsToRemove.push(l[n].pinId);if(r){q=p[n];o=k[n]}this.pins[l[n].pinId]=h={pinId:l[n].pinId,animation:this.anim,container:this.container};if((typeof l[n].x==="number")&&(typeof l[n].y==="number")){h.defaultPin={x:(l[n].x-q),y:(l[n].y-o),z:l[n].z||1e-8}}if(l[n].frames){h.frames=[];for(m=0;m<l[n].frames.length;m++){if(l[n].frames[m]){if((typeof l[n].frames[m].x==="number")&&(typeof l[n].frames[m].y==="number")){h.frames.push({x:(l[n].frames[m].x-q),y:(l[n].frames[m].y-o),z:l[n].frames[m].z||(h.defaultPin?h.defaultPin.z:1e-8)})}else{if(h.defaultPin){if(typeof l[n].frames[m].x==="number"){h.frames.push({x:(l[n].frames[m].x-q),y:h.defaultPin.y,z:l[n].frames[m].z||h.defaultPin.z})}else{if(typeof l[n].frames[m].y==="number"){h.frames.push({x:h.defaultPin.x,y:(l[n].frames[m].y-o),z:l[n].frames[m].z||h.defaultPin.z})}else{h.frames.push(null)}}}else{h.frames.push(null)}}}else{h.frames.push(null)}}}this.owner.trigger("attach-pin",h)}},removePins:function(){var h=0;if(this.pins&&this.pinsToRemove){for(;h<this.pinsToRemove.length;h++){this.owner.trigger("remove-pin",this.pins[this.pinsToRemove[h]].pinId);delete this.pins[this.pinsToRemove[h]]}this.pinsToRemove.length=0}},destroy:function(){if(this.stage){this.stage.removeChild(this.container);this.stage=undefined}this.removePins();this.followThroughs=null;this.anim=undefined;this.container=undefined}}})})();(function(){return d.createComponentClass({id:"render-image",constructor:function(h){var j=h.image,i=h.source;this.rotate=h.rotate||false;this.mirror=h.mirror||false;this.flip=h.flip||false;if(h.acceptInput){this.hover=h.acceptInput.hover||false;this.click=h.acceptInput.click||false;this.touch=h.acceptInput.touch||false}else{this.hover=false;this.click=false;this.touch=false}this.stage=undefined;this.image=new createjs.Bitmap(d.assets[j]);var g=d.assets[j].scaleX||1,f=d.assets[j].scaleY||1;if(h.pins){this.container=new createjs.Container();this.container.addChild(this.image);this.image.z=0;this.addPins(h.pins,h.regX||0,h.regY||0)}else{this.container=this.image}this.pinTo=h.pinTo||false;if(this.pinTo){this.owner.trigger("pin-me",this.pinTo)}if(i){i.x=i.x||0;i.y=i.y||0;this.image.sourceRect=new createjs.Rectangle(i.x*g,i.y*f,i.width*g,i.height*f)}this.image.hidden=h.hidden||false;this.image.regX=(h.regX||0)*g;this.image.regY=(h.regY||0)*f;this.worldScaleX=h.scaleX;this.worldScaleY=h.scaleY;this.imageScaleX=g;this.imageScaleY=f;this.lastOwnerScaleX=this.owner.scaleX;this.lastOwnerScaleY=this.owner.scaleY;this.container.scaleX=(this.worldScaleX||1)*(this.owner.scaleX||1);this.container.scaleY=(this.worldScaleY||1)*(this.owner.scaleY||1);this.image.scaleX/=this.imageScaleX;this.image.scaleY/=this.imageScaleY;this.scaleX=this.container.scaleX;this.scaleY=this.container.scaleY;this.skewX=this.owner.skewX||h.skewX;this.skewY=this.owner.skewY||h.skewY;this.offsetZ=h.offsetZ||0},events:{"handle-render-load":function(f){if(!this.pinTo){this.stage=f.stage;if(!this.stage){return}this.stage.addChild(this.container);this.addInputs()}else{return}},"handle-render":(function(){var f=function(h,g){return h.z-g.z};return function(h){var g=null;if(!this.stage){if(!this.pinTo){this["handle-render-load"](h);if(!this.stage){console.warn('No CreateJS Stage, removing render component from "'+this.owner.type+'".');this.owner.removeComponent(this);return}}else{return}}if(this.pinnedTo){if(this.pinnedTo.frames&&this.pinnedTo.frames[this.pinnedTo.animation.currentFrame]){this.container.x=this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].x;this.container.y=this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].y;if(this.container.z!==this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].z){this.stage.reorder=true;this.container.z=this.pinnedTo.frames[this.pinnedTo.animation.currentFrame].z}this.container.visible=true}else{if(this.pinnedTo.defaultPin){this.container.x=this.pinnedTo.defaultPin.x;this.container.y=this.pinnedTo.defaultPin.y;if(this.container.z!==this.pinnedTo.defaultPin.z){this.stage.reorder=true;this.container.z=this.pinnedTo.defaultPin.z}this.container.visible=true}else{this.container.visible=false}}}else{this.container.x=this.owner.x;this.container.y=this.owner.y;if(this.container.z!==(this.owner.z+this.offsetZ)){this.stage.reorder=true;this.container.z=(this.owner.z+this.offsetZ)}if(this.owner.opacity||(this.owner.opacity===0)){this.container.alpha=this.owner.opacity}}if(this.container.reorder){this.container.reorder=false;this.container.sortChildren(f)}if(this.skewX){this.container.skewX=this.skewX}if(this.skewY){this.container.skewY=this.skewY}if(this.owner.scaleX!=this.lastOwnerScaleX||this.owner.scaleY!=this.lastOwnerScaleY){this.container.scaleX=(this.worldScaleX||1)*(this.owner.scaleX||1);this.container.scaleY=(this.worldScaleY||1)*(this.owner.scaleY||1);this.image.scaleX/=this.imageScaleX;this.image.scaleY/=this.imageScaleY;this.scaleX=this.container.scaleX;this.scaleY=this.container.scaleY;this.lastOwnerScaleX=this.owner.scaleX;this.lastOwnerScaleY=this.owner.scaleY}if(this.rotate||this.mirror||this.flip){g=((this.owner.orientation*180)/Math.PI+360)%360;if(this.rotate){this.container.rotation=g}if(this.mirror){if((g>90)&&(g<270)){this.container.scaleX=-this.scaleX}else{this.container.scaleX=this.scaleX}}if(this.flip){if(g>180){this.container.scaleY=this.scaleY}else{this.container.scaleY=-this.scaleY}}}}})(),"logical-state":function(f){if(f.hidden!==undefined){this.container.hidden=f.hidden}},"hide-image":function(){this.container.hidden=true},"show-image":function(){this.container.hidden=false},"pin-me":function(f){if(this.pins&&this.pins[f]){this.owner.trigger("attach-pin",this.pins[f])}},"attach-pin":function(f){if(f.pinId===this.pinTo){this.stage=f.container;this.stage.addChild(this.container);this.addInputs();this.pinnedTo=f}},"remove-pin":function(f){if(f.pinId===this.pinTo){this.stage.removeChild(this.container);this.stage=null;this.pinnedTo=null}}},methods:{addInputs:function(){var f=this,g=false;if(this.click||this.touch){if(this.touch&&createjs.Touch.isSupported()){createjs.Touch.enable(this.stage)}this.image.addEventListener("mousedown",function(h){f.owner.trigger("mousedown",{event:h.nativeEvent,over:g,x:h.stageX,y:h.stageY,entity:f.owner});h.addEventListener("mouseup",function(i){f.owner.trigger("mouseup",{event:i.nativeEvent,over:g,x:i.stageX,y:i.stageY,entity:f.owner})});h.addEventListener("mousemove",function(i){f.owner.trigger("mousemove",{event:i.nativeEvent,over:g,x:i.stageX,y:i.stageY,entity:f.owner})})});this.image.addEventListener("mouseout",function(){g=false});this.image.addEventListener("mouseover",function(){g=true})}if(this.hover){this.stage.enableMouseOver();this.image.addEventListener("mouseout",function(h){g=false;f.owner.trigger("mouseout",{event:h.nativeEvent,over:g,x:h.stageX,y:h.stageY,entity:f.owner})});this.image.addEventListener("mouseover",function(h){g=true;f.owner.trigger("mouseover",{event:h.nativeEvent,over:g,x:h.stageX,y:h.stageY,entity:f.owner})})}},addPins:function(j,k,h){var g=0,f=null;this.pinsToRemove=this.pinsToRemove||[];this.pins={};for(;g<j.length;g++){this.pinsToRemove.push(j[g].pinId);this.pins[j[g].pinId]=f={pinId:j[g].pinId,container:this.container,defaultPin:{x:j[g].x-k,y:j[g].y-h,z:j[g].z||1e-8}};this.owner.trigger("attach-pin",f)}},removePins:function(){var f=0;if(this.pins&&this.pinsToRemove){for(;f<this.pinsToRemove.length;f++){this.owner.trigger("remove-pin",this.pins[this.pinsToRemove[f]].pinId);delete this.pins[this.pinsToRemove[f]]}this.pinsToRemove.length=0}},destroy:function(){if(this.stage){this.stage.removeChild(this.container);this.stage=undefined}this.removePins();this.image=undefined;this.container=undefined}}})})();d.components["logic-button"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.state=this.owner.state;this.state.released=true;this.state.pressed=false;this.stateChange="";if(i.state==="pressed"){this.pressed()}if(i.toggle){this.toggle=true;this.addListener("mouseup")}else{this.addListeners(["mousedown","mouseup"])}this.addListeners(["handle-logic","pressed","released"])};var g=f.prototype;g.mousedown=g.pressed=function(){this.stateChange="pressed"};g.mouseup=function(){if(this.toggle){if(this.state.pressed){this.released()}else{this.pressed()}}else{this.released()}};g.released=function(){this.stateChange="released"};g["handle-logic"]=function(h){if(this.state.released&&(this.stateChange==="pressed")){this.stateChange="";this.state.pressed=true;this.state.released=false}if(this.state.pressed&&(this.stateChange==="released")){this.stateChange="";this.state.pressed=false;this.state.released=true}};g.destroy=function(){this.removeListeners(this.listeners);this.state=undefined;this.owner=undefined};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();(function(){var g=function(h){return function(i){if(i){this[h]=(i.pressed!==false)}else{this[h]=true}}},f=function(i,k){var h=Math.sqrt(i*i+k*k),j=0;if(h!=0){j=Math.acos(i/h);if(k<0){j=(Math.PI*2)-j}}return j};return d.createComponentClass({id:"logic-directional-movement",constructor:function(i){var h=this;this.speed=i.speed||0.3;this.boost=false;this.paused=false;if(i.pause||i.boost){if(typeof i.pause==="string"){this.pausers=[i.pause]}else{this.pausers=i.pause}this.addListener("logical-state");this["logical-state"]=function(l){var k=false;if(i.pause){for(var j=0;j<h.pausers.length;j++){k=k||l[h.pausers[j]]}this.paused=k}if(i.boost){if(h.boost){if(l[i.boost]===false){h.boost=false}}else{if(l[i.boost]===true){h.boost=true}}}}}this.state=this.owner.state;this.state.moving=false;this.state.left=false;this.state.right=false;this.state.up=false;this.state.down=false;this.owner.orientation=0;this.moving=false;this.left=false;this.right=false;this.up=false;this.down=false;this.upLeft=false;this.upRight=false;this.downLeft=false;this.downRight=false;this.facing="right"},events:{"handle-logic":function(m){var j=0,h=0,o=this.up||this.upLeft||this.downLeft,p=this.upLeft||(this.up&&this.left),l=this.left||this.upLeft||this.downLeft,q=this.downLeft||(this.down&&this.left),s=this.down||this.downLeft||this.downRight,k=this.downRight||(this.down&&this.right),r=this.right||this.upRight||this.downRight,n=this.upRight||(this.up&&this.right),i=0;if(o&&s){this.moving=false}else{if(l&&r){this.moving=false}else{if(p){j=-this.speed/1.414;h=-this.speed/1.414;this.moving=true;this.facing="up-left"}else{if(n){h=-this.speed/1.414;j=this.speed/1.414;this.moving=true;this.facing="up-right"}else{if(q){h=this.speed/1.414;j=-this.speed/1.414;this.moving=true;this.facing="down-left"}else{if(k){h=this.speed/1.414;j=this.speed/1.414;this.moving=true;this.facing="down-right"}else{if(l){j=-this.speed;this.moving=true;this.facing="left"}else{if(r){j=this.speed;this.moving=true;this.facing="right"}else{if(o){h=-this.speed;this.moving=true;this.facing="up"}else{if(s){h=this.speed;this.moving=true;this.facing="down"}else{this.moving=false;switch(this.facing){case"up":o=true;break;case"down":s=true;break;case"left":l=true;break;case"right":r=true;break;case"up-left":o=true;l=true;break;case"up-right":o=true;r=true;break;case"down-left":s=true;l=true;break;case"down-right":r=true;r=true;break}}}}}}}}}}}if(this.moving){if(!this.paused){if(this.boost){j*=1.5;h*=1.5}this.owner.x+=(j*m.delta);this.owner.y+=(h*m.delta)}i=f(j,h);if(this.owner.orientation!==i){this.owner.orientation=i}}if(this.state.moving!==this.moving){this.state.moving=this.moving}if(this.state.up!==o){this.state.up=o}if(this.state.right!==r){this.state.right=r}if(this.state.down!==s){this.state.down=s}if(this.state.left!==l){this.state.left=l}},"go-down":g("down"),"go-south":g("down"),"go-down-left":g("downLeft"),"go-southwest":g("downLeft"),"go-left":g("left"),"go-west":g("left"),"go-up-left":g("upLeft"),"go-northwest":g("upLeft"),"go-up":g("up"),"go-north":g("up"),"go-up-right":g("upRight"),"go-northeast":g("upRight"),"go-right":g("right"),"go-east":g("right"),"go-down-right":g("downRight"),"go-southeast":g("downRight"),stop:function(h){if(!h||(h.pressed!==false)){this.left=false;this.right=false;this.up=false;this.down=false;this.upLeft=false;this.upRight=false;this.downLeft=false;this.downRight=false}},accelerate:function(h){this.speed=h}}})})();(function(){return d.createComponentClass({id:"logic-gravity",constructor:function(f){this.vY=f.gravity||f.yGravity;if(typeof this.vY!=="number"){this.vY=0.01}this.vX=f.xGravity||0;this.maxVelocity=f.maxVelocity||0;this.newMaxX=this.maxVelocityX=f.maxVelocityX||this.maxVelocity;this.newMaxY=this.maxVelocityY=f.maxVelocityY||this.maxVelocity;this.accelerationX=0;this.accelerationY=0;this.durationX=0;this.durationY=0;if(typeof this.owner.dx!=="number"){this.owner.dx=0}if(typeof this.owner.dy!=="number"){this.owner.dy=0}this.state=this.owner.state;this.hovering=this.state.hovering=this.state.hovering||false;this.falling=this.state.falling=this.state.falling||false;this.grounded=this.state.grounded=this.state.grounded||!this.falling},events:{"handle-logic":function(f){var g=f.delta;if(!this.hovering){if(this.newMaxX!==this.maxVelocityX){if(this.durationX-g>0){this.maxVelocityX+=(this.newMaxX-this.maxVelocityX)*(g/this.durationX);this.durationX-=g}else{if(this.accelerationX){if(this.newMaxX>this.maxVelocityX){if(this.owner.dx>this.maxVelocityX){this.maxVelocityX=this.owner.dx}this.maxVelocityX=Math.min(this.maxVelocityX+(this.accelerationX*f.delta),this.newMaxX)}else{if(this.owner.dx<this.maxVelocityX){this.maxVelocityX=this.owner.dx}this.maxVelocityX=Math.max(this.maxVelocityX-(this.accelerationX*f.delta),this.newMaxX)}}else{this.maxVelocityX=this.newMaxX;this.durationX=0}}}if(this.newMaxY!==this.maxVelocityY){if(this.durationY-g>0){this.maxVelocityY+=(this.newMaxY-this.maxVelocityY)*(g/this.durationY);this.durationY-=g}else{if(this.accelerationY){if(this.newMaxY>this.maxVelocityY){if(this.owner.dy>this.maxVelocityY){this.maxVelocityY=this.owner.dy}this.maxVelocityY=Math.min(this.maxVelocityY+(this.accelerationY*f.delta),this.newMaxY)}else{if(this.owner.dy<this.maxVelocityY){this.maxVelocityY=this.owner.dy}this.maxVelocityY=Math.max(this.maxVelocityY-(this.accelerationY*f.delta),this.newMaxY)}}else{this.maxVelocityY=this.newMaxY;this.durationY=0}}}this.owner.dx+=this.vX*g;this.owner.dy+=this.vY*g;if(this.vX&&this.maxVelocityX&&(this.owner.dx>this.maxVelocityX)){this.owner.dx=this.maxVelocityX}if(this.vY&&this.maxVelocityY&&(this.owner.dy>this.maxVelocityY)){this.owner.dy=this.maxVelocityY}}if(this.state.hovering!==this.hovering){this.state.hovering=this.hovering}if(this.state.falling!==this.falling){this.state.falling=this.falling}if(this.state.grounded!==this.grounded){this.state.grounded=this.grounded}this.grounded=false;this.falling=true},"hit-solid":function(f){if(!this.hovering){if(((f.y>0)&&(this.vY>0))||((f.y<0)&&(this.vY<0))){this.owner.dy=0;this.falling=false;this.grounded=true}else{if(((f.x<0)&&(this.vX<0))||((f.x>0)&&(this.vX>0))){this.owner.dx=0;this.falling=false;this.grounded=true}}}return true},glide:function(i){var f=i.maxVelocity||this.maxVelocity,h=i.duration||0,g=i.acceleration||0;this.durationX=i.durationX||h;this.durationY=i.durationY||h;this.accelerationX=i.accelerationX||g;this.accelerationY=i.accelerationY||g;this.newMaxX=i.maxVelocityX||f||this.maxVelocityX;this.newMaxY=i.maxVelocityY||f||this.maxVelocityY;if(!this.durationX&&!this.accelerationX){this.maxVelocityX=this.newMaxX}if(!this.durationY&&!this.accelerationY){this.maxVelocityY=this.newMaxY}},gravitate:function(f){this.vY=f.gravity||f.yGravity||0;this.vX=f.xGravity||0},hover:function(f){this.owner.dx=0;this.owner.dy=0;this.hovering=!f||(f.pressed!==false)},fall:function(f){this.hovering=!!f&&(f.pressed===false)}},methods:{destroy:function(){this.owner.dx=0;this.owner.dy=0}}})})();(function(){return d.createComponentClass({id:"logic-jump",constructor:function(f){if(f.message){this.addListener(f.message);this[f.message]=this["jump"]}this.aX=this.owner.accelerationX||f.accelerationX||0;this.aY=this.owner.accelerationY||f.accelerationY;if(typeof this.aY!=="number"){this.aY=-4}if(typeof this.owner.dx!=="number"){this.owner.dx=0}if(typeof this.owner.dy!=="number"){this.owner.dy=0}this.time=f.time||0;this.jumpLength=0;this.jumping=false;this.justJumped=false;this.grounded=true;this.state=this.owner.state;this.state.jumping=false;this.state.justJumped=false},events:{"handle-logic":function(f){var g=f.delta;if(this.state.justJumped!==this.justJumped){this.state.justJumped=this.justJumped}if(this.justJumped){this.justJumped=false;this.jumpLength=this.time;this.owner.triggerEvent("just-jumped")}if(this.state.jumping!==this.jumping){this.state.jumping=this.jumping}if(this.jumping){if(this.time){this.owner.dx+=this.aX*g;this.owner.dy+=this.aY*g;this.jumpLength-=g;if(this.jumpLength<0){this.jumping=false}}else{this.owner.dx=this.aX;this.owner.dy=this.aY;this.jumping=false}}this.grounded=false},jump:function(g){var f=false;if(g){f=(g.pressed!==false)}else{f=true}if(!this.jumping&&f&&this.grounded){this.justJumped=true;this.jumping=true}else{if(this.jumping&&!f){this.jumping=false}}},"hit-solid":function(f){if(!this.justJumped){if(f.y){this.owner.dy=0;if(((f.y>0)&&(this.aY<0))||((f.y<0)&&(this.aY>0))){this.jumping=false;this.grounded=true}}else{if(f.x){this.owner.dx=0;if(((f.x<0)&&(this.aX>0))||((f.x>0)&&(this.aX<0))){this.jumping=false;this.grounded=true}}}}return true}}})})();d.components.counter=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["increment-count","change-count","change-total"]);if(i.incrementMessage){this.addListener(i.incrementMessage);this[i.incrementMessage]=this["increment-count"]}if(i.countMessage){this.addListener(i.countMessage);this[i.countMessage]=this["change-count"]}if(i.totalMessage){this.addListener(i.totalMessage);this[i.totalMessage]=this["change-total"]}this.count=0;this.total=0;this.showTotal=i.showTotal||false;this.output={text:""}};var g=f.prototype;g["change-total"]=function(h){this.total=h;if(this.total){this.output.text=this.count+"/"+this.total}else{this.output.text=""+this.count}this.owner.trigger("update-content",this.output)};g["change-count"]=function(h){this.count=h;if(this.total){this.output.text=this.count+"/"+this.total}else{this.output.text=""+this.count}this.owner.trigger("update-content",this.output)};g["increment-count"]=function(){this.count++;if(this.total){this.output.text=this.count+"/"+this.total}else{this.output.text=""+this.count}this.owner.trigger("update-content",this.output)};g.destroy=function(){this.removeListeners(this.listeners);this.owner=undefined};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();d.components["logic-timer"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["handle-logic","set-timer","start-timer","stop-timer"]);this.time=this.owner.time||i.time||0;this.prevTime=this.time;this.alarmTime=this.owner.alarmTime||i.alarmTime||undefined;this.isInterval=this.owner.isInterval||i.isInterval||false;this.alarmMessage=this.owner.alarmMessage||i.alarmMessage||"";this.updateMessage=this.owner.updateMessage||i.updateMessage||"";this.isOn=this.owner.on||i.on||true;this.isIncrementing=this.owner.isIncrementing||i.isIncrementing||true;this.maxTime=this.owner.maxTime||i.maxTime||3600000};var g=f.prototype;g["handle-logic"]=function(h){if(this.isOn){this.prevTime=this.time;this.isIncrementing?this.time+=h.delta:this.time-=h.delta;if(Math.abs(this.time)>this.maxTime){if(this.time>0){this.time=this.maxTime}else{if(this.time<0){this.time=-this.maxTime}}this["stop-timer"]()}if(typeof this.alarmTime!=="undefined"){if(this.isInterval){if(this.isIncrementing){if(Math.floor(this.time/this.alarmTime)>Math.floor(this.prevTime/this.alarmTime)){this.owner.trigger(this.alarmMessage)}}else{if(Math.floor(this.time/this.alarmTime)<Math.floor(this.prevTime/this.alarmTime)){this.owner.trigger(this.alarmMessage)}}}else{if(this.isIncrementing){if(this.time>this.alarmTime&&this.prevTime<this.alarmTime){this.owner.trigger(this.alarmMessage)}}else{if(this.time<this.alarmTime&&this.prevTime>this.alarmTime){this.owner.trigger(this.alarmMessage)}}}}}this.owner.trigger(this.updateMessage,{time:this.time})};g["set-timer"]=function(h){this.time=h.time};g["start-timer"]=function(){this.isOn=true};g["stop-timer"]=function(){this.isOn=false};g.destroy=function(){this.removeListeners(this.listeners);this.owner=undefined};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();d.components["logic-portal"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["handle-logic","occupied-portal","activate-portal"]);this.destination=this.owner.destination||i.destination;this.activated=false;this.used=false};var g=f.prototype;g["handle-logic"]=function(){if(!this.used&&this.activated){this.owner.trigger("new-scene",{scene:this.destination});this.used=true}};g["occupied-portal"]=function(i){var h=i.entity;h.trigger("portal-waiting",this.owner)};g["activate-portal"]=function(){this.activated=true};g.destroy=function(){this.removeListeners(this.listeners);this.owner=undefined};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();(function(){var h=function(i,k,j){return function(l){k.call(i,l);j.call(i,l)}},f=function(k,i,j){if(typeof k==="string"){return function(l){if(l.myType===j){if(l.hitType===i){this.owner.triggerEvent(k,l)}}}}else{if(k.length){return function(l){if(l.myType===j){if(l.hitType===i){for(var m in k){this.owner.triggerEvent(k[m],l)}}}}}else{return function(n){var m=n.x,l=n.y;if(n.entity&&!(m||l)){m=n.entity.x-this.owner.x;l=n.entity.y-this.owner.y}if(n.myType===j){if(n.hitType===i){if((l>0)&&k.bottom){this.owner.trigger(k.bottom,n)}if((l<0)&&k.top){this.owner.trigger(k.top,n)}if((m>0)&&k.right){this.owner.trigger(k.right,n)}if((m<0)&&k.left){this.owner.trigger(k.left,n)}if(k.all){this.owner.trigger(k.all,n)}}}}}}},g=function(j,i){if(!i.collisionFunctions){i.collisionFunctions={};i.getAABB=function(m){if(!m){var k=i.aabb=i.aabb||new d.classes.aABB();k.reset();for(var l in i.collisionFunctions){k.include(i.collisionFunctions[l].getAABB())}return k}else{if(i.collisionFunctions[m]){return i.collisionFunctions[m].getAABB()}else{return null}}};i.getPreviousAABB=function(k){if(i.collisionFunctions[k]){return i.collisionFunctions[k].getPreviousAABB()}else{return null}};i.getShapes=function(k){if(i.collisionFunctions[k]){return i.collisionFunctions[k].getShapes()}else{return null}};i.getPrevShapes=function(k){if(i.collisionFunctions[k]){return i.collisionFunctions[k].getPrevShapes()}else{return null}};i.prepareCollision=function(k,m){for(var l in i.collisionFunctions){i.collisionFunctions[l].prepareCollision(k,m)}};i.relocateEntity=function(k,l){i.triggerEvent("relocate-entity",{x:k,y:l})};i.movePreviousX=function(k){for(var l in i.collisionFunctions){i.collisionFunctions[l].movePreviousX(k)}};i.getCollisionTypes=function(){return i.collisionTypes};i.getSolidCollisions=function(){return i.solidCollisions}}i.collisionFunctions[j.collisionType]={getAABB:function(){return j.getAABB()},getPreviousAABB:function(){return j.getPreviousAABB()},getShapes:function(){return j.getShapes()},getPrevShapes:function(){return j.getPrevShapes()},prepareCollision:function(k,l){j.prepareCollision(k,l)},movePreviousX:function(k){j.movePreviousX(k)}}};return d.createComponentClass({id:"collision-basic",constructor:function(m){var v=0,l=null,t=m.regX,s=m.regY,k=m.width,w=m.height,u=m.radius,o=m.margin||0,n=m.marginLeft||o,r=m.marginRight||o,j=m.marginTop||o,p=m.marginBottom||o;if(isNaN(k)){k=this.owner.width;if(isNaN(t)){t=this.owner.regX}}if(isNaN(w)){w=this.owner.height;if(isNaN(s)){s=this.owner.regY}}if(isNaN(u)){u=this.owner.radius;if(isNaN(t)){t=this.owner.regX}if(isNaN(s)){s=this.owner.regY}}this.immobile=this.owner.immobile=this.owner.immobile||m.immobile||false;this.owner.previousX=this.owner.previousX||this.owner.x;this.owner.previousY=this.owner.previousY||this.owner.y;this.aabb=new d.classes.aABB();this.prevAABB=new d.classes.aABB();this.owner.bullet=this.owner.bullet||m.bullet;if(m.shapes){l=m.shapes}else{if(m.shape){l=[m.shape]}else{if(m.shapeType==="circle"){u=u||(((k||0)+(w||0))/4);l=[{regX:(isNaN(t)?u:t)-(r-n)/2,regY:(isNaN(s)?u:s)-(p-j)/2,radius:u,width:u*2,height:u*2,type:m.shapeType}]}else{l=[{regX:(isNaN(t)?(k||0)/2:t)-(r-n)/2,regY:(isNaN(s)?(w||0)/2:s)-(p-j)/2,points:m.points,width:(k||0)+n+r,height:(w||0)+j+p,type:m.shapeType}]}}}this.collisionType=m.collisionType||"none";this.owner.collisionTypes=this.owner.collisionTypes||[];this.owner.collisionTypes.push(this.collisionType);this.shapes=[];this.prevShapes=[];this.entities=undefined;for(v in l){this.shapes.push(new d.classes.collisionShape(this.owner,l[v],this.collisionType));this.prevShapes.push(new d.classes.collisionShape(this.owner,l[v],this.collisionType));this.prevAABB.include(this.prevShapes[v].getAABB());this.aabb.include(this.shapes[v].getAABB())}if(m.jumpThrough){this.owner.jumpThrough=true}g(this,this.owner);this.owner.solidCollisions=this.owner.solidCollisions||{};this.owner.solidCollisions[this.collisionType]=[];if(m.solidCollisions){for(var q in m.solidCollisions){this.owner.solidCollisions[this.collisionType].push(q);this.owner.collides=true;if(m.solidCollisions[q]){this.addListener("hit-by-"+q);this["hit-by-"+q]=f(m.solidCollisions[q],"solid",this.collisionType)}}}this.owner.softCollisions=this.owner.softCollisions||{};this.owner.softCollisions[this.collisionType]=[];if(m.softCollisions){for(var q in m.softCollisions){this.owner.softCollisions[this.collisionType].push(q);if(m.softCollisions[q]){if(this["hit-by-"+q]){this["hit-by-"+q]=h(this,this["hit-by-"+q],f(m.softCollisions[q],"soft",this.collisionType))}else{this.addListener("hit-by-"+q);this["hit-by-"+q]=f(m.softCollisions[q],"soft",this.collisionType)}}}}},events:{"collide-on":function(){this.owner.parent.trigger("add-collision-entity",this.owner)},"collide-off":function(){this.owner.parent.trigger("remove-collision-entity",this.owner)},"handle-logic":function(){if(this.owner.movementAbsorbed){this.owner.movementAbsorbed=false}},"prepare-for-collision":function(j){var i=this.owner.x,k=this.owner.y;if(!this.owner.movementAbsorbed&&j){this.owner.movementAbsorbed=true;if(this.owner.dx){i+=this.owner.dx*(j.delta||0)}if(this.owner.dy){k+=this.owner.dy*(j.delta||0)}}this.owner.x=i;this.owner.y=k},"relocate-entity":function(j){if(j.relative){this.owner.x=this.owner.previousX+j.x;this.owner.y=this.owner.previousY+j.y}else{this.owner.x=j.x;this.owner.y=j.y}this.aabb.reset();for(var i in this.shapes){this.shapes[i].update(this.owner.x,this.owner.y);this.aabb.include(this.shapes[i].getAABB())}this.owner.previousX=this.owner.x;this.owner.previousY=this.owner.y}},methods:{getAABB:function(){return this.aabb},getPreviousAABB:function(){return this.prevAABB},getShapes:function(){return this.shapes},getPrevShapes:function(){return this.prevShapes},prepareCollision:function(i,k){var j=this.prevShapes;this.owner.x=i;this.owner.y=k;this.prevShapes=this.shapes;this.shapes=j;this.prevAABB.set(this.aabb);this.aabb.reset();for(var i=0;i<this.shapes.length;i++){this.shapes[i].update(this.owner.x,this.owner.y);this.aabb.include(this.shapes[i].getAABB())}},movePreviousX:function(i){this.prevAABB.moveX(i);for(var j=0;j<this.prevShapes.length;j++){this.prevShapes[j].setXWithEntityX(i)}}}})})();(function(){var f=[],h=0,g=[];return d.createComponentClass({id:"collision-tiles",constructor:function(i){this.collisionMap=i.collisionMap||[];this.tileWidth=i.tileWidth||this.owner.tileWidth||10;this.tileHeight=i.tileHeight||this.owner.tileHeight||10;this.tileHalfWidth=this.tileWidth/2;this.tileHalfHeight=this.tileHeight/2},methods:{getShape:function(k,i,l){var j=null;if(h<f.length){j=f[h];h+=1;j.update(i*this.tileWidth+this.tileHalfWidth,l*this.tileHeight+this.tileHalfHeight)}else{f.push(new d.classes.collisionShape(null,{x:i*this.tileWidth+this.tileHalfWidth,y:l*this.tileHeight+this.tileHalfHeight,type:"rectangle",width:this.tileWidth,height:this.tileHeight},"tiles"));j=f[h]}return j},addShape:function(j,k,i,l){if(this.collisionMap[i][l]>-1){j.push(this.getShape(k,i,l))}else{if(this.collisionMap[i][l]<-1){switch(this.collisionMap[i][l]){case -2:if(k.bottom<=l*this.tileHeight){j.push(this.getShape(k,i,l))}break;case -3:if(k.left>=(i+1)*this.tileWidth){j.push(this.getShape(k,i,l))}break;case -4:if(k.top>=(l+1)*this.tileHeight){j.push(this.getShape(k,i,l))}break;case -5:if(k.right<=i*this.tileWidth){j.push(this.getShape(k,i,l))}break}}}return j}},publicMethods:{getAABB:function(){return{left:0,top:0,right:this.tileWidth*this.collisionMap.length,bottom:this.tileHeight*this.collisionMap.length[0]}},isTile:function(i,j){return !((i<0)||(j<0)||(i>=this.collisionMap.length)||(j>=this.collisionMap[0].length)||(this.collisionMap[i][j]===-1))},getTileShapes:function(l,p){var k=Math.max(Math.floor(l.left/this.tileWidth),0),n=Math.max(Math.floor(l.top/this.tileHeight),0),q=Math.min(Math.ceil(l.right/this.tileWidth),this.collisionMap.length),i=Math.min(Math.ceil(l.bottom/this.tileHeight),this.collisionMap[0].length),o=0,m=0,j=g;g.length=0;h=0;for(o=k;o<q;o++){for(m=n;m<i;m++){this.addShape(j,p,o,m)}}return j}}})})();(function(){var o=e.Common.Math.b2Vec2,g=e.Dynamics.b2BodyDef,n=e.Dynamics.b2Body,i=e.Dynamics.b2FixtureDef,k=e.Dynamics.b2Fixture,q=e.Dynamics.b2World,r=e.Collision.Shapes.b2MassData,j=e.Collision.Shapes.b2PolygonShape,p=e.Collision.Shapes.b2CircleShape,l=e.Dynamics.b2DebugDraw,h=1,m=0.5,f=0.2;return d.createComponentClass({id:"collision-box2d",constructor:function(s){this.def=s;this.body=null;this.world=null;this.drawScale=1},events:{"connect-box2D":function(z){this.world=z.world;this.drawScale=z.drawScale;this.body=null;var v=new g;var s=new i;var t=null;var w=null;var y=null;var B=null;var u=null;if(this.def.body){if(this.def.body.type=="static"){v.type=n.b2_staticBody}else{if(this.def.body.type=="kinematic"){v.type=n.b2_kinematicBody}else{v.type=n.b2_dynamicBody}}if(this.def.body.position){v.position.x=(this.owner.x||this.def.body.position.x||0)/this.drawScale;v.position.y=(this.owner.y||this.def.body.position.y||0)/this.drawScale}else{v.position.x=(this.owner.x||0)/this.drawScale;v.position.y=(this.owner.y||0)/this.drawScale}this.owner.x=v.position.x;this.owner.y=v.position.y;this.body=this.world.CreateBody(v);if(!this.def.body.fixtureDefinition){this.def.body.fixtureDefinition={}}t=this.def.body.fixtureDefinition;for(var C=0;C<this.def.body.shapes.length;C++){y=this.def.body.shapes[C];if(!y.fixtureDefinition){y.fixtureDefinition={}}w=y.fixtureDefinition;if(typeof w.density!=="undefined"){s.density=w.density}else{if(t.density!=="undefined"){s.density=t.density}else{s.density=h}}if(typeof w.friction!=="undefined"){s.friction=w.friction}else{if(typeof t.friction!=="undefined"){s.friction=t.friction}else{s.friction=m}}if(typeof w.restitution!=="undefined"){s.restitution=w.restitution}else{if(typeof t.restitution!=="undefined"){s.friction=t.restitution}else{s.friction=f}}if(y.radius){s.shape=new p(y.radius/this.drawScale)}else{if(y.points){B=[];for(var A=0;A<y.points.length;A++){u=new o();u.Set(points[A].x/this.drawScale,points[A].y/this.drawScale);B[A]=u}s.shape=new j;s.shape.SetAsArray(vecs,vecs.length)}else{if(y.halfWidth&&y.halfHeight){s.shape=new j;s.shape.SetAsBox(y.halfWidth/this.drawScale,y.halfHeight/this.drawScale)}}}this.body.CreateFixture(s)}}},"handle-box2d":function(){var t=this.body.GetPosition();var s=this.body.GetAngle();this.owner.x=t.x*this.drawScale;this.owner.y=t.y*this.drawScale;this.owner.orientation=s}},methods:{destroy:function(){this.def=null;this.world=null}},publicMethods:{}})})();d.components["logic-fps-counter"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["handle-logic","time-elapsed"]);this.counter={text:""};this.times={};this.timeElapsed=false;this.ticks=i.ticks||30;this.count=this.ticks};var g=f.prototype;g["handle-logic"]=function(){if(!d.game.settings.debug&&this.owner.parent){this.owner.parent.removeEntity(this.owner)}if(this.timeElapsed){this.timeElapsed=false;this.count--;if(!this.count){this.count=this.ticks;var i=Math.floor(createjs.Ticker.getMeasuredFPS())+" FPS<br />";for(var h in this.times){i+="<br />"+h+": "+Math.round(this.times[h]/this.ticks)+"ms";this.times[h]=0}this.counter.text=i;this.owner.trigger("update-content",this.counter)}}};g["time-elapsed"]=function(h){if(h){if(h.name){if((h.name==="Engine Total")&&!this.timeElapsed){this.timeElapsed=true}if(!this.times[h.name]){this.times[h.name]=0}this.times[h.name]+=h.time}}};g.destroy=function(){this.counter=undefined;this.removeListeners(this.listeners)};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();d.components["render-gui"]=(function(){var f=function(i,k){this.owner=i;this.listeners=[];this.addListeners(["handle-render","handle-render-load"]);this.background=undefined;this.stage=undefined;var l={images:k.spriteSheet.images.slice(),frames:k.spriteSheet.frames,animations:k.spriteSheet.animations};for(var h=0;h<l.images.length;h++){l.images[h]=d.assets[l.images[h]]}var j=new createjs.SpriteSheet(l);this.background=new createjs.Sprite(j,0);this.currentAnimation="default";this.background.scaleX=this.owner.scaleX||1;this.background.scaleY=this.owner.scaleY||1;if(this.currentAnimation){this.background.gotoAndPlay(this.currentAnimation)}};var g=f.prototype;g["handle-render-load"]=function(h){this.stage=h.stage;this.stage.addChild(this.background);this.background.x=200;this.background.y=200;this.background.z=this.owner.z};g["handle-render"]=function(h){};g.destroy=function(){this.removeListeners(this.listeners)};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();d.components["render-counter"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["handle-render","handle-render-load","refresh-count"]);this.currentValue=0;this.targetValue=0;this.txt=new createjs.Text(this.currentValue.toString());this.txt.scaleX=i.scaleX||this.owner.scaleX||1;this.txt.scaleY=i.scaleY||this.owner.scaleY||1;this.txt.color=i.color||"#000"};var g=f.prototype;g["handle-render-load"]=function(h){this.txt.x=this.owner.x;this.txt.y=this.owner.y;this.txt.z=this.owner.z;this.txt.textAlign="center";this.txt.textBaseline="middle";h.stage.addChild(this.txt)};g["handle-render"]=function(){if(this.currentValue!=this.targetValue){if(this.currentValue<this.targetValue){this.currentValue++}if(this.currentValue>this.targetValue){this.currentValue--}this.txt.text=this.currentValue}};g["refresh-count"]=function(h){this.targetValue=h};g.destroy=function(){this.removeListeners(this.listeners)};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();d.components["render-clock"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["handle-render","handle-render-load","refresh-clock"]);this.stage=undefined;this.currentValue=0;this.targetValue=0;this.txt=new createjs.Text(this.currentValue.toString());this.txt.scaleX=i.scaleX||this.owner.scaleX||1;this.txt.scaleY=i.scaleY||this.owner.scaleY||1;this.txt.color=i.color||"#000"};var g=f.prototype;g["handle-render-load"]=function(h){this.stage=h.stage;this.txt.x=this.owner.x;this.txt.y=this.owner.y;this.txt.z=this.owner.z;this.txt.textAlign="center";this.txt.textBaseline="middle";this.stage.addChild(this.txt)};g["handle-render"]=function(){this.txt.text=Math.floor(this.time/1000).toString()+"sec."};g["refresh-clock"]=function(h){this.time=h.time};g.destroy=function(){this.stage.removeChild(this.txt);this.stage=undefined;this.txt=undefined;this.removeListeners(this.listeners)};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})();(function(){return d.createComponentClass({id:"logic-hero",constructor:function(f){var g=this.state=this.owner.state;g.swing=false;g.swingHit=false;this.teleportDestination=undefined;this.justTeleported=false},events:{"handle-logic":function(){},"portal-waiting":function(f){f.trigger("activate-portal")}}})})();d.components["logic-gui"]=(function(){var f=function(h,i){this.owner=h;this.listeners=[];this.addListeners(["load"])};var g=f.prototype;g.load=function(h){this.owner.trigger("logical-state",{state:"default"})};g.destroy=function(){this.removeListeners(this.listeners)};g.addListeners=function(i){for(var h in i){this.addListener(i[h])}};g.removeListeners=function(i){for(var h in i){this.removeListener(h,i[h])}};g.addListener=function(i,k){var h=this,j=k||function(m,l){h[i](m,l)};this.owner.bind(i,j);this.listeners[i]=j};g.removeListener=function(h,i){this.owner.unbind(h,i)};return f})()})();